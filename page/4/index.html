<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Be a better man!">
<meta property="og:type" content="website">
<meta property="og:title" content="小黄">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="小黄">
<meta property="og:description" content="Be a better man!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小黄">
<meta name="twitter:description" content="Be a better man!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>小黄</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黄</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">黄小黄的幸福生活！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/Java/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Java
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/一致性哈希算法及其Java实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/一致性哈希算法及其Java实现/" itemprop="url">一致性哈希及其Java实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Consistent-Hash/" itemprop="url" rel="index">
                    <span itemprop="name">Consistent Hash</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一致性哈希概念"><a href="#一致性哈希概念" class="headerlink" title="一致性哈希概念"></a>一致性哈希概念</h1><ul>
<li>维基百科的定义</li>
</ul>
<p>一致哈希 是一种特殊的哈希算法。在使用一致哈希算法后，哈希表槽位数（大小）的改变平均只需要对K/n 个关键字重新映射，其中K是关键字的数量，n是槽位数量。然而在传统的哈希表中，添加或删除一个槽位的几乎需要对所有关键字进行重新映射。</p>
<p>一致性哈希算法提出了动态变化的Cache环境中，判定哈希算法好坏的四个定义：</p>
<ol>
<li>平衡性：哈希的结果尽可能分布到所有的缓存中，充分利用缓存空间。</li>
<li>单调性：举例说吧，本来有ABC三个缓存，数据1存储在B中，现在添加了D缓存进去，则数据1只会分布在B或者D中，不会分配到AC中。</li>
<li>分散性：分散性是同一个数据被映射到不同的缓存中，需要避免</li>
<li>负载：一个缓冲区被多个用户映射为不同的内容，需要降低缓冲的负载。</li>
</ol>
<h1 id="传统哈希算法"><a href="#传统哈希算法" class="headerlink" title="传统哈希算法"></a>传统哈希算法</h1><p>针对分布式场景，假定有1000W个数据项，100个存储接待你，一个数据的存储位置为该数据的Hash值对服务器数量取余，这样可以将数据尽可能的分散到各个服务器上。</p>
<p>  <img src="/img/cons-Hash-1.png" alt="Alt text"></p>
<p>这种哈希方案的优点是每个节点的的数据量是相仿的，相对均衡，但是当在集群里面增加一台服务器，或者减少一台服务器的话，几乎所有的缓存都会失效，需要重新哈希。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by cdx0312</div><div class="line"> * 2018/4/18\</div><div class="line"> * 传统哈希方法</div><div class="line"> * 100000000个数据项，100个存储节点</div><div class="line"> */</div><div class="line">public class NormalHashMethod &#123;</div><div class="line">    //数据数</div><div class="line">    public static final int NUMBER_OF_DATA = 10000000;</div><div class="line">    //节点数</div><div class="line">    public static final int NUMBER_OF_NODE = 100;</div><div class="line">    //节点中存放的数据个数</div><div class="line">    private static int[] record = new int[NUMBER_OF_NODE];</div><div class="line"></div><div class="line">    //将节点放入对应的服务器中</div><div class="line">    public static void hashProcess() &#123;</div><div class="line">        for (int i = 0; i &lt; NUMBER_OF_DATA; i++) &#123;</div><div class="line">            int result = getHash(i+&quot;&quot;);</div><div class="line">            record[result%100]++;</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;平均节点中的数据量： &quot; + NUMBER_OF_DATA/NUMBER_OF_NODE);</div><div class="line">        System.out.println(&quot;最多的一个节点的数量： &quot; + getMax(record));</div><div class="line">        System.out.println(&quot;最少的一个节点的数量： &quot; + getMin(record));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //添加一个节点或者减少一个节点时，需要移动的节点数</div><div class="line">    public static void afterAddOrDeleteOneNode() &#123;</div><div class="line">        int count = 0;</div><div class="line">        int count1 = 0;</div><div class="line">        //对所有数据进行hash，对新的服务器数量取余</div><div class="line">        for (int i = 0; i &lt; NUMBER_OF_DATA; i++) &#123;</div><div class="line">            int result = getHash(i+&quot;&quot;);</div><div class="line">            if (result % NUMBER_OF_NODE != result % (NUMBER_OF_NODE + 1))</div><div class="line">                count++;</div><div class="line">            if (result % NUMBER_OF_NODE != result % (NUMBER_OF_NODE - 1))</div><div class="line">                count1++;</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;添加一个节点数据移动的数量： &quot; + count);</div><div class="line">        System.out.println(&quot;减少一个节点数据移动的数量： &quot; + count1);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //使用FNV1_32_HASH算法</div><div class="line">    private static int getHash(String str) &#123;</div><div class="line">        final int p = 16777619;</div><div class="line">        int hash = (int) 2166136261L;</div><div class="line">        for (int i = 0; i &lt; str.length(); i++)</div><div class="line">            hash = (hash ^ str.charAt(i)) * p;</div><div class="line">        hash += hash &lt;&lt; 13;</div><div class="line">        hash ^= hash &gt;&gt; 7;</div><div class="line">        hash += hash &lt;&lt; 3;</div><div class="line">        hash ^= hash &gt;&gt; 17;</div><div class="line">        hash += hash &lt;&lt; 5;</div><div class="line"></div><div class="line">        // 如果算出来的值为负数则取其绝对值</div><div class="line">        if (hash &lt; 0)</div><div class="line">            hash = Math.abs(hash);</div><div class="line">        return hash;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static int getMax(int[] arr) &#123;</div><div class="line">        int max = arr[0];</div><div class="line">        for (int x = 1; x &lt; arr.length; x++) &#123;</div><div class="line">            if (arr[x] &gt; max)</div><div class="line">                max = arr[x];</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        return max;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static int getMin(int[] arr) &#123;</div><div class="line">        int min = arr[0];</div><div class="line">        for (int x = 1; x &lt; arr.length; x++) &#123;</div><div class="line">            if (arr[x] &lt; min)</div><div class="line">                min = arr[x];</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        return min;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        hashProcess();</div><div class="line">        afterAddOrDeleteOneNode();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的例子中是用普通哈希方法来做的，输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">平均节点中的数据量： 100000</div><div class="line">最多的一个节点的数量： 100653</div><div class="line">最少的一个节点的数量： 99160</div><div class="line">添加一个节点数据移动的数量： 9900492</div><div class="line">减少一个节点数据移动的数量： 9899656</div></pre></td></tr></table></figure>
<p>可以看出，一共1000万个数据，添加或者减少一个节点，进行重新哈希，则990万个数据需要改变存储位置。也就是说990万个缓存不能命中，实际场景中这明显是不能接受的，因此提出了一致性哈希来解决这个问题。</p>
<h1 id="一致性哈希"><a href="#一致性哈希" class="headerlink" title="一致性哈希"></a>一致性哈希</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul>
<li>唤醒hash空间：按照常用的hash算法来将对应的key哈希到一个具有2^32次方个桶的空间中，也就是0-2^32-1的数字空间中，将其收尾相连，形成一个环空间。</li>
</ul>
<p>Hash(object1) = key1；<br>Hash(object2) = key2；<br>Hash(object3) = key3；<br>Hash(object4) = key4；</p>
<p>  <img src="/img/cons-Hash-2.png" alt="Alt text"></p>
<ul>
<li><p>将数据通过一定的哈希算法处理后映射到环上</p>
<p><img src="/img/cons-Hash-3.png" alt="Alt text"></p>
</li>
<li><p>将服务器通过哈希算法映射到环上,和数据的哈希算法是一样的，环上的数据，顺时针遇到的第一个服务器就是该数据的存储位置。假定有三个服务器节点。</p>
</li>
</ul>
<p>Hash(NODE1) = KEY1;<br>Hash(NODE2) = KEY2;<br>Hash(NODE3) = KEY3;</p>
<p>  <img src="/img/cons-Hash-4.png" alt="Alt text"></p>
<p>由于哈希环是不会变更的，因此一个数据可以快速的知道他的真正的存储位置。</p>
<h2 id="服务器的删除与添加"><a href="#服务器的删除与添加" class="headerlink" title="服务器的删除与添加"></a>服务器的删除与添加</h2><p>不同于传统哈希求余方法，一致性哈希算法在增加或者删除服务器节点是，需要换位置的节点很少，性能很高。</p>
<ol>
<li><p>删除服务器节点,如果NODE2出现故障，则从集群里面溢出，那么object3会迁移到Node3中，其他数据的位置不变。</p>
<p><img src="/img/cons-Hash-5.png" alt="Alt text"></p>
</li>
<li><p>添加服务器节点，向集群里面添加新的 首先将其映射到环中，通过顺时针迁移的规则，object2会迁移到NODE4中，其他对象不会发生改变。数据迁移的数量很小，很适合分布式集群。</p>
<p><img src="/img/cons-Hash-6.png" alt="Alt text"></p>
</li>
<li><p>java示范</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line">import java.util.Objects;</div><div class="line">import java.util.SortedMap;</div><div class="line">import java.util.TreeMap;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by cdx0312</div><div class="line"> * 2018/4/18\</div><div class="line"> * 一致性哈希方法</div><div class="line"> * 100000000个数据项，100个存储节点</div><div class="line"> */</div><div class="line">public class ConsistentHashMethod &#123;</div><div class="line">    public static final int NUMBER_OF_DATA = 10000000;</div><div class="line">    public static final int NUMBER_OF_NODE = 100;</div><div class="line">    //记录服务器要添加的环上的位置，默认为均匀分布的</div><div class="line">    private static int[] servers = new int[NUMBER_OF_NODE];</div><div class="line">    //key-服务器的哈希值，value表示服务器的位置</div><div class="line">    private static SortedMap&lt;Integer, Integer&gt; sortedMap = new TreeMap&lt;&gt;();</div><div class="line">    //记录每个服务器节点放置的数据数</div><div class="line">    private static int[] record = new int[NUMBER_OF_NODE];</div><div class="line"></div><div class="line">    //初始化，将服务器放入环中</div><div class="line">    public static void init() &#123;</div><div class="line">        int div = (Integer.MAX_VALUE) / NUMBER_OF_NODE;</div><div class="line">        for (int i = 0; i &lt; 100; i++) &#123;</div><div class="line">            servers[i] = i * div;</div><div class="line">        &#125;</div><div class="line">        //将所有服务器放入SortedMap中</div><div class="line">        for (int i = 0; i &lt; servers.length; i++) &#123;</div><div class="line">            int hash = getHash(servers[i] + &quot;&quot;);</div><div class="line">            sortedMap.put(hash, servers[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void hashProcess() &#123;</div><div class="line">        int div = 21474836;</div><div class="line">        for (int i = 0; i &lt; NUMBER_OF_DATA; i++) &#123;</div><div class="line">            int hash = getHash(i+&quot;&quot;);</div><div class="line">            //得到大于该Hash值的所有Map</div><div class="line">            SortedMap&lt;Integer, Integer&gt; subMap = sortedMap.tailMap(hash);</div><div class="line">            //将节点放入对应的服务器中</div><div class="line">            if (subMap.isEmpty()) &#123;</div><div class="line">                Integer index = sortedMap.firstKey();</div><div class="line">                record[sortedMap.get(index) / div]++;</div><div class="line">            &#125; else &#123;</div><div class="line">                Integer index = subMap.firstKey();</div><div class="line">                record[sortedMap.get(index)/div]++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;平均节点中的数据量： &quot; + NUMBER_OF_DATA/NUMBER_OF_NODE);</div><div class="line">        System.out.println(&quot;最多的一个节点的数量： &quot; + getMax(record));</div><div class="line">        System.out.println(&quot;最少的一个节点的数量： &quot; + getMin(record));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void afterAddOneNode() &#123;</div><div class="line">        int count = 0;</div><div class="line">        int div1 = (Integer.MAX_VALUE) / NUMBER_OF_NODE;</div><div class="line">        SortedMap&lt;Integer, Integer&gt; addNode = new TreeMap&lt;&gt;(sortedMap);</div><div class="line">        addNode.put(getHash(&quot;2333&quot;), 2333);</div><div class="line">        for (int i = 0; i &lt; NUMBER_OF_DATA; i++) &#123;</div><div class="line">            int hash = getHash(i + &quot;&quot;);</div><div class="line">            SortedMap&lt;Integer, Integer&gt; sub = sortedMap.tailMap(hash);</div><div class="line">            SortedMap&lt;Integer, Integer&gt; sub1 = addNode.tailMap(hash);</div><div class="line">            if (sub.isEmpty() &amp;&amp; sub1.isEmpty() ) &#123;</div><div class="line">                count++;</div><div class="line">            &#125;</div><div class="line">            if (!sub.isEmpty() &amp;&amp; !sub1.isEmpty() &amp;&amp; !Objects.equals(sub.firstKey(), sub1.firstKey())) &#123;</div><div class="line">                count++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;添加一个节点数据移动的数量： &quot; + count);</div><div class="line">    &#125;</div><div class="line">    //使用FNV1_32_HASH算法</div><div class="line">    private static int getHash(String str) &#123;</div><div class="line">        final int p = 16777619;</div><div class="line">        int hash = (int) 2166136261L;</div><div class="line">        for (int i = 0; i &lt; str.length(); i++)</div><div class="line">            hash = (hash ^ str.charAt(i)) * p;</div><div class="line">        hash += hash &lt;&lt; 13;</div><div class="line">        hash ^= hash &gt;&gt; 7;</div><div class="line">        hash += hash &lt;&lt; 3;</div><div class="line">        hash ^= hash &gt;&gt; 17;</div><div class="line">        hash += hash &lt;&lt; 5;</div><div class="line"></div><div class="line">        // 如果算出来的值为负数则取其绝对值</div><div class="line">        if (hash &lt; 0)</div><div class="line">            hash = Math.abs(hash);</div><div class="line">        return hash;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static int getMax(int[] arr) &#123;</div><div class="line">        int max = arr[0];</div><div class="line">        for (int x = 1; x &lt; arr.length; x++) &#123;</div><div class="line">            if (arr[x] &gt; max)</div><div class="line">                max = arr[x];</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        return max;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static int getMin(int[] arr) &#123;</div><div class="line">        int min = arr[0];</div><div class="line">        for (int x = 1; x &lt; arr.length; x++) &#123;</div><div class="line">            if (arr[x] &lt; min)</div><div class="line">                min = arr[x];</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        return min;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        init();</div><div class="line">        hashProcess();</div><div class="line">        afterAddOneNode();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">平均节点中的数据量： 100000</div><div class="line">最多的一个节点的数量： 479784</div><div class="line">最少的一个节点的数量： 1367</div><div class="line">添加一个节点数据移动的数量： 138303</div></pre></td></tr></table></figure>
<p>可以看出添加一个节点之后，要修改的数据只有十万个，效率很高。</p>
<h2 id="虚拟节点"><a href="#虚拟节点" class="headerlink" title="虚拟节点"></a>虚拟节点</h2><p>上面可以明确看出，一致性哈希算法满足了单调性和负载均衡的特性以及一般hash算法的分散性，平衡性的体现通过虚拟节点来实现。哈希算法是不保证平衡的，如值部署了NODE1和NODE3的情况，object1存储到NODE1中，其他的都存到NODE3中，这样就非常不平衡了。因此引入了虚拟节点。</p>
<ul>
<li><p>虚拟节点：实际上是及其在哈希空间中的复制品，一个实际的节点对应了若干个虚拟节点，这样对应个数也成为复制个数，虚拟节点在哈希空间中以哈希值排列。新建两个复制节点之后可以看到节点分配变得很均衡。</p>
<p><img src="/img/cons-Hash-7.png" alt="Alt text"></p>
</li>
</ul>
<p>其中涉及了哈希虚拟节点到实际节点的转换，其实只是一个简单的映射：</p>
<p>  <img src="/img/cons-Hash-8.png" alt="Alt text"></p>
<p>而在实际的场景中，可以通过对真实节点进行编号来生成相应的虚拟节点。如真实节点的IP为192.168.10.11，则虚拟节点可以设置为192.168.10.11#1,192.168.10.11#2。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/Zookeeper分布式专题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/Zookeeper分布式专题/" itemprop="url">Zookeeper分布式专题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式/" itemprop="url" rel="index">
                    <span itemprop="name">分布式</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式/zookeeper/" itemprop="url" rel="index">
                    <span itemprop="name">zookeeper</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="zookeeper简介"><a href="#zookeeper简介" class="headerlink" title="zookeeper简介"></a>zookeeper简介</h1><ul>
<li>中间件，提供协调服务</li>
<li>作用于分布式系统，发挥其优势，可以为大数据服务</li>
<li><p>支持java，提供java和c语言的客户端API</p>
</li>
<li><p>特性：</p>
<ol>
<li>一致性：数据一致性，数据按照顺序分批入库</li>
<li>原子性：事物要么成功，要么失败，不会局部化执行</li>
<li>单一视图：客户端连接集群中的任一个zk节点，数据都是一致的</li>
<li>可靠性：每次对zk的操作状态都会保存在服务端</li>
<li>实时性：客户端可以读取到zk服务端的最新数据</li>
</ol>
</li>
</ul>
<h2 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h2><ul>
<li>多个计算机组成一个整体，一个整体一致对外并且处理同一请求</li>
<li>内部的每台计算机都可以通信，restful/rpc</li>
<li>客户端到服务端的一次请求到响应结束会经历多台计算机</li>
</ul>
<h1 id="zookeeper的安装"><a href="#zookeeper的安装" class="headerlink" title="zookeeper的安装"></a>zookeeper的安装</h1><h2 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h2><ol>
<li>下载linux的jdk1.8,上传服务器</li>
<li>解压缩jdk，配置jdk</li>
<li><p>测试：java -version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ubuntu@VM-0-8-ubuntu:~$ java -version</div><div class="line">java version &quot;1.8.0_181&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="zookeeper基本数据模型"><a href="#zookeeper基本数据模型" class="headerlink" title="zookeeper基本数据模型"></a>zookeeper基本数据模型</h1><ul>
<li>zk的数据模型可以理解为linux的目录文件</li>
<li>每一个节点称为znode，可以有子节点，也可以有数据</li>
<li>每一个节点分为临时节点和永久节点，临时节点在客户端断开后消失</li>
<li>每一个zk节点都有各自的版本号，可以通过命令行显示节点信息</li>
<li>当节点的数据发生变化，该节点的版本号就会累加</li>
<li>删除修改过的节点，版本号不匹配则会报错</li>
<li>每个zk节点存储的数据不宜过大，几k即可</li>
<li>节点可以设置权限acl，可以通过权限来限制用户的访问</li>
</ul>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><ul>
<li>客户端连接</li>
<li>查看znode</li>
<li>关闭连接</li>
</ul>
<h2 id="zk的作用"><a href="#zk的作用" class="headerlink" title="zk的作用"></a>zk的作用</h2><ul>
<li>master节点选举，主节点挂了之后，从节点会接收工作，并且保证这个节点时唯一的，也就是所谓的首脑模式，从而保证集群的高可用。</li>
<li>统一配置文件管理，只需要一台服务器，可以把相同的配置文件同步更新到其他的服务器，在云计算中使用的很多。</li>
<li>发布与订阅，类似于MQ，dubbo发布者将数据存在znode，订阅者会读取这个数据。</li>
<li>提供分布式锁，用于分布式环境中不同进程之间争夺资源，类似于多线程中的锁。</li>
<li>集群管理，保证集群中数据的强一致性。</li>
</ul>
<h1 id="zk基本特性"><a href="#zk基本特性" class="headerlink" title="zk基本特性"></a>zk基本特性</h1><ul>
<li><p>./zkCli.sh打开客户端</p>
</li>
<li><p>ls</p>
</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017195401356.png" alt></p>
<ul>
<li>ls2</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017195429318.png" alt></p>
<ul>
<li>get</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017195553887.png" alt></p>
<ul>
<li>stat</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017195526564.png" alt></p>
<p>参数信息：</p>
<ul>
<li>cZid：节点id</li>
<li>ctime：创建时间</li>
<li>mZid：修改节点的id</li>
<li>mTime</li>
<li>pZxid：子节点id</li>
<li>cversion：子节点version</li>
<li>dataVersion：当前节点数据的版本号</li>
<li>aclVersion：权限版本号</li>
<li>ephemeralOwner：</li>
<li>dataLength：</li>
<li>numChildren：子节点的个数</li>
</ul>
<h2 id="session的基本原理"><a href="#session的基本原理" class="headerlink" title="session的基本原理"></a>session的基本原理</h2><ul>
<li>客户端和服务端之间的连接存在session</li>
<li>每个session都可以设置一个超时时间</li>
<li>心跳结束，session就过期</li>
<li>session过期，临时节点znode会被抛弃</li>
<li>心跳机制：客户端向服务端的ping包请求</li>
</ul>
<h2 id="create命令"><a href="#create命令" class="headerlink" title="create命令"></a>create命令</h2><ul>
<li>创建持久化节点</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017200354365.png" alt></p>
<ul>
<li>创建临时节点</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017200449517.png" alt></p>
<ul>
<li>创建顺序节点</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017200805341.png" alt></p>
<h2 id="set命令"><a href="#set命令" class="headerlink" title="set命令"></a>set命令</h2><p><img src="assets/markdown-img-paste-20181017201052567.png" alt></p>
<ul>
<li>根据版本号实现乐观锁</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017201144595.png" alt></p>
<h2 id="delete命令"><a href="#delete命令" class="headerlink" title="delete命令"></a>delete命令</h2><ul>
<li>不设置版本号</li>
</ul>
<p><img src="assets/markdown-img-paste-2018101720133103.png" alt></p>
<ul>
<li>设置版本号需要版本号匹配才可以删除</li>
</ul>
<p><img src="assets/markdown-img-paste-20181017201438164.png" alt></p>
<h2 id="watcher机制"><a href="#watcher机制" class="headerlink" title="watcher机制"></a>watcher机制</h2><ul>
<li>针对每一个节点的操作，都会有一个监督者，也就是watcher</li>
<li>当监控的某一个对象（znode）发生了变化，则出发watcher事件</li>
<li>zk中的watcher是一次性的，触发后就会被立即销毁</li>
<li>父节点，子节点，增删改查都能够触发其watcher</li>
<li>针对不同类型的操作，触发的watcher事件也是不同的<ul>
<li>子节点创建事件</li>
<li>子节点删除事件</li>
<li>子节点数据变化事件</li>
</ul>
</li>
</ul>
<h2 id="watcher命令行"><a href="#watcher命令行" class="headerlink" title="watcher命令行"></a>watcher命令行</h2><ul>
<li><p>watcher事件类型</p>
<ul>
<li>创建父节点触发：NodeCreated<br><img src="assets/markdown-img-paste-20181017202244131.png" alt></li>
<li>修改父节点数据触发：NodeDataChanged<br><img src="assets/markdown-img-paste-20181017202411972.png" alt></li>
<li>删除节点触发：NodeDeleted<br><img src="assets/markdown-img-paste-20181017202630988.png" alt></li>
<li>ls为父节点设置watcher，创建子节点触发：NodeChildrenChanged<br><img src="assets/markdown-img-paste-20181017202829923.png" alt></li>
<li>ls为父节点设置watcher，删除子节点触发：NodeChildrenChanged<br><img src="assets/markdown-img-paste-20181017202933755.png" alt></li>
<li>ls为父节点设置watcher，修改子节点不触发任何事件<br><img src="assets/markdown-img-paste-20181017203123310.png" alt></li>
</ul>
</li>
<li><p>watcher使用场景</p>
<ul>
<li>统一资源配置</li>
</ul>
</li>
</ul>
<h2 id="ACL-Acess-Control-Lists-权限控制"><a href="#ACL-Acess-Control-Lists-权限控制" class="headerlink" title="ACL(Acess Control Lists)权限控制"></a>ACL(Acess Control Lists)权限控制</h2><ul>
<li>针对节点可以设置相关读写等权限，目的为了保障数据安全性</li>
<li>权限permissions可以指定不同的权限范围以及角色</li>
</ul>
<h3 id="ACL命令行"><a href="#ACL命令行" class="headerlink" title="ACL命令行"></a>ACL命令行</h3><ul>
<li>getAcl：获取某个节点的acl权限信息</li>
<li>setAcl：设置某个节点的acl权限信息</li>
<li>addauth：输入认证权限信息，注册时输入明文密码登录，但是在zk的系统中，密码以加密形式存在。</li>
<li>zk的acl通过【scheme:id:permissions】来构成权限列表<ul>
<li>scheme：代表采用的某种权限机制<ul>
<li>world:world下只有一个id，也就是只有一个用户anyone，任何人都可以访问该节点</li>
<li>auth:代表认证登录，需要注册用户有权限就可以，明文密码登录</li>
<li>digest:需要对密码加密才能访问</li>
<li>ip:当设置ip为指定的ip地址，此时限制ip进行访问</li>
<li>super：代表超级管理员，拥有所有的权限</li>
</ul>
</li>
<li>id：代表允许访问的用户</li>
<li>permissions：权限组合字符串<ul>
<li>crdwa：权限字符串</li>
<li>create：创建子节点</li>
<li>read：获取节点、子节点</li>
<li>write：设置节点数据</li>
<li>delete：删除子节点</li>
<li>admin：设置权限</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>world:anyone:cdrwa</li>
</ol>
<p><img src="assets/markdown-img-paste-20181018120809334.png" alt></p>
<p><img src="assets/markdown-img-paste-2018101812272445.png" alt></p>
<ol>
<li>auth:user:pwd:cdrwa</li>
<li>digest:user:BASE64(SHA1(pwd)):cdrwa</li>
<li>addauth digest user:pwd</li>
</ol>
<p><img src="assets/markdown-img-paste-20181018130237413.png" alt></p>
<h1 id="zk集群"><a href="#zk集群" class="headerlink" title="zk集群"></a>zk集群</h1><h2 id="集群搭建的注意点"><a href="#集群搭建的注意点" class="headerlink" title="集群搭建的注意点"></a>集群搭建的注意点</h2><ul>
<li>配置文件myid 1/2/3对应server.1.2.3</li>
<li>通过./zkCli.sh -server [ip]:[port]检测集群是否配置成功</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/struts2总结 五--interceptor拦截器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/struts2总结 五--interceptor拦截器/" itemprop="url">struts2总结（五）--interceptor</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Struts2/" itemprop="url" rel="index">
                    <span itemprop="name">Struts2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="8-拦截器-interceptor"><a href="#8-拦截器-interceptor" class="headerlink" title="8 拦截器(interceptor)"></a>8 拦截器(interceptor)</h2><h3 id="8-1-Struts架构图"><a href="#8-1-Struts架构图" class="headerlink" title="8.1 Struts架构图"></a>8.1 Struts架构图</h3><p>  <img src="/img/struts_arch.jpg" alt="Alt text"></p>
<h3 id="8-2-Struts执行过程分析"><a href="#8-2-Struts执行过程分析" class="headerlink" title="8.2 Struts执行过程分析"></a>8.2 Struts执行过程分析</h3><p><img src="/img/struts.png" alt="Alt text"></p>
<blockquote>
<ul>
<li>拦截器：拦截器是struts2框架中提供的一种Java类</li>
<li>作用：<pre><code>* 可以拦截访问Action的请求
* 给这个Action加上新的丰富功能（上传，参数自动接收，类型自动转换等）需要配置之后，指明哪一个拦截器去拦截哪一个Action或者哪一些Action，这个拦截器才会去拦截我们的Action。
</code></pre></li>
<li>拦截器工作原理：<pre><code>1. 有一个拦截器的类（框架的或者自定义的）
2. 在配置文件中把这个拦截器类配置出来
3. 指明这个拦截器要拦截哪一个或者哪一些action
4. 客户端发送一个请求访问一个被拦截器拦截的Action
5. 这个请求首先会被struts2 的filter所拦截，filter会检查这个请求是不是请求的Action，如果是，会再检查这个Action有没有被定义的拦截器所拦截，如果有，那么把这个请求交给拦截器去处理
</code></pre></li>
</ul>
</blockquote>
<h3 id="8-3-Interceptor拦截器过程模拟"><a href="#8-3-Interceptor拦截器过程模拟" class="headerlink" title="8.3  Interceptor拦截器过程模拟"></a>8.3  Interceptor拦截器过程模拟</h3><ul>
<li>定义一个Interceptor接口，有一个intercept方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface Inteceptor &#123;</div><div class="line">    public void intercept(ActionInvocation actionInvocation);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>创建两个interceptor实现了interceptor接口：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class FirstInterceptor implements Inteceptor&#123;</div><div class="line">    @Override</div><div class="line">    public void intercept(ActionInvocation actionInvocation) &#123;</div><div class="line">        System.out.println(1);</div><div class="line">        actionInvocation.invoke();</div><div class="line">        System.out.println(-1);</div><div class="line">      &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class SecondInterceptor implements Inteceptor&#123;</div><div class="line">    @Override</div><div class="line">    public void intercept(ActionInvocation actionInvocation) &#123;</div><div class="line">        System.out.println(2);</div><div class="line">        actionInvocation.invoke();</div><div class="line">        System.out.println(-2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>定义一个Action</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class SecondInterceptor implements Inteceptor&#123;</div><div class="line">    @Override</div><div class="line">    public void intercept(ActionInvocation actionInvocation) &#123;</div><div class="line">        System.out.println(2);</div><div class="line">        actionInvocation.invoke();</div><div class="line">        System.out.println(-2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>定义ActionInvocation</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">public class ActionInvocation &#123;</div><div class="line">    List&lt;Inteceptor&gt; inteceptors = new ArrayList&lt;&gt;();</div><div class="line">    int index = -1;</div><div class="line">    Action a = new Action();</div><div class="line"></div><div class="line">    public ActionInvocation() &#123;</div><div class="line">        this.inteceptors.add(new FirstInterceptor());</div><div class="line">        this.inteceptors.add(new SecondInterceptor());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void invoke() &#123;</div><div class="line">        index++;</div><div class="line">        if (index &gt;= this.inteceptors.size()) &#123;</div><div class="line">            a.execute();</div><div class="line">        &#125; else &#123;</div><div class="line">            this.inteceptors.get(index).intercept(this);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>执行main文件:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class Main &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        new ActionInvocation().invoke();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>运行结果为：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">execute</div><div class="line">-2</div><div class="line">-1</div></pre></td></tr></table></figure>
<blockquote>
<p>从而执行顺序为，首先main函数，创建ActionInvocation对象，初始化的时候讲两个Inteceptor加到interceptors这个列表中，调用其invoke()方法，当还有interceptor没有访问时，调用第一个interceptor的intercept方法，输出1，并调用ActionInvocation的invoke方法，此时会调用第二个Inteceptor的intercept方法，输出2，并调用ActionInvocation的invoke方法，此时不存在拦截器，执行Action输出execute，后面依次输出-2 -1， 完成这个模拟过程！</p>
</blockquote>
<h3 id="8-4-定义自己的拦截器"><a href="#8-4-定义自己的拦截器" class="headerlink" title="8.4 定义自己的拦截器"></a>8.4 定义自己的拦截器</h3><ul>
<li><p>struts2框架已经写好了很多个拦截器，同时也把这些拦截器配置在配置文件里面struts-default.xml中，除此之外，我们可以写自己的拦截器</p>
</li>
<li><p>首先实现一个Interceptor接口：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class MyInterceptor implements Interceptor &#123;</div><div class="line"></div><div class="line">	public void destroy() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void init() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public String intercept(ActionInvocation invocation) throws Exception &#123;</div><div class="line">		long start = System.currentTimeMillis();</div><div class="line">		String r = invocation.invoke();</div><div class="line">		long end = System.currentTimeMillis();</div><div class="line">		System.out.println(&quot;action time = &quot; + (end - start));</div><div class="line">		return r;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>然后在struts.xml文件中配置出这个拦截器：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;package name=&quot;test&quot; namespace=&quot;/&quot; extends=&quot;struts-default&quot;&gt;</div><div class="line">		&lt;interceptors&gt;</div><div class="line">			&lt;interceptor name=&quot;my&quot; class=&quot;com.interceptor.MyInterceptor&quot;&gt;&lt;/interceptor&gt;</div><div class="line">		&lt;/interceptors&gt;</div><div class="line"></div><div class="line">		&lt;action name=&quot;test&quot; class=&quot;com.action.TestAction&quot;&gt;</div><div class="line">			&lt;result&gt;/test.jsp&lt;/result&gt;</div><div class="line">			&lt;interceptor-ref name=&quot;my&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">			&lt;interceptor-ref name=&quot;defaultStack&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">		&lt;/action&gt;</div><div class="line"></div><div class="line">	&lt;/package&gt;</div></pre></td></tr></table></figure>
<h3 id="8-5-拦截器栈"><a href="#8-5-拦截器栈" class="headerlink" title="8.5 拦截器栈"></a>8.5 拦截器栈</h3><p>当一个Action需要被多个拦截器拦截的时候，正常情况下我们需要在这个Action中去引用要使用的多个拦截器，但是我们可以使用一个拦截器栈去包含那几个拦截器，然后直接在Action中引用这个拦截器栈就可以。</p>
<ul>
<li>一个拦截器栈可以包含多个拦截器</li>
<li>一个拦截器栈还可以包含其他拦截器栈</li>
<li>定义拦截器栈都要在<interceptors>标签中</interceptors></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;interceptors&gt;</div><div class="line">   &lt;interceptor name=&quot;myInterceptor&quot; class=&quot;com.interceptor.MyInterceptor&quot;&gt;&lt;/interceptor&gt;</div><div class="line">   &lt;interceptor-stack name=&quot;myStack&quot;&gt;</div><div class="line">   &lt;!-- 这是我们自己定义的一个拦截器 --&gt;</div><div class="line">      &lt;interceptor-ref name=&quot;myInterceptor&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">     &lt;!-- 这是struts-default.xml文件中定义的一个拦截器 --&gt;</div><div class="line">      &lt;interceptor-ref name=&quot;params&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">     &lt;!-- 这是struts-default.xml文件中定义的一个拦截器栈 --&gt;</div><div class="line">    &lt;interceptor-ref name=&quot;basicStack&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">   &lt;/interceptor-stack&gt;</div><div class="line">  &lt;/interceptors&gt;</div></pre></td></tr></table></figure>
<h3 id="8-6-默认拦截器栈-拦截器"><a href="#8-6-默认拦截器栈-拦截器" class="headerlink" title="8.6 默认拦截器栈/拦截器"></a>8.6 默认拦截器栈/拦截器</h3><p>在一个package中，我们可以把一个拦截器或者拦截器栈的声明为一个默认的拦截器/拦截器栈。以后这个package中所有的Action都会被这个默认的拦截器/拦截器栈所拦截</p>
<ul>
<li>我们写的任何Action都会被一个叫做defaultStack的拦截器栈所拦截，这个拦截器栈包含了十几个拦截器，这些拦截器给我们的Action提供了很多丰富的功能，因为我们写的所有的package都是直接或者间接继承了struts-default.xml文件中的一个名字叫struts-default的package， struts-default包中又把名字叫做defaultStack的拦截器栈配置成了一个默认的拦截器栈，我们的package继承了这个，所有的Action都会被defaultStack所拦截。</li>
<li>但是如果我们指明了一个Action被我们所写的一个拦截器/拦截器栈所拦截，name这个Action就不会被defaultStack拦截了，所以我们需要在Action中主动的在声明这个Action被defaultStack所拦截，或者把defaultStack加入到我们自己定义的拦截器栈里面。</li>
<li>也可以专门定义一个package专门定义拦截器，拦截器栈，其他package继承这个拦截器栈package：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 在这个package中,我们只定义拦截器/拦截器栈 --&gt;</div><div class="line">    &lt;package name=&quot;MyInter&quot; extends=&quot;struts-default&quot; namespace=&quot;/&quot;&gt;</div><div class="line"></div><div class="line">    &lt;interceptors&gt;</div><div class="line">        &lt;interceptor name=&quot;myInterceptor&quot; class=&quot;com.briup.web.interceptor.MyInterceptor&quot;&gt;&lt;/interceptor&gt;</div><div class="line">        &lt;interceptor-stack name=&quot;myStack&quot;&gt;</div><div class="line">            &lt;interceptor-ref name=&quot;myInterceptor&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">            &lt;!-- 这是struts-default.xml文件中定义的一个拦截器栈 --&gt;</div><div class="line">            &lt;interceptor-ref name=&quot;defaultStack&quot;&gt;&lt;/interceptor-ref&gt;</div><div class="line">        &lt;/interceptor-stack&gt;</div><div class="line">    &lt;/interceptors&gt;</div><div class="line"></div><div class="line">    &lt;!-- 声明默认拦截器/拦截器栈 --&gt;</div><div class="line">    &lt;!-- 当前包中所有的action都会被这个myStack所拦截器 --&gt;</div><div class="line">    &lt;!-- 继承了当前包的其他包里面的所有action也会被这个myStack所拦截器 --&gt;</div><div class="line">    &lt;default-interceptor-ref name=&quot;myStack&quot;&gt;&lt;/default-interceptor-ref&gt;</div><div class="line"></div><div class="line">    &lt;/package&gt;</div></pre></td></tr></table></figure>
<h3 id="8-7-类型转换"><a href="#8-7-类型转换" class="headerlink" title="8.7 类型转换"></a>8.7 类型转换</h3><p>类型转换：解析HTTP请求参数，将HTTP请求参数赋值给Action属性，当其类型不一致时进行的类型转换操作。struts2完成了String和基本类型的类型转换，只要Action属性有get set 方法。同时其还支持自定义的类型转换。</p>
<p>struts2类型转换时通过Params拦截器进行转换的；如果转换失败，则conversionError拦截器拦截该异常，并封装到fieldError中，放入ActionContext中。</p>
<h4 id="8-7-1-基础类型转换："><a href="#8-7-1-基础类型转换：" class="headerlink" title="8.7.1 基础类型转换："></a>8.7.1 基础类型转换：</h4><p>testAction：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">public class TestAction extends ActionSupport&#123;</div><div class="line">    private String name;</div><div class="line">    private int age;</div><div class="line">    private Date d;</div><div class="line">    Set&lt;String&gt; interests;</div><div class="line">    Map&lt;String, String&gt; users;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getAge() &#123;</div><div class="line">        return age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setAge(int age) &#123;</div><div class="line">        this.age = age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Date getD() &#123;</div><div class="line">        return d;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setD(Date d) &#123;</div><div class="line">        this.d = d;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Set&lt;String&gt; getInterests() &#123;</div><div class="line">        return interests;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setInterests(Set&lt;String&gt; interests) &#123;</div><div class="line">        this.interests = interests;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Map&lt;String, String&gt; getUsers() &#123;</div><div class="line">        return users;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setUsers(Map&lt;String, String&gt; users) &#123;</div><div class="line">        this.users = users;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        return super.execute();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>test.jsp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">name:&lt;s:property value=&quot;name&quot;/&gt;&lt;br/&gt;</div><div class="line">age:&lt;s:property value=&quot;age&quot;/&gt;&lt;br/&gt;</div><div class="line">date:&lt;s:property value=&quot;d&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;s:date name=&quot;d&quot; format=&quot;yyyy/MM/dd HH:mm:ss&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;s:property value=&quot;interests&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;s:property value=&quot;users&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<h4 id="8-7-2自定义类型转换"><a href="#8-7-2自定义类型转换" class="headerlink" title="8.7.2自定义类型转换"></a>8.7.2自定义类型转换</h4><p>自定义类型转换器方法:</p>
<h5 id="继承DefaultTypeConverter，重写convertValue方法，这个方法的功能是完成双向转换-Sting数组转换到Action属性。函数模板为："><a href="#继承DefaultTypeConverter，重写convertValue方法，这个方法的功能是完成双向转换-Sting数组转换到Action属性。函数模板为：" class="headerlink" title="继承DefaultTypeConverter，重写convertValue方法，这个方法的功能是完成双向转换,Sting数组转换到Action属性。函数模板为："></a>继承DefaultTypeConverter，重写convertValue方法，这个方法的功能是完成双向转换,Sting数组转换到Action属性。函数模板为：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class MyPointConverter extends DefaultTypeConverter&#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public Object convertValue(Object value, Class toType) &#123;</div><div class="line">		if(toType == Point.class) &#123;</div><div class="line">			Point p = new Point();</div><div class="line">			String[] strs = (String[])value;</div><div class="line">			String[] xy = strs[0].split(&quot;,&quot;);</div><div class="line">			p.x = Integer.parseInt(xy[0]);</div><div class="line">			p.y = Integer.parseInt(xy[1]);</div><div class="line">			return p;</div><div class="line">		&#125;</div><div class="line">		if(toType == String.class) &#123;</div><div class="line">			return value.toString();</div><div class="line">		&#125;</div><div class="line">		return super.convertValue(value, toType);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="继承StrutsTypeConverter"><a href="#继承StrutsTypeConverter" class="headerlink" title="继承StrutsTypeConverter"></a>继承StrutsTypeConverter</h5><ul>
<li>StrutsTypeConverter是DefaultTypeConverter的子类。在两个方向的类型转换上分别实现：</li>
</ul>
<p>MyPointerConverter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class MyPointConverter extends StrutsTypeConverter&#123;</div><div class="line">    @Override</div><div class="line">    public Object convertFromString(Map map, String[] strings, Class aClass) &#123;</div><div class="line">        Point point = new Point();</div><div class="line">        String[] strings1 = (String[])strings;</div><div class="line">        String[] xy = strings1[0].split(&quot;,&quot;);</div><div class="line">        point.x = Integer.parseInt(xy[0]);</div><div class="line">        point.y = Integer.parseInt(xy[1]);</div><div class="line">        return point;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String convertToString(Map map, Object o) &#123;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>TestAction:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">public class TestAction extends ActionSupport&#123;</div><div class="line">    Point p;</div><div class="line">    List&lt;Point&gt; ps;</div><div class="line">    Map&lt;String, Point&gt; points;</div><div class="line"></div><div class="line">    public Point getP() &#123;</div><div class="line">        return p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setP(Point p) &#123;</div><div class="line">        this.p = p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public List&lt;Point&gt; getPs() &#123;</div><div class="line">        return ps;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setPs(List&lt;Point&gt; ps) &#123;</div><div class="line">        this.ps = ps;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Map&lt;String, Point&gt; getPoints() &#123;</div><div class="line">        return points;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setPoints(Map&lt;String, Point&gt; points) &#123;</div><div class="line">        this.points = points;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        return super.execute();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">&lt;s:property value=&quot;p&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;s:property value=&quot;ps&quot;/&gt;&lt;br/&gt;</div><div class="line">points:&lt;s:property value=&quot;points&quot;/&gt;&lt;br/&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<h5 id="注册方式："><a href="#注册方式：" class="headerlink" title="注册方式："></a>注册方式：</h5><ul>
<li>第一种配置方法为在具备类型转换文件中配置，局部类型转换文件命名为<code>ActionName-conversion.properties</code>,位置放在特定的Action目录下，文件内容格式为：<code>typeName=ConverClass</code>仅针对特定的Action的特定属性有效</li>
<li>第二种配置方法为全局类型转换文件中红配置，文件名为xwork-conversion.properties,在<code>WEB-INF\classes</code>下，文件内容格式为：<code>attributeName=ConvertClass</code>, 对某个类型都有效，比如对Point类型注册了类型转换器。</li>
<li><p>注解</p>
<h3 id="8-8-拦截器和过滤器的比较"><a href="#8-8-拦截器和过滤器的比较" class="headerlink" title="8.8 拦截器和过滤器的比较"></a>8.8 拦截器和过滤器的比较</h3></li>
<li>相同点：<ul>
<li>都是一种Java类</li>
<li>都能拦截客户端发给服务端的请求</li>
<li>拦截到请求之后都可以做一些相应的处理，最后还可以把这个请求放行</li>
<li>都需要实现各自相应的接口记忆在相应的配置文件中配置</li>
</ul>
</li>
<li><p>不同点：</p>
<ul>
<li>拦截器是Struts2框架中定义的，过滤器是web里面的对象，是J2EE标准定义的</li>
<li>拦截器只会拦截访问Action的请求，过滤器可以拦截所有的请求</li>
<li>拦截器定义在struts.xml文件中，过滤器定义在web.xml中</li>
<li>拦截器对象的创建、调用、销毁时struts2框架负责的，过滤器对象的创建、调用、销毁时服务器负责的。</li>
</ul>
<p><em>我们自己定义的filter也可以拦截struts2框架中的Action，需要在web.xml文件中把我们自己的filter配置在struts2的filter上面才可以，因为web.xml文件中的filter配置的先后顺序控制filter起作用的顺序，如果struts的filter先拦截到访问action的请求后，不会把这个请求交给下面的filter，而是交给它内部的拦截器。如果我们自己的filter拦截到请求之后，还是会交给下一个filter，也就是交给struts2的filter</em></p>
</li>
</ul>
<h2 id="9-注解Annotation"><a href="#9-注解Annotation" class="headerlink" title="9 注解Annotation"></a>9 注解Annotation</h2><h3 id="9-1-注解使用方式"><a href="#9-1-注解使用方式" class="headerlink" title="9.1 注解使用方式"></a>9.1 注解使用方式</h3><ol>
<li>引入支持struts2框架注解开发的jar包 struts2-convention-plugin-2.3.4.1</li>
<li>struts.xml <code>&lt;constant name=&quot;struts.convention.action.suffix&quot; value=&quot;Action&quot;/&gt;</code></li>
<li><p>Struts2使用注解开发需要遵循一定的规范：</p>
<ul>
<li>Action要必须继承ActionSupport父类</li>
<li>Action所在的包名必须以Action结尾</li>
<li>package-info.java <em>在这里配置这个包下所有的类都可以用</em></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> @Namespace(&quot;/&quot;)</div><div class="line">@ParentPackage(&quot;struts-default&quot;)</div><div class="line">@DefaultInterceptorRef(&quot;authStack&quot;)//authStack自定义的拦截器</div><div class="line"> package com.briup.action.manager;</div><div class="line">import org.apache.struts2.convention.annotation.Namespace;</div><div class="line">import org.apache.struts2.convention.annotation.ParentPackage;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="9-2-Action常用注解"><a href="#9-2-Action常用注解" class="headerlink" title="9.2 Action常用注解"></a>9.2 Action常用注解</h3><ul>
<li><p>Namespace Annotation</p>
<ul>
<li>通过在ActionClass上定义@Namespace(“/custom”)</li>
<li>通过package0info.java定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Namespace(&quot;/manager&quot;)</div><div class="line">@ParentPackage(&quot;default&quot;)</div><div class="line">@DefaultInterceptorRef(&quot;authStack&quot;)</div><div class="line">package com.example.actions;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Action Annotation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">1. @Action(interceptorRefs=&#123;</div><div class="line">                @InterceptorRef(&quot;validation&quot;),</div><div class="line">                @InterceptorRef(&quot;defaultStack&quot;)</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">2.      chain</div><div class="line">        @Action(&quot;foo&quot;)</div><div class="line">        public String foo() &#123;</div><div class="line">            return &quot;bar&quot;;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Action(&quot;foo-bar&quot;)</div><div class="line">        public String bar() &#123;</div><div class="line">            return SUCCESS;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Result Annotation</p>
<ul>
<li>全局， 整个类可以访问</li>
<li>局部， 某个方法可以访问<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> @Results(&#123;</div><div class="line">    @Result(name=&quot;failure&quot;, location=&quot;fail.jsp&quot;)</div><div class="line">&#125;)</div><div class="line">public class HelloWorld extends ActionSupport &#123;</div><div class="line">    @Action(value=&quot;/different/url&quot;,results=&#123;@Result(name=&quot;success&quot;, location=&quot;http://struts.apache.org&quot;, type=&quot;redirect&quot;)&#125;          )</div><div class="line">    public String execute() &#123;</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><em>参考：<a href="http://www.jianshu.com/p/a884504a8863" target="_blank" rel="external">http://www.jianshu.com/p/a884504a8863</a></em></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/struts2总结 六--struts2项目开发流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/struts2总结 六--struts2项目开发流程/" itemprop="url">struts2总结（六）--Struts2项目开发流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Struts2/" itemprop="url" rel="index">
                    <span itemprop="name">Struts2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>建立界面原型</li>
<li>建立struts.XHTML<ul>
<li>确定namespace</li>
<li>确定package</li>
<li>确定Result</li>
<li>将界面原型页面进行修改，匹配现有设置</li>
<li>测试</li>
<li>做好规划</li>
</ul>
</li>
<li>建立数据库</li>
<li>建立Model层</li>
<li>建立Service层<ul>
<li>使用JUnit进行单元测试</li>
</ul>
</li>
<li>开始开发</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/struts2总结 二--Result和OGNL表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/struts2总结 二--Result和OGNL表达式/" itemprop="url">struts2总结（二）--Result和OGNL表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Struts2/" itemprop="url" rel="index">
                    <span itemprop="name">Struts2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-Result"><a href="#4-Result" class="headerlink" title="4 Result"></a>4 Result</h2><p>Result是Action执行结束之后返回的结果，result包含name和type属性，前者是返回的字符串，后者指定跳转的类型，默认为dispatcher。</p>
<h3 id="4-1-Result常用的四中类型"><a href="#4-1-Result常用的四中类型" class="headerlink" title="4.1 Result常用的四中类型"></a>4.1 Result常用的四中类型</h3><ol>
<li>dispatcher， 从一个Action里面服务器内部跳转到一个页面中, r1–&gt;r1.jsp</li>
<li>chain， 从一个Action里面服务器内部跳转到另一个Action中,r2–&gt;r2.jsp</li>
<li>redirect， 从一个Action里面客户端重定向到一个页面中, r3-&gt;r1-&gt;r1.jsp</li>
<li>redirectAction， 从一个Action里面客户端重定向到另一个Action中, r4-&gt;r2-&gt;r2.jsp<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;resultTypes&quot; namespace=&quot;/r&quot; extends=&quot;struts-default&quot;&gt;</div><div class="line">	    &lt;action name=&quot;r1&quot;&gt;</div><div class="line">	    	&lt;result type=&quot;dispatcher&quot;&gt;/r1.jsp&lt;/result&gt;</div><div class="line">	    &lt;/action&gt;</div><div class="line"></div><div class="line">	    &lt;action name=&quot;r2&quot;&gt;</div><div class="line">	    	&lt;result type=&quot;redirect&quot;&gt;/r2.jsp&lt;/result&gt;</div><div class="line">	    &lt;/action&gt;</div><div class="line"></div><div class="line">	    &lt;action name=&quot;r3&quot;&gt;</div><div class="line">	    	&lt;result type=&quot;chain&quot;&gt;r1&lt;/result&gt;</div><div class="line">	    &lt;/action&gt;</div><div class="line"></div><div class="line">	    &lt;action name=&quot;r4&quot;&gt;</div><div class="line">	    	&lt;result type=&quot;redirectAction&quot;&gt;r2&lt;/result&gt;</div><div class="line">	    &lt;/action&gt;</div><div class="line"></div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-2-全局结果集"><a href="#4-2-全局结果集" class="headerlink" title="4.2 全局结果集"></a>4.2 全局结果集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;global-results&gt;</div><div class="line">    		&lt;result name=&quot;mainpage&quot;&gt;/main.jsp&lt;/result&gt;</div><div class="line">&lt;/global-results&gt;</div></pre></td></tr></table></figure>
<p>在其他任何Action中，不需要单独设置，所有返回mainpage字符串的Action会跳转到main.jsp页面。但是如果在某一个Action定义了mainpage字符串的跳转，全局跳转对这个acting失效。action结果集的优先级高于全局结果集。</p>
<h3 id="4-3-动态结果（了解）"><a href="#4-3-动态结果（了解）" class="headerlink" title="4.3 动态结果（了解）"></a>4.3 动态结果（了解）</h3><p>动态结果集表示在struts配置的时候，Action根据类型的不同，动态的决定返回的页面。首先需要在Action中定义两个成员变量，type和r, 其中type用于接收页面传入的参数，r用于保存Action传出的结果。<br>struts.xml为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;user&quot; namespace=&quot;/user&quot; extends=&quot;struts-default&quot;&gt;</div><div class="line"></div><div class="line">	    &lt;action name=&quot;user&quot; class=&quot;com.bjsxt.struts2.user.action.UserAction&quot;&gt;</div><div class="line">	    	&lt;result&gt;$&#123;r&#125;&lt;/result&gt;</div><div class="line">	    &lt;/action&gt;	    </div><div class="line">    &lt;/package&gt;</div><div class="line"></div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure>
<p>index.jsp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">动态结果</div><div class="line">一定不要忘了为动态结果的保存值设置set get方法</div><div class="line">&lt;ol&gt;</div><div class="line">	&lt;li&gt;&lt;a href=&quot;user/user?type=1&quot;&gt;返回success&lt;/a&gt;&lt;/li&gt;</div><div class="line">	&lt;li&gt;&lt;a href=&quot;user/user?type=2&quot;&gt;返回error&lt;/a&gt;&lt;/li&gt;</div><div class="line">&lt;/ol&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>UserAction：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public class UserAction extends ActionSupport &#123;</div><div class="line">	private int type;</div><div class="line"></div><div class="line">	private String r;</div><div class="line"></div><div class="line">	public String getR() &#123;</div><div class="line">		return r;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setR(String r) &#123;</div><div class="line">		this.r = r;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public int getType() &#123;</div><div class="line">		return type;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setType(int type) &#123;</div><div class="line">		this.type = type;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public String execute() throws Exception &#123;</div><div class="line">		if(type == 1) r=&quot;/user_success.jsp&quot;;</div><div class="line">		else if (type == 2) r=&quot;/user_error.jsp&quot;;</div><div class="line">		return &quot;success&quot;;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-4-传递参数"><a href="#4-4-传递参数" class="headerlink" title="4.4 传递参数"></a>4.4 传递参数</h3><p>除了request，session，application来向页面传值之外，还可以通过ValueStack和ActionContext。</p>
<ul>
<li>ValueStack是一个接口， <code>ValueStack vs = context.getValueStack()</code>将值从Action传到页面，ActionContext是一个类，<code>ActionContext context = ActionContext.getContext()</code>来传值，在页面中农需要<code>&lt;s:debug /&gt;</code>标签来查看结果。</li>
<li>当Action进行跳转的时候，struts2框架会自动的把这个Action对象本身分别放到ValueStack和ActionContext中去。然后struts2将这两个对象传递给页面，在页面中可以通过这两个对象来拿到之前放进去的值。也可以在Action中拿到这两个对象手动放值:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ActionContext ac = ActionContext.getContext();</div><div class="line">ValueStack vs = ac.getValueStack();</div><div class="line">ac.put(&quot;ac&quot;,&quot;ac&quot;);</div><div class="line">User user = new User()；</div><div class="line">vs.push(user);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="4-4-1-ValueStack"><a href="#4-4-1-ValueStack" class="headerlink" title="4.4.1 ValueStack"></a>4.4.1 ValueStack</h4><ol>
<li>把一个对象放到值栈之后，文名从这个值栈中是拿不到这个对象的，但是文名可以直接拿到这个对象的属性及其属性值。</li>
<li>从值栈中拿值的时候，是从值栈的property name这一列来拿的，拿到的是property value之一列的值。</li>
<li>所以通过值栈来传递参数到页面需要将参数封装到一个对象中，将这个对象放到值栈中。</li>
<li>生命周期为request</li>
<li>创建一个新的值栈对象后，都会把这个对象放到ActionCon中去。</li>
</ol>
<h4 id="4-4-2-ActionContext"><a href="#4-4-2-ActionContext" class="headerlink" title="4.4.2 ActionContext"></a>4.4.2 ActionContext</h4><ol>
<li>向ActionContext中放值的时候是通过k-v的形式存放的，String-Object键值对，取值同样是通过key拿到value。</li>
<li>struts2框架默认向这个对象里面存放的对象很多，包括request，session，application，ValueStack，parameter等</li>
<li>每次请求都会创建一个新的ActionContext对象</li>
</ol>
<h4 id="4-4-3-取值方式"><a href="#4-4-3-取值方式" class="headerlink" title="4.4.3 取值方式"></a>4.4.3 取值方式</h4><ol>
<li><p>jsp内置对象取值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;%=request.getAttribute(&quot;name&quot;) %&gt;&lt;br&gt;</div><div class="line">&lt;%=session.getAttribute(&quot;name&quot;) %&gt;&lt;br&gt;</div><div class="line">&lt;%=application.getAttribute(&quot;name&quot;) %&gt;&lt;br&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>jstl标签+EL表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$&#123;requestScope.MyName &#125;&lt;br&gt;</div><div class="line"> $&#123;requestScope.name &#125;  &lt;br&gt;</div><div class="line"> $&#123;sessionScope.MyName &#125;  &lt;br&gt;</div><div class="line"> $&#123;applicationScope.MyName &#125;  &lt;br&gt;</div><div class="line"> $&#123;MyName &#125;  &lt;br&gt;</div><div class="line"> $&#123;name &#125;  &lt;br&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>struts2标签+OGNL表达式<code>&lt;s:property value=&quot;OGNL&quot;</code></p>
</li>
</ol>
<blockquote>
<ul>
<li><p>从ValueStack中取值：这个value属性的值name,是一个OGNL表达式，表示取一个名字为name的property的值。从ValueStack中取值，如果存在重名的，默认取最上面的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;s:property value=&quot;name&quot;/&gt;</div><div class="line">&lt;s:property value=&quot;user&quot;/&gt;</div><div class="line">&lt;s:property value=&quot;user.id&quot;/&gt;</div><div class="line">&lt;s:property value=&quot;user.name&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>从ActionContext中取值  #</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;s:property value=&quot;#action.name&quot;/&gt;&lt;br&gt;</div><div class="line"> &lt;s:property value=&quot;#msg&quot;/&gt;&lt;br&gt;</div><div class="line"> &lt;s:property value=&quot;#user&quot;/&gt;&lt;br&gt;</div><div class="line"> &lt;s:property value=&quot;#user.id&quot;/&gt;&lt;br&gt;</div><div class="line"> &lt;s:property value=&quot;#user.name&quot;/&gt;&lt;br&gt;</div><div class="line"> &lt;s:property value=&quot;#user.age&quot;/&gt;&lt;br&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="5-OGNL表达式"><a href="#5-OGNL表达式" class="headerlink" title="5 OGNL表达式"></a>5 OGNL表达式</h2><p>OGNL:Object-Graph Navigation Language，图对象导航语言，是struts2中默认的表达式语言。</p>
<h3 id="5-1-访问普通方法、属性、构造方法"><a href="#5-1-访问普通方法、属性、构造方法" class="headerlink" title="5.1 访问普通方法、属性、构造方法"></a>5.1 访问普通方法、属性、构造方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;访问值栈中的action的普通属性: username = &lt;s:property value=&quot;username&quot;/&gt; &lt;/li&gt;</div><div class="line">&lt;li&gt;访问值栈中对象的普通属性(get set方法)：&lt;s:property value=&quot;user.age&quot;/&gt; | &lt;s:property value=&quot;user[&apos;age&apos;]&quot;/&gt; | &lt;s:property value=&quot;user[\&quot;age\&quot;]&quot;/&gt; | wrong: &lt;%--&lt;s:property value=&quot;user[age]&quot;/&gt;--%&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问值栈中对象的普通属性(get set方法): &lt;s:property value=&quot;cat.friend.name&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问值栈中对象的普通方法：&lt;s:property value=&quot;password.length()&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问值栈中对象的普通方法：&lt;s:property value=&quot;cat.miaomiao()&quot; /&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问值栈中action的普通方法：&lt;s:property value=&quot;m()&quot; /&gt;&lt;/li&gt;</div><div class="line">&lt;hr /&gt;</div><div class="line">&lt;li&gt;访问普通类的构造方法：&lt;s:property value=&quot;new com.struts2.ognl.User(8)&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;hr /&gt;</div></pre></td></tr></table></figure>
<h3 id="5-2-访问静态方法、属性"><a href="#5-2-访问静态方法、属性" class="headerlink" title="5.2 访问静态方法、属性"></a>5.2 访问静态方法、属性</h3><p>struts2默认的<code>&lt;constant name=&quot;struts.ognl.allowStaticMethodAccess&quot; value=&quot;true&quot;&gt;&lt;/constant&gt;</code>为false，需要配置成true才可以访问静态方法、属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;访问静态方法：&lt;s:property value=&quot;@com.struts2.ognl.S@s()&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问静态属性：&lt;s:property value=&quot;@com.struts2.ognl.S@STR&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Math类的静态方法：&lt;s:property value=&quot;@@max(2,3)&quot; /&gt;&lt;/li&gt;</div></pre></td></tr></table></figure>
<h3 id="5-3-访问集合元素："><a href="#5-3-访问集合元素：" class="headerlink" title="5.3 访问集合元素："></a>5.3 访问集合元素：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;访问List:&lt;s:property value=&quot;users&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问List中某个元素:&lt;s:property value=&quot;users[1]&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问List中元素某个属性的集合:&lt;s:property value=&quot;users.&#123;age&#125;&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问List中元素某个属性的集合中的特定值:&lt;s:property value=&quot;users.&#123;age&#125;[0]&quot;/&gt; | &lt;s:property value=&quot;users[0].age&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Set:&lt;s:property value=&quot;dogs&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Set中某个元素:&lt;s:property value=&quot;dogs[1]&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Map:&lt;s:property value=&quot;dogMap&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Map中某个元素:&lt;s:property value=&quot;dogMap.dog101&quot;/&gt; | &lt;s:property value=&quot;dogMap[&apos;dog101&apos;]&quot;/&gt; | &lt;s:property value=&quot;dogMap[\&quot;dog101\&quot;]&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Map中所有的key:&lt;s:property value=&quot;dogMap.keys&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问Map中所有的value:&lt;s:property value=&quot;dogMap.values&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;访问容器的大小：&lt;s:property value=&quot;dogMap.size()&quot;/&gt; | &lt;s:property value=&quot;users.size&quot;/&gt; &lt;/li&gt;</div></pre></td></tr></table></figure>
<h3 id="5-4-投影和过滤"><a href="#5-4-投影和过滤" class="headerlink" title="5.4 投影和过滤"></a>5.4 投影和过滤</h3><ul>
<li>“?#”：过滤所有符合条件的集合</li>
<li>“^#”：过滤第一个符合条件的元素</li>
<li>“$#”：过滤最后一个符合条件的元素</li>
<li>返回的是一个集合，可以使用索引取得集合中指定的元素。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;投影(过滤)：&lt;s:property value=&quot;users.&#123;?#this.age==1&#125;[0]&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;投影：&lt;s:property value=&quot;users.&#123;^#this.age&gt;1&#125;.&#123;age&#125;&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;投影：&lt;s:property value=&quot;users.&#123;$#this.age&gt;1&#125;.&#123;age&#125;&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;投影：&lt;s:property value=&quot;users.&#123;$#this.age&gt;1&#125;.&#123;age&#125; == null&quot;/&gt;&lt;/li&gt;</div></pre></td></tr></table></figure>
<h3 id="5-5-区分-和"><a href="#5-5-区分-和" class="headerlink" title="5.5 区分 %{} 和 ${}"></a>5.5 区分 %{} 和 ${}</h3><ul>
<li>%{}<br>%{}的主要作用是告诉标签的处理类将它包含的字符串按照OGNL表达式处理，类似eval函数</li>
<li>${}<br>${}的主要用于两方面：<ul>
<li>用于国际化资源文件中</li>
<li>用于Struts2配置文件中</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/struts2总结 三--Struts Tags/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/struts2总结 三--Struts Tags/" itemprop="url">struts2总结（三）--Struts Tags</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Struts2/" itemprop="url" rel="index">
                    <span itemprop="name">Struts2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="5-Struts-Tags"><a href="#5-Struts-Tags" class="headerlink" title="5 Struts Tags"></a>5 Struts Tags</h2><p>要在jsp中使用Struts2的标签，需要先引入<code>&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt;</code></p>
<h3 id="5-1-通用标签"><a href="#5-1-通用标签" class="headerlink" title="5.1 通用标签"></a>5.1 通用标签</h3><ul>
<li><p>property</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;property: &lt;s:property value=&quot;username&quot;/&gt; &lt;/li&gt;</div><div class="line">&lt;li&gt;property 取值为字符串: &lt;s:property value=&quot;&apos;username&apos;&quot;/&gt; &lt;/li&gt;</div><div class="line">&lt;li&gt;property 设定默认值: &lt;s:property value=&quot;admin&quot; default=&quot;管理员&quot;/&gt; &lt;/li&gt;</div><div class="line">&lt;li&gt;property 设定HTML: &lt;s:property value=&quot;&apos;&lt;hr/&gt;&apos;&quot; escape=&quot;false&quot;/&gt; &lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>set 将某个值放入指定范围内</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;set 设定adminName值（默认为request 和 ActionContext）: &lt;s:set var=&quot;adminName&quot; value=&quot;username&quot; /&gt;&lt;/li&gt;</div><div class="line"></div><div class="line">&lt;li&gt;set 从request取值: &lt;s:property value=&quot;#request.adminName&quot; /&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;set 从ActionContext取值: &lt;s:property value=&quot;#adminName&quot; /&gt;&lt;/li&gt;</div><div class="line"></div><div class="line">&lt;%--&lt;li&gt;set 设定范围: &lt;s:set name=&quot;adminPassword&quot; value=&quot;password&quot; scope=&quot;page&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;set 从相应范围取值: &lt;%=pageContext.getAttribute(&quot;adminPassword&quot;) %&gt;&lt;/li&gt;</div><div class="line">--%&gt;</div><div class="line">&lt;li&gt;set 设定var，范围为ActionContext: &lt;s:set var=&quot;adminPassword&quot; value=&quot;password&quot; scope=&quot;session&quot;/&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;set 使用#取值: &lt;s:property value=&quot;#adminPassword&quot;/&gt; &lt;/li&gt;</div><div class="line">&lt;li&gt;set 从相应范围取值: &lt;s:property value=&quot;#session.adminPassword&quot;/&gt; &lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>bean 实例化一个JavaBean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;bean 定义bean,并使用param来设定新的属性值:</div><div class="line">        &lt;s:bean name=&quot;com.struts2.tags.Dog&quot; &gt;</div><div class="line">            &lt;s:param name=&quot;name&quot; value=&quot;&apos;pp&apos;&quot;&gt;&lt;/s:param&gt;</div><div class="line">            &lt;s:property value=&quot;name&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;/s:bean&gt;</div><div class="line">&lt;/li&gt;</div><div class="line">&lt;li&gt;bean 查看debug情况:</div><div class="line">        &lt;s:bean name=&quot;com.struts2.tags.Dog&quot; var=&quot;myDog&quot;&gt;</div><div class="line">            &lt;s:param name=&quot;name&quot; value=&quot;&apos;oudy&apos;&quot;&gt;&lt;/s:param&gt;</div><div class="line">        &lt;/s:bean&gt;</div><div class="line">        拿出值：</div><div class="line">        &lt;s:property value=&quot;#myDog.name&quot;/&gt;</div><div class="line">&lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>include 将一JSP或者Servlet包含到当前页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;include _include1.html 包含静态英文文件</div><div class="line">       &lt;s:include value=&quot;/_include1.html&quot;&gt;&lt;/s:include&gt;</div><div class="line">   &lt;/li&gt;</div><div class="line"></div><div class="line">   &lt;li&gt;include _include2.html 包含静态中文文件</div><div class="line">       &lt;s:include value=&quot;/_include2.html&quot;&gt;&lt;/s:include&gt;</div><div class="line">   &lt;/li&gt;</div><div class="line"></div><div class="line">   &lt;li&gt;include _include1.html 包含静态英文文件，说明%用法</div><div class="line">       &lt;s:set var=&quot;incPage&quot; value=&quot;%&#123;&apos;/_include1.html&apos;&#125;&quot; /&gt;</div><div class="line">       &lt;s:include value=&quot;%&#123;#incPage&#125;&quot;&gt;&lt;/s:include&gt;</div><div class="line">   &lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>param 为其他标签提供参数</p>
</li>
<li>debug 辅助调试，查看值栈等信息<h3 id="5-2-控制标签"><a href="#5-2-控制标签" class="headerlink" title="5.2 控制标签"></a>5.2 控制标签</h3></li>
<li><p>if elseif else 用来控制选择输出的标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;if elseif else:</div><div class="line">    age = &lt;s:property value=&quot;#parameters.age[0]&quot; /&gt; &lt;br /&gt;</div><div class="line">    &lt;s:set var=&quot;age&quot; value=&quot;#parameters.age[0]&quot; /&gt;</div><div class="line">    &lt;s:if test=&quot;#age &lt; 0&quot;&gt;wrong age!&lt;/s:if&gt;</div><div class="line">    &lt;s:elseif test=&quot;#parameters.age[0] &lt; 20&quot;&gt;too young!&lt;/s:elseif&gt;</div><div class="line">    &lt;s:else&gt;yeah!&lt;/s:else&gt;&lt;br /&gt;</div><div class="line"></div><div class="line">    &lt;s:if test=&quot;#parameters.aaa == null&quot;&gt;null&lt;/s:if&gt;</div><div class="line">&lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>iterator 迭代器，用于将集合迭代输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;遍历集合：&lt;br /&gt;</div><div class="line">    &lt;s:iterator value=&quot;&#123;1, 2, 3&#125;&quot; &gt;</div><div class="line">        &lt;s:property/&gt; |</div><div class="line">    &lt;/s:iterator&gt;</div><div class="line">&lt;/li&gt;</div><div class="line">&lt;li&gt;自定义变量：&lt;br /&gt;</div><div class="line">    &lt;s:iterator value=&quot;&#123;&apos;aaa&apos;, &apos;bbb&apos;, &apos;ccc&apos;&#125;&quot; var=&quot;x&quot;&gt;</div><div class="line">        &lt;s:property value=&quot;#x.toUpperCase()&quot;/&gt; |</div><div class="line">    &lt;/s:iterator&gt;</div><div class="line">&lt;/li&gt;</div><div class="line">&lt;li&gt;使用status:&lt;br /&gt;</div><div class="line">    &lt;s:iterator value=&quot;&#123;&apos;aaa&apos;, &apos;bbb&apos;, &apos;ccc&apos;&#125;&quot; status=&quot;status&quot;&gt;</div><div class="line">        &lt;s:property/&gt; |</div><div class="line">        遍历过的元素总数：&lt;s:property value=&quot;#status.count&quot;/&gt; |</div><div class="line">        遍历过的元素索引：&lt;s:property value=&quot;#status.index&quot;/&gt; |</div><div class="line">        当前是偶数？：&lt;s:property value=&quot;#status.even&quot;/&gt; |</div><div class="line">        当前是奇数？：&lt;s:property value=&quot;#status.odd&quot;/&gt; |</div><div class="line">        是第一个元素吗？：&lt;s:property value=&quot;#status.first&quot;/&gt; |</div><div class="line">        是最后一个元素吗？：&lt;s:property value=&quot;#status.last&quot;/&gt;</div><div class="line">        &lt;br /&gt;</div><div class="line">    &lt;/s:iterator&gt;</div><div class="line"></div><div class="line">&lt;/li&gt;</div><div class="line"></div><div class="line">&lt;li&gt;</div><div class="line">    &lt;s:iterator value=&quot;#&#123;1:&apos;a&apos;, 2:&apos;b&apos;, 3:&apos;c&apos;&#125;&quot; &gt;</div><div class="line">        &lt;s:property value=&quot;key&quot;/&gt; | &lt;s:property value=&quot;value&quot;/&gt; &lt;br /&gt;</div><div class="line">    &lt;/s:iterator&gt;</div><div class="line">&lt;/li&gt;</div><div class="line"></div><div class="line">&lt;li&gt;</div><div class="line">    &lt;s:iterator value=&quot;#&#123;1:&apos;a&apos;, 2:&apos;b&apos;, 3:&apos;c&apos;&#125;&quot; var=&quot;x&quot;&gt;</div><div class="line">        &lt;s:property value=&quot;#x.key&quot;/&gt; | &lt;s:property value=&quot;#x.value&quot;/&gt; &lt;br /&gt;</div><div class="line">    &lt;/s:iterator&gt;</div><div class="line">&lt;/li&gt;</div><div class="line"></div><div class="line">&lt;li&gt;</div><div class="line"></div><div class="line">    &lt;s:fielderror fieldName=&quot;fielderror.test&quot; theme=&quot;simple&quot;&gt;&lt;/s:fielderror&gt;</div><div class="line"></div><div class="line">&lt;/li&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>subset 用于截取集合的部分元素，形成新的子集合</p>
<h3 id="5-3-UI标签"><a href="#5-3-UI标签" class="headerlink" title="5.3 UI标签"></a>5.3 UI标签</h3><p>Struts2中一共定义了4个主题，simple， XHTML（默认）， css_xhtml, ajax.</p>
<h3 id="5-4-AJAX标签"><a href="#5-4-AJAX标签" class="headerlink" title="5.4 AJAX标签"></a>5.4 AJAX标签</h3><p>后续可以查</p>
<h3 id="5-5-的区别"><a href="#5-5-的区别" class="headerlink" title="5.5 $ # % 的区别"></a>5.5 $ # % 的区别</h3></li>
<li><p>$用于i18n和struts配置文件</p>
</li>
<li>#取得ActionContext的值</li>
<li>%将原本的文本属性解析为OGNL，对本来是OGNL的属性不起作用</li>
</ul>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p>这部分用的不多，所以存了几个相关的比较全的博客地址，方便需要的时候去学习:<br><a href="http://blog.csdn.net/liujiahan629629/article/details/39274997" target="_blank" rel="external">Struts2标签小结</a><br><a href="http://www.cnblogs.com/lihuiyy/archive/2012/04/09/2439509.html" target="_blank" rel="external">UI标签</a><br><a href="http://blog.csdn.net/zklxuankai/article/details/8468815" target="_blank" rel="external">AJAX标签</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/SQL开发技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/SQL开发技巧/" itemprop="url">SQL开发技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/database/" itemprop="url" rel="index">
                    <span itemprop="name">database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SQL语句分类"><a href="#SQL语句分类" class="headerlink" title="SQL语句分类"></a>SQL语句分类</h1><ul>
<li>DDL：数据定义语言</li>
<li>TPL：事务处理语言</li>
<li>DCL：数据控制语言-grant</li>
<li>DML：数据操作语言-crud</li>
</ul>
<h1 id="join从句"><a href="#join从句" class="headerlink" title="join从句"></a>join从句</h1><p>操作表数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from user1;</div><div class="line">+----+-----------+----------+</div><div class="line">| id | user_name | over     |</div><div class="line">+----+-----------+----------+</div><div class="line">|  1 | 唐僧      | 唐僧成佛 |</div><div class="line">|  2 | 猪八戒    | 净坛使者 |</div><div class="line">|  3 | 孙悟空    | 斗战胜佛 |</div><div class="line">|  4 | 沙僧      | 金身罗汉 |</div><div class="line">+----+-----------+----------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from user2;</div><div class="line">+----+-----------+--------+</div><div class="line">| id | user_name | over   |</div><div class="line">+----+-----------+--------+</div><div class="line">|  1 | 孙悟空    | 成佛   |</div><div class="line">|  2 | 牛魔王    | 妖怪吧 |</div><div class="line">|  3 | 蛟魔王    | 妖怪吧 |</div><div class="line">|  4 | 鹏魔王    | 妖怪吧 |</div><div class="line">|  5 | 狮驼王    | 妖怪吧 |</div><div class="line">+----+-----------+--------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="内连接-inner"><a href="#内连接-inner" class="headerlink" title="内连接 inner"></a>内连接 inner</h2><p>基于连接谓词将两张表的列组合在一起，产生新的结果表，交集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, b.over from user1 a join user2 b on a.user_name = b.user_name;</div><div class="line">+-----------+----------+------+</div><div class="line">| user_name | over     | over |</div><div class="line">+-----------+----------+------+</div><div class="line">| 孙悟空    | 斗战胜佛 | 成佛 |</div><div class="line">+-----------+----------+------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="全外连接-full-outer"><a href="#全外连接-full-outer" class="headerlink" title="全外连接 full outer"></a>全外连接 full outer</h2><p>并集，MySQL中不支持直接的full join。用union all来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, b.over from user1 a left join user2 b on a.user_name = b. user_name</div><div class="line">    -&gt; union all</div><div class="line">    -&gt; select b.user_name, b.over, a.over</div><div class="line">    -&gt; from user1 a right join user2 b on b.user_name = a.user_name;</div><div class="line">+-----------+----------+----------+</div><div class="line">| user_name | over     | over     |</div><div class="line">+-----------+----------+----------+</div><div class="line">| 孙悟空    | 斗战胜佛 | 成佛     |</div><div class="line">| 唐僧      | 唐僧成佛 | NULL     |</div><div class="line">| 猪八戒    | 净坛使者 | NULL     |</div><div class="line">| 沙僧      | 金身罗汉 | NULL     |</div><div class="line">| 孙悟空    | 成佛     | 斗战胜佛 |</div><div class="line">| 牛魔王    | 妖怪吧   | NULL     |</div><div class="line">| 蛟魔王    | 妖怪吧   | NULL     |</div><div class="line">| 鹏魔王    | 妖怪吧   | NULL     |</div><div class="line">| 狮驼王    | 妖怪吧   | NULL     |</div><div class="line">+-----------+----------+----------+</div><div class="line">9 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="左外连接-left-outer"><a href="#左外连接-left-outer" class="headerlink" title="左外连接 left outer"></a>左外连接 left outer</h2><p>以左表为准。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, b.over from user1 a left join user2 b on a.user_name = b.user_name where b.user_name is null;</div><div class="line">+-----------+----------+------+</div><div class="line">| user_name | over     | over |</div><div class="line">+-----------+----------+------+</div><div class="line">| 唐僧      | 唐僧成佛 | NULL |</div><div class="line">| 猪八戒    | 净坛使者 | NULL |</div><div class="line">| 沙僧      | 金身罗汉 | NULL |</div><div class="line">+-----------+----------+------+</div><div class="line">3 rows in set (0.00 sec)</div><div class="line">mysql&gt; select a.user_name, a.over, b.over from user1 a left join user2 b on a.user_name = b.user_name where b.user_name is not null;</div><div class="line">+-----------+----------+------+</div><div class="line">| user_name | over     | over |</div><div class="line">+-----------+----------+------+</div><div class="line">| 孙悟空    | 斗战胜佛 | 成佛 |</div><div class="line">+-----------+----------+------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="右外连接-right-outer"><a href="#右外连接-right-outer" class="headerlink" title="右外连接 right outer"></a>右外连接 right outer</h2><p>以右表为准。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select b.user_name, b.over, a.over from user1 a right join user2 b on b.user_name = a.user_name where a.user_name is null;</div><div class="line">+-----------+--------+------+</div><div class="line">| user_name | over   | over |</div><div class="line">+-----------+--------+------+</div><div class="line">| 牛魔王    | 妖怪吧 | NULL |</div><div class="line">| 蛟魔王    | 妖怪吧 | NULL |</div><div class="line">| 鹏魔王    | 妖怪吧 | NULL |</div><div class="line">| 狮驼王    | 妖怪吧 | NULL |</div><div class="line">+-----------+--------+------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select b.user_name, b.over, a.over from user1 a right join user2 b on b.user_name = a.user_name where a.user_name is not null;</div><div class="line">+-----------+------+----------+</div><div class="line">| user_name | over | over     |</div><div class="line">+-----------+------+----------+</div><div class="line">| 孙悟空    | 成佛 | 斗战胜佛 |</div><div class="line">+-----------+------+----------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="交叉连接-cross"><a href="#交叉连接-cross" class="headerlink" title="交叉连接 cross"></a>交叉连接 cross</h2><p>实际中需要避免。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, b.over from user1 a cross join user2 b;</div><div class="line">+-----------+----------+--------+</div><div class="line">| user_name | over     | over   |</div><div class="line">+-----------+----------+--------+</div><div class="line">| 唐僧      | 唐僧成佛 | 成佛   |</div><div class="line">| 猪八戒    | 净坛使者 | 成佛   |</div><div class="line">| 孙悟空    | 斗战胜佛 | 成佛   |</div><div class="line">| 沙僧      | 金身罗汉 | 成佛   |</div><div class="line">| 唐僧      | 唐僧成佛 | 妖怪吧 |</div><div class="line">| 猪八戒    | 净坛使者 | 妖怪吧 |</div><div class="line">| 孙悟空    | 斗战胜佛 | 妖怪吧 |</div><div class="line">| 沙僧      | 金身罗汉 | 妖怪吧 |</div><div class="line">| 唐僧      | 唐僧成佛 | 妖怪吧 |</div><div class="line">| 猪八戒    | 净坛使者 | 妖怪吧 |</div><div class="line">| 孙悟空    | 斗战胜佛 | 妖怪吧 |</div><div class="line">| 沙僧      | 金身罗汉 | 妖怪吧 |</div><div class="line">| 唐僧      | 唐僧成佛 | 妖怪吧 |</div><div class="line">| 猪八戒    | 净坛使者 | 妖怪吧 |</div><div class="line">| 孙悟空    | 斗战胜佛 | 妖怪吧 |</div><div class="line">| 沙僧      | 金身罗汉 | 妖怪吧 |</div><div class="line">| 唐僧      | 唐僧成佛 | 妖怪吧 |</div><div class="line">| 猪八戒    | 净坛使者 | 妖怪吧 |</div><div class="line">| 孙悟空    | 斗战胜佛 | 妖怪吧 |</div><div class="line">| 沙僧      | 金身罗汉 | 妖怪吧 |</div><div class="line">+-----------+----------+--------+</div><div class="line">20 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="如何更新过滤条件中包括自身的表"><a href="#如何更新过滤条件中包括自身的表" class="headerlink" title="如何更新过滤条件中包括自身的表"></a>如何更新过滤条件中包括自身的表</h2><p>直接更新是不可以的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; update user1 set over=&apos;齐天大圣&apos; where user1.user_name in (</div><div class="line">    -&gt; select b.user_name</div><div class="line">    -&gt; from user1 a inner join user2 b on</div><div class="line">    -&gt; a.user_name=b.user_name);</div><div class="line">ERROR 1093 (HY000): You can&apos;t specify target table &apos;user1&apos; for update in FROM clause</div></pre></td></tr></table></figure>
<p>先join，更新join之后的表方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">mysql&gt; update user1 a join(</div><div class="line">    -&gt; select b.user_name</div><div class="line">    -&gt; from user1 a inner join user2 b on</div><div class="line">    -&gt; a.user_name=b.user_name) b on a.user_name = b.user_name set a.over=&apos;齐天大圣&apos;;</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line">Rows matched: 1  Changed: 1  Warnings: 0</div><div class="line"></div><div class="line">mysql&gt; select * from user1;</div><div class="line">+----+-----------+----------+</div><div class="line">| id | user_name | over     |</div><div class="line">+----+-----------+----------+</div><div class="line">|  1 | 唐僧      | 唐僧成佛 |</div><div class="line">|  2 | 猪八戒    | 净坛使者 |</div><div class="line">|  3 | 孙悟空    | 齐天大圣 |</div><div class="line">|  4 | 沙僧      | 金身罗汉 |</div><div class="line">+----+-----------+----------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="join优化子查询"><a href="#join优化子查询" class="headerlink" title="join优化子查询"></a>join优化子查询</h2><p>低效的子查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, (select over from user2 b where a.user_name=b.user_name) as over2 from user1 a;</div><div class="line">+-----------+----------+-------+</div><div class="line">| user_name | over     | over2 |</div><div class="line">+-----------+----------+-------+</div><div class="line">| 唐僧      | 唐僧成佛 | NULL  |</div><div class="line">| 猪八戒    | 净坛使者 | NULL  |</div><div class="line">| 孙悟空    | 齐天大圣 | 成佛  |</div><div class="line">| 沙僧      | 金身罗汉 | NULL  |</div><div class="line">+-----------+----------+-------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line">mysql&gt; explain select a.user_name, a.over, (select over from user2 b where a.user_name=b.user_name) as over2 from user1 a\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: PRIMARY</div><div class="line">        table: a</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 4</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: NULL</div><div class="line">*************************** 2. row ***************************</div><div class="line">           id: 2</div><div class="line">  select_type: DEPENDENT SUBQUERY</div><div class="line">        table: b</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 20.00</div><div class="line">        Extra: Using where</div><div class="line">2 rows in set, 2 warnings (0.00 sec)</div></pre></td></tr></table></figure>
<p>left join优化后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, a.over, b.over as over2 from user1 a left join user2 b on a.user_name=b.user_name;</div><div class="line">+-----------+----------+-------+</div><div class="line">| user_name | over     | over2 |</div><div class="line">+-----------+----------+-------+</div><div class="line">| 孙悟空    | 齐天大圣 | 成佛  |</div><div class="line">| 唐僧      | 唐僧成佛 | NULL  |</div><div class="line">| 猪八戒    | 净坛使者 | NULL  |</div><div class="line">| 沙僧      | 金身罗汉 | NULL  |</div><div class="line">+-----------+----------+-------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; explain select a.user_name, a.over, b.over as over2 from user1 a left join user2 b on a.user_name=b.user_name\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: a</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 4</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: NULL</div><div class="line">*************************** 2. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: b</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: Using where; Using join buffer (Block Nested Loop)</div><div class="line">2 rows in set, 1 warning (0.00 sec)</div></pre></td></tr></table></figure>
<h2 id="join优化聚合子查询"><a href="#join优化聚合子查询" class="headerlink" title="join优化聚合子查询"></a>join优化聚合子查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, b.timestr, b.kills from user1 a join user_kills b on a.id=b.user_id where b.kills=(select max(c.kills) from user_kills c where c.user_id = b.user_id);</div><div class="line">+-----------+-----------+-------+</div><div class="line">| user_name | timestr   | kills |</div><div class="line">+-----------+-----------+-------+</div><div class="line">| 猪八戒    | 2013-2-5  |    12 |</div><div class="line">| 沙僧      | 2013-1-10 |     3 |</div><div class="line">+-----------+-----------+-------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line">mysql&gt; explain select a.user_name, b.timestr, b.kills from user1 a join user_kills b on a.id=b.user_id where b.kills=(select max(c.kills) from user_kills c where c.user_id = b.user_id)\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: PRIMARY</div><div class="line">        table: a</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: PRIMARY</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 4</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: NULL</div><div class="line">*************************** 2. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: PRIMARY</div><div class="line">        table: b</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 20.00</div><div class="line">        Extra: Using where; Using join buffer (Block Nested Loop)</div><div class="line">*************************** 3. row ***************************</div><div class="line">           id: 2</div><div class="line">  select_type: DEPENDENT SUBQUERY</div><div class="line">        table: c</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 20.00</div><div class="line">        Extra: Using where</div><div class="line">3 rows in set, 2 warnings (0.00 sec)</div></pre></td></tr></table></figure>
<p>优化后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, b.timestr, b.kills from user1 a join user_kills b on a.id = b.user_id join user_kills c on c.user_id=b.user_id group by a.user_name, b.timestr, b.kills having b.kills = max(c.kills);</div><div class="line">+-----------+-----------+-------+</div><div class="line">| user_name | timestr   | kills |</div><div class="line">+-----------+-----------+-------+</div><div class="line">| 沙僧      | 2013-1-10 |     3 |</div><div class="line">| 猪八戒    | 2013-2-5  |    12 |</div><div class="line">+-----------+-----------+-------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; explain select a.user_name, b.timestr, b.kills from user1 a join user_kills b on a.id = b.user_id join user_kills c on c.user_id=b.user_id group by a.user_name, b.timestr, b.kills having b.kills = max(c.kills)\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: b</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: Using where; Using temporary; Using filesort</div><div class="line">*************************** 2. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: c</div><div class="line">   partitions: NULL</div><div class="line">         type: ALL</div><div class="line">possible_keys: NULL</div><div class="line">          key: NULL</div><div class="line">      key_len: NULL</div><div class="line">          ref: NULL</div><div class="line">         rows: 5</div><div class="line">     filtered: 20.00</div><div class="line">        Extra: Using where; Using join buffer (Block Nested Loop)</div><div class="line">*************************** 3. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: a</div><div class="line">   partitions: NULL</div><div class="line">         type: eq_ref</div><div class="line">possible_keys: PRIMARY</div><div class="line">          key: PRIMARY</div><div class="line">      key_len: 4</div><div class="line">          ref: test1.b.user_id</div><div class="line">         rows: 1</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: NULL</div><div class="line">3 rows in set, 1 warning (0.00 sec)</div></pre></td></tr></table></figure>
<h1 id="如何实现分组选择"><a href="#如何实现分组选择" class="headerlink" title="如何实现分组选择"></a>如何实现分组选择</h1><p>每一组数据中选出前几名的情景，可以分组逐个进行查询，这种情况下，分组比较多，需要执行同一次查询很多次，而且增加了应用程序与数据库的交互次数，增加了数据库执行查询的次数，不符合批处理的原则，也会增加网络流量，因此实际中不使用这种方式。</p>
<p>优化方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select d.user_name, c.timestr, kills from (select user_id, timestr, kills, (select count(*) from user_kills b where b.user_id=a.user_id and a.kills&lt;=b.kills) as cnt from user_kills a group by user_id, timestr, kills) c join user1 d on c.user_id=d.id where cnt&lt;=2;</div><div class="line">+-----------+-----------+-------+</div><div class="line">| user_name | timestr   | kills |</div><div class="line">+-----------+-----------+-------+</div><div class="line">| 猪八戒    | 2013-2-5  |    12 |</div><div class="line">| 猪八戒    | 2013-1-10 |    10 |</div><div class="line">| 沙僧      | 2013-1-10 |     3 |</div><div class="line">+-----------+-----------+-------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<h1 id="如何进行行列转换"><a href="#如何进行行列转换" class="headerlink" title="如何进行行列转换"></a>如何进行行列转换</h1><h2 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h2><p>报表统计，汇总显示会经常使用行转列的操作。</p>
<ul>
<li><p>打印流水单：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, b.kills from user1 a join user_kills b on a.id=b.user_id;</div><div class="line">+-----------+-------+</div><div class="line">| user_name | kills |</div><div class="line">+-----------+-------+</div><div class="line">| 猪八戒    |    10 |</div><div class="line">| 猪八戒    |     2 |</div><div class="line">| 猪八戒    |    12 |</div><div class="line">| 沙僧      |     3 |</div><div class="line">| 猪八戒    |     6 |</div><div class="line">| 孙悟空    |    50 |</div><div class="line">| 孙悟空    |    12 |</div><div class="line">| 孙悟空    |     5 |</div><div class="line">| 猪八戒    |    15 |</div><div class="line">| 沙僧      |   123 |</div><div class="line">| 沙僧      |    14 |</div><div class="line">| 沙僧      |    10 |</div><div class="line">+-----------+-------+</div><div class="line">12 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>汇总通过sum和group by</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select a.user_name, sum(b.kills) from user1 a join user_kills b on a.id=b.user_id group by a.user_name;</div><div class="line">+-----------+--------------+</div><div class="line">| user_name | sum(b.kills) |</div><div class="line">+-----------+--------------+</div><div class="line">| 孙悟空    |           67 |</div><div class="line">| 沙僧      |          150 |</div><div class="line">| 猪八戒    |           45 |</div><div class="line">+-----------+--------------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>通过cross join来实现行转列, 存在性能问题。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from (select sum(b.kills) as &apos;猪八戒&apos; from user1 a join user_kills b on a.id=b.user_id and user_name=&apos;猪八戒&apos;) a cross join (select sum(b.kills) as &apos;孙悟空&apos; from user1 a join user_kills b on a.id=b.user_id and user_name=&apos;孙悟空&apos;) b cross join (select sum(b.kills) as &apos;沙僧&apos; from user1 a join user_kills b on a.id=b.user_id and user_name=&apos;沙僧&apos;) c;</div><div class="line">+--------+--------+------+</div><div class="line">| 猪八戒 | 孙悟空 | 沙僧 |</div><div class="line">+--------+--------+------+</div><div class="line">|     45 |     67 |  150 |</div><div class="line">+--------+--------+------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>使用case语句来实现行转列</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select sum(case when user_name=&apos;孙悟空&apos; then kills end) as &apos;孙悟空&apos;, sum(case when user_name=&apos;猪八戒&apos; then kills end) as &apos;猪八戒&apos;, sum(case when user_name=&apos;沙僧&apos; then kills end) as &apos;沙僧&apos; from user1 a join user_kills b on  a.id = b.user_id;</div><div class="line">+--------+--------+------+</div><div class="line">| 孙悟空 | 猪八戒 | 沙僧 |</div><div class="line">+--------+--------+------+</div><div class="line">|     67 |     45 |  150 |</div><div class="line">+--------+--------+------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h2><p>属性拆分，比如权限分隔。</p>
<ul>
<li><p>利用序列表实现列转行</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT</div><div class="line">user_name,REPLACE(substring(SUBSTRING_INDEX(mobile,&apos;,&apos;,a.id),CHAR_LENGTH(SUBSTRING_INDEX(mobile,&apos;,&apos;,a.id-1))+1),&apos;,&apos;,&apos;&apos;) AS mobile</div><div class="line">FROM tb_sequence AS a</div><div class="line">CROSS JOIN</div><div class="line">(SELECT user_name, CONCAT(mobile,&apos;,&apos;) AS mobile, (LENGTH(mobile)-LENGTH(REPLACE(mobile,&apos;,&apos;,&apos;&apos;))+1) AS size FROM user1) AS b</div><div class="line">ON a.id &lt;= b.size;</div><div class="line">+-----------+----------+</div><div class="line">| user_name | mobile   |</div><div class="line">+-----------+----------+</div><div class="line">| 唐僧      | 12123123 |</div><div class="line">| 唐僧      | 123      |</div><div class="line">| 唐僧      | 123432   |</div><div class="line">| 唐僧      | 2131     |</div><div class="line">| 唐僧      | 4213     |</div><div class="line">| 唐僧      | 3421     |</div><div class="line">| 猪八戒    | 12123123 |</div><div class="line">| 猪八戒    | 123      |</div><div class="line">| 猪八戒    | 123432   |</div><div class="line">| 猪八戒    | 2131     |</div><div class="line">| 猪八戒    | 4213     |</div><div class="line">| 猪八戒    | 3421     |</div><div class="line">| 孙悟空    | 12123123 |</div><div class="line">| 孙悟空    | 123      |</div><div class="line">| 孙悟空    | 123432   |</div><div class="line">| 孙悟空    | 2131     |</div><div class="line">| 孙悟空    | 4213     |</div><div class="line">| 孙悟空    | 3421     |</div><div class="line">| 沙僧      | 12123123 |</div><div class="line">| 沙僧      | 123      |</div><div class="line">| 沙僧      | 123432   |</div><div class="line">| 沙僧      | 2131     |</div><div class="line">| 沙僧      | 4213     |</div><div class="line">| 沙僧      | 3421     |</div><div class="line">+-----------+----------+</div><div class="line">24 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>使用union join实现行列转换</p>
</li>
</ul>
<p>原数据</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select user_name, arms, clothing, shoe from user1 a join user1_equipment b on a.id = b.user_id;</div><div class="line">+-----------+----------+------------+------------+</div><div class="line">| user_name | arms     | clothing   | shoe       |</div><div class="line">+-----------+----------+------------+------------+</div><div class="line">| 唐僧      | 九环锡杖 | 袈裟       | 僧鞋       |</div><div class="line">| 猪八戒    | 九齿钉耙 | 僧衣       | 僧鞋       |</div><div class="line">| 孙悟空    | 金箍棒   | 梭子黄金甲 | 藕丝云步履 |</div><div class="line">| 沙僧      | 降妖宝杖 | 僧衣       | 僧鞋       |</div><div class="line">+-----------+----------+------------+------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</code></pre><p>结果集：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select user_name, &apos;arms&apos; as equipment, arms from user1 a join user1_equipment b on a.id = b.user_id</div><div class="line">    -&gt; union all</div><div class="line">    -&gt; select user_name, &apos;clothing&apos; as equipment, clothing from user1 a join user1_equipment b on a.id = b.user_id</div><div class="line">    -&gt; union all</div><div class="line">    -&gt; select user_name, &apos;shoe&apos; as equipment, shoe from user1 a join user1_equipment b on a.id = b.user_id</div><div class="line">    -&gt; order by user_name;</div><div class="line">+-----------+-----------+------------+</div><div class="line">| user_name | equipment | arms       |</div><div class="line">+-----------+-----------+------------+</div><div class="line">| 唐僧      | clothing  | 袈裟       |</div><div class="line">| 唐僧      | arms      | 九环锡杖   |</div><div class="line">| 唐僧      | shoe      | 僧鞋       |</div><div class="line">| 孙悟空    | arms      | 金箍棒     |</div><div class="line">| 孙悟空    | shoe      | 藕丝云步履 |</div><div class="line">| 孙悟空    | clothing  | 梭子黄金甲 |</div><div class="line">| 沙僧      | shoe      | 僧鞋       |</div><div class="line">| 沙僧      | clothing  | 僧衣       |</div><div class="line">| 沙僧      | arms      | 降妖宝杖   |</div><div class="line">| 猪八戒    | shoe      | 僧鞋       |</div><div class="line">| 猪八戒    | clothing  | 僧衣       |</div><div class="line">| 猪八戒    | arms      | 九齿钉耙   |</div><div class="line">+-----------+-----------+------------+</div><div class="line">12 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>使用序列号进行列转行</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select user_name,</div><div class="line">    -&gt; case when c.id=1 then &apos;arms&apos;</div><div class="line">    -&gt; when c.id=2 then &apos;clothing&apos;</div><div class="line">    -&gt; when c.id=3 then &apos;shoe&apos;</div><div class="line">    -&gt; end as equipment,</div><div class="line">    -&gt; coalesce(case when c.id=1 then arms end,</div><div class="line">    -&gt; case when c.id=2 then clothing end,</div><div class="line">    -&gt; case when c.id=3 then shoe end) as eq_name</div><div class="line">    -&gt; from user1 a</div><div class="line">    -&gt; join user1_equipment b on a.id=b.user_id</div><div class="line">    -&gt; cross join tb_sequence c where c.id&lt;=3 order by user_name;</div><div class="line">+-----------+-----------+------------+</div><div class="line">| user_name | equipment | eq_name    |</div><div class="line">+-----------+-----------+------------+</div><div class="line">| 唐僧      | shoe      | 僧鞋       |</div><div class="line">| 唐僧      | arms      | 九环锡杖   |</div><div class="line">| 唐僧      | clothing  | 袈裟       |</div><div class="line">| 孙悟空    | shoe      | 藕丝云步履 |</div><div class="line">| 孙悟空    | arms      | 金箍棒     |</div><div class="line">| 孙悟空    | clothing  | 梭子黄金甲 |</div><div class="line">| 沙僧      | clothing  | 僧衣       |</div><div class="line">| 沙僧      | shoe      | 僧鞋       |</div><div class="line">| 沙僧      | arms      | 降妖宝杖   |</div><div class="line">| 猪八戒    | clothing  | 僧衣       |</div><div class="line">| 猪八戒    | shoe      | 僧鞋       |</div><div class="line">| 猪八戒    | arms      | 九齿钉耙   |</div><div class="line">+-----------+-----------+------------+</div><div class="line">12 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="如何生成唯一序列号"><a href="#如何生成唯一序列号" class="headerlink" title="如何生成唯一序列号"></a>如何生成唯一序列号</h1><p>需要的场景：</p>
<ul>
<li>数据库主键，聚集索引方式</li>
<li>业务序列号如发票号，车票号，订单号</li>
</ul>
<p>生成序列号的方法：</p>
<ul>
<li>MySQL：auto_increment</li>
<li>Oracle：sequence</li>
<li>SQLServer：identity/sequence</li>
</ul>
<p>如何选择生成序列号的方式：</p>
<ul>
<li><p>优先选择系统提供的序列号生成方式，需要注意数据空洞的问题：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create table t (id int auto_increment not null, primary key(id));</div><div class="line">Query OK, 0 rows affected (0.04 sec)</div><div class="line">mysql&gt; insert into t value(),();</div><div class="line">Query OK, 2 rows affected (0.01 sec)</div><div class="line">Records: 2  Duplicates: 0  Warnings: 0</div><div class="line">mysql&gt; select * from t;</div><div class="line">+----+</div><div class="line">| id |</div><div class="line">+----+</div><div class="line">|  1 |</div><div class="line">|  2 |</div><div class="line">+----+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line">mysql&gt; begin;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; insert into t values();</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">mysql&gt; select * from t;</div><div class="line">+----+</div><div class="line">| id |</div><div class="line">+----+</div><div class="line">|  1 |</div><div class="line">|  2 |</div><div class="line">|  3 |</div><div class="line">+----+</div><div class="line">3 rows in set (0.00 sec)</div><div class="line">mysql&gt; rollback;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line">mysql&gt; insert into t values();</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line">mysql&gt; select * from t;</div><div class="line">+----+</div><div class="line">| id |</div><div class="line">+----+</div><div class="line">|  1 |</div><div class="line">|  2 |</div><div class="line">|  4 |</div><div class="line">+----+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>使用SQL方式生成序列号，特殊情况下使用。如生成订单序列号，要求序列号的格式为YYYYMMDDNNNNNNN</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">CREATE PROCEDURE usp_seqnum()</div><div class="line">    BEGIN</div><div class="line">      #定义变量并获取相关值</div><div class="line">      DECLARE v_cnt INT;</div><div class="line">      DECLARE v_timestr INT;</div><div class="line">      SET v_timestr = DATE_FORMAT(NOW(),&apos;%Y%m%d&apos;);</div><div class="line">      SELECT ROUND(RAND()*100,0)+1 INTO v_cnt;</div><div class="line">      #新建表</div><div class="line">      DROP TABLE IF EXISTS im_orderseq;</div><div class="line">      CREATE TABLE  im_orderseq(</div><div class="line">        timestr NVARCHAR(8) NOT NULL ,</div><div class="line">        ordersn INT(3)</div><div class="line">      );</div><div class="line">      START TRANSACTION;</div><div class="line">      #更新表的最值</div><div class="line">      UPDATE im_orderseq SET ordersn = ordersn + v_cnt WHERE timestr = v_timestr;</div><div class="line">      IF ROW_COUNT() = 0 THEN</div><div class="line">        #插入数据</div><div class="line">        INSERT INTO im_orderseq(timestr,ordersn) VALUES(v_timestr,v_cnt);</div><div class="line">      END IF;</div><div class="line">      SELECT CONCAT(v_timestr,LPAD(ordersn,7,0))AS ordersn</div><div class="line">      FROM im_orderseq WHERE timestr = v_timestr;</div><div class="line">      COMMIT;</div><div class="line">    END;</div><div class="line"></div><div class="line">    mysql&gt; call usp_seqnum();</div><div class="line">    +-----------------+</div><div class="line">    | ordersn         |</div><div class="line">    +-----------------+</div><div class="line">    | 201804270000009 |</div><div class="line">    +-----------------+</div><div class="line">    1 row in set (0.04 sec)</div><div class="line"></div><div class="line">    Query OK, 0 rows affected (0.05 sec)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="如何删除重复元素"><a href="#如何删除重复元素" class="headerlink" title="如何删除重复元素"></a>如何删除重复元素</h1><p>产生原因：</p>
<pre><code>* 人为原因，重复录入数据，重复提交数据
* 系统原因，由于系统升级或设计的原因使原来可以重复的数据变为不能重复了。
</code></pre><p>查询数据是否重复：group by + having</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from user1_test;</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">| id | user_name | over     | mobile                             |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">|  1 | 唐僧      | 唐僧成佛 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  2 | 猪八戒    | 净坛使者 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  3 | 孙悟空    | 齐天大圣 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  4 | 沙僧      | 金身罗汉 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  8 | 唐僧      | 唐僧成佛 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  9 | 猪八戒    | 净坛使者 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 10 | 孙悟空    | 齐天大圣 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 11 | 沙僧      | 金身罗汉 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">8 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select user_name, count(*) from user1_test group by user_name having count(*)&gt;1;</div><div class="line">+-----------+----------+</div><div class="line">| user_name | count(*) |</div><div class="line">+-----------+----------+</div><div class="line">| 唐僧      |        2 |</div><div class="line">| 孙悟空    |        2 |</div><div class="line">| 沙僧      |        2 |</div><div class="line">| 猪八戒    |        2 |</div><div class="line">+-----------+----------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</code></pre><p>删除重复数据，相同数据保留ID最大的：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from user1_test;</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">| id | user_name | over     | mobile                             |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">|  1 | 唐僧      | 唐僧成佛 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  2 | 猪八戒    | 净坛使者 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  3 | 孙悟空    | 齐天大圣 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  4 | 沙僧      | 金身罗汉 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  8 | 唐僧      | 唐僧成佛 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  9 | 猪八戒    | 净坛使者 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 10 | 孙悟空    | 齐天大圣 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 11 | 沙僧      | 金身罗汉 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">8 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; delete a from user1_test a join (</div><div class="line">    -&gt; select user_name, count(*), max(id) as id</div><div class="line">    -&gt; from user1_test</div><div class="line">    -&gt; group by user_name</div><div class="line">    -&gt; having count(*)&gt;1) b</div><div class="line">    -&gt; on a.user_name=b.user_name</div><div class="line">    -&gt; where a.id &lt; b.id;</div><div class="line">Query OK, 4 rows affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; select * from user1_test;</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">| id | user_name | over     | mobile                             |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">|  8 | 唐僧      | 唐僧成佛 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">|  9 | 猪八戒    | 净坛使者 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 10 | 孙悟空    | 齐天大圣 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">| 11 | 沙僧      | 金身罗汉 | 12123123,123,123432,2131,4213,3421 |</div><div class="line">+----+-----------+----------+------------------------------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
</code></pre><h1 id="如何在子查询中匹配两个值"><a href="#如何在子查询中匹配两个值" class="headerlink" title="如何在子查询中匹配两个值"></a>如何在子查询中匹配两个值</h1><ul>
<li>子查询：当一个查询是另一个查询的条件时，成为子查询。</li>
</ul>
<h1 id="解决同属性多值过滤的问题"><a href="#解决同属性多值过滤的问题" class="headerlink" title="解决同属性多值过滤的问题"></a>解决同属性多值过滤的问题</h1><h1 id="如何计算累进税问题"><a href="#如何计算累进税问题" class="headerlink" title="如何计算累进税问题"></a>如何计算累进税问题</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/struts2总结 一--简介和Action/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/struts2总结 一--简介和Action/" itemprop="url">struts2总结（一）--简介和Action</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Struts2/" itemprop="url" rel="index">
                    <span itemprop="name">Struts2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>Apache Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet,在MVC设计模式中，Struts2作为控制器（Controller）来建立模型与视图的数据交互。Struts2是Struts1和WebWork的技术基础上进行了合并的全新的Struts2框架。其全新的Struts2的体系结构与Struts1的体系结构差别巨大。Struts2以WebWork为核心，采用拦截器的机制来处理用户的请求，这样的设也是的业务逻辑控制器能够ServletAPI完全脱离开。</p>
<h3 id="1-1-Struts2的优点"><a href="#1-1-Struts2的优点" class="headerlink" title="1.1 Struts2的优点"></a>1.1 Struts2的优点</h3><blockquote>
<ol>
<li>在软件设计上，Struts2没有像struts1那样和Servlet API和struts API有着紧密的耦合，Struts2的应用可以不依赖于Servlet API和Struts2 API，属于无侵入式设计。</li>
<li>Struts2提供了拦截器，利用拦截器可以进行AOP（面向切面编程）,实现注入权限拦截等功能。</li>
<li>Struts2提供了类型转换器，可以把特殊的请求参数转换为需要的类型。</li>
<li>Struts2提供支持多种表现层技术，如JSP，freeMarker， Velocity等</li>
<li>Struts2的输入校验可以对指定方法进行校验</li>
<li>提供了全局范围，包范围和Action范围的国际化资源文件管理实现</li>
</ol>
</blockquote>
<h3 id="1-2-Web项目中的三层框架"><a href="#1-2-Web项目中的三层框架" class="headerlink" title="1.2 Web项目中的三层框架"></a>1.2 Web项目中的三层框架</h3><h4 id="1-2-1-表示层"><a href="#1-2-1-表示层" class="headerlink" title="1.2.1 表示层"></a>1.2.1 表示层</h4><p>Struts2框架就是工作在这里</p>
<h4 id="1-2-2-业务逻辑层"><a href="#1-2-2-业务逻辑层" class="headerlink" title="1.2.2 业务逻辑层"></a>1.2.2 业务逻辑层</h4><p>Service层，处理业务逻辑，比如判断用户名是否存在，用户名和密码是否匹配，权限检查等。为一些执行某一个操作条件的判断。</p>
<h4 id="1-2-3-数据访问层"><a href="#1-2-3-数据访问层" class="headerlink" title="1.2.3 数据访问层"></a>1.2.3 数据访问层</h4><p>dao层，专门处理和数据库进行交换的业务。jdbc/hibernate在这里使用。MVC架构是项目中三层架构的一部分，三层架构的表示层可以使用MVC架构的struts2框架来实现。</p>
<h2 id="2-web项目中引入struts2框架"><a href="#2-web项目中引入struts2框架" class="headerlink" title="2. web项目中引入struts2框架"></a>2. web项目中引入struts2框架</h2><h3 id="2-1-开发环境"><a href="#2-1-开发环境" class="headerlink" title="2.1 开发环境"></a>2.1 开发环境</h3><ul>
<li>IDE：Intellij IDEA 2017.2</li>
<li>Server：Tomcat 9.0</li>
<li>JDK：JDK 8</li>
</ul>
<h3 id="2-2-新建项目"><a href="#2-2-新建项目" class="headerlink" title="2.2 新建项目"></a>2.2 新建项目</h3><p>File-New-Project<br>创建JavaEE项目，勾选WebApplication和Struts2选项。</p>
<h3 id="2-3-目录结构"><a href="#2-3-目录结构" class="headerlink" title="2.3 目录结构"></a>2.3 目录结构</h3><ul>
<li>Project Name<ul>
<li>.idea</li>
<li>lib</li>
<li>out</li>
<li>src</li>
<li>web</li>
<li>xx.iml<br>需要注意将lib移动到web目录下面的Web-INF文件夹下，并在moudule中添加路径，不然部署过程中会报ClassNotFoundException。因为部署过程中只会读取web下的lib， 外部的lib是不会读取的。</li>
</ul>
</li>
</ul>
<h3 id="2-4-struts2配置文件"><a href="#2-4-struts2配置文件" class="headerlink" title="2.4 struts2配置文件"></a>2.4 struts2配置文件</h3><p>src目录下面会生成struts.xml文件，默认内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;!DOCTYPE struts PUBLIC</div><div class="line">        &quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</div><div class="line">        &quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;&gt;        </div><div class="line">&lt;struts&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure></p>
<h3 id="2-5-web-xml文件中配置struts2框架的过滤器"><a href="#2-5-web-xml文件中配置struts2框架的过滤器" class="headerlink" title="2.5 web.xml文件中配置struts2框架的过滤器"></a>2.5 web.xml文件中配置struts2框架的过滤器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</div><div class="line">         version=&quot;3.1&quot;&gt;</div><div class="line">    &lt;filter&gt;</div><div class="line">        &lt;filter-name&gt;struts2&lt;/filter-name&gt;</div><div class="line">        &lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;</div><div class="line">    &lt;/filter&gt;</div><div class="line">    &lt;filter-mapping&gt;</div><div class="line">        &lt;filter-name&gt;struts2&lt;/filter-name&gt;</div><div class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">    &lt;/filter-mapping&gt;</div><div class="line">&lt;/web-app&gt;</div></pre></td></tr></table></figure>
<p><em>这个过滤器的作用是拦截struts2框架中的action</em></p>
<h2 id="3-Action"><a href="#3-Action" class="headerlink" title="3 Action"></a>3 Action</h2><h3 id="3-1-Action定义"><a href="#3-1-Action定义" class="headerlink" title="3.1 Action定义"></a>3.1 Action定义</h3><ul>
<li>struts2框架中有一种Java类叫做Action。struts2框架楼底层封装了Servlet的相关内容而实现出来的。替代之前Servlet的类在Struts2中成为Action。比Servlet功能更加强大，操作更加简单。原因在于拦截器的设计，拦截器可以拦截访问Action的请求，拦截请求之后，可以给Action添加很多丰富的功能，而Action专注于业务逻辑的处理就可以。</li>
</ul>
<h3 id="3-2-实现一个Action"><a href="#3-2-实现一个Action" class="headerlink" title="3.2 实现一个Action"></a>3.2 实现一个Action</h3><h4 id="3-2-1-类中只要有一个固定的方法："><a href="#3-2-1-类中只要有一个固定的方法：" class="headerlink" title="3.2.1 类中只要有一个固定的方法："></a>3.2.1 类中只要有一个固定的方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public class IndexAction1 &#123;</div><div class="line">    public String execute() &#123;</div><div class="line">        return &quot;success&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不需要实现或继承任何接口或者父类。execute方法一定要返回String类型的对象，每个字符串都可以对应一个跳转的页面。（字符串是可以自己随便定义的，字符串对应的哪一个跳转到页面也是自己定义的，在struts.xml文件中定义这些内容）</p>
<h4 id="3-2-2-实现一个接口-com-opensyymphony-xwork2-Action"><a href="#3-2-2-实现一个接口-com-opensyymphony-xwork2-Action" class="headerlink" title="3.2.2 实现一个接口:com.opensyymphony.xwork2.Action"></a>3.2.2 实现一个接口:com.opensyymphony.xwork2.Action</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">package com.struts2.front.action;</div><div class="line"></div><div class="line">import com.opensymphony.xwork2.Action;</div><div class="line"></div><div class="line">public class IndexAction2 implements Action&#123;</div><div class="line">    @Override</div><div class="line">    public String execute() throws Exception &#123;</div><div class="line">        return &quot;success&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该接口有一个抽象方法execute()和五个静态属性：ERROR，SUCCESS， INPUT NONE， LOGIN</p>
<h4 id="3-2-3-继承一个指定的父类ActionSupport"><a href="#3-2-3-继承一个指定的父类ActionSupport" class="headerlink" title="3.2.3 继承一个指定的父类ActionSupport"></a>3.2.3 继承一个指定的父类ActionSupport</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">package com.struts2.front.action;</div><div class="line"></div><div class="line">import com.opensymphony.xwork2.ActionSupport;</div><div class="line"></div><div class="line">public class IndexAction3 extends ActionSupport&#123;</div><div class="line">    @Override</div><div class="line">    public String execute() &#123;</div><div class="line">        return &quot;success&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种方法是最常用的，继承ActionSupport类，重写execute()方法。实际上ActionSupport实现了Action接口。</p>
<h3 id="3-3-在struts-xml中进行配置"><a href="#3-3-在struts-xml中进行配置" class="headerlink" title="3.3 在struts.xml中进行配置"></a>3.3 在struts.xml中进行配置</h3><p>配置之后，才可以通知struts2框架我们写的这个类是一个Action，将来struts2框架中要给这个类创建对象，调用方法以及这个Action加入更多丰富的功能，注册的实例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE struts PUBLIC</div><div class="line">        &quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</div><div class="line">        &quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;&gt;</div><div class="line"></div><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;front&quot; extends=&quot;struts-default&quot; namespace=&quot;/&quot;&gt;</div><div class="line">        &lt;action name=&quot;index&quot; class=&quot;com.struts2.front.action.IndexAction1&quot;&gt;</div><div class="line">            &lt;result name=&quot;success&quot;&gt;/ActionIntroduction.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>&lt;package&gt;</code>: 一个struts.xml文件中可以配置多个<code>&lt;package&gt;</code>标签，一个<code>&lt;package&gt;</code>标签里面可以配置多个<code>&lt;action&gt;</code>标签，一个<code>&lt;action&gt;</code>标签里面可以配多个<code>&lt;result&gt;</code>标签</li>
<li>name=”front” 表示给当前package起一个名字，唯一标示当前这个package，方便package之间的继承</li>
<li>extends=”struct-default” 表示当前这个package继承了另外一个名字叫做struct-default的package。这个package定义在core包中的struts-default.xml中定义。所有的package都会直接或者间接的继承struts-default这个包，类似java中的Object类。</li>
<li>namespace=”/“ 表示当前package的命名空间为/，以后这个package里面所有的action被访问时候，路径里面都要加上这个命名空间</li>
<li><code>&lt;action&gt;标签属性及其子标签</code>:<blockquote>
<ul>
<li>name=”index” 表示当前配置这个action的名字为index，这个名字是自己定义的，可以和action类的名字相同，同时将来浏览器中的地址栏里面就要出现这个名字来访问当前这个action类</li>
<li>class=”com.struts2.front.action.IndexAction1” 表示当前配置的action对应的是IndexAction1这个类，</li>
<li><code>&lt;result&gt;</code> 标签表示action访问完成之后，根据action返回的字符串的值，跳转不同的页面，默认结果为’success’, 可以省略，一般都是Action接口中的那5个返回值，也可以自己定义。</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="3-4-动态方法调用DMI"><a href="#3-4-动态方法调用DMI" class="headerlink" title="3.4 动态方法调用DMI"></a>3.4 动态方法调用DMI</h3><p>struts2默认调用的是action中的execute方法，实际上我们也可以让其调用其他的方法，首先定义一个类，让其继承ActionSupport类,配置的时候配置其方法，或者不写具体的方法，用DMI的方式进行调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">package com.struts2.user.action;</div><div class="line"></div><div class="line">import com.opensymphony.xwork2.ActionSupport;</div><div class="line"></div><div class="line">public class UserAction extends ActionSupport&#123;</div><div class="line">    public String add() &#123;</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对其进行配置struts2.xml:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;!--&lt;constant name=&quot;struts.enable.DynamicMethodInvocation&quot; value=&quot;true&quot;/&gt;--&gt;</div><div class="line">    &lt;!--允许默认动态方法调用，Struts2默认不支持此功能--&gt;</div><div class="line">    &lt;constant name=&quot;struts.enable.DynamicMethodInvocation&quot; value=&quot;true&quot;/&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;user&quot; extends=&quot;struts-default&quot; namespace=&quot;/user&quot;&gt;</div><div class="line">        &lt;action name=&quot;userAdd&quot; class=&quot;com.struts2.user.action.UserAction&quot; method=&quot;add&quot;&gt;</div><div class="line">            &lt;result&gt;/user_add_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">        &lt;action name=&quot;user&quot; class=&quot;com.struts2.user.action.UserAction&quot;&gt;</div><div class="line">            &lt;result&gt;/user_add_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure></p>
<p>其中需要注意的是：</p>
<ul>
<li>struts.enable.DynamicMethodInvocation 默认为false，将其设置为true</li>
<li>配置action的时候，</li>
<li>浏览器中的访问方法为:../user/user!add 动态方法调用， 或者../user/userAdd 都可以成功访问</li>
</ul>
<h3 id="3-5-使用通配符来配置action"><a href="#3-5-使用通配符来配置action" class="headerlink" title="3.5 使用通配符来配置action"></a>3.5 使用通配符来配置action</h3><p>从之前的学习中可以发现，多个action名字或者类的名字是有一定的规律的，比如我们要写两个action， StudentAction， TeacherAction， 每个action有两个方法，add和execute方法，配置的时候可以使用通配符来简化配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;actions&quot; extends=&quot;struts-default&quot; namespace=&quot;/actions&quot;&gt;</div><div class="line">        &lt;action name=&quot;Student*&quot; class=&quot;com.struts2.action.StudentAction&quot; method=&quot;&#123;1&#125;&quot;&gt;</div><div class="line">            &lt;result&gt;/Student&#123;1&#125;_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line"></div><div class="line">        &lt;action name=&quot;*_*&quot; class=&quot;com.struts2.action.&#123;1&#125;Action&quot; method=&quot;&#123;2&#125;&quot; &gt;</div><div class="line">            &lt;result&gt;/&#123;1&#125;_&#123;2&#125;_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure></p>
<p>其中{1}代表的是前面name属性中的第一个*号的值。这样可以简化配置，如果约定的好的话，整个配置文件可以只配置一个action。但是需要记住一点： <code>约定优于配置！！</code></p>
<h3 id="3-6-action-的特点及其访问"><a href="#3-6-action-的特点及其访问" class="headerlink" title="3.6 action 的特点及其访问"></a>3.6 action 的特点及其访问</h3><h4 id="3-6-1-特点："><a href="#3-6-1-特点：" class="headerlink" title="3.6.1 特点："></a>3.6.1 特点：</h4><ul>
<li>Servlet 是线程不安全的，因为Servlet是单例</li>
<li>struts2 框架中的action是线程安全的，因为每次访问都会创建一个新的Action对象，所有的action里面可以随意定义成员变变量（只有成员变量才有线程安全的问题）<h4 id="3-6-2-访问："><a href="#3-6-2-访问：" class="headerlink" title="3.6.2 访问："></a>3.6.2 访问：</h4>默认情况下，namespace/actionName.action或者namespace/actionName即可访问到action。访问成功会跳转到相应的jsp页面。由于这样会影响对相关Servlet的访问，所有最好默认action访问使用后缀名.action</li>
<li>访问action的时候，action中方法的调用<blockquote>
<ol>
<li>默认情况下，访问action的 时候会调用action的execute（）方法，这个方法执行完返回一个字符串，根据字符串进行跳转</li>
<li>可以在action标签里面添加一个method属性来指明将来访问这个action的时候会调用的方法</li>
<li>地址栏中动态指定调用的方法</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="3-7-Action接收参数"><a href="#3-7-Action接收参数" class="headerlink" title="3.7 Action接收参数"></a>3.7 Action接收参数</h3><h4 id="3-7-1-同名参数"><a href="#3-7-1-同名参数" class="headerlink" title="3.7.1 同名参数"></a>3.7.1 同名参数</h4><p>例如通过页面将name=a&amp;age=8这个参数传送给action，这时候需要：</p>
<blockquote>
<ul>
<li>action里面定义两个成员变量；name，age</li>
<li>action里面需要提供get/set方法</li>
<li>当页面将参数传送过来的时候，struts2框架会自动帮我们把这两个参数的值放在action中的属性里面，并自动进行了类型转换。从而完成了参数的初始化，实际上这个是有defaultStack这个拦截器栈里面的拦截器来完成的</li>
</ul>
</blockquote>
<p>index.jsp:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;title&gt;$Title$&lt;/title&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">  使用action属性接受参数&lt;a href=&quot;user/user!add?name=a&amp;age=8&quot;&gt;添加用户&lt;/a&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>struts.xml:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot;/&gt;</div><div class="line">    &lt;constant name=&quot;struts.enable.DynamicMethodInvocation&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;package name=&quot;user&quot; extends=&quot;struts-default&quot; namespace=&quot;/user&quot;&gt;</div><div class="line">        &lt;action name=&quot;user&quot; class=&quot;com.struts2.user.action.UserAction&quot;&gt;</div><div class="line">            &lt;result&gt;/user_add_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure></p>
<p>UserAction:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">package com.struts2.user.action;</div><div class="line"></div><div class="line">import com.opensymphony.xwork2.ActionSupport;</div><div class="line"></div><div class="line">public class UserAction extends ActionSupport&#123;</div><div class="line">    private String name;</div><div class="line">    private int age;</div><div class="line"></div><div class="line">    public String add() &#123;</div><div class="line">        System.out.println(&quot;name = &quot; + name);</div><div class="line">        System.out.println(&quot;age = &quot; + age);</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getAge() &#123;</div><div class="line">        return age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setAge(int age) &#123;</div><div class="line">        this.age = age;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="3-7-2-DomainModel-域模型"><a href="#3-7-2-DomainModel-域模型" class="headerlink" title="3.7.2 DomainModel 域模型"></a>3.7.2 DomainModel 域模型</h4><p>在接收到的页面传值的时候，可以让struts2框架直接帮我们把这些接收到的值封装到一个JavaBean对象里面：</p>
<ol>
<li>Action中定义一个User类型的变量user，User类中有name，age两个成员变量及其get/set方法</li>
<li>UserAction中提供这个User的get/set方法</li>
<li>页面向Action传递参数的名称要求user.name=1&amp;user.age=23</li>
</ol>
<p>接收到这个参数之后，struts2框架会帮我们去创建一个User队形，并且将所传的参数封装到对象的三个属性中去，最后将这个封装好的对象放到Action中的user属性中去。</p>
<h4 id="3-7-3-模型驱动"><a href="#3-7-3-模型驱动" class="headerlink" title="3.7.3 模型驱动"></a>3.7.3 模型驱动</h4><p>实现ModelDriven接口，没怎么接触，不常用！创建一个User类有name,age两个成员变量，以及一个UserAction类，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public class UserAction extends ActionSupport implements ModelDriven&lt;User&gt;&#123;</div><div class="line"></div><div class="line">	private User user = new User();</div><div class="line"></div><div class="line">	public String add() &#123;</div><div class="line">		System.out.println(&quot;name=&quot; + user.getName());</div><div class="line">		System.out.println(&quot;age=&quot; + user.getAge());</div><div class="line">		return SUCCESS;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public User getModel() &#123;</div><div class="line">		return user;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-8-简单数据验证"><a href="#3-8-简单数据验证" class="headerlink" title="3.8 简单数据验证"></a>3.8 简单数据验证</h3><p>Action可以进行简单数据验证，这种验证一般不使用UI标签就可以完成，添加addFieldError到页面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public String add() &#123;</div><div class="line">		if(name == null || !name.equals(&quot;admin&quot;)) &#123;</div><div class="line">			this.addFieldError(&quot;name&quot;, &quot;name is error&quot;);</div><div class="line">			this.addFieldError(&quot;name&quot;, &quot;name is too long&quot;);</div><div class="line">			return ERROR;</div><div class="line">		&#125;</div><div class="line">		return SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-9-访问Web元素"><a href="#3-9-访问Web元素" class="headerlink" title="3.9 访问Web元素"></a>3.9 访问Web元素</h3><p>访问Web元素有四种方法，Map类型的和原始类型的各两种：</p>
<ol>
<li><p>Map类型 依赖于容器：Action初始化的时候生成三个Action容器，获取网页元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public LoginAction1() &#123;</div><div class="line">        request = (Map)ActionContext.getContext().get(&quot;request&quot;);</div><div class="line">        session = ActionContext.getContext().getSession();</div><div class="line">        application = ActionContext.getContext().getApplication();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Map类型 IOC，Action实现了RequestAware,SessionAware, ApplicationAware三个接口,有三个Map类型的成员变量，并重写了成员变量的set方法，struts会自动调用set方法将元素注入到Action中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public class LoginAction2 extends ActionSupport implements RequestAware, SessionAware, ApplicationAware&#123;</div><div class="line"></div><div class="line">    private Map&lt;String, Object&gt; request;</div><div class="line">    private Map&lt;String, Object&gt; session;</div><div class="line">    private Map&lt;String, Object&gt; application;</div><div class="line"></div><div class="line">    public String execute() &#123;</div><div class="line">        request.put(&quot;r1&quot;, &quot;r1&quot;);</div><div class="line">        session.put(&quot;s1&quot;, &quot;s1&quot;);</div><div class="line">        application.put(&quot;a1&quot;, &quot;a1&quot;);</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setApplication(Map&lt;String, Object&gt; application) &#123;</div><div class="line">        this.application = application;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setRequest(Map&lt;String, Object&gt; request) &#123;</div><div class="line">        this.request = request;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setSession(Map&lt;String, Object&gt; session) &#123;</div><div class="line">        this.session = session;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>原始类型，IOC,实现了ServletRequestAware接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class LoginAction3 extends ActionSupport implements ServletRequestAware&#123;</div><div class="line">    private HttpServletRequest request;</div><div class="line">    private HttpSession session;</div><div class="line">    private ServletContext application;</div><div class="line"></div><div class="line">    public String execute() &#123;</div><div class="line">        request.setAttribute(&quot;r1&quot;, &quot;r1&quot;);</div><div class="line">        session.setAttribute(&quot;s1&quot;, &quot;s1&quot;);</div><div class="line">        application.setAttribute(&quot;a1&quot;, &quot;a1&quot;);</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setServletRequest(HttpServletRequest httpServletRequest) &#123;</div><div class="line">        this.request = request;</div><div class="line">        this.session = request.getSession();</div><div class="line">        this.application = session.getServletContext();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>原始类型，依赖容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class LoginAction4 extends ActionSupport&#123;</div><div class="line">    private HttpServletRequest request;</div><div class="line">    private HttpSession session;</div><div class="line">    private ServletContext application;</div><div class="line"></div><div class="line">    public LoginAction4() &#123;</div><div class="line">        request = ServletActionContext.getRequest();</div><div class="line">        session = request.getSession();</div><div class="line">        application = session.getServletContext();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String execute() &#123;</div><div class="line">        request.setAttribute(&quot;r1&quot;, &quot;r1&quot;);</div><div class="line">        session.setAttribute(&quot;s1&quot;, &quot;s1&quot;);</div><div class="line">        application.setAttribute(&quot;a1&quot;, &quot;a1&quot;);</div><div class="line">        return SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>原类型和map类型的关系<blockquote>
<ol>
<li>使用Map类型的对象，可以降低对ServletAPI的依赖</li>
<li>我们使用元类型大多时候也是存值和取值，原来性里面本身也封装了Map对象，使用Map类型对象也可以完成存值和取值</li>
<li>map类型的request对象里面的k-v值是复制原类型request对象的键值对的，元类型的request对象中还包含其他的属性和方法。</li>
<li>原类型和Map类型的Request对象是相同的 ，可以互相读取值，session和application也一样。</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="3-10-包含文件配置"><a href="#3-10-包含文件配置" class="headerlink" title="3.10 包含文件配置"></a>3.10 包含文件配置</h3><p>struts2支持配置文件之间的继承，通过include标签完成，相当于将include内容复制到include的位置：</p>
<ul>
<li><p>struts.xml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</div><div class="line">    &lt;include file=&quot;login.xml&quot; /&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>login.xml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;struts&gt;</div><div class="line">    &lt;package name=&quot;login&quot; extends=&quot;struts-default&quot; namespace=&quot;/login&quot;&gt;</div><div class="line">        &lt;action name=&quot;login*&quot; class=&quot;com.bjsxt.struts2.user.action.LoginAction&#123;1&#125;&quot;&gt;</div><div class="line">            &lt;result&gt;/user_login_success.jsp&lt;/result&gt;</div><div class="line">        &lt;/action&gt;</div><div class="line">    &lt;/package&gt;</div><div class="line">&lt;/struts&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-11-默认Action处理"><a href="#3-11-默认Action处理" class="headerlink" title="3.11 默认Action处理"></a>3.11 默认Action处理</h3><p>当struts中没有找到请求的Action的时候会报错，我们可以设置一个默认的Action，当找不到请求的action的时候访问这个特定的Action，使得用户体验更加友好。在package中配置一条语句就可以完成：</p>
<ul>
<li><code>&lt;default-action-ref name=&quot;index&quot;&gt;&lt;/default-action-ref&gt;</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/Spring_Data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/Spring_Data/" itemprop="url">Spring Data</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>  Spring Data JPA 是 Spring Data 系列的一部分，可以轻松实现基于 JPA 的存储库。 该模块处理对基于 JPA 的数据访问层的增强的支持。 这使得使用数据访问技术构建Spring 的应用程序变得更加容易。</p>
<h1 id="传统方式访问数据库JDBC驱动"><a href="#传统方式访问数据库JDBC驱动" class="headerlink" title="传统方式访问数据库JDBC驱动"></a>传统方式访问数据库JDBC驱动</h1><h2 id="创建Maven项目"><a href="#创建Maven项目" class="headerlink" title="创建Maven项目"></a>创建Maven项目</h2><ul>
<li>maven工程的目录结构<br>|– pom.xml<br>|– src<br>|   |– main<br>|   |   <code>-- java
|   |</code>– resources<br>|   |   <code>-- filters
|</code>– test<br>|   |   <code>-- java
|   |</code>– resources<br>|   |   <code>-- filters
|</code>– it<br>|   <code>-- assembly
|</code>– site<br>|– LICENSE.txt<br>|– NOTICE.txt<br>|– README.txt</li>
<li>添加依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!--MySQL Driver--&gt;</div><div class="line">      &lt;dependency&gt;</div><div class="line">          &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">          &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">          &lt;version&gt;5.1.38&lt;/version&gt;</div><div class="line">      &lt;/dependency&gt;</div><div class="line">      &lt;!--junit--&gt;</div><div class="line">      &lt;dependency&gt;</div><div class="line">          &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">          &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">          &lt;version&gt;4.10&lt;/version&gt;</div><div class="line">          &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="数据表准备"><a href="#数据表准备" class="headerlink" title="数据表准备"></a>数据表准备</h2><ul>
<li>Create database spring_data;</li>
<li>create table student(<br>   id int not null auto_increment,<br>   name varchar(20) not null,<br>   age int not null,<br>   primary key(id)<br>  );</li>
<li>Insert into student (name, age) values (“zhangsan”,20);</li>
<li>Insert into student (name, age) values (“lisi”,21);</li>
<li>Insert into student (name, age) values (“wangwu”,22);<h2 id="开发JDBCUtil工具类"><a href="#开发JDBCUtil工具类" class="headerlink" title="开发JDBCUtil工具类"></a>开发JDBCUtil工具类</h2></li>
<li>获取Connection，关闭Connection、Statement、ResultSet</li>
<li>注意事项<br> 配置的属性放置在配置文件中，通过代码的方式将配置文件中的属性加载进程序<h2 id="建立对象模型，DAO"><a href="#建立对象模型，DAO" class="headerlink" title="建立对象模型，DAO"></a>建立对象模型，DAO</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">package com.imooc.domain;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Student实体类</div><div class="line"> */</div><div class="line">public class Student &#123;</div><div class="line">    /**</div><div class="line">     * 主键字段</div><div class="line">     */</div><div class="line">    private int id;</div><div class="line">    /**</div><div class="line">     * 姓名</div><div class="line">     */</div><div class="line">    private String name;</div><div class="line">    /**</div><div class="line">     * 年龄</div><div class="line">     */</div><div class="line">    private int age;</div><div class="line"></div><div class="line">    public int getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setId(int id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public int getAge() &#123;</div><div class="line">        return age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setAge(int age) &#123;</div><div class="line">        this.age = age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String toString() &#123;</div><div class="line">        return &quot;Student&#123;&quot; +</div><div class="line">                &quot;id=&quot; + id +</div><div class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</div><div class="line">                &quot;, age=&quot; + age +</div><div class="line">                &apos;&#125;&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h1 id="使用Spring-JDBC的方式操作数据库"><a href="#使用Spring-JDBC的方式操作数据库" class="headerlink" title="使用Spring JDBC的方式操作数据库"></a>使用Spring JDBC的方式操作数据库</h1><h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.3.5.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.3.5.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h2 id="配置beans-xml"><a href="#配置beans-xml" class="headerlink" title="配置beans.xml"></a>配置beans.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</div><div class="line">    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</div><div class="line">    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/spring_data&quot;/&gt;</div><div class="line">    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</div><div class="line">    &lt;property name=&quot;password&quot; value=&quot;linux&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</div><div class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;studentDAO&quot; class=&quot;com.imooc.dao.StudentDAOSprignJDBCImpl&quot;&gt;</div><div class="line">    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h2 id="开发Spring-JDBC版本的query和save方法"><a href="#开发Spring-JDBC版本的query和save方法" class="headerlink" title="开发Spring JDBC版本的query和save方法"></a>开发Spring JDBC版本的query和save方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">package com.imooc.dao;</div><div class="line"></div><div class="line">import com.imooc.domain.Student;</div><div class="line">import org.springframework.jdbc.core.JdbcTemplate;</div><div class="line">import org.springframework.jdbc.core.RowCallbackHandler;</div><div class="line"></div><div class="line">import java.sql.ResultSet;</div><div class="line">import java.sql.SQLException;</div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">/**</div><div class="line"> * StudentDAO访问接口实现类：通过SPring JDBC的方式操作</div><div class="line"> */</div><div class="line">public class StudentDAOSprignJDBCImpl implements StudentDAO&#123;</div><div class="line"></div><div class="line">    private JdbcTemplate jdbcTemplate;</div><div class="line"></div><div class="line">    public List&lt;Student&gt; query() &#123;</div><div class="line">        final List&lt;Student&gt; students = new ArrayList&lt;Student&gt;();</div><div class="line">        String sql = &quot;select id, name, age from student&quot;;</div><div class="line">        jdbcTemplate.query(sql, new RowCallbackHandler() &#123;</div><div class="line">            public void processRow(ResultSet rs) throws SQLException &#123;</div><div class="line">                Student student = new Student();</div><div class="line">                int id = rs.getInt(&quot;id&quot;);</div><div class="line">                String name = rs.getString(&quot;name&quot;);</div><div class="line">                int age = rs.getInt(&quot;age&quot;);</div><div class="line"></div><div class="line">                student.setId(id);</div><div class="line">                student.setAge(age);</div><div class="line">                student.setName(name);</div><div class="line"></div><div class="line">                students.add(student);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        return students;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void save(Student student) &#123;</div><div class="line">        String sql = &quot;insert into student (name, age) values (?, ?)&quot;;</div><div class="line">        jdbcTemplate.update(sql, student.getName(), student.getAge());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public JdbcTemplate getJdbcTemplate() &#123;</div><div class="line">        return jdbcTemplate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</div><div class="line">        this.jdbcTemplate = jdbcTemplate;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="传统方式访问数据库的缺点"><a href="#传统方式访问数据库的缺点" class="headerlink" title="传统方式访问数据库的缺点"></a>传统方式访问数据库的缺点</h2><ol>
<li>DAO里面代码很多</li>
<li>DAOImpl有很多重复的代码</li>
<li>开发分页和其他功能需要重新封装</li>
</ol>
<hr>
<h1 id="Spring-Data-JPA快速起步"><a href="#Spring-Data-JPA快速起步" class="headerlink" title="Spring Data JPA快速起步"></a>Spring Data JPA快速起步</h1><h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&lt;dependencies&gt;</div><div class="line">    &lt;!--MySQL Driver--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;5.1.38&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;!--junit--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.10&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;!--spring--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.3.5.RELEASE&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.3.5.RELEASE&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;!--spring data jpa--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;1.8.0.RELEASE&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.hibernate&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.3.6.Final&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;/dependencies&gt;</div></pre></td></tr></table></figure>
<h3 id="beans-xml"><a href="#beans-xml" class="headerlink" title="beans.xml"></a>beans.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line"></div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">       xmlns:jpa=&quot;http://www.springframework.org/schema/data/jpa&quot;</div><div class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">    http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa-1.3.xsd</div><div class="line">    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--配置数据源--&gt;</div><div class="line">    &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</div><div class="line">        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</div><div class="line">        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/spring_data&quot;/&gt;</div><div class="line">        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;linux&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">    &lt;!--配置EntityManagerFactory--&gt;</div><div class="line">    &lt;bean id=&quot;entityManagerFactory&quot; class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">        &lt;property name=&quot;jpaVendorAdapter&quot;&gt;</div><div class="line">            &lt;bean class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;/&gt;</div><div class="line">        &lt;/property&gt;</div><div class="line">        &lt;property name=&quot;packagesToScan&quot; value=&quot;com.imooc&quot;/&gt;</div><div class="line"></div><div class="line">        &lt;property name=&quot;jpaProperties&quot;&gt;</div><div class="line">            &lt;props&gt;</div><div class="line">                &lt;prop key=&quot;hibernate.ejb.naming_strategy&quot;&gt;org.hibernate.cfg.ImprovedNamingStrategy&lt;/prop&gt;</div><div class="line">                &lt;prop key=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQL5InnoDBDialect&lt;/prop&gt;</div><div class="line">                &lt;prop key=&quot;hibernate.show_sql&quot;&gt;true&lt;/prop&gt;</div><div class="line">                &lt;prop key=&quot;hibernate.format_sql&quot;&gt;true&lt;/prop&gt;</div><div class="line">                &lt;prop key=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/prop&gt;</div><div class="line">            &lt;/props&gt;</div><div class="line">        &lt;/property&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">    &lt;!--配置事务管理器--&gt;</div><div class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;</div><div class="line">        &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!--支持注解的事务--&gt;</div><div class="line">    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!--配置Spring data--&gt;</div><div class="line">    &lt;jpa:repositories base-package=&quot;com.imooc&quot; entity-manager-factory-ref=&quot;entityManagerFactory&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;context:component-scan base-package=&quot;com.imooc&quot; /&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<hr>
<h1 id="Spring-data-JPA进阶"><a href="#Spring-data-JPA进阶" class="headerlink" title="Spring data JPA进阶"></a>Spring data JPA进阶</h1><h2 id="Repository接口讲解"><a href="#Repository接口讲解" class="headerlink" title="Repository接口讲解"></a>Repository接口讲解</h2><ol>
<li>Repository是Spring Data的核心接口，不提供任何方法</li>
<li>Public interface Repository<t, id extends serializable>{ }</t,></li>
<li><code>@RepositoryDefinition</code>注解的使用</li>
<li>Repository是一个空接口，也叫做标记接口（没有包含方法声明的接口）</li>
<li>如果我们定义的EmployeeRepository extends Repository，如果我们自己的接口没有继承Repository接口，会报错</li>
<li>添加注解能够达到不用extends Repository接口 的功能<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@RepositoryDefinition(domainClass = Employee.class, idClass = Integer.class)</div><div class="line">public interface EmployeeRepository&#123;</div><div class="line">    public Employee findByName(String name);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Repository子接口讲解"><a href="#Repository子接口讲解" class="headerlink" title="Repository子接口讲解"></a>Repository子接口讲解</h2><ol>
<li>CrudRepository：继承Repository，实现CRUD相关的方法</li>
<li>PagingAndSortingRepositoy：继承CrudRepository，实现了分页排序相关的方法</li>
<li>JPARepository：继承PagingAndSortingRepository，实现JPA规范相关的方法</li>
</ol>
<h2 id="Repository中查询方法定义规则和使用"><a href="#Repository中查询方法定义规则和使用" class="headerlink" title="Repository中查询方法定义规则和使用"></a>Repository中查询方法定义规则和使用</h2><ul>
<li><img src="./spring_data_repository_query_1" alt="Alt text"></li>
<li><img src="./spring_data_repository_query_2" alt="Alt text"></li>
<li><p>接口代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public interface EmployeeRepository extends Repository&lt;Employee, Integer&gt;&#123;</div><div class="line">    public Employee findByName(String name);</div><div class="line">//    where name like ?% and age &lt; ?</div><div class="line">    public List&lt;Employee&gt; findByNameStartingWithAndAgeLessThan(String name, Integer age);</div><div class="line">    //    where name like %? and age &lt; ?</div><div class="line">    public List&lt;Employee&gt; findByNameEndingWithAndAgeLessThan(String name, Integer age);</div><div class="line">//    where name in (?,?) or age &lt; ?</div><div class="line">    public List&lt;Employee&gt; findByNameInOrAgeLessThan(List&lt;String&gt; names, Integer age);</div><div class="line">    //    where name in (?,?) and age &lt; ?</div><div class="line">    public List&lt;Employee&gt; findByNameInAndAgeLessThan(List&lt;String&gt; names, Integer age);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>按照方法命名规则来使用的话的弊端：</p>
<ol>
<li>方法名比较常：约定大于配置</li>
<li>对于一些复杂查询，很难实现</li>
</ol>
</li>
</ul>
<h2 id="4-Query注解的使用"><a href="#4-Query注解的使用" class="headerlink" title="4. Query注解的使用"></a>4. Query注解的使用</h2><pre><code>1. 在Repository方法中使用，不需要遵循查询方法命名规则
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Query(&quot;select o from Employee o where id=(select max (id) from Employee t1)&quot;)</div><div class="line"> public Employee getEmployeeByMaxId();</div></pre></td></tr></table></figure>
<pre><code>2. 只需要将@Query定义在Repository中的方法之上即可
    3. 支持命名参数和索引参数的使用
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  @Query(&quot;select o from Employee o where o.name=?1 and o.age=?2&quot;)</div><div class="line">public List&lt;Employee&gt; queryParams1(String name, Integer age);</div><div class="line"></div><div class="line">@Query(&quot;select o from Employee o where o.name=:name and o.age=:age&quot;)</div><div class="line">public List&lt;Employee&gt; queryParams2(@Param(&quot;name&quot;) String name,</div><div class="line">                                   @Param(&quot;age&quot;) Integer age);</div></pre></td></tr></table></figure>
<pre><code>4. 支持本地查询
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">      @Query(nativeQuery = true, value = &quot;select COUNT(1) from employee&quot;)</div><div class="line">public long getCount();</div></pre></td></tr></table></figure>
<h2 id="5-更新和删除操作整合事务的使用"><a href="#5-更新和删除操作整合事务的使用" class="headerlink" title="5. 更新和删除操作整合事务的使用"></a>5. 更新和删除操作整合事务的使用</h2><pre><code>  1. `@Modifying`注解使用
  2. `@Modifying`结合@Query注解执行更新操作
  2. `@Transactional`在Spring Data中的使用
  4. 事务在Spring中的使用：
      * 事务一般是在Service层
* @Query、@Modifying、@Transactional的综合使用
</code></pre><hr>
<h1 id="Spring-Data-JPA高级"><a href="#Spring-Data-JPA高级" class="headerlink" title="Spring Data JPA高级"></a>Spring Data JPA高级</h1><h2 id="CrudRepository接口使用详解"><a href="#CrudRepository接口使用详解" class="headerlink" title="CrudRepository接口使用详解"></a>CrudRepository接口使用详解</h2><h2 id="PagingAndSortingRepository接口使用详解"><a href="#PagingAndSortingRepository接口使用详解" class="headerlink" title="PagingAndSortingRepository接口使用详解"></a>PagingAndSortingRepository接口使用详解</h2><ol>
<li>分页和排序</li>
<li><p>带排序的查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void testPage() &#123;</div><div class="line">    //page: index是从0开始的</div><div class="line">    Pageable pageable = new PageRequest(0,5);</div><div class="line"></div><div class="line">    Page&lt;Employee&gt; page = employeePagingAndSortingRepository.findAll(pageable);</div><div class="line"></div><div class="line">    System.out.println(&quot;查询的总页数：&quot; + page.getTotalPages());</div><div class="line">    System.out.println(&quot;查询的总记录数：&quot; + page.getTotalElements());</div><div class="line">    System.out.println(&quot;查询当前第几页：&quot; + page.getNumber() + 1);</div><div class="line">    System.out.println(&quot;查询的当前页面的集合：&quot; + page.getContent());</div><div class="line">    System.out.println(&quot;查询的当前页面的记录数：&quot; + page.getNumberOfElements());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>带排序的分页查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">   public void testPageAndSort() &#123;</div><div class="line">       Sort.Order order = new Sort.Order(Sort.Direction.DESC, &quot;id&quot;);</div><div class="line">       Sort sort = new Sort(order);</div><div class="line">       //page: index是从0开始的</div><div class="line">       Pageable pageable = new PageRequest(0,5, sort);</div><div class="line"></div><div class="line">       Page&lt;Employee&gt; page = employeePagingAndSortingRepository.findAll(pageable);</div><div class="line"></div><div class="line">       System.out.println(&quot;查询的总页数：&quot; + page.getTotalPages());</div><div class="line">       System.out.println(&quot;查询的总记录数：&quot; + page.getTotalElements());</div><div class="line">       System.out.println(&quot;查询当前第几页：&quot; + page.getNumber() + 1);</div><div class="line">       System.out.println(&quot;查询的当前页面的集合：&quot; + page.getContent());</div><div class="line">       System.out.println(&quot;查询的当前页面的记录数：&quot; + page.getNumberOfElements());</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="JpaRepository接口使用详解"><a href="#JpaRepository接口使用详解" class="headerlink" title="JpaRepository接口使用详解"></a>JpaRepository接口使用详解</h2><ol>
<li>findAll</li>
<li>findAll(Sort sort)</li>
<li>Save(entities)</li>
<li>Flush</li>
<li>deleteInBatche(enties)<h2 id="JpaSpecificationExcutor接口使用详解"><a href="#JpaSpecificationExcutor接口使用详解" class="headerlink" title="JpaSpecificationExcutor接口使用详解"></a>JpaSpecificationExcutor接口使用详解</h2></li>
</ol>
<ul>
<li>封装了JPA Criteria查询条件</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/Springmvc总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/Springmvc总结/" itemprop="url">Springmvc总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Springmvc/" itemprop="url" rel="index">
                    <span itemprop="name">Springmvc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1、Springmvc介绍"><a href="#1、Springmvc介绍" class="headerlink" title="1、Springmvc介绍"></a>1、Springmvc介绍</h1><ul>
<li><p>Spring MVC 是一个模型 - 视图 - 控制器（MVC）的Web框架建立在中央前端控制器servlet（DispatcherServlet），它负责发送每个请求到合适的处理程序，使用视图来最终返回响应结果的概念。Spring MVC 是 Spring 产品组合的一部分，它享有 Spring IoC容器紧密结合Spring松耦合等特点，因此它有Spring的所有优点。</p>
</li>
<li><p>Springmvc处理流程</p>
<p><img src="/img/springmvc-1.png" alt="Alt text"></p>
</li>
</ul>
<h1 id="2、入门程序"><a href="#2、入门程序" class="headerlink" title="2、入门程序"></a>2、入门程序</h1><h2 id="1、开发环境"><a href="#1、开发环境" class="headerlink" title="1、开发环境"></a>1、开发环境</h2><ul>
<li>IDEA 2017.2</li>
<li>JDK 1.8.0.141</li>
<li>Tomcat 9.0.0 M22</li>
<li>Springmvc 4.1.3</li>
</ul>
<h2 id="2、需求"><a href="#2、需求" class="headerlink" title="2、需求"></a>2、需求</h2><p>使用Springmvc实现商品列表的展示：</p>
<ul>
<li><p>请求的url：/itemList.action</p>
</li>
<li><p>参数：无</p>
</li>
<li><p>数据：静态数据</p>
</li>
</ul>
<h2 id="3、开发步骤"><a href="#3、开发步骤" class="headerlink" title="3、开发步骤"></a>3、开发步骤</h2><ol>
<li><p>创建一个Javaweb工程</p>
</li>
<li><p>导入jar包</p>
<p><img src="/img/springmvc-2.png" alt="Alt text"></p>
</li>
<li><p>创建itemList.jsp</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</div><div class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</div><div class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot;  prefix=&quot;fmt&quot;%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="line">&lt;title&gt;查询商品列表&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/item/queryitem.action&quot; method=&quot;post&quot;&gt;</div><div class="line">查询条件：</div><div class="line">&lt;table width=&quot;100%&quot; border=1&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;查询&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;/table&gt;</div><div class="line">商品列表：</div><div class="line">&lt;table width=&quot;100%&quot; border=1&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">	&lt;td&gt;商品名称&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品价格&lt;/td&gt;</div><div class="line">	&lt;td&gt;生产日期&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品描述&lt;/td&gt;</div><div class="line">	&lt;td&gt;操作&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot;&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">	&lt;td&gt;$&#123;item.name &#125;&lt;/td&gt;</div><div class="line">	&lt;td&gt;$&#123;item.price &#125;&lt;/td&gt;</div><div class="line">	&lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;</div><div class="line">	&lt;td&gt;$&#123;item.detail &#125;&lt;/td&gt;</div><div class="line"></div><div class="line">	&lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/itemEdit.action?id=$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line"></div><div class="line">&lt;/table&gt;</div><div class="line">&lt;/form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>创建ItemsController</p>
<p> ItemController是一个普通的java类，不需要实现任何接口，只需要在类上添加@Controller注解即可。@RequestMapping注解指定请求的url，其中“.action”可以加也可以不加。在ModelAndView对象中，将视图设置为“/WEB-INF/jsp/itemList.jsp”。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">publicclass ItemController &#123;</div><div class="line"></div><div class="line">	@RequestMapping(&quot;/itemList&quot;)</div><div class="line">	public ModelAndView itemList() throws Exception &#123;</div><div class="line"></div><div class="line">		List&lt;Items&gt;itemList = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">		//商品列表</div><div class="line">		Items items_1 = new Items();</div><div class="line">		items_1.setName(&quot;联想笔记本_3&quot;);</div><div class="line">		items_1.setPrice(6000f);</div><div class="line">		items_1.setDetail(&quot;ThinkPad T430 联想笔记本电脑！&quot;);</div><div class="line"></div><div class="line">		Items items_2 = new Items();</div><div class="line">		items_2.setName(&quot;苹果手机&quot;);</div><div class="line">		items_2.setPrice(5000f);</div><div class="line">		items_2.setDetail(&quot;iphone6苹果手机！&quot;);</div><div class="line"></div><div class="line">		itemList.add(items_1);</div><div class="line">		itemList.add(items_2);</div><div class="line">		//创建modelandView对象</div><div class="line">		ModelAndView modelAndView = new ModelAndView();</div><div class="line">		//添加model</div><div class="line">		modelAndView.addObject(&quot;itemList&quot;, itemList);</div><div class="line">		//添加视图</div><div class="line">		modelAndView.setViewName(&quot;/WEB-INF/jsp/itemList.jsp&quot;);</div><div class="line">//		modelAndView.setViewName(&quot;itemsList&quot;);</div><div class="line">		returnmodelAndView;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建springmvc.xml</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">        xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">        xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/mvc</div><div class="line">        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://code.alibabatech.com/schema/dubbo</div><div class="line">        http://code.alibabatech.com/schema/dubbo/dubbo.xsd</div><div class="line">        http://www.springframework.org/schema/context</div><div class="line">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</div><div class="line">    &lt;!--配置controller注解扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>配置前端控制器:在web.xml中添加DispatcherServlet的配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;!--springmvc前端控制器--&gt;</div><div class="line">&lt;servlet&gt;</div><div class="line">    &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</div><div class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line"></div><div class="line">    &lt;!--指定配置文件--&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath*:springmvc.xml&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line"></div><div class="line">    &lt;!--启动加载--&gt;</div><div class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">&lt;/servlet&gt;</div><div class="line">&lt;servlet-mapping&gt;</div><div class="line">    &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</div><div class="line">    &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">&lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="3、Springmvc架构"><a href="#3、Springmvc架构" class="headerlink" title="3、Springmvc架构"></a>3、Springmvc架构</h1><h2 id="1、框架结构"><a href="#1、框架结构" class="headerlink" title="1、框架结构"></a>1、框架结构</h2><p><img src="/img/springmvc-3.png" alt="Alt text"></p>
<h2 id="2、架构流程"><a href="#2、架构流程" class="headerlink" title="2、架构流程"></a>2、架构流程</h2><ol>
<li><p>用户发送请求至前端控制器DispatcherServlet</p>
</li>
<li><p>DispatcherServlet收到请求调用HandlerMapping(处理器映射器)</p>
</li>
<li><p>处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器一并返回给DispatcherServlet</p>
</li>
<li><p>DispatcherServlet通过HandlerAdapter(处理器适配器)调用处理器</p>
</li>
<li><p>执行处理器(Controller，也叫后端控制器)</p>
</li>
<li><p>Controller执行完成返回ModelAndView</p>
</li>
<li><p>HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet</p>
</li>
<li><p>DispatcherServlet将ModelAndView传给ViewResolver(视图解析器)</p>
</li>
<li><p>ViewResolver解析后返回具体View</p>
</li>
<li><p>DispatcherServlet对View进行渲染视图(也就是讲模型数据填充至视图中)</p>
</li>
<li><p>DispatcherServlet相应用户</p>
</li>
</ol>
<h2 id="3、组件说明"><a href="#3、组件说明" class="headerlink" title="3、组件说明"></a>3、组件说明</h2><ul>
<li><p>DispatcherServlet：前段控制器，用户请求到达前端控制器，它就相当于mvc模式中的c，dispatcherServlet是整个流程控制的中心，由它调用其它组件处理用户的请求，dispatcherServlet的存在降低了组件之间的耦合性。</p>
</li>
<li><p>HandlerMapping：处理器映射器，HandlerMapping负责根据用户请求找到Handler即处理器，springmvc提供了不同的映射器实现不同的映射方式，例如：配置文件方式，实现接口方式，注解方式等。</p>
</li>
<li><p>Handler：处理器，Handler 是继DispatcherServlet前端控制器的后端控制器，在DispatcherServlet的控制下Handler对具体的用户请求进行处理。由于Handler涉及到具体的用户业务请求，所以一般情况需要程序员根据业务需求开发Handler。</p>
</li>
<li><p>HandlAdapter：处理器适配器，通过HandlerAdapter对处理器进行执行，这是适配器模式的应用，通过扩展适配器可以对更多类型的处理器进行执行。</p>
</li>
<li><p>View Resolver：视图解析器，View Resolver负责将处理结果生成View视图，View Resolver首先根据逻辑视图名解析成物理视图名即具体的页面地址，再生成View视图对象，最后对View进行渲染将处理结果通过页面展示给用户。</p>
</li>
<li><p>View：视图，springmvc框架提供了很多的View视图类型的支持，包括：jstlView、freemarkerView、pdfView等。我们最常用的视图就是jsp。一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面。</p>
<p><em>在springmvc的各个组件中，处理器映射器、处理器适配器、视图解析器称为springmvc的三大组件。</em></p>
<p><em>需要用户开放的组件有handler、view</em></p>
</li>
</ul>
<h2 id="4、框架默认加载组件-DispatcherServelet-properties"><a href="#4、框架默认加载组件-DispatcherServelet-properties" class="headerlink" title="4、框架默认加载组件:DispatcherServelet.properties"></a>4、框架默认加载组件:DispatcherServelet.properties</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"># Default implementation classes for DispatcherServlet&apos;s strategy interfaces.</div><div class="line"># Used as fallback when no matching beans are found in the DispatcherServlet context.</div><div class="line"># Not meant to be customized by application developers.</div><div class="line"></div><div class="line">org.springframework.web.servlet.LocaleResolver=org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.ThemeResolver=org.springframework.web.servlet.theme.FixedThemeResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerMapping=org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerAdapter=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.RequestToViewNameTranslator=org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</div><div class="line"></div><div class="line">org.springframework.web.servlet.ViewResolver=org.springframework.web.servlet.view.InternalResourceViewResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.FlashMapManager=org.springframework.web.servlet.support.SessionFlashMapManager</div></pre></td></tr></table></figure>
<h2 id="5、注解映射器和适配器"><a href="#5、注解映射器和适配器" class="headerlink" title="5、注解映射器和适配器"></a>5、注解映射器和适配器</h2><ol>
<li><p>组件扫描器：使用组件扫描器省去在Spring容器中配置每个controller类的繁琐。使用<context:component-scan>自动标记@controller的控制器类,多个包中间使用半角逗号分隔</context:component-scan></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置controller注解扫描--&gt;</div><div class="line">&lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>RequestMappingHandlerMapping</p>
<ul>
<li><p>注解式处理器映射器，对类中标记@ResquestMapping的方法进行映射，根据ResquestMapping定义的url匹配ResquestMapping标记的方法，匹配成功返回HandlerMethod对象给前端控制器，HandlerMethod对象中封装url对应的方法Method。从spring3.1版本开始，废除了DefaultAnnotationHandlerMapping的使用，推荐使用RequestMappingHandlerMapping完成注解式处理器映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!--如果没有显示的配置处理器映射器和处理器适配器，那么SpringMVC会去默认</div><div class="line">    的dispatcherServlet.properties中查找，对应的处理器映射器和处理器适配器来使用。</div><div class="line">    导致每个请求都要扫描一次他的默认文件，效率很低，降低访问速度，需要显示的配置</div><div class="line">    处理器映射器和处理器适配器</div><div class="line">--&gt;</div><div class="line">&lt;!--注解形式的处理器映射器--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>RequestMappingHandlerAdapter</p>
<ul>
<li><p>注解式处理器适配器，对标记@ResquestMapping的方法进行适配。从spring3.1版本开始，废除了AnnotationMethodHandlerAdapter的使用，推荐使用RequestMappingHandlerAdapter完成注解式处理器适配。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--注解形式的处理器适配器--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>&lt;mvc:annotation-driven&gt;</code></p>
<ul>
<li><p>springmvc使用<mvc:annotation-driven>自动加载RequestMappingHandlerMapping和RequestMappingHandlerAdapter，可用在springmvc.xml配置文件中使用<mvc:annotation-driven>替代注解处理器和适配器的配置。</mvc:annotation-driven></mvc:annotation-driven></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--//注解驱动：自动配置最新版的处理器映射器和处理器适配器--&gt;</div><div class="line">&lt;mvc:annotation-driven/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="6、视图解析器"><a href="#6、视图解析器" class="headerlink" title="6、视图解析器"></a>6、视图解析器</h2><ul>
<li>InternalResourceViewResolver：支持JSP视图解析</li>
<li>viewClass：JstlView表示JSP模板页面需要使用JSTL标签库，所以classpath中必须包含jstl的相关jar 包。此属性可以不设置，默认为JstlView。</li>
<li>prefix 和suffix：查找视图页面的前缀和后缀，最终视图的址为：前缀+逻辑视图名+后缀，逻辑视图名需要在controller中返回ModelAndView指定，比如逻辑视图名为hello，则最终返回的jsp视图地址 “WEB-INF/jsp/hello.jsp”</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置视图解析器，在controller中指定路径名称时不用谢完整的扩展名名称，只写名称就可以--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</div><div class="line">    &lt;!--真正的页面路径 = 前缀 + 去掉后缀名的页面名称 + 后缀--&gt;</div><div class="line">    &lt;!--前缀--&gt;</div><div class="line">    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</div><div class="line">    &lt;!--后缀--&gt;</div><div class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
</code></pre><h1 id="4、Springmvc整合mybatis"><a href="#4、Springmvc整合mybatis" class="headerlink" title="4、Springmvc整合mybatis"></a>4、Springmvc整合mybatis</h1><p>控制层采用Springmvc，持久层使用mybatis。</p>
<h2 id="1、需求"><a href="#1、需求" class="headerlink" title="1、需求"></a>1、需求</h2><p>实现商品查询列表，从MySQL数据库查询商品信息。</p>
<h2 id="2、jar包"><a href="#2、jar包" class="headerlink" title="2、jar包"></a>2、jar包</h2><p><img src="/img/springmvc-4.png" alt="Alt text"></p>
<h2 id="3、工程搭建"><a href="#3、工程搭建" class="headerlink" title="3、工程搭建"></a>3、工程搭建</h2><h3 id="1、整合思路"><a href="#1、整合思路" class="headerlink" title="1、整合思路"></a>1、整合思路</h3><p>DAO层：</p>
<ol>
<li><p>SqlMapConfig.xml,空文件，需要头文件。</p>
</li>
<li><p>application.xml中配置：</p>
<ul>
<li><p>数据库连接池</p>
</li>
<li><p>SqlSessionFactory对象，需要Spring和mybatis整合包下的</p>
</li>
<li><p>配置mapper文件扫描器</p>
</li>
</ul>
</li>
</ol>
<p>Service层：</p>
<ol>
<li><p>applicationContext-service.xml包扫描器，扫描<code>@Service</code>注解的类</p>
</li>
<li><p>applicationContext-trans.xml配置事务</p>
</li>
</ol>
<p>表现层：</p>
<ol>
<li><p>springmvc.xml：</p>
<ul>
<li><p>包扫描器，扫描<code>@Controller</code>注解的类</p>
</li>
<li><p>配置注解驱动</p>
</li>
<li><p>视图解析器</p>
</li>
</ul>
</li>
<li><p>Web.xml：</p>
<ul>
<li>配置前端控制器</li>
</ul>
</li>
</ol>
<h3 id="2、sqlMapConfig-xml"><a href="#2、sqlMapConfig-xml" class="headerlink" title="2、sqlMapConfig.xml"></a>2、sqlMapConfig.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;!DOCTYPE configuration</div><div class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</div><div class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</div><div class="line">&lt;configuration&gt;</div><div class="line"></div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="3、applicationContext-dao-xml"><a href="#3、applicationContext-dao-xml" class="headerlink" title="3、applicationContext-dao.xml"></a>3、applicationContext-dao.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 加载配置文件 --&gt;</div><div class="line">    &lt;context:property-placeholder location=&quot;classpath:db.properties&quot; /&gt;</div><div class="line">    &lt;!-- 数据库连接池 --&gt;</div><div class="line">    &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;</div><div class="line">          destroy-method=&quot;close&quot;&gt;</div><div class="line">        &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;maxActive&quot; value=&quot;10&quot; /&gt;</div><div class="line">        &lt;property name=&quot;maxIdle&quot; value=&quot;5&quot; /&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!-- mapper配置 --&gt;</div><div class="line">    &lt;!-- 让spring管理sqlsessionfactory 使用mybatis和spring整合包中的 --&gt;</div><div class="line">    &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</div><div class="line">        &lt;!-- 数据库连接池 --&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</div><div class="line">        &lt;!-- 加载mybatis的全局配置文件 --&gt;</div><div class="line">        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:SqlMapConfig.xml&quot; /&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!-- 配置Mapper扫描器 --&gt;</div><div class="line">    &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</div><div class="line">        &lt;property name=&quot;basePackage&quot; value=&quot;cn.itheima.dao&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<p>db.properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">jdbc.driver=com.mysql.jdbc.Driver</div><div class="line">jdbc.url=jdbc:mysql://localhost:3306/springmvc?characterEncoding=utf-8</div><div class="line">jdbc.username=root</div><div class="line">jdbc.password=linux</div></pre></td></tr></table></figure>
<h3 id="4、applicationContext-service-xml"><a href="#4、applicationContext-service-xml" class="headerlink" title="4、applicationContext-service.xml"></a>4、applicationContext-service.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--@Serviece扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.service&quot;/&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="5、applicationContext-transaction-xml"><a href="#5、applicationContext-transaction-xml" class="headerlink" title="5、applicationContext-transaction.xml"></a>5、applicationContext-transaction.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 事务管理器 --&gt;</div><div class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</div><div class="line">        &lt;!--数据源--&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!--通知--&gt;</div><div class="line">    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</div><div class="line">        &lt;tx:attributes&gt;</div><div class="line">            &lt;!--传播行为--&gt;</div><div class="line">            &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;</div><div class="line">        &lt;/tx:attributes&gt;</div><div class="line">    &lt;/tx:advice&gt;</div><div class="line"></div><div class="line">    &lt;!--切面--&gt;</div><div class="line">    &lt;aop:config&gt;</div><div class="line">        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut=&quot;execution(* cn.itheima.service.*.*(..))&quot;/&gt;</div><div class="line">    &lt;/aop:config&gt;</div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="6、springmvc-xml"><a href="#6、springmvc-xml" class="headerlink" title="6、springmvc.xml"></a>6、springmvc.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">        xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">        xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--配置注解扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!--配置注解驱动--&gt;</div><div class="line">    &lt;!--&lt;mvc:annotation-driven/&gt;--&gt;</div><div class="line"></div><div class="line">    &lt;!--配置视图解析器--&gt;</div><div class="line">    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</div><div class="line">        &lt;!--前缀--&gt;</div><div class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</div><div class="line">        &lt;!--后缀--&gt;</div><div class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="7、web-xml"><a href="#7、web-xml" class="headerlink" title="7、web.xml"></a>7、web.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</div><div class="line">         version=&quot;3.1&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--解决post乱码问题--&gt;</div><div class="line">    &lt;filter&gt;</div><div class="line">        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</div><div class="line">        &lt;init-param&gt;</div><div class="line">            &lt;param-name&gt;encoding&lt;/param-name&gt;</div><div class="line">            &lt;param-value&gt;utf-8&lt;/param-value&gt;</div><div class="line">        &lt;/init-param&gt;</div><div class="line">    &lt;/filter&gt;</div><div class="line">    &lt;filter-mapping&gt;</div><div class="line">        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">    &lt;/filter-mapping&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;!--SpringMVC的前端控制器--&gt;</div><div class="line">    &lt;servlet&gt;</div><div class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line">        &lt;init-param&gt;</div><div class="line">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">            &lt;param-value&gt;classpath:SpringMvc.xml&lt;/param-value&gt;</div><div class="line">        &lt;/init-param&gt;</div><div class="line">        &lt;!--在Tomcat启动的时候就加载这个Servlet--&gt;</div><div class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">    &lt;/servlet&gt;</div><div class="line">    &lt;servlet-mapping&gt;</div><div class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">        &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">    &lt;/servlet-mapping&gt;</div><div class="line"></div><div class="line">    &lt;!--配置Spring监听器--&gt;</div><div class="line">    &lt;context-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath:applicationContext-*.xml&lt;/param-value&gt;</div><div class="line">    &lt;/context-param&gt;</div><div class="line">    &lt;listener&gt;</div><div class="line">        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</div><div class="line">    &lt;/listener&gt;</div><div class="line"></div><div class="line">&lt;/web-app&gt;</div></pre></td></tr></table></figure>
<h2 id="4、Dao"><a href="#4、Dao" class="headerlink" title="4、Dao"></a>4、Dao</h2><p>通过mybatis逆向工程生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public interface ItemsMapper &#123;</div><div class="line">    int countByExample(ItemsExample example);</div><div class="line"></div><div class="line">    int deleteByExample(ItemsExample example);</div><div class="line"></div><div class="line">    int deleteByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int insert(Items record);</div><div class="line"></div><div class="line">    int insertSelective(Items record);</div><div class="line"></div><div class="line">    List&lt;Items&gt; selectByExampleWithBLOBs(ItemsExample example);</div><div class="line"></div><div class="line">    List&lt;Items&gt; selectByExample(ItemsExample example);</div><div class="line"></div><div class="line">    Items selectByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int updateByExampleSelective(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByExampleWithBLOBs(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByExample(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByPrimaryKeySelective(Items record);</div><div class="line"></div><div class="line">    int updateByPrimaryKeyWithBLOBs(Items record);</div><div class="line"></div><div class="line">    int updateByPrimaryKey(Items record);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public interface UserMapper &#123;</div><div class="line">    int countByExample(UserExample example);</div><div class="line"></div><div class="line">    int deleteByExample(UserExample example);</div><div class="line"></div><div class="line">    int deleteByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int insert(User record);</div><div class="line"></div><div class="line">    int insertSelective(User record);</div><div class="line"></div><div class="line">    List&lt;User&gt; selectByExample(UserExample example);</div><div class="line"></div><div class="line">    User selectByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int updateByExampleSelective(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</div><div class="line"></div><div class="line">    int updateByExample(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</div><div class="line"></div><div class="line">    int updateByPrimaryKeySelective(User record);</div><div class="line"></div><div class="line">    int updateByPrimaryKey(User record);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5、Service"><a href="#5、Service" class="headerlink" title="5、Service"></a>5、Service</h2><p>Service由Spring管理，Spring对service进行事务控制。</p>
<h3 id="1、ItemService接口"><a href="#1、ItemService接口" class="headerlink" title="1、ItemService接口"></a>1、ItemService接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface ItemsService &#123;</div><div class="line">    public List&lt;Items&gt; list() throws Exception;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2、ItemsServiceImplement实现类"><a href="#2、ItemsServiceImplement实现类" class="headerlink" title="2、ItemsServiceImplement实现类"></a>2、ItemsServiceImplement实现类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Service</div><div class="line">public class ItemsServiceImpl implements ItemsService&#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private ItemsMapper itemsMapper;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public List&lt;Items&gt; list() throws Exception &#123;</div><div class="line">        ItemsExample example = new ItemsExample();</div><div class="line"></div><div class="line">        List&lt;Items&gt; list = itemsMapper.selectByExampleWithBLOBs(example);</div><div class="line"></div><div class="line">        return list;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">//窄化请求映射</div><div class="line">@RequestMapping(&quot;/items&quot;)</div><div class="line">public class ItemsController &#123;</div><div class="line">    @Autowired</div><div class="line">    private ItemsService itemsService;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/list&quot;)</div><div class="line">    public ModelAndView itemsList() throws Exception &#123;</div><div class="line">        List&lt;Items&gt; list = itemsService.list();</div><div class="line"></div><div class="line">        ModelAndView modelAndView = new ModelAndView();</div><div class="line">        modelAndView.addObject(&quot;itemList&quot;, list);</div><div class="line">        modelAndView.setViewName(&quot;itemList&quot;);</div><div class="line"></div><div class="line">        return modelAndView;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>访问<a href="http://localhost:8080//items/list.action进行测试。" target="_blank" rel="external">http://localhost:8080//items/list.action进行测试。</a></p>
<h1 id="5、参数绑定"><a href="#5、参数绑定" class="headerlink" title="5、参数绑定"></a>5、参数绑定</h1><h2 id="1、简单数据类型"><a href="#1、简单数据类型" class="headerlink" title="1、简单数据类型"></a>1、简单数据类型</h2><p>需求：打开商品编辑页面，展示商品信息。</p>
<ul>
<li><p>编辑商品信息，需要根据id查询商品信息，然后展示到页面，</p>
</li>
<li><p>请求：/itemsEdit.action，</p>
</li>
<li><p>参数：id,</p>
</li>
<li><p>相应结果：商品编辑页面，展示商品详细信息</p>
</li>
</ul>
<h3 id="1、service"><a href="#1、service" class="headerlink" title="1、service"></a>1、service</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public Items findItemsById(Integer id) throws Exception &#123;</div><div class="line">    return itemsMapper.selectByPrimaryKey(id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2、Controller参数绑定"><a href="#2、Controller参数绑定" class="headerlink" title="2、Controller参数绑定"></a>2、Controller参数绑定</h3><p>根据id查询商品数据，需要从请求的参数中把请求的id提取出来。Id应该包含在Request对象中。可以从Request中取id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">public ModelAnd itemEdit(HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">  //从Request中取id</div><div class="line">  String strId = request.getParameter(&quot;id&quot;);</div><div class="line">  Integer id = null;</div><div class="line">  //如果id有值则转换成int类型</div><div class="line">  if (strId != null&amp;&amp; !&quot;&quot;.equals(strId)) &#123;</div><div class="line">    id = newInteger(strId);</div><div class="line">  &#125; else &#123;</div><div class="line">    //出错</div><div class="line">    returnnull;</div><div class="line">  &#125;</div><div class="line">  Items items = itemService.getItemById(id);</div><div class="line">  //创建ModelAndView</div><div class="line">  ModelAndView modelAndView = new ModelAndView();</div><div class="line">  //向jsp传递数据</div><div class="line">  modelAndView.addObject(&quot;item&quot;, items);</div><div class="line">  //设置跳转的jsp页面</div><div class="line">  modelAndView.setViewName(&quot;editItem&quot;);</div><div class="line">  returnmodelAndView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、Springmvc默认支持的类型"><a href="#3、Springmvc默认支持的类型" class="headerlink" title="3、Springmvc默认支持的类型"></a>3、Springmvc默认支持的类型</h3><p>处理器形参中添加如下类型的参数，处理适配器会默认识别并进行赋值。</p>
<ul>
<li><p>HttpServletRequest：通过request对象获取请求信息</p>
</li>
<li><p>HttpServletResponse: 通过response处理相应信息</p>
</li>
<li><p>HttpSession：通过Session对象得到session中存放的对象</p>
</li>
<li><p>Model/ModelMap：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//调用service查询商品信息</div><div class="line">Items item = itemService.findItemById(id);</div><div class="line">model.addAttribute(&quot;item&quot;, item);</div></pre></td></tr></table></figure>
<ul>
<li><p>页面通过${item.xxx}获取Model中的属性。实际上使用Model和ModelMap效果一样，使用Model，springmvc会实例化ModelMap。</p>
</li>
<li><p>如果使用Model则可以不使用ModelAndView对象，Model对象可以向页面传递数据，View对象则可以使用String返回值替代。不管是Model还是ModelAndView，其本质都是使用Request对象向jsp传递数据。</p>
</li>
<li><p>使用ModelAndView则方法可以变为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">public String itemEdit(HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">    String idStr = reuqest.getParameter(&quot;id&quot;);</div><div class="line">    Items items = itemsService.findItemsById(Integer.parseInt(idStr));</div><div class="line"></div><div class="line">    model.addAttribute(&quot;item&quot;, items);</div><div class="line">    //如果springmvc方法返回一个简单的字符串，nameSpringmvc就会认为这个字符串是页面的名称</div><div class="line">    return &quot;editItem&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="4、绑定简单类型"><a href="#4、绑定简单类型" class="headerlink" title="4、绑定简单类型"></a>4、绑定简单类型</h3><p>当请求的参数名称和处理器形参 <em>名称一致</em> 时，会将请求参数与形参进行绑定。从request取参数的方法可以进一步简化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">	public String itemEdit(Integer id, Model model) &#123;</div><div class="line">		Items items = itemService.getItemById(id);</div><div class="line">		//向jsp传递数据</div><div class="line">		model.addAttribute(&quot;item&quot;, items);</div><div class="line">		//设置跳转的jsp页面</div><div class="line">		return&quot;editItem&quot;;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>支持的数据类型：参数类型推荐使用包装数据类型，因为基础数据类型不可以为null</p>
<ul>
<li><p>Integer，int</p>
</li>
<li><p>Float Float</p>
</li>
<li><p>Double Double</p>
</li>
<li><p>Boolean Boolean ：对于Boolean类型的参数，请求的参数值为true或者false。</p>
</li>
</ul>
</li>
<li><p><code>@RequestParam</code> ：使用<code>@RequestParam</code>用于处理简单类型的绑定</p>
<ul>
<li><p>value：参数名字，即入参的请求参数名字，如value=“item_id”表示请求的参数区中的名字为item_id的参数的值将传入；</p>
</li>
<li><p>required：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报:TTP Status 400 - Required Integer parameter ‘XXXX’ is not present</p>
</li>
<li><p>defaultValue：默认值，表示如果请求中没有同名参数时的默认值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public String editItem(@RequestParam(value=&quot;item_id&quot;,required=true) String id) &#123;&#125;</div></pre></td></tr></table></figure>
<p>形参名称为id,这里使用value=”item_id”限定请求的参数名为item_id，所以页面出传递的参数名必须为item_id。如果请求参数中没有该参数会报500错误。同时通过require=true限定item_id参数Wie必穿阐述，如果不传递则会报400错误。可以使用defaultvalue设置默认值。</p>
</li>
</ul>
</li>
</ol>
<h2 id="3、绑定pojo类型"><a href="#3、绑定pojo类型" class="headerlink" title="3、绑定pojo类型"></a>3、绑定pojo类型</h2><h3 id="1、需求-1"><a href="#1、需求-1" class="headerlink" title="1、需求"></a>1、需求</h3><p>将页面修改后的商品信息保存到数据库中。</p>
<ul>
<li><p>请求的url：/updateitem.action结尾的</p>
</li>
<li><p>参数：表单中的数据</p>
</li>
<li><p>相应内容：更新成功页面</p>
</li>
</ul>
<h3 id="2、使用pojo接收表单数据"><a href="#2、使用pojo接收表单数据" class="headerlink" title="2、使用pojo接收表单数据"></a>2、使用pojo接收表单数据</h3><p>如果提交的参数很多，或者提交的表单的内容很多的时候可以使用pojo接收数据。要求pojo对象中的属性名和表单input的name属性一致。</p>
<p>页面定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">  &lt;td&gt;商品名称&lt;/td&gt;</div><div class="line">  &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;$&#123;item.name &#125;&quot; /&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">  &lt;td&gt;商品价格&lt;/td&gt;</div><div class="line">  &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;price&quot; value=&quot;$&#123;item.price &#125;&quot; /&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div></pre></td></tr></table></figure>
<p>Pojo定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class Items &#123;</div><div class="line">    private Integer id;</div><div class="line"></div><div class="line">    private String name;</div><div class="line"></div><div class="line">    private Float price;</div><div class="line"></div><div class="line">    private String pic;</div><div class="line"></div><div class="line">    private Date createtime;</div><div class="line"></div><div class="line">    private String detail;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//可以直接绑定pojo对象，pojo属性名称和页面传过来的参数名称需要一致，</div><div class="line">// 按照名称来进行参数绑定</div><div class="line">@RequestMapping(&quot;/updateitem&quot;)</div><div class="line">public String update(Items items) throws Exception &#123;</div><div class="line"></div><div class="line">    itemsService.updateItem(items);</div><div class="line"></div><div class="line">    return &quot;success&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时提交的表单中不能有日期类型的数据，否则会报400错误。需要自定义参数绑定才可以提交日期类型的数据。</p>
<h3 id="3、解决post提交的乱码问题：在web-xml中加入："><a href="#3、解决post提交的乱码问题：在web-xml中加入：" class="headerlink" title="3、解决post提交的乱码问题：在web.xml中加入："></a>3、解决post提交的乱码问题：在web.xml中加入：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!--解决post乱码问题--&gt;</div><div class="line">&lt;filter&gt;</div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;encoding&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;utf-8&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line">&lt;/filter&gt;</div><div class="line">&lt;filter-mapping&gt;</div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure>
<p>而对于get请求中文参数的乱码问题解决方案有两个：</p>
<ol>
<li><p>修改Tomcat配置文件添加编码与工程编码一致：<code>&lt;Connector URIEncoding=&quot;utf-8&quot; connectionTimeout=&quot;20000&quot; port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot;/&gt;</code></p>
</li>
<li><p>对参数重新编码：<code>String userName new
String(request.getParamter(&quot;userName&quot;).getBytes(&quot;ISO8859-1&quot;),&quot;utf-8&quot;)</code></p>
</li>
</ol>
<h2 id="4、pojo包装类型"><a href="#4、pojo包装类型" class="headerlink" title="4、pojo包装类型"></a>4、pojo包装类型</h2><ul>
<li>需求</li>
</ul>
<p>使用包装的pojo接收商品信息的查询条件。</p>
<ul>
<li>包装对象定义如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line"></div><div class="line">    public Items getItems() &#123;</div><div class="line">        return items;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setItems(Items items) &#123;</div><div class="line">        this.items = items;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>页面定义：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">	&lt;%--如果Controller中接收的是VO，name页面上的属性值要等于VO的属性.属性。属性--%&gt;</div><div class="line">	&lt;td&gt;商品名称：&lt;input type=&quot;text&quot; name=&quot;items.name&quot;/&gt;&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品价格：&lt;input type=&quot;text&quot; name=&quot;items.price&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;查询&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div></pre></td></tr></table></figure>
<ul>
<li>Controller:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/search&quot;)</div><div class="line">public String search(QueryVo queryVo) throws Exception &#123;</div><div class="line">    System.out.println(queryVo);</div><div class="line">    return &quot;success&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5、自定义参数绑定"><a href="#5、自定义参数绑定" class="headerlink" title="5、自定义参数绑定"></a>5、自定义参数绑定</h2><ul>
<li>需求</li>
</ul>
<p>在商品修改页面可以修改商品的日期，并且根据业务需求自定义日期格式。</p>
<p>由于日期数据有多种格式，所以springmvc没办法把字符串转换成日期类型。所以需要自定义参数绑定。前端控制器接收到请求后，找到注解形式的处理器适配器，对RequestMapping标记的方法进行适配，并对方法中的形参进行参数绑定。在springmvc这可以在处理器适配器上自定义Converter进行参数绑定。如果使用<mvc:annotation-driven>可以在此标签上进行扩展。</mvc:annotation-driven></p>
<ul>
<li><p>自定义Convert</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class CustomGlobalStrToDataConvert implements Converter&lt;String, Date&gt;&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Date convert(String s) &#123;</div><div class="line">        try &#123;</div><div class="line">            Date date = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).parse(s);</div><div class="line">            return date;</div><div class="line">        &#125; catch (ParseException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置Convert:此方法需要独立配置处理器映射器，处理器适配器，不能使用<mvc:annotation-driven></mvc:annotation-driven></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置自定义转换器--&gt;</div><div class="line">&lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt;</div><div class="line">    &lt;property name=&quot;converters&quot;&gt;</div><div class="line">        &lt;set&gt;</div><div class="line">            &lt;bean class=&quot;cn.itheima.controller.convert.CustomGlobalStrToDataConvert&quot;/&gt;</div><div class="line">        &lt;/set&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- 自定义webBinder --&gt;</div><div class="line">&lt;beanid=&quot;customBinder&quot;	class=&quot;org.springframework.web.bind.support.ConfigurableWebBindingInitializer&quot;&gt;</div><div class="line">  &lt;propertyname=&quot;conversionService&quot;ref=&quot;conversionService&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!--注解适配器 --&gt;</div><div class="line">&lt;beanclass=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;</div><div class="line">  &lt;propertyname=&quot;webBindingInitializer&quot;ref=&quot;customBinder&quot;&gt;&lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- 注解处理器映射器 --&gt;</div><div class="line">&lt;beanclass=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="6、Springmvc和Struts2的区别"><a href="#6、Springmvc和Struts2的区别" class="headerlink" title="6、Springmvc和Struts2的区别"></a>6、Springmvc和Struts2的区别</h1><ol>
<li><p>springmvc的入口是一个servlet，也就是前端控制器，Struts2入口是一个filter过滤器。</p>
</li>
<li><p>springmvc是基于方法开发(一个url对应一个方法)，请求参数传递到方法的形参，可以设计为单例或者多例。Struts2是基于类开发的，传递参数是通过类的属性，只能设计为多例。</p>
</li>
<li><p>Struts2采用值栈存储请求和相应的数据，通过OGNL表达式存取数据。springmvc通过参数解析器是将request中请求内容解析，并给方法形参赋值，将数据和视图封装成ModelAndView对象，通过又将ModelAndView中的模型数据通过request域传输到页面。JSP视图解析器默认使用jstl。</p>
</li>
</ol>
<h1 id="7、高级参数绑定"><a href="#7、高级参数绑定" class="headerlink" title="7、高级参数绑定"></a>7、高级参数绑定</h1><h2 id="1、数组类型的参数绑定"><a href="#1、数组类型的参数绑定" class="headerlink" title="1、数组类型的参数绑定"></a>1、数组类型的参数绑定</h2><h3 id="1、需求-2"><a href="#1、需求-2" class="headerlink" title="1、需求"></a>1、需求</h3><p>在商品列表页面选中多个商品，然后删除，此功能要求商品列表页面的每个商品签名有个复选框，选中多个商品后点击删除按钮，将商品id传递给Controller，根据id删除商品信息。</p>
<h3 id="2、jsp页面修改"><a href="#2、jsp页面修改" class="headerlink" title="2、jsp页面修改"></a>2、jsp页面修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot; varStatus=&quot;status&quot;&gt;</div><div class="line">			&lt;tr&gt;</div><div class="line">				&lt;td&gt;</div><div class="line">					&lt;input type=&quot;checkbox&quot; name=&quot;ids&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">				&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.name&quot; value=&quot;$&#123;item.name &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.price&quot; value=&quot;$&#123;item.price &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.createtime&quot;</div><div class="line">						   value=&quot;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.detail&quot; value=&quot;$&#123;item.detail &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/items/itemEdit/$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">			&lt;/tr&gt;</div><div class="line">		&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<h3 id="3、Controller"><a href="#3、Controller" class="headerlink" title="3、Controller"></a>3、Controller</h3><p>Controller方法可以用String[]接收，或者pojo的String[]属性接收。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/delAll&quot;)</div><div class="line">public String delAll(QueryVo vo) throws Exception &#123;</div><div class="line">//        如果批量删除，一堆input框，name可以提交数组，选中的会自动进入到数组中</div><div class="line">    System.out.println(vo);</div><div class="line">    return &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Vo:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line">    //批量删除使用</div><div class="line">    private Integer[] ids;</div><div class="line">    //批量修改使用</div><div class="line">    private List&lt;Items&gt; itemsList;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2、List类型的参数绑定"><a href="#2、List类型的参数绑定" class="headerlink" title="2、List类型的参数绑定"></a>2、List类型的参数绑定</h2><h3 id="1、需求-3"><a href="#1、需求-3" class="headerlink" title="1、需求"></a>1、需求</h3><p>实现商品数据的批量修改。要想实现商品数据的批量修改，需要在商品列表中可以对商品信息进行修改，并且可以批量提交修改后的商品数据。</p>
<h3 id="2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。"><a href="#2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。" class="headerlink" title="2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。"></a>2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line">    //批量删除使用</div><div class="line">    private Integer[] ids;</div><div class="line">    //批量修改使用</div><div class="line">    private List&lt;Items&gt; itemsList;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、jsp修改"><a href="#3、jsp修改" class="headerlink" title="3、jsp修改"></a>3、jsp修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot; varStatus=&quot;status&quot;&gt;</div><div class="line">  &lt;tr&gt;</div><div class="line">    &lt;!-- name属性名称要等于vo中的接收的属性名 --&gt;</div><div class="line">    &lt;!-- 如果批量删除,可以用List&lt;pojo&gt;来接收,页面上input框的name属性值= vo中接收的集合属性名称+[list的下标]+.+list泛型的属性名称 --&gt;</div><div class="line">    &lt;td&gt;</div><div class="line">      &lt;input type=&quot;checkbox&quot; name=&quot;ids&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">      &lt;input type=&quot;hidden&quot; name=&quot;itemsList[$&#123;status.index &#125;].id&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">    &lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].name&quot; value=&quot;$&#123;item.name &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].price&quot; value=&quot;$&#123;item.price &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].createtime&quot;</div><div class="line">           value=&quot;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].detail&quot; value=&quot;$&#123;item.detail &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">    &lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/items/itemEdit/$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">  &lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<p>其中name属性必须是包装pojo的list属性+下表+元素属性。</p>
<ul>
<li><p>varStatus属性常用参数总结：</p>
<ul>
<li>${status.index}      输出行号，从0开始。</li>
<li>${status.count}      输出行号，从1开始。</li>
<li>${status.current}   当前这次迭代的（集合中的）项</li>
<li>${status.first}  判断当前项是否为集合中的第一项，返回值为true或false</li>
<li>${status.last}   判断当前项是否为集合中的最后一项，返回值为true或false</li>
<li>begin、end、step分别表示：起始序号，结束序号，跳跃步伐。</li>
</ul>
</li>
</ul>
<h3 id="4、Controller"><a href="#4、Controller" class="headerlink" title="4、Controller"></a>4、Controller</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/updateAll&quot;)</div><div class="line">public String updateAll(QueryVo vo) throws Exception &#123;</div><div class="line">    System.out.println(vo);</div><div class="line">    return &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <em>接收List类型的数据必须是pojo的属性，方法的形参为List类型无法正确接收到数据</em></p>
<h1 id="8、-RequestMapping注解的使用"><a href="#8、-RequestMapping注解的使用" class="headerlink" title="8、@RequestMapping注解的使用"></a>8、<code>@RequestMapping</code>注解的使用</h1><p>通过<code>@RequestMapping</code>注解可以定义不同的处理器映射规则。</p>
<ul>
<li><p><code>@RequestMapping(value=&quot;/item&quot;)</code>或者<code>@RequestMapping(&quot;/item&quot;)</code>， value的值是数组，可以将多个url映射到一个方法中。</p>
</li>
<li><p>窄化请求映射，在class上添加<code>@RequestMapping(url)</code>指定通用请求前缀，限制此类下的所有方法请求url必须以请求前缀开头，通过此方法对url进行分类管理。例如：在类名上添加<code>@RequestMapping(&quot;/item&quot;)</code>,在方法名上添加<code>@RequestMapping(&quot;/list&quot;)</code>，则访问地址为：<code>/item/list</code></p>
</li>
<li><p>方法请求限定：</p>
<ul>
<li><p>限定Get方法：<code>@RequestMapping(method = RequestMethod.GET)</code> 如果通过post请求会报错：<code>HTTP Status 405 - Request method &#39;POST&#39; not supported</code></p>
</li>
<li><p>限定POST方法：<code>@RequestMapping(method = RequestMethod.POST)</code>如果通过get请求则报错：<code>HTTP Status 405 - Request method &#39;GET&#39; not supported</code></p>
</li>
<li><p>GET和POST都可以：<code>@RequestMapping(method={RequestMethod.GET,RequestMethod.POST})</code></p>
</li>
</ul>
</li>
</ul>
<h1 id="9、Controller方法的返回值"><a href="#9、Controller方法的返回值" class="headerlink" title="9、Controller方法的返回值"></a>9、Controller方法的返回值</h1><ol>
<li><p>返回ModelAndView：controller方法中定义ModelAndView对象并返回，对象中可添加model数据，指定view。</p>
</li>
<li><p>返回Void：在controller方法形参上可以定义request和response，使用request或者response指定响应结果：</p>
<ul>
<li><p>使用request转向页面：<code>request.getRequestDispatcher(&quot;/WEB-INF/jsp/success.jsp&quot;).forward(request, response);</code></p>
</li>
<li><p>使用response重定向:<code>response.sendRedirect(&quot;url&quot;)</code></p>
</li>
<li><p>也可以通过response指定响应结果：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">response.setCharacterEncoding(&quot;utf-8&quot;);</div><div class="line">response.setContentType(&quot;application/json;charset=utf-8&quot;);</div><div class="line">response.getWriter().write(&quot;json串&quot;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回字符串</p>
<ul>
<li><p>逻辑视图名</p>
<ul>
<li><p>controller方法返回字符串可以指定逻辑视图名，通过视图解析器解析为物理视图地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//指定逻辑视图名，经过视图解析器解析为jsp物理路径：/WEB-INF/jsp/item/editItem.jsp</div><div class="line">return &quot;item/editItem&quot;;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Redirect重定向</p>
<ul>
<li><p>Controller方法返回结果重定向到一个url地址吗，如下商品修改提交后重定向到商品查询方法，参数无法带到商品查询方法中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//重定向到queryItem.action地址,request无法带过去</div><div class="line">return &quot;redirect:queryItem.action&quot;;</div></pre></td></tr></table></figure>
</li>
<li><p>redirect方式相当于<code>response.sendRedirect()</code>,转发后浏览器的地址栏变为转发后的地址，因为转发执行了一个新的request和response。由于发起了一个request原来的参数在转发时就不能传递到下一个url，如果要传入参数可以在url中添加</p>
</li>
</ul>
</li>
<li><p>forward转发</p>
<ul>
<li><p>controller方法执行后继续执行另一个controller方法，如下商品修改提交后转向到商品修改页面，修改商品的id参数可以带到商品修改方法中去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//结果转发到editItem.action，request可以带过去</div><div class="line">return &quot;forward:editItem.action&quot;;</div></pre></td></tr></table></figure>
</li>
<li><p>forward方式相当于<code>request.getRequestDispatcher().forward(request,response)</code>，转发后浏览器地址栏还是原来的地址，转发并没有执行新的request和response，而是和转发前的请求公用一个request和response。所以转发请求的参数在转发后仍然可以读取到。</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="10、Springmvc中的异常处理"><a href="#10、Springmvc中的异常处理" class="headerlink" title="10、Springmvc中的异常处理"></a>10、Springmvc中的异常处理</h1><p>springmvc在处理请求过程中出现异常信息交由异常处理器进行处理，自定义异常处理器可以实现一个系统的异常处理逻辑。</p>
<h2 id="1、异常处理思路"><a href="#1、异常处理思路" class="headerlink" title="1、异常处理思路"></a>1、异常处理思路</h2><ul>
<li><p>系统中异常分为两类：</p>
<ul>
<li><p>预期异常，通过捕获异常从而获取异常</p>
</li>
<li><p>运行时异常，规范代码开发</p>
</li>
</ul>
</li>
<li><p>系统的dao、service、controller出现都通过throws Exception向上抛出，最后由springmvc的前端控制器交由异常处理器进行异常处理</p>
</li>
</ul>
<p><img src="/img/springmvc-5.png" alt="Alt text"></p>
<h2 id="2、自定义异常类"><a href="#2、自定义异常类" class="headerlink" title="2、自定义异常类"></a>2、自定义异常类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class CustomException extends Exception &#123;</div><div class="line"></div><div class="line">	/** serialVersionUID*/</div><div class="line">	private static final long serialVersionUID = -5212079010855161498L;</div><div class="line"></div><div class="line">	public CustomException(String message)&#123;</div><div class="line">		super(message);</div><div class="line">		this.message = message;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//异常信息</div><div class="line">	private String message;</div><div class="line"></div><div class="line">	public String getMessage() &#123;</div><div class="line">		return message;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setMessage(String message) &#123;</div><div class="line">		this.message = message;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、自定义异常处理器"><a href="#3、自定义异常处理器" class="headerlink" title="3、自定义异常处理器"></a>3、自定义异常处理器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class CustomExceptionResolver implements HandlerExceptionResolver &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public ModelAndView resolveException(HttpServletRequest request,</div><div class="line">			HttpServletResponse response, Object handler, Exception ex) &#123;</div><div class="line"></div><div class="line">		ex.printStackTrace();</div><div class="line"></div><div class="line">		CustomException customException = null;</div><div class="line"></div><div class="line">		//如果抛出的是系统自定义异常则直接转换</div><div class="line">		if(ex instanceof CustomException)&#123;</div><div class="line">			customException = (CustomException)ex;</div><div class="line">		&#125;else&#123;</div><div class="line">			//如果抛出的不是系统自定义异常则重新构造一个系统错误异常。</div><div class="line">			customException = new CustomException(&quot;系统错误，请与系统管理 员联系！&quot;);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		ModelAndView modelAndView = new ModelAndView();</div><div class="line">		modelAndView.addObject(&quot;message&quot;, customException.getMessage());</div><div class="line">		modelAndView.setViewName(&quot;error&quot;);</div><div class="line"></div><div class="line">		return modelAndView;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4、配置异常处理器"><a href="#4、配置异常处理器" class="headerlink" title="4、配置异常处理器"></a>4、配置异常处理器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 异常处理器 --&gt;</div><div class="line">	&lt;bean id=&quot;handlerExceptionResolver&quot; class=&quot;cn.itcast.ssm.controller.exceptionResolver.CustomExceptionResolver&quot;/&gt;</div></pre></td></tr></table></figure>
<h1 id="11、-图片上传处理"><a href="#11、-图片上传处理" class="headerlink" title="11、 图片上传处理"></a>11、 图片上传处理</h1><h2 id="1、Tomcat上配置图片虚拟目录"><a href="#1、Tomcat上配置图片虚拟目录" class="headerlink" title="1、Tomcat上配置图片虚拟目录"></a>1、Tomcat上配置图片虚拟目录</h2><p>  <img src="/img/springmvc-6.png" alt="Alt text"></p>
<h2 id="2、jar包-1"><a href="#2、jar包-1" class="headerlink" title="2、jar包"></a>2、jar包</h2><p>CommonsMultipartResolver解析器依赖commons-fileupload和commons-io</p>
<h2 id="3、配置解析器"><a href="#3、配置解析器" class="headerlink" title="3、配置解析器"></a>3、配置解析器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置文件上传--&gt;</div><div class="line">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</div><div class="line">    &lt;!--设置上传文件的最大尺寸为5M--&gt;</div><div class="line">    &lt;property name=&quot;maxUploadSize&quot;&gt;</div><div class="line">        &lt;value&gt;5242880&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h2 id="4、图片上传实现"><a href="#4、图片上传实现" class="headerlink" title="4、图片上传实现"></a>4、图片上传实现</h2><ul>
<li><p>Controller</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/updateitem&quot;)</div><div class="line">public String update(MultipartFile pictureFile, Items items) throws Exception &#123;</div><div class="line"></div><div class="line">    //1获取图片完整名称</div><div class="line">    String fileStr = pictureFile.getOriginalFilename();</div><div class="line">    //2使用随机生成的字符串+原图片扩展名，放置图片重名</div><div class="line">    String newFileStr = UUID.randomUUID().toString() + fileStr.substring(fileStr.lastIndexOf(&quot;.&quot;));</div><div class="line">    //3将图片保存到硬盘</div><div class="line">    pictureFile.transferTo(new File(&quot;E:\\pic\\&quot; + newFileStr));</div><div class="line">    //4将图片名称保存到数据库</div><div class="line">    items.setPic(newFileStr);</div><div class="line"></div><div class="line">    itemsService.updateItem(items);</div><div class="line"></div><div class="line">    return &quot;redirect:itemEdit/&quot; + items.getId();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;form id=&quot;itemForm&quot;	action=&quot;$&#123;pageContext.request.contextPath &#125;/items/updateitem&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</div><div class="line">	     ...</div><div class="line">        &lt;tr&gt;</div><div class="line">            &lt;td&gt;商品图片&lt;/td&gt;</div><div class="line">            &lt;td&gt;</div><div class="line">                &lt;c:if test=&quot;$&#123;item.pic !=null&#125;&quot;&gt;</div><div class="line">                    &lt;img src=&quot;/pic/$&#123;item.pic&#125;&quot; width=100 height=100/&gt;</div><div class="line">                    &lt;br/&gt;</div><div class="line">                &lt;/c:if&gt;</div><div class="line">                &lt;input type=&quot;file&quot;  name=&quot;pictureFile&quot;/&gt;</div><div class="line">            &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">			 ...</div><div class="line">	&lt;/form&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="12、Json数据交互"><a href="#12、Json数据交互" class="headerlink" title="12、Json数据交互"></a>12、Json数据交互</h1><h2 id="1、-RequestBody"><a href="#1、-RequestBody" class="headerlink" title="1、@RequestBody"></a>1、<code>@RequestBody</code></h2><ul>
<li><code>@RequestBody</code>注解用于读取http请求的内容，通过springmvc提供的HttpMessageConvert接口架构读到的内容转换为json，xml等格式的数据并绑定到controller方法的参数上。</li>
</ul>
<h2 id="2、-ResponseBody"><a href="#2、-ResponseBody" class="headerlink" title="2、@ResponseBody"></a>2、<code>@ResponseBody</code></h2><ul>
<li>该注解用于将Controller的方法返回的对象，通过HttpMessageConverter接口转换为指定格式的数据如：json,xml等，通过Response响应给客户端</li>
</ul>
<h2 id="3、请求json，相应json的实现"><a href="#3、请求json，相应json的实现" class="headerlink" title="3、请求json，相应json的实现"></a>3、请求json，相应json的实现</h2><ol>
<li><p>环境准备：springmvc默认用MappingJacksonHttpMesseageConvert对json数据进行转换，需要加入Jackson的包：</p>
<ul>
<li><p>jackson-core-asl-1.9.11.jar</p>
</li>
<li><p>jackson-mapper-asl-1.9.11.jar</p>
</li>
</ul>
</li>
<li><p>配置json转换器:在注解适配器中加入messageConvert</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;!--注解适配器 --&gt;</div><div class="line">	&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;</div><div class="line">		&lt;property name=&quot;messageConverters&quot;&gt;</div><div class="line">		&lt;list&gt;</div><div class="line">		&lt;bean class=&quot;org.springframework.http.converter.json.MappingJacksonHttpMessageConverter&quot;&gt;&lt;/bean&gt;</div><div class="line">		&lt;/list&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">	&lt;/bean&gt;</div></pre></td></tr></table></figure>
<p> 如果使用了<mvc:annotation-driven> 则不用定义上边的内容。</mvc:annotation-driven></p>
</li>
<li><p>Controller编写</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//导入jsckson的jar包在controller的方法中可以使用@RequestBody，让springmvc将</div><div class="line">// json格式字符串自动转换成java中的pojo对象，要求json的key的值等于pojo中的属性</div><div class="line">@RequestMapping(&quot;/sendJson&quot;)</div><div class="line">//controller方法返回pojo类型的对象，添加@ResponseBody注解，</div><div class="line">// springmvc会自动将对象转换成json格式字符串并传递给页面</div><div class="line">@ResponseBody</div><div class="line">public Items json(@RequestBody Items items) throws Exception &#123;</div><div class="line">    System.out.println(items);</div><div class="line"></div><div class="line">    return items;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>页面js方法的编写</p>
<ul>
<li><p>引入js：    <script type="text/javascript" src="${pageContext.request.contextPath }/js/jquery-1.4.4.min.js"></script></p>
</li>
<li><p>ajax请求：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    function sendJson()&#123;</div><div class="line">        //请求json响应json</div><div class="line">        $.ajax(&#123;</div><div class="line">            type:&quot;post&quot;,</div><div class="line">            url:&quot;$&#123;pageContext.request.contextPath &#125;/items/sendJson.action&quot;,</div><div class="line">            contentType:&quot;application/json;charset=utf-8&quot;,</div><div class="line">            data:&apos;&#123;&quot;name&quot;:&quot;测试商品&quot;,&quot;price&quot;:99.9&#125;&apos;,</div><div class="line">            success:function(data)&#123;</div><div class="line">                alert(data);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h1 id="13、Springmvc实现Restful"><a href="#13、Springmvc实现Restful" class="headerlink" title="13、Springmvc实现Restful"></a>13、Springmvc实现Restful</h1><h2 id="1、RESTful定义"><a href="#1、RESTful定义" class="headerlink" title="1、RESTful定义"></a>1、RESTful定义</h2><ul>
<li><p>Restful就是一个资源定位及资源操作的风格。不是标准也不是协议，只是一种风格，是对http协议的诠释。</p>
</li>
<li><p>资源定位：互联网所有的事物都是资源，要求url中没有动词，只有名词。没有参数:Url格式：<a href="http://blog.csdn.net/beat_the_world/article/details/45621673" target="_blank" rel="external">http://blog.csdn.net/beat_the_world/article/details/45621673</a></p>
</li>
<li><p>资源操作：使用put、delete、post、get，使用不同方法对资源进行操作。分别对应添加、删除、修改、查询。一般使用时还是post和get。Put和Delete几乎不使用。</p>
</li>
</ul>
<h2 id="2、需求-1"><a href="#2、需求-1" class="headerlink" title="2、需求"></a>2、需求</h2><p>RESTful方式实现商品信息查询，返回json数据。</p>
<h2 id="3、添加DispatcherServlet的rest配置"><a href="#3、添加DispatcherServlet的rest配置" class="headerlink" title="3、添加DispatcherServlet的rest配置"></a>3、添加DispatcherServlet的rest配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;!--SpringMVC的前端控制器--&gt;</div><div class="line">&lt;servlet&gt;</div><div class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath:SpringMvc.xml&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line">    &lt;!--在Tomcat启动的时候就加载这个Servlet--&gt;</div><div class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">&lt;/servlet&gt;</div><div class="line">&lt;servlet-mapping&gt;</div><div class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">    &lt;!--</div><div class="line">    &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">    *.action    拦截后缀名为.action结尾的</div><div class="line">    /           拦截所有到那时不包括.jsp</div><div class="line">    /*          拦截所有，包括.jsp</div><div class="line">    --&gt;</div><div class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</div><div class="line">&lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure>
<h2 id="4、URL模板模式映射"><a href="#4、URL模板模式映射" class="headerlink" title="4、URL模板模式映射"></a>4、URL模板模式映射</h2><ul>
<li><p><code>@RequestMapping(value=&quot;/ viewItems/{id}&quot;)</code>：{×××}占位符，请求的URL可以是“/viewItems/1”或“/viewItems/2”，通过在方法中使用<code>@PathVariable</code>获取{×××}中的×××变量。</p>
</li>
<li><p><code>@PathVariable</code>用于将请求URL中的模板变量映射到功能处理方法的参数上。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit/&#123;id&#125;&quot;)</div><div class="line">public String itemEdit(@PathVariable(&quot;id&quot;) Integer id,  HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">//        String idStr = reuqest.getParameter(&quot;id&quot;);</div><div class="line">    Items items = itemsService.findItemsById(id);</div><div class="line">//        if (items == null) &#123;</div><div class="line">//            throw new CustomException(&quot;商品信息不存在！&quot;);</div><div class="line">//        &#125;</div><div class="line"></div><div class="line">    model.addAttribute(&quot;item&quot;, items);</div><div class="line">    //如果springmvc方法返回一个简单的字符串，nameSpringmvc就会认为这个字符串是页面的名称</div><div class="line">    return &quot;editItem&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果RequestMapping中表示为”/itemEdit/{id}”，id和形参名称一致，使用<code>@PathVariable</code>不用指定名称。</li>
</ul>
</li>
</ul>
<h2 id="5、静态资源访问"><a href="#5、静态资源访问" class="headerlink" title="5、静态资源访问"></a>5、静态资源访问<mvc:resources></mvc:resources></h2><ul>
<li><p>如果在DispatcherServlet中设置url-pattern为 /则必须对静态资源进行访问处理。spring mvc 的<mvc:resources mapping location>实现对静态资源进行映射访问。</mvc:resources></p>
</li>
<li><p>如下是对js文件访问配置：<code>&lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt;</code></p>
</li>
</ul>
<h1 id="14、拦截器"><a href="#14、拦截器" class="headerlink" title="14、拦截器"></a>14、拦截器</h1><h2 id="1、定义"><a href="#1、定义" class="headerlink" title="1、定义"></a>1、定义</h2><ul>
<li>Spring Web MVC 的处理器拦截器类似于Servlet 开发中的过滤器Filter，用于对处理器进行预处理和后处理。</li>
</ul>
<h2 id="2、拦截器定义"><a href="#2、拦截器定义" class="headerlink" title="2、拦截器定义"></a>2、拦截器定义</h2><ul>
<li><p>实现HandlerInterceptor接口，如下：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">public class Inteceptor1 implements HandlerInterceptor&#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时间：controller方法没有被执行， modelAndView没有被返回</div><div class="line">     * 使用场景：权限验证</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @return true:放行， false：拦截</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========pre===========&quot;);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时机：controller方法已经执行，modelAndView没有返回</div><div class="line">     * 使用场景：可以在此方法中设置全局的数据处理业务，</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @param modelAndView</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========post===========&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时机：controller方法已经执行，modelAndView已经返回</div><div class="line">     * 使用场景：记录操作日志，记录登录用户的IP，时间等</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @param e</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========after===========&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3、拦截器配置"><a href="#3、拦截器配置" class="headerlink" title="3、拦截器配置"></a>3、拦截器配置</h2><h3 id="1、针对某种mapping配置拦截器"><a href="#1、针对某种mapping配置拦截器" class="headerlink" title="1、针对某种mapping配置拦截器"></a>1、针对某种mapping配置拦截器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;bean</div><div class="line">	class=&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;&gt;</div><div class="line">	&lt;property name=&quot;interceptors&quot;&gt;</div><div class="line">		&lt;list&gt;</div><div class="line">			&lt;ref bean=&quot;handlerInterceptor1&quot;/&gt;</div><div class="line">			&lt;ref bean=&quot;handlerInterceptor2&quot;/&gt;</div><div class="line">		&lt;/list&gt;</div><div class="line">	&lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">	&lt;bean id=&quot;handlerInterceptor1&quot; class=&quot;springmvc.intercapter.HandlerInterceptor1&quot;/&gt;</div><div class="line">	&lt;bean id=&quot;handlerInterceptor2&quot; class=&quot;springmvc.intercapter.HandlerInterceptor2&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="2、针对所有mapper配置全局拦截器"><a href="#2、针对所有mapper配置全局拦截器" class="headerlink" title="2、针对所有mapper配置全局拦截器"></a>2、针对所有mapper配置全局拦截器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置拦截器--&gt;</div><div class="line">&lt;mvc:interceptors&gt;</div><div class="line">    &lt;!--多个拦截器的执行顺序，等于其配置顺序--&gt;</div><div class="line">    &lt;mvc:interceptor&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;配置拦截请求的路径 /**代表所有&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;mvc:mapping path=&quot;/**&quot;/&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;指定拦截器的位置&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;bean class=&quot;cn.itheima.interceptor.Inteceptor1&quot;/&gt;</div><div class="line">    &lt;/mvc:interceptor&gt;</div><div class="line"></div><div class="line">    &lt;mvc:interceptor&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;配置拦截请求的路径 /**代表所有&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;mvc:mapping path=&quot;/**&quot;/&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;指定拦截器的位置&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;bean class=&quot;cn.itheima.interceptor.Inteceptor2&quot;/&gt;</div><div class="line">    &lt;/mvc:interceptor&gt;</div><div class="line">&lt;/mvc:interceptors&gt;</div></pre></td></tr></table></figure>
<h2 id="4、测试流程"><a href="#4、测试流程" class="headerlink" title="4、测试流程"></a>4、测试流程</h2><ul>
<li><p>定义两个拦截器分别为HandlerInterceptor1和HandlerInterceptor2，每个拦截器的preHandler方法都返回true：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception &#123;</div><div class="line">    System.out.println(&quot;==========Inteceptor1===========pre===========&quot;);</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre></li>
<li><p>运行流程：</p>
<ul>
<li>HandlerInterceptor1..preHandle..</li>
<li>HandlerInterceptor2..preHandle..</li>
<li>HandlerInterceptor2..postHandle..</li>
<li>HandlerInterceptor1..postHandle..</li>
<li>HandlerInterceptor2..afterCompletion..</li>
<li>HandlerInterceptor1..afterCompletion..</li>
</ul>
</li>
</ul>
<h2 id="5、终端流程测试"><a href="#5、终端流程测试" class="headerlink" title="5、终端流程测试"></a>5、终端流程测试</h2><ul>
<li><p>定义两个拦截器分别为HandlerInterceptor1和HandlerInterceptor2</p>
</li>
<li><p>运行流程：</p>
<ul>
<li><p>preHandler按拦截器定义顺序调用</p>
</li>
<li><p>postHandler按拦截器定义逆序调用</p>
</li>
<li><p>afterCompletion按拦截器定义逆序调用</p>
</li>
<li><p>postHandler在拦截器链内所有拦截器返回成功调用</p>
</li>
<li><p>afterCompletion只有preHandler返回true才调用</p>
</li>
</ul>
</li>
</ul>
<h2 id="6、拦截器应用"><a href="#6、拦截器应用" class="headerlink" title="6、拦截器应用"></a>6、拦截器应用</h2><h3 id="1、处理流程"><a href="#1、处理流程" class="headerlink" title="1、处理流程"></a>1、处理流程</h3><ol>
<li><p>有一个登录页面，需要写一个controler访问页面</p>
</li>
<li><p>登录页面有一项提交表单的动作，需要在controller中处理。</p>
<ul>
<li><p>判断用户名是否正确</p>
</li>
<li><p>如果正确，向session中写入用户信息</p>
</li>
<li><p>返回登录成功，或者跳转到登录页面</p>
</li>
</ul>
</li>
<li><p>拦截器</p>
<ul>
<li><p>拦截用户请求，判断用户是否登录</p>
</li>
<li><p>如果已经登录，放行</p>
</li>
<li><p>如果用户未登录，跳转到登录页面</p>
</li>
</ul>
</li>
</ol>
<h3 id="2、用户身份认证"><a href="#2、用户身份认证" class="headerlink" title="2、用户身份认证"></a>2、用户身份认证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">package cn.itheima.interceptor;</div><div class="line"></div><div class="line">import org.springframework.web.servlet.HandlerInterceptor;</div><div class="line">import org.springframework.web.servlet.ModelAndView;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import javax.servlet.http.HttpSession;</div><div class="line"></div><div class="line">public class LoginInterceptor implements HandlerInterceptor&#123;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object arg2) throws Exception &#123;</div><div class="line">        //判断当前访问路径是否为登录的路径,如果是则放行</div><div class="line">        if(request.getRequestURI().indexOf(&quot;/login&quot;) &gt;= 0)&#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //判断session中是否有登录信息,如果没有则跳转到登录页面,如果有则放行</div><div class="line">        HttpSession session = request.getSession();</div><div class="line">        if(session.getAttribute(&quot;username&quot;) != null)&#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        request.getRequestDispatcher(&quot;/WEB-INF/jsp/login.jsp&quot;).forward(request, response);</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、用户登录controller"><a href="#3、用户登录controller" class="headerlink" title="3、用户登录controller"></a>3、用户登录controller</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">@RequestMapping(&quot;/login&quot;)</div><div class="line">public class LoginController &#123;</div><div class="line"></div><div class="line">    //跳转到登录页面</div><div class="line">    @RequestMapping(&quot;/login&quot;)</div><div class="line">    public String login() throws Exception&#123;</div><div class="line">        return &quot;login&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/submit&quot;)</div><div class="line">    public String submit(String username, String pwd ,HttpServletRequest request) throws Exception&#123;</div><div class="line"></div><div class="line">        HttpSession session = request.getSession();</div><div class="line">        //判断用户名密码的正确性,如果正确则将登录信息放入session中</div><div class="line">        //这里简写,真正项目中需要去数据库中校验用户名和密码</div><div class="line">        if(username != null)&#123;</div><div class="line">            session.setAttribute(&quot;username&quot;, username);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //跳转到列表页</div><div class="line">        return &quot;redirect:/items/list&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="15、重点总结"><a href="#15、重点总结" class="headerlink" title="15、重点总结"></a>15、重点总结</h1><ol>
<li><p>springMvc:是一个表现层框架</p>
<ul>
<li>作用:就是从请求中接收传入的参数,将处理后的结果数据返回给页面展示</li>
</ul>
</li>
<li><p>ssm整合:</p>
<ol>
<li><p>Dao层</p>
<ul>
<li><p>pojo和映射文件以及接口使用逆向工程生成</p>
</li>
<li><p>SqlMapConfig.xml   mybatis核心配置文件</p>
</li>
<li><p>ApplicationContext-dao.xml 整合后spring在dao层的配置</p>
</li>
<li><p>数据源</p>
</li>
<li><p>会话工厂</p>
</li>
<li><p>扫描Mapper</p>
</li>
</ul>
</li>
<li><p>service层</p>
<ul>
<li><p>事务            ApplicationContext-trans.xml</p>
</li>
<li><p><code>@Service</code>注解扫描    ApplicationContext-service.xml</p>
</li>
</ul>
</li>
<li><p>controller层</p>
<ul>
<li><p>SpringMvc.xml</p>
<ul>
<li><p>注解扫描:扫描@Controller注解</p>
</li>
<li><p>注解驱动:替我们显示的配置了最新版的处理器映射器和处理器适配器</p>
</li>
<li><p>视图解析器:显示的配置是为了在controller中不用每个方法都写页面的全路径</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>web.xml</p>
<ul>
<li><p>springMvc前端控制器配置</p>
</li>
<li><p>spring监听</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>参数绑定:(从请求中接收参数)</p>
<ol>
<li><p>默认支持的类型:Request,Response,Session,Model</p>
</li>
<li><p>基本数据类型(包含String)</p>
</li>
<li><p>Pojo类型</p>
</li>
<li><p>Vo类型</p>
</li>
<li><p>Converter自定义转换器</p>
</li>
<li><p>数组</p>
</li>
<li><p>List</p>
</li>
</ol>
</li>
<li><p>controller方法返回值(指定返回到哪个页面, 指定返回到页面的数据)</p>
<ol>
<li><p>ModelAndView</p>
<ul>
<li><p>modelAndView.addObject(“itemList”, list); 指定返回页面的数据</p>
</li>
<li><p>modelAndView.setViewName(“itemList”);      指定返回的页面</p>
</li>
</ul>
</li>
<li><p>String(推荐使用)</p>
<ul>
<li><p>返回普通字符串,就是页面去掉扩展名的名称, 返回给页面数据通过Model来完成</p>
</li>
<li><p>返回的字符串以forward:开头为请求转发</p>
</li>
<li><p>返回的字符串以redirect:开头为重定向</p>
</li>
</ul>
</li>
<li><p>返回void(使用它破坏了springMvc的结构,所以不建议使用)</p>
<ul>
<li><p>可以使用request.setAttribut 来给页面返回数据</p>
</li>
<li><p>可以使用request.getRquestDispatcher().forward()来指定返回的页面</p>
</li>
<li><p>如果controller返回值为void则不走springMvc的组件,所以要写页面的完整路径名称</p>
</li>
</ul>
<ul>
<li><p>相对路径:相对于当前目录,也就是在当前类的目录下,这时候可以使用相对路径跳转</p>
</li>
<li><p>绝对路径:从项目名后开始.</p>
</li>
<li><p>在springMvc中不管是forward还是redirect后面凡是以/开头的为绝对路径,不以/开头的为相对路径例如:forward:/items/itemEdit.action 为绝对路径,forward:itemEdit.action为相对路径</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>架构级别异常处理:</p>
<ul>
<li>主要为了防止项目上线后给用户抛500等异常信息,所以需要在架构级别上整体处理.hold住异常首先自定义全局异常处理器实现HandlerExceptionResolver接口,在spirngMvc.xml中配置生效</li>
</ul>
</li>
<li><p>上传图片:</p>
<ol>
<li><p>在tomcat中配置虚拟图片服务器</p>
</li>
<li><p>导入fileupload的jar包</p>
</li>
<li><p>在springMvc.xml中配置上传组件</p>
</li>
<li><p>在页面上编写上传域,更改form标签的类型</p>
</li>
<li><p>在controller方法中可以使用MultiPartFile接口接收上传的图片</p>
</li>
<li><p>将文件名保存到数据库,将图片保存到磁盘中</p>
</li>
</ol>
</li>
<li><p>Json数据交互:</p>
<ul>
<li><p>需要加入jackson的jar包</p>
</li>
<li><p><code>@Requestbody</code>:将页面传到controller中的json格式字符串自动转换成java的pojo对象</p>
</li>
<li><p><code>@ResponseBody</code>:将java中pojo对象自动转换成json格式字符串返回给页面</p>
</li>
</ul>
</li>
<li><p>RestFul支持:</p>
<ul>
<li><p>就是对url的命名标准,要求url中只有能名词,没有动词(不严格要求),但是要求url中不能用问号?传参<br>传参数:</p>
<ul>
<li><p>页面:${pageContext.request.contextPath }/items/itemEdit/${item.id}</p>
</li>
<li><p>方法: @RquestMapping(“/itemEdit/{id}”)</p>
</li>
<li><p>方法: @PathVariable(“id”) Integer idd</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>拦截器:</p>
<ul>
<li><p>作用:拦截请求,一般做登录权限验证时用的比较多</p>
<ol>
<li><p>需要编写自定义拦截器类,实现HandlerInterceptor接口</p>
</li>
<li><p>在spirngMvc.xml中配置拦截器生效</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>登录权限验证:</p>
<ol>
<li><p>编写登录的controller, 编写跳转到登录页面的方法,  编写登录验证方法</p>
</li>
<li><p>编写登录页面</p>
</li>
<li><p>编写拦截器</p>
</li>
</ol>
<ul>
<li>运行过程:</li>
</ul>
<ol>
<li><p>访问随意一个页面,拦截器会拦截请求,会验证session中是否有登录信息,如果已登录,放行,        如果未登录,跳转到登录页面</p>
</li>
<li><p>在登录页面中输入用户名,密码,点击登录按钮,拦截器会拦截请求,如果是登录路径放行,在controller方法中判断用户名密码是否正确,如果正确则将登录信息放入session</p>
</li>
</ol>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.gif"
              alt="cdx" />
          
            <p class="site-author-name" itemprop="name">cdx</p>
            <p class="site-description motion-element" itemprop="description">Be a better man!</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">85</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cdx0312" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:cdxu0312@outlook.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cdx</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
