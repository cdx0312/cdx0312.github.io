<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Be a better man!">
<meta property="og:type" content="website">
<meta property="og:title" content="小黄">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小黄">
<meta property="og:description" content="Be a better man!">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小黄">
<meta name="twitter:description" content="Be a better man!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>小黄</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黄</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">黄小黄的幸福生活！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/Java/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Java
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/25/设计模式之代理模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/设计模式之代理模式/" itemprop="url">设计模式之代理模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-25T19:59:03+08:00">
                2018-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/design-patterns/" itemprop="url" rel="index">
                    <span itemprop="name">design patterns</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h1><p>为其他对象提供一种代理，以控制对这个对象的访问。代理对象起到中介作用，可以去掉功能服务或者增加额外的功能服务。</p>
<h1 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h1><p>代理和被代理对象在代理之前是确定的。他们都是事先相同的接口或者继承相同的抽象类。</p>
<p><img src="/img/dp-staticProxy.png" alt="Alt text"></p>
<p>创建一个接口Moveable，Car继承Moveable接口，要求用代理类来记录Car的运行时间。</p>
<p>Car继承Moveable接口:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface Moveable &#123;</div><div class="line">    void move();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Car:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Car implements Moveable&#123;</div><div class="line">    @Override</div><div class="line">    public void move() &#123;</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(new Random().nextInt(1000));</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="继承实现静态代理"><a href="#继承实现静态代理" class="headerlink" title="继承实现静态代理"></a>继承实现静态代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Car2 extends Car&#123;</div><div class="line">    @Override</div><div class="line">    public void move() &#123;</div><div class="line">        long startTime = System.currentTimeMillis();</div><div class="line">        System.out.println(startTime);</div><div class="line">        super.move();</div><div class="line">        long endTime = System.currentTimeMillis();</div><div class="line">        System.out.println(endTime);</div><div class="line">        System.out.println(endTime - startTime);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="聚合实现静态代理"><a href="#聚合实现静态代理" class="headerlink" title="聚合实现静态代理"></a>聚合实现静态代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class Car3 implements Moveable&#123;</div><div class="line"></div><div class="line">    private Car car;</div><div class="line"></div><div class="line">    public Car3(Car car) &#123;</div><div class="line">        this.car = car;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void move() &#123;</div><div class="line">        long startTime = System.currentTimeMillis();</div><div class="line">        System.out.println(startTime);</div><div class="line">        car.move();</div><div class="line">        long endTime = System.currentTimeMillis();</div><div class="line">        System.out.println(endTime);</div><div class="line">        System.out.println(endTime - startTime);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>考虑到继承方式扩展代理功能的不方便，推荐使用聚合实现静态代理。也就是代理类和实际类实现共同的接口，代理类中包含所实现接口的引用。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class CarLogProxy implements Moveable&#123;</div><div class="line"></div><div class="line">    private Moveable moveable;</div><div class="line"></div><div class="line">    public CarLogProxy(Moveable moveable) &#123;</div><div class="line">        this.moveable = moveable;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void move() &#123;</div><div class="line">        System.out.println(&quot;log start&quot;);</div><div class="line">        moveable.move();</div><div class="line">        System.out.println(&quot;log end&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class CarTimeProxy implements Moveable&#123;</div><div class="line"></div><div class="line">    private Moveable moveable;</div><div class="line"></div><div class="line">    public CarTimeProxy(Moveable moveable) &#123;</div><div class="line">        this.moveable = moveable;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void move() &#123;</div><div class="line">        long startTime = System.currentTimeMillis();</div><div class="line">        System.out.println(startTime);</div><div class="line">        moveable.move();</div><div class="line">        long endTime = System.currentTimeMillis();</div><div class="line">        System.out.println(endTime);</div><div class="line">        System.out.println(endTime - startTime);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Moveable car = new Car();</div><div class="line">        CarTimeProxy carTimeProxy = new CarTimeProxy(car);</div><div class="line">        CarLogProxy carLogProxy = new CarLogProxy(carTimeProxy);</div><div class="line">        carLogProxy.move();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><p>前面实现了Car类的静态代理，为其添加了运行时间记录和日志记录的功能。如果需要为火车或者自行车添加类似的功能，需要重新定义相同的类，类十分臃肿，同时代码重用性不高，因此引入了动态代理，也就是在程序</p>
<h2 id="jdk动态代理"><a href="#jdk动态代理" class="headerlink" title="jdk动态代理"></a>jdk动态代理</h2><p><img src="/img/dp-dynamicProxy.png" alt="Alt text"></p>
<ul>
<li>InvocationHandler接口，接口中定义了一个invoke方法，invoke方法中第一个参数表示代理类，第二个参数指被代理的方法，args指该方法的参数数组。这个抽象方法会在代理类中动态实现。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface InvocationHandler &#123;</div><div class="line">    public Object invoke(Object proxy, Method method, Object[] args)</div><div class="line">        throws Throwable;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Proxy：该类为动态代理类，其中的newProxyInstance方法返回一个代理类实例，返回后的代理类可以被当做代理类使用，可使用被代理类的在接口中声明过的方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">public static Object newProxyInstance(ClassLoader loader,</div><div class="line">                                          Class&lt;?&gt;[] interfaces,</div><div class="line">                                          InvocationHandler h)</div><div class="line">        throws IllegalArgumentException</div><div class="line">    &#123;</div><div class="line">        Objects.requireNonNull(h);</div><div class="line"></div><div class="line">        final Class&lt;?&gt;[] intfs = interfaces.clone();</div><div class="line">        final SecurityManager sm = System.getSecurityManager();</div><div class="line">        if (sm != null) &#123;</div><div class="line">            checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        /*</div><div class="line">         * Look up or generate the designated proxy class.</div><div class="line">         */</div><div class="line">        Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</div><div class="line"></div><div class="line">        /*</div><div class="line">         * Invoke its constructor with the designated invocation handler.</div><div class="line">         */</div><div class="line">        try &#123;</div><div class="line">            if (sm != null) &#123;</div><div class="line">                checkNewProxyPermission(Reflection.getCallerClass(), cl);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</div><div class="line">            final InvocationHandler ih = h;</div><div class="line">            if (!Modifier.isPublic(cl.getModifiers())) &#123;</div><div class="line">                AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;</div><div class="line">                    public Void run() &#123;</div><div class="line">                        cons.setAccessible(true);</div><div class="line">                        return null;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">            return cons.newInstance(new Object[]&#123;h&#125;);</div><div class="line">        &#125; catch (IllegalAccessException|InstantiationException e) &#123;</div><div class="line">            throw new InternalError(e.toString(), e);</div><div class="line">        &#125; catch (InvocationTargetException e) &#123;</div><div class="line">            Throwable t = e.getCause();</div><div class="line">            if (t instanceof RuntimeException) &#123;</div><div class="line">                throw (RuntimeException) t;</div><div class="line">            &#125; else &#123;</div><div class="line">                throw new InternalError(t.toString(), t);</div><div class="line">            &#125;</div><div class="line">        &#125; catch (NoSuchMethodException e) &#123;</div><div class="line">            throw new InternalError(e.toString(), e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="动态代理实现步骤"><a href="#动态代理实现步骤" class="headerlink" title="动态代理实现步骤"></a>动态代理实现步骤</h2><ol>
<li>创建一个实现接口InvocationHandler的类，实现invoke方法</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class TimeHandler implements InvocationHandler&#123;</div><div class="line"></div><div class="line">    private Object target;</div><div class="line"></div><div class="line">    public TimeHandler(Object target) &#123;</div><div class="line">        this.target = target;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *</div><div class="line">     * @param proxy 被代理的对象</div><div class="line">     * @param method 被代理对象的方法</div><div class="line">     * @param args 被代理对象的方法的参数</div><div class="line">     * @return Object对象，方法的返回值</div><div class="line">     * @throws Throwable</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</div><div class="line">        System.out.println(&quot;time begin&quot;);</div><div class="line">        method.invoke(target);</div><div class="line">        System.out.println(&quot;time end&quot;);</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>创建被代理的类以及接口(Car以及Moveable)</li>
<li>调用Proxy的静态方法，创建一个代理类</li>
<li>通过代理调用方法</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Car car = new Car();</div><div class="line"></div><div class="line">        InvocationHandler h = new TimeHandler(car);</div><div class="line">        Class&lt;?&gt; cls = car.getClass();</div><div class="line"></div><div class="line">        /**</div><div class="line">         * loader：类加载器</div><div class="line">         * interfaces：实现接口</div><div class="line">         * h ：invocationHandler</div><div class="line">         */</div><div class="line">        Moveable m = (Moveable) Proxy.newProxyInstance(cls.getClassLoader(), cls.getInterfaces(), h);</div><div class="line"></div><div class="line">        m.move();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="JDK动态代理与CGLIB动态代理的区别"><a href="#JDK动态代理与CGLIB动态代理的区别" class="headerlink" title="JDK动态代理与CGLIB动态代理的区别"></a>JDK动态代理与CGLIB动态代理的区别</h2><table>
<thead>
<tr>
<th>jdk动态代理</th>
<th>CGLIB动态代理</th>
</tr>
</thead>
<tbody>
<tr>
<td>只能代理实现了接口的类</td>
<td>针对类来实现代理</td>
</tr>
<tr>
<td>没有实现接口的类不能实现JDK动态代理</td>
<td>对指定目标类产生一个子类，通过方法拦截技术拦截所有父类方法调用</td>
</tr>
<tr>
<td>JDK动态代理利用反射机制生成一个实现代理接口的匿名类，在调用具体方法前调用InvocationHandler来处理</td>
<td>cglib是利用asm开源包，对代理对象的class文件加载进来，通过修改其字节码生成子类来处理</td>
</tr>
</tbody>
</table>
<h2 id="模拟JDK动态代理的实现"><a href="#模拟JDK动态代理的实现" class="headerlink" title="模拟JDK动态代理的实现"></a>模拟JDK动态代理的实现</h2><p>实现功能，通过Proxy的newproxyInstance返回代理对象<br>1、声明一段源码，动态产生代理<br>2、编译源码，产生新的类<br>3、将这个类load到内存中，产生一个新的对象<br>4、return代理对象</p>
<p>handler:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">package proxy;</div><div class="line"></div><div class="line">import java.lang.reflect.Method;</div><div class="line"></div><div class="line">public interface InvocationHandler &#123;</div><div class="line">    public void invoke(Object o, Method m);</div><div class="line">&#125;</div><div class="line"></div><div class="line">package proxy;</div><div class="line"></div><div class="line">import java.lang.reflect.InvocationTargetException;</div><div class="line">import java.lang.reflect.Method;</div><div class="line"></div><div class="line">public class TimeHandler implements InvocationHandler&#123;</div><div class="line"></div><div class="line">    private Object target;</div><div class="line"></div><div class="line">    public TimeHandler(Object target) &#123;</div><div class="line">        this.target = target;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void invoke(Object o, Method m) &#123;</div><div class="line">        try &#123;</div><div class="line">            long starttime = System.currentTimeMillis();</div><div class="line">            System.out.println(&quot;汽车开始行驶....&quot;);</div><div class="line">            m.invoke(target);</div><div class="line">            long endtime = System.currentTimeMillis();</div><div class="line">            System.out.println(&quot;汽车结束行驶....  汽车行驶时间：&quot;+ (endtime - starttime) + &quot;毫秒！&quot;);</div><div class="line">        &#125; catch (IllegalAccessException | InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>proxy:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">public class Proxy &#123;</div><div class="line"></div><div class="line">    public static Object newProxyInstance(Class infce, InvocationHandler h) throws IOException, ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123;</div><div class="line">        //创建源码</div><div class="line">        String rt = &quot;\r\n&quot;;</div><div class="line">        String methodStr = &quot;&quot;;</div><div class="line">        for(Method m : infce.getMethods())&#123;</div><div class="line">            methodStr += &quot;	@Override&quot; + rt +</div><div class="line">                    &quot;	public void &quot; + m.getName() + &quot;() &#123;&quot; + rt +</div><div class="line">                    &quot;  try&#123;&quot; + rt +</div><div class="line">                    &quot;  Method md = &quot; + infce.getName() + &quot;.class.getMethod(\&quot;&quot;</div><div class="line">                    + m.getName() + &quot;\&quot;);&quot; + rt +</div><div class="line">                    &quot;  h.invoke(this,md);&quot; +rt+</div><div class="line">                    &quot;  &#125;catch(Exception e)&#123; e.printStackTrace();&#125;&quot; + rt +</div><div class="line">                    &quot;	&#125;&quot; ;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        String str =</div><div class="line">                &quot;package proxy;&quot; + rt +</div><div class="line">                        &quot;import java.lang.reflect.Method;&quot; + rt +</div><div class="line">                        &quot;import proxy.InvocationHandler;&quot; +  rt+</div><div class="line">                        &quot;public class $Proxy0 implements &quot; + infce.getName() + &quot; &#123;&quot; + rt +</div><div class="line">                        &quot;	public $Proxy0(InvocationHandler h) &#123;&quot; + rt +</div><div class="line">                        &quot;		this.h = h;&quot; + rt +</div><div class="line">                        &quot;	&#125;&quot; + rt +</div><div class="line">                        &quot;  private InvocationHandler h;&quot; + rt+</div><div class="line">                        methodStr + rt +</div><div class="line">                        &quot;&#125;&quot; ;</div><div class="line">        String fileName = System.getProperty(&quot;user.dir&quot;) + &quot;/out/production/Design_Patterns_new/proxy/$Proxy0.java&quot;;</div><div class="line">        File file = new File(fileName);</div><div class="line">        FileUtils.writeStringToFile(file, str);</div><div class="line"></div><div class="line">        //编译源码</div><div class="line">        JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</div><div class="line">        StandardJavaFileManager fileManager = compiler.getStandardFileManager(null, null, null);</div><div class="line">        Iterable units = fileManager.getJavaFileObjects(fileName);</div><div class="line">        //编译任务</div><div class="line">        JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, null, null, null, units);</div><div class="line">        //执行任务</div><div class="line">        task.call();</div><div class="line">        fileManager.close();</div><div class="line"></div><div class="line">        //load到内存</div><div class="line">        ClassLoader loader = ClassLoader.getSystemClassLoader();</div><div class="line">        Class&lt;?&gt; c = loader.loadClass(&quot;proxy.$Proxy0&quot;);</div><div class="line"></div><div class="line">        Constructor constructor = c.getConstructor(InvocationHandler.class);</div><div class="line">        return constructor.newInstance(h);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/25/全排列和全组合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/全排列和全组合/" itemprop="url">全排列和全组合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-25T16:55:40+08:00">
                2018-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/algorithms/" itemprop="url" rel="index">
                    <span itemprop="name">algorithms</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="全排列"><a href="#全排列" class="headerlink" title="全排列"></a>全排列</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><ul>
<li><p>输入一个字符串，求字符串包含元素（含重复，比如aab的情况）的所有排列可能。</p>
</li>
<li><p>例如：输入abc,所有排列组合包括: abc, acb, bac, bca, cab, cba。</p>
</li>
</ul>
<h2 id="递归解法"><a href="#递归解法" class="headerlink" title="递归解法"></a>递归解法</h2><ul>
<li><p>思路：如果输入为abcdef，则首先确定排列的第一个字母，有6中可能，如果选定a,则其后接bcdef的全排列，明显适用于递归结题。结题思路为第一个字母分别选定所有可能的情况，然后对剩下的字母进行递归。递归终止条件为选定的字母的下标为字符串长度-1。</p>
</li>
<li><p>实现</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public class AllSort &#123;</div><div class="line">    private static ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public static void main(String[] args) throws IOException &#123;</div><div class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));</div><div class="line">        String str = br.readLine();</div><div class="line">        Permutation(str.toCharArray(), str.length(), 0);</div><div class="line">        System.out.println(list.toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void Permutation(char[] chars, int strLen, int curIndex) &#123;</div><div class="line">        //如果到最后一个数，将排好的加入到list中</div><div class="line">        if (curIndex == strLen - 1) &#123;</div><div class="line">            list.add(new String(chars));</div><div class="line">        &#125; else &#123;</div><div class="line">            for (int i = curIndex; i &lt;= strLen - 1; i++) &#123;</div><div class="line">                //去重，避免相同数字的交换造成最终结果存在重复</div><div class="line">                if (i == curIndex || chars[i] != chars[curIndex]) &#123;</div><div class="line">                    //依次交换开头字母与后面的进行递归</div><div class="line">                    Swap(chars, i, curIndex);</div><div class="line">                    Permutation(chars, strLen, curIndex + 1);</div><div class="line">                    Swap(chars, i, curIndex);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void Swap(char[] chars, int i, int curIndex) &#123;</div><div class="line">        char tmp = chars[i];</div><div class="line">        chars[i] = chars[curIndex];</div><div class="line">        chars[curIndex] = tmp;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="字典序法"><a href="#字典序法" class="headerlink" title="字典序法"></a>字典序法</h2><ul>
<li>思想：将输入排序，如输入为1234，则其最小值为1234，然后下一次加入的值为除了1234以外，1,2,3,4组成的最小的值。获取方法为从末尾找第一个从右向左不递增的数a，然后找到从末尾开始从右向左第一个大于a的数，并将这两个数交换次序。然后将原来a的位置之后的字符串反序。也就是说1234，的下一个为1243，在下一个为1324..直到字符串从右向左递增为止。</li>
</ul>
<p>实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">public class AllSort &#123;</div><div class="line">    private static ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public static void main(String[] args) throws IOException &#123;</div><div class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));</div><div class="line">        String str = br.readLine();</div><div class="line">        PermutationWithDictionary(str.toCharArray(), str.length());</div><div class="line">        System.out.println(list.toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void Swap(char[] chars, int i, int curIndex) &#123;</div><div class="line">        char tmp = chars[i];</div><div class="line">        chars[i] = chars[curIndex];</div><div class="line">        chars[curIndex] = tmp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void PermutationWithDictionary(char[] chars, int strLen) &#123;</div><div class="line">        //对字符数组进行排序</div><div class="line">        Arrays.sort(chars);</div><div class="line"></div><div class="line">        while (true) &#123;</div><div class="line">            int j;</div><div class="line">            int index = 0;</div><div class="line">            //找到从右向左第一个不是非递增元素</div><div class="line">            for (j = strLen - 2; j &gt;= 0; j--) &#123;</div><div class="line">                if (chars[j] &lt; chars[j+1])&#123;</div><div class="line">                    index = j;</div><div class="line">                    break;</div><div class="line">                &#125; else if (j == 0)&#123;</div><div class="line">                    return;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            //与从右向左第一个大于这个元素的元素交换</div><div class="line">            for (j = strLen - 1; j &gt;= 0; j--) &#123;</div><div class="line">                if (chars[j] &gt; chars[index]) &#123;</div><div class="line">                    break;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            //交换这两个值</div><div class="line">            Swap(chars, index, j);</div><div class="line">            //对非递增元素位置后面的数组进行逆序排序</div><div class="line">            Reverse(chars, index+1);</div><div class="line">            list.add(new String(chars));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void Reverse(char[] chars, int index) &#123;</div><div class="line">        int k = index, j = chars.length-1;</div><div class="line">        while (k &lt; j) &#123;</div><div class="line">            Swap(chars,k,j);</div><div class="line">            k++;</div><div class="line">            j--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="全组合"><a href="#全组合" class="headerlink" title="全组合"></a>全组合</h1><ul>
<li>题目描述：输入一个字符串，求字符的所有组合。如abc,则输出可能为a,b,c,ab,ac,bc,abc。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">public class AllCombine &#123;</div><div class="line">    static ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public static void main(String[] args) throws IOException &#123;</div><div class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));</div><div class="line">        String str = br.readLine();</div><div class="line">        combinetion(str.toCharArray(), str.length());</div><div class="line">        System.out.println(list.toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void combinetion(char[] chars, int length) &#123;</div><div class="line">       if (chars == null || length == 0)</div><div class="line">           return;</div><div class="line">        List&lt;Character&gt; array = new ArrayList&lt;&gt;();</div><div class="line">        //n中情况分别考虑</div><div class="line">        for (int i = 1; i &lt;= length; i++) &#123;</div><div class="line">            combine(chars, 0, i, array);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 从字符数组中index以后挑选number个数加入list</div><div class="line">     * @param chars 输入的字符数组</div><div class="line">     * @param index 开始字符下标</div><div class="line">     * @param number</div><div class="line">     * @param array</div><div class="line">     */</div><div class="line">    private static void combine(char[] chars, int index, int number, List&lt;Character&gt; array) &#123;</div><div class="line">        if (number == 0) &#123;</div><div class="line">            //递归终止条件，判断是为了去重</div><div class="line">            if (!list.contains(array.toString())) &#123;</div><div class="line">                list.add(array.toString());</div><div class="line">            &#125;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        if (index == chars.length) &#123;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        //取当前元素，并考察递归选取n-1个元素的情况</div><div class="line">        array.add(chars[index]);</div><div class="line">        combine(chars, index+1, number - 1, array);</div><div class="line">        array.remove((Character) chars[index]);</div><div class="line">        //不取当前元素，考察后面选取n个元素</div><div class="line">        combine(chars, index+1, number, array);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>基于位图：假定元素有n个，则最终结果组合为2^n-1个，我们使用位操作方法：假设元素原本为123，则1表示取该元素，0表示不取该元素。000是没有意义是，则选取的对应如下：<br>001,010,100,011,101,110,111-&gt;a,b,c,bc,ac,ab,abc。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public class AllCombine1 &#123;</div><div class="line">    static ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public static void main(String[] args) throws IOException &#123;</div><div class="line">        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));</div><div class="line">        String str = br.readLine();</div><div class="line">        combinetion(str.toCharArray());</div><div class="line">        System.out.println(list.toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void combinetion(char[] chars) &#123;</div><div class="line">        if (chars == null || chars.length == 0)</div><div class="line">            return;</div><div class="line">        int len = chars.length;</div><div class="line">        //n=2^len</div><div class="line">        int n = 1&lt;&lt;len;</div><div class="line">        for (int i = 1; i &lt; n; i++) &#123;</div><div class="line">            StringBuilder sb = new StringBuilder();</div><div class="line">            for (int j = 0; j &lt; len; j++) &#123;</div><div class="line">                int temp = i;</div><div class="line">                if ((temp &amp; (1&lt;&lt;j)) != 0)</div><div class="line">                    sb.append(chars[j]);</div><div class="line">            &#125;</div><div class="line">            list.add(sb.toString());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/25/设计模式之原型模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/设计模式之原型模式/" itemprop="url">设计模式之原型模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-25T13:20:19+08:00">
                2018-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/design-patterns/" itemprop="url" rel="index">
                    <span itemprop="name">design patterns</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h1><p>用原型实例指定创建对象的种类，并通过拷贝这些原型创建新的对象。</p>
<h1 id="模式使用场景"><a href="#模式使用场景" class="headerlink" title="模式使用场景"></a>模式使用场景</h1><ol>
<li>类初始化需要消耗非常多的资源，这个资源包括数据，硬件资源等，通过原型拷贝避免这些消耗。</li>
<li>通过new产生一个对象需要非常繁琐的数据准备或访问权限，则可以使用原型模式。</li>
<li>一个对象需要提供给其他对象访问，而且各个调用者可能都需要修改其值时，可以考虑使用原型模式拷贝多个对象供调用者使用。</li>
</ol>
<h1 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h1><p><img src="/img/dp-factory-prototype.png" alt="Alt text"></p>
<h2 id="角色描述"><a href="#角色描述" class="headerlink" title="角色描述"></a>角色描述</h2><pre><code>* Client: 客户端用户
* Prototype：抽象类或接口，声明具备clone能力
* ConcretePrototype：具体的原型类
</code></pre><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>文档拷贝为例。</p>
<p>Prototype抽象类为java.lang.clone,ConcretePrototype通过重写该方法完成对象的拷贝功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">package prototype;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by cdx0312</div><div class="line"> * 2018/3/25</div><div class="line"> */</div><div class="line">public class ConcretePrototype implements Cloneable&#123;</div><div class="line">    private String mText;</div><div class="line">    private ArrayList&lt;String&gt; mImages = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    public ConcretePrototype() &#123;</div><div class="line">        System.out.println(&quot;concretePrototype构造函数&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected Object clone() throws CloneNotSupportedException &#123;</div><div class="line">        try &#123;</div><div class="line">            ConcretePrototype concretePrototype = (ConcretePrototype) super.clone();</div><div class="line">            concretePrototype.mText = this.mText;</div><div class="line">            concretePrototype.mImages = this.mImages;</div><div class="line">            return concretePrototype;</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getmText() &#123;</div><div class="line">        return mText;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setmText(String mText) &#123;</div><div class="line">        this.mText = mText;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public ArrayList&lt;String&gt; getmImages() &#123;</div><div class="line">        return mImages;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setmImages(ArrayList&lt;String&gt; mImages) &#123;</div><div class="line">        this.mImages = mImages;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void addImage(String img) &#123;</div><div class="line">        this.mImages.add(img);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void showContent() &#123;</div><div class="line">        System.out.println(&quot;==========start===========&quot;);</div><div class="line">        System.out.println(&quot;Text:  &quot; + mText);</div><div class="line">        System.out.println(&quot;Images List: &quot;);</div><div class="line">        for (String string : mImages) &#123;</div><div class="line">            System.out.println(&quot;image name : &quot; + string);</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;============end==========&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Client:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">package prototype;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by cdx0312</div><div class="line"> * 2018/3/25</div><div class="line"> */</div><div class="line">public class Client &#123;</div><div class="line">    public static void main(String[] args) throws CloneNotSupportedException &#123;</div><div class="line">        //创建对象</div><div class="line">        ConcretePrototype original = new ConcretePrototype();</div><div class="line">        original.setmText(&quot;first&quot;);</div><div class="line">        original.addImage(&quot;pic 1&quot;);</div><div class="line">        original.addImage(&quot;pic 2&quot;);</div><div class="line">        original.addImage(&quot;pic 3&quot;);</div><div class="line">        original.addImage(&quot;pic 4&quot;);</div><div class="line">        original.showContent();</div><div class="line">        //复制对象</div><div class="line">        ConcretePrototype clone = (ConcretePrototype) original.clone();</div><div class="line">        clone.showContent();</div><div class="line">        //修改并展示复制的对象</div><div class="line">        clone.setmText(&quot;clone&quot;);</div><div class="line">        clone.showContent();</div><div class="line">        //展示原型对象</div><div class="line">        original.showContent();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：修改clone之后的对象的值不会印象到原来的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">concretePrototype构造函数</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  clone</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div></pre></td></tr></table></figure>
<p>深浅拷贝的区别：引用类型拷贝过程中，只拷贝了其引用，并没有将对象进行复制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">package prototype;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by cdx0312</div><div class="line"> * 2018/3/25</div><div class="line"> */</div><div class="line">public class Client1 &#123;</div><div class="line">    public static void main(String[] args) throws CloneNotSupportedException &#123;</div><div class="line">        //创建对象</div><div class="line">        ConcretePrototype original = new ConcretePrototype();</div><div class="line">        original.setmText(&quot;first&quot;);</div><div class="line">        original.addImage(&quot;pic 1&quot;);</div><div class="line">        original.addImage(&quot;pic 2&quot;);</div><div class="line">        original.addImage(&quot;pic 3&quot;);</div><div class="line">        original.addImage(&quot;pic 4&quot;);</div><div class="line">        original.showContent();</div><div class="line"></div><div class="line">        ConcretePrototype clone = (ConcretePrototype) original.clone();</div><div class="line">        clone.showContent();</div><div class="line"></div><div class="line">        clone.setmText(&quot;clone1&quot;);</div><div class="line">        clone.addImage(&quot;new pic 5&quot;);</div><div class="line">        clone.showContent();</div><div class="line"></div><div class="line">        original.showContent();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">concretePrototype构造函数</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  clone1</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">image name : new pic 5</div><div class="line">============end==========</div><div class="line">==========start===========</div><div class="line">Text:  first</div><div class="line">Images List:</div><div class="line">image name : pic 1</div><div class="line">image name : pic 2</div><div class="line">image name : pic 3</div><div class="line">image name : pic 4</div><div class="line">image name : new pic 5</div><div class="line">============end==========</div></pre></td></tr></table></figure>
<p>深拷贝过程中需要将引用类型的字段也要进行拷贝，而不是单纯的拷贝引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 深拷贝</div><div class="line"> * @return</div><div class="line"> * @throws CloneNotSupportedException</div><div class="line"> */</div><div class="line">@Override</div><div class="line">protected Object clone() throws CloneNotSupportedException &#123;</div><div class="line">    try &#123;</div><div class="line">        ConcretePrototype concretePrototype = (ConcretePrototype) super.clone();</div><div class="line">        concretePrototype.mText = this.mText;</div><div class="line">        concretePrototype.mImages = (ArrayList&lt;String&gt;) this.mImages.clone();</div><div class="line">        return concretePrototype;</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="优点和缺点"><a href="#优点和缺点" class="headerlink" title="优点和缺点"></a>优点和缺点</h2><ul>
<li><p>优点：原型模式是在内存二进制流的拷贝，要比直接new一个对象性能好很多，特别是需要在一个循环体中产生大量对象时。</p>
</li>
<li><p>缺点：直接在内存中拷贝，构造方法不会执行，减少了约束，需要注意。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/24/设计模式之Builder模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/设计模式之Builder模式/" itemprop="url">设计模式之Builder模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-24T17:18:12+08:00">
                2018-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/design-patterns/" itemprop="url" rel="index">
                    <span itemprop="name">design patterns</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h1><p>将一个复杂对象的构建与他的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<h1 id="模式使用场景"><a href="#模式使用场景" class="headerlink" title="模式使用场景"></a>模式使用场景</h1><ol>
<li>相同的方法，不同的执行顺序，产生不同的时间结果时。</li>
<li>多个部件或零件，都可以装配到一个对象中，但是产生的结果又不相同时。</li>
<li>产品类非常复杂，或者产品类中的调用顺序不同产生了不同的效能时。</li>
</ol>
<h1 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h1><p><img src="/img/dp-factory-builder.png" alt="Alt text"></p>
<h2 id="角色描述"><a href="#角色描述" class="headerlink" title="角色描述"></a>角色描述</h2><pre><code>* Product产品类：产品的抽象类
* Builder：抽象类，规范产品的组件，一般由子类实现具体的组装过程。
* ConcreteBuilder：具体的构造器
* Director：统一组装过程
</code></pre><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>电脑组装过程比较复杂，步骤很多，但是顺序却不确定。适用于Builder模式</p>
<p>Computer抽象类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public abstract class Computer &#123;</div><div class="line">    protected int mCpuCore = 1;</div><div class="line">    protected int mRanSize = 0;</div><div class="line">    protected String mOs = &quot;Dos&quot;;</div><div class="line"></div><div class="line">    public Computer() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public abstract void setmCpuCore(int mCpuCore);</div><div class="line"></div><div class="line">    public abstract void setmRanSize(int mRanSize);</div><div class="line"></div><div class="line">    public abstract void setmOs(String mOs);</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String toString() &#123;</div><div class="line">        return &quot;Computer&#123;&quot; +</div><div class="line">                &quot;mCpuCore=&quot; + mCpuCore +</div><div class="line">                &quot;, mRanSize=&quot; + mRanSize +</div><div class="line">                &quot;, mOs=&apos;&quot; + mOs + &apos;\&apos;&apos; +</div><div class="line">                &apos;&#125;&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AppleComputer实现类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public class AppleComputer extends Computer&#123;</div><div class="line">    protected AppleComputer()&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setmCpuCore(int mCpuCore) &#123;</div><div class="line">        super.mCpuCore = mCpuCore;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setmRanSize(int mRanSize) &#123;</div><div class="line">        super.mRanSize = mRanSize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void setmOs(String mOs) &#123;</div><div class="line">        super.mOs = mOs;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Builder抽象类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public abstract class Builder &#123;</div><div class="line">    public abstract void buildCPU(int core);</div><div class="line"></div><div class="line">    public abstract void buildRAM(int gb);</div><div class="line"></div><div class="line">    public abstract void buildOs(String os);</div><div class="line"></div><div class="line">    public abstract Computer create();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AppleBuilder实现类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class AppleBuilder extends Builder&#123;</div><div class="line"></div><div class="line">    private Computer mApplePC = new AppleComputer();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildCPU(int core) &#123;</div><div class="line">        mApplePC.setmCpuCore(core);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildRAM(int gb) &#123;</div><div class="line">        mApplePC.setmRanSize(gb);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void buildOs(String os) &#123;</div><div class="line">        mApplePC.setmOs(os);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Computer create() &#123;</div><div class="line">        return mApplePC;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class Director &#123;</div><div class="line">    Builder builder = null;</div><div class="line"></div><div class="line">    public Director(Builder builder) &#123;</div><div class="line">        this.builder = builder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void construct(int cpu, int ram, String os) &#123;</div><div class="line">        builder.buildCPU(cpu);</div><div class="line">        builder.buildRAM(ram);</div><div class="line">        builder.buildOs(os);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Builder builder = new AppleBuilder();</div><div class="line">        Director director = new Director(builder);</div><div class="line">        director.construct(4,2,&quot;Max OS X 10.0.3&quot;);</div><div class="line">        System.out.println(builder.create().toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="优点和缺点"><a href="#优点和缺点" class="headerlink" title="优点和缺点"></a>优点和缺点</h2><ul>
<li><p>优点：</p>
<ul>
<li>良好的封装性，使用Builder模式可以使客户端不必知道产品内部组成的细节。</li>
<li>建造者独立，容易扩展</li>
<li>在对象创建过程中会使用到系统中的其他对象，这些对象在产品的创建过程中不易得到。</li>
</ul>
</li>
<li><p>缺点：</p>
<ul>
<li>会产生多余的Builder对象和Director对象，消耗内存</li>
<li>对象的构建过程暴露。</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/24/设计模式简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/设计模式简介/" itemprop="url">设计模式简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-24T16:52:11+08:00">
                2018-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/design-patterns/" itemprop="url" rel="index">
                    <span itemprop="name">design patterns</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><ul>
<li>创建型模式：工厂方法模式，抽象工厂模式，单例模式，建造者模式，原型模式</li>
<li>结构型模式：适配器模式，装饰器模式，代理模式，外观模式，桥接模式，组合模式，享元模式</li>
<li>行为型模式：策略模式，模板方法模式，观察者模式，迭代子模式，责任链模式，命令模式，备忘录模式，状态模式，访问者模式，中介者模式，解释器模式。</li>
</ul>
<h1 id="设计模式六大原则"><a href="#设计模式六大原则" class="headerlink" title="设计模式六大原则"></a>设计模式六大原则</h1><ol>
<li>总原则-开闭原则</li>
</ol>
<p>对扩展开放，对修改封闭。</p>
<p>在需要对程序进行扩展时，不去修改原来的代码，而是要扩展原有代码，类似热插拔。需要使用接口或者抽象类。</p>
<ol>
<li>单一职能原则</li>
</ol>
<ul>
<li>不要存在多余一个类变更的原因，也就是每个类应该实现单一的职责，否则需要将类进行拆分。</li>
</ul>
<ol>
<li>里氏替换原则</li>
</ol>
<ul>
<li><p>任何基类可以出现的地方，子类一定可以出现。里氏替换原则是继承复用的基石，只有当衍生类可以替换基类，软件单位的功能不受影响时，基类才能真正被复用，而衍生类也能够在基类的基础上增加新的行为。</p>
</li>
<li><p>里氏替换原则是对实现抽象化的具体步骤的规范。其中子类对父类的方法尽量不要重写和重载。因为父类代表着定义好的结构，通过这个规范的接口与外界交互，子类不应该破坏。</p>
</li>
</ul>
<ol>
<li>依赖倒转原则</li>
</ol>
<ul>
<li>面向接口编程，依赖于抽象而不依赖于具体。写代码时用到具体类时，不与具体类交互，而是与具体类的上层接口交互。</li>
</ul>
<ol>
<li>接口隔离原则</li>
</ol>
<ul>
<li>每个接口中不存在子类用不到却必须实现的方法，否则就拆分接口。使用多个隔离的接口，比使用单个接口要好。</li>
</ul>
<ol>
<li>迪米特法则</li>
</ol>
<ul>
<li><p>一个类对自己依赖的类知道的越少越好。无论被依赖的类多么复杂，都应该讲逻辑封装到方法的内部，通过public方法提供给外部。这样当被依赖的类变化时，才能最小的影响该类。</p>
</li>
<li><p>最少知道原则：只与直接的朋友通信，类之间要是有耦合关系，就称为朋友关系。耦合分为依赖，关联，聚合，组合灯，我们成出现为成员变量，方法参数，方法返回值中的类为直接朋友。局部变量，临时变量则不是直接朋友。我们要求陌生的类不要作为局部变量出现在类中。</p>
</li>
</ul>
<ol>
<li>合成复用原则</li>
</ol>
<ul>
<li>尽量首先使用合成、聚合方式，而不是使用继承。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/23/设计模式之单例模式与工厂方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/设计模式之单例模式与工厂方法/" itemprop="url">设计模式之单例模式与工厂方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T20:43:38+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/design-patterns/" itemprop="url" rel="index">
                    <span itemprop="name">design patterns</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><p>  设计模式是一套被反复使用的，多数人知晓的，经过分类编目的，代码设计经验的总结。使用设计模式是为了可重用代码。</p>
<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><ol>
<li><p>定义：单例模式确保只有一个实例，而且自行实例化并向整个系统提供这个实例。</p>
</li>
<li><p>类型：创建类模式</p>
</li>
<li><p>组成：私有构造方法则不能通过构造方法来创建类，静态属性在类加载时就创建了一个对象，公有静态方法保证外部类可以直接调用。</p>
<ul>
<li>私有的构造方法</li>
<li>指向自己实例的私有静态引用</li>
<li>以自己实例为返回值的静态的公有方法</li>
</ul>
</li>
<li><p>实现：</p>
<ol>
<li><p>饿汉式单例：单例类被加载时候，就实例化一个对象交个自己引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Singleton &#123;</div><div class="line">    private Singleton() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static Singleton singleton = new Singleton();</div><div class="line"></div><div class="line">    public static Singleton getInstance() &#123;</div><div class="line">        return singleton;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>懒汉式实例：调用取得方法实例时才会实例化对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class Singleton1 &#123;</div><div class="line">    private Singleton1()&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static Singleton1 singleton1;</div><div class="line"></div><div class="line">    public static synchronized Singleton1 getInstacne()&#123;</div><div class="line">        if (singleton1 == null)</div><div class="line">            singleton1 = new Singleton1();</div><div class="line">        return singleton1;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>优点:</p>
<ul>
<li>内存中只有一个对象，节省内存空间</li>
<li>避免频繁的创建和销毁对象，可以提高性能</li>
<li>避免对共享资源的多重占用</li>
<li>可以全局访问</li>
</ul>
</li>
<li><p>应用场景：</p>
<ul>
<li>需要频繁实例化然后销毁的对象</li>
<li>创建对象耗时过多或者消耗资源过多，但又经常用到的对象。</li>
<li>有状态的工具类对象</li>
<li>频繁访问数据库或文件的对象</li>
</ul>
</li>
<li><p>注意事项：</p>
<ul>
<li>只能使用单例类提供的方法获得单例对象，不要使用反射，否则会实例化一个新对象。</li>
<li>不要做断开单例类对象与类中静态引用的操作。</li>
<li>多线程使用单例共享资源时，注意线程安全的问题。</li>
</ul>
</li>
<li><p>相关问题：</p>
<ul>
<li><p>单例模式的对象长时间不用会被jvm回收吗？<br>  不会，Hotspot中只要对象和GC Roots之间有可达引用链，也就是单例对象和单例中的引用没有被断开就不会被回收。</p>
</li>
<li><p>一个jvm中会出现多个单例吗？<br>  不使用反射的话，在一个jvm中不会出现多个单例。</p>
</li>
<li><p>单例模式只有饿汉和懒汉两种吗？<br>  所有可以实现一个实例的类，都是单例模式。</p>
</li>
<li><p>单例模式可以被继承吗？<br>  饿汉和懒汉，private方法不可以被继承。</p>
</li>
</ul>
</li>
</ol>
<h1 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h1><ol>
<li><p>定义：定义一个用于创建对象的接口，让子类决定实例化哪一个类，工厂方法使一个类的实例化延迟到其子类。</p>
</li>
<li><p>类型：创建类模式</p>
</li>
<li><p>实现：</p>
<p>工厂模式根据抽象程度的不同分为三种：</p>
<ul>
<li><p>简单工厂模式（静态工厂模式）：创建一个工厂来创建新的对象。</p>
<p>   <img src="/img/dp-factory-simpleFactory.png" alt="Alt text"></p>
<p>   工厂类</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class Factory &#123;</div><div class="line">    public Product createFactory(int type) &#123;</div><div class="line">        if (type == 1)</div><div class="line">            return new Product1();</div><div class="line">        else</div><div class="line">            return new Product2();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>   产品抽象类和具体产品</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public abstract class Product &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Product1 extends Product&#123;</div><div class="line">    public Product1() &#123;</div><div class="line">        System.out.println(&quot;product1&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Product2 extends Product&#123;</div><div class="line">    public Product2() &#123;</div><div class="line">        System.out.println(&quot;product2&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>   消费者</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class Customer &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Factory factory = new Factory();</div><div class="line">        Product product1 = factory.createFactory(1);</div><div class="line">        Product product2 = factory.createFactory(2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>组成：</p>
<ul>
<li>工厂类：用于创建商品</li>
<li>抽象产品：具体产品继承的父类或者实现的接口</li>
<li>具体产品：工厂类创建的对象</li>
</ul>
</li>
<li><p>此时当我们想要添加一种产品时，需要修改工厂类的业务员逻辑，实际中对应很多产品，对于工厂类来说负担太大，因此引入工厂方法模式，也就是讲工厂类定义成接口，增加一个商品，就增加该商品对应的工厂类的实现。</p>
</li>
</ul>
</li>
<li><p>工厂方法模式</p>
<p> <img src="/img/dp-factory-factoryMethod.png" alt="Alt text"></p>
<p> 产品类：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public interface IProduct &#123;</div><div class="line">    public void productMethod();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Product implements IProduct&#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;产品&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Product1 implements IProduct&#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;产品1&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 工厂类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public interface IFactory &#123;</div><div class="line">    public IProduct createProduct();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Factory implements IFactory&#123;</div><div class="line">    @Override</div><div class="line">    public IProduct createProduct() &#123;</div><div class="line">        return new Product();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Factory1 implements IFactory&#123;</div><div class="line">    @Override</div><div class="line">    public IProduct createProduct() &#123;</div><div class="line">        return new Product1();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 客户类</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class Client &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        IFactory factory = new Factory();</div><div class="line">        IProduct product = factory.createProduct();</div><div class="line">        product.productMethod();</div><div class="line"></div><div class="line">        IFactory factory1 = new Factory1();</div><div class="line">        IProduct product1 = factory1.createProduct();</div><div class="line">        product1.productMethod();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 工厂方法模式去掉了简单工厂模式中工厂方法的静态属性，使得它可以被子类继承。这样在简单工厂模式中集中在工厂方法中的压力就转到不同的工厂子类这种去了。</p>
<ul>
<li><p>组成：</p>
<ul>
<li>抽象工厂：具体工厂必须实现的接口或父类</li>
<li>具体工厂：含有和具体业务逻辑有关的代码。</li>
<li>抽象产品：具体产品继承的接口或父类。</li>
<li>具体产品：创建产品的类。</li>
</ul>
</li>
<li><p>工厂方法模式对对象的创建进行了包装，使得客户程序中仅仅处理抽象产品角色提供的接口。这样的缺点是使得对象的数量成倍增加。</p>
</li>
</ul>
</li>
<li><p>抽象工厂模式</p>
<p>产品类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">public interface IProductA &#123;</div><div class="line">    public void productMethod();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class ProductA implements IProductA &#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;A产品&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class ProductA1 implements IProductA &#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;A产品1&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public interface IProductB &#123;</div><div class="line">    public void productMethod();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class ProductB implements IProductB &#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;B产品&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class ProductB1 implements IProductB &#123;</div><div class="line">    @Override</div><div class="line">    public void productMethod() &#123;</div><div class="line">        System.out.println(&quot;B产品1&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>工厂类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public interface AbstratFactory &#123;</div><div class="line">    public IProductA createProductA();</div><div class="line"></div><div class="line">    public IProductB createProductB();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Factory implements AbstratFactory&#123;</div><div class="line">    @Override</div><div class="line">    public IProductA createProductA() &#123;</div><div class="line">        return new ProductA();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IProductB createProductB() &#123;</div><div class="line">        return new ProductB();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Factory1 implements AbstratFactory&#123;</div><div class="line">    @Override</div><div class="line">    public IProductA createProductA() &#123;</div><div class="line">        return new ProductA1();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IProductB createProductB() &#123;</div><div class="line">        return new ProductB1();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Client &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        //生产产品</div><div class="line">        AbstratFactory factory = new Factory();</div><div class="line">        IProductA productA = factory.createProductA();</div><div class="line">        productA.productMethod();</div><div class="line">        IProductB productB = factory.createProductB();</div><div class="line">        productB.productMethod();</div><div class="line">        //生产产品1</div><div class="line"></div><div class="line">        AbstratFactory factory1 = new Factory1();</div><div class="line">        IProductA productA1 = factory1.createProductA();</div><div class="line">        IProductB productB1 = factory1.createProductB();</div><div class="line">        productA1.productMethod();</div><div class="line">        productB1.productMethod();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>无论是简单工厂模式，工厂方法模式，还是抽象工厂模式，他们都属于工厂模式，在形式和特点上也是极为相似的，他们的最终目的都是为了解耦。在使用时，我们不必去在意这个模式到底工厂方法模式还是抽象工厂模式，因为他们之间的演变常常是令人琢磨不透的。经常你会发现，明明使用的工厂方法模式，当新需求来临，稍加修改，加入了一个新方法后，由于类中的产品构成了不同等级结构中的产品族，它就变成抽象工厂模式了；而对于抽象工厂模式，当减少一个方法使的提供的产品不再构成产品族之后，它就演变成了工厂方法模式。</li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/22/HashMap和ConcurrentHashMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/HashMap和ConcurrentHashMap/" itemprop="url">HashMap和ConcurrentHashMap理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-22T20:38:39+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><ul>
<li><p>hashhMap本质是数组+链表。根据key取得hash值，然后计算出数组下标，如果多个key对应到同一个下标，就用链表连接起来，最新插入的数据在链表头。</p>
</li>
<li><p>HashMap继承AbstractHashMap，实现了Map，Cloneable，Serializable接口</p>
</li>
<li><p>HashMap设计线程不安全的。</p>
</li>
<li><p>对键值对的描述，Node：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;</div><div class="line">        final int hash;</div><div class="line">        final K key;</div><div class="line">        V value;</div><div class="line">        Node&lt;K,V&gt; next;</div><div class="line"></div><div class="line">        Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123;</div><div class="line">            this.hash = hash;</div><div class="line">            this.key = key;</div><div class="line">            this.value = value;</div><div class="line">            this.next = next;</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<p>hashmap中键值对的存储形式为链表节点，hasCode相同的节点位于一个桶中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public final int hashCode() &#123;</div><div class="line">     return Objects.hashCode(key) ^ Objects.hashCode(value);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123;</div><div class="line">    TreeNode&lt;K,V&gt; parent;  // red-black tree links</div><div class="line">    TreeNode&lt;K,V&gt; left;</div><div class="line">    TreeNode&lt;K,V&gt; right;</div><div class="line">    TreeNode&lt;K,V&gt; prev;    // needed to unlink next upon deletion</div><div class="line">    boolean red;</div><div class="line">    TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123;</div><div class="line">        super(hash, key, val, next);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="HashMap构造函数"><a href="#HashMap构造函数" class="headerlink" title="HashMap构造函数"></a>HashMap构造函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public HashMap(int initialCapacity, float loadFactor) &#123;</div><div class="line">    if (initialCapacity &lt; 0)</div><div class="line">        throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; +</div><div class="line">                                           initialCapacity);</div><div class="line">    if (initialCapacity &gt; MAXIMUM_CAPACITY)</div><div class="line">        initialCapacity = MAXIMUM_CAPACITY;</div><div class="line">    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))</div><div class="line">        throw new IllegalArgumentException(&quot;Illegal load factor: &quot; +</div><div class="line">                                           loadFactor);</div><div class="line">    this.loadFactor = loadFactor;</div><div class="line">    this.threshold = tableSizeFor(initialCapacity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>HashMap的构造方法中的三个重要的参数：</p>
<ul>
<li>capacity:容量，表示数组容量大小</li>
<li>loadFactor:比例，扩容用</li>
<li>threshold：最多容纳的Entry数=capacity*loadFactory，如果当前元素个数多于这个就要扩容（capacity扩容为2倍）<ul>
<li>static final int TREEIFY_THRESHOLD： JDK1.8 新加，Entry链表最大长度，当桶中节点数目大于该长度时，将链表转成红黑树存储；</li>
<li>static final int UNTREEIFY_THRESHOLD：JDK1.8 新加，当桶中节点数小于该长度，将红黑树转为链表存储；</li>
<li>static final int DEFAULT_INITIAL_CAPACITY: 默认键值队个数为16</li>
</ul>
</li>
</ul>
<h2 id="get方法"><a href="#get方法" class="headerlink" title="get方法"></a>get方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public V get(Object key) &#123;</div><div class="line">       Node&lt;K,V&gt; e;</div><div class="line">       return (e = getNode(hash(key), key)) == null ? null : e.value;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   final Node&lt;K,V&gt; getNode(int hash, Object key) &#123;</div><div class="line">           Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;</div><div class="line">           if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</div><div class="line">               (first = tab[(n - 1) &amp; hash]) != null) &#123;</div><div class="line">               if (first.hash == hash &amp;&amp; // always check first node</div><div class="line">                   ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))</div><div class="line">                   return first;</div><div class="line">               if ((e = first.next) != null) &#123;</div><div class="line">                   if (first instanceof TreeNode)</div><div class="line">                       return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</div><div class="line">                   do &#123;</div><div class="line">                       if (e.hash == hash &amp;&amp;</div><div class="line">                           ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</div><div class="line">                           return e;</div><div class="line">                   &#125; while ((e = e.next) != null);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           return null;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>先查找对应桶的首元素，然后根据红黑树结构OR链表结构对应查找。</p>
<h2 id="put方法"><a href="#put方法" class="headerlink" title="put方法"></a>put方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">public V put(K key, V value) &#123;</div><div class="line">    return putVal(hash(key), key, value, false, true);</div><div class="line">&#125;</div><div class="line"></div><div class="line">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</div><div class="line">               boolean evict) &#123;</div><div class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</div><div class="line">    if ((tab = table) == null || (n = tab.length) == 0)</div><div class="line">        n = (tab = resize()).length;</div><div class="line">    if ((p = tab[i = (n - 1) &amp; hash]) == null)</div><div class="line">        tab[i] = newNode(hash, key, value, null);</div><div class="line">    else &#123;</div><div class="line">        Node&lt;K,V&gt; e; K k;</div><div class="line">        if (p.hash == hash &amp;&amp;</div><div class="line">            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))</div><div class="line">            e = p;</div><div class="line">        else if (p instanceof TreeNode)</div><div class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);</div><div class="line">        else &#123;</div><div class="line">            for (int binCount = 0; ; ++binCount) &#123;</div><div class="line">                if ((e = p.next) == null) &#123;</div><div class="line">                    p.next = newNode(hash, key, value, null);</div><div class="line">                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st</div><div class="line">                        treeifyBin(tab, hash);</div><div class="line">                    break;</div><div class="line">                &#125;</div><div class="line">                if (e.hash == hash &amp;&amp;</div><div class="line">                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</div><div class="line">                    break;</div><div class="line">                p = e;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (e != null) &#123; // existing mapping for key</div><div class="line">            V oldValue = e.value;</div><div class="line">            if (!onlyIfAbsent || oldValue == null)</div><div class="line">                e.value = value;</div><div class="line">            afterNodeAccess(e);</div><div class="line">            return oldValue;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ++modCount;</div><div class="line">    if (++size &gt; threshold)</div><div class="line">        resize();</div><div class="line">    afterNodeInsertion(evict);</div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>散列分布策略：键值对的槽位 = （容量-1） * hash(key)</p>
<ul>
<li>键值对槽位是键值对在tab数组的索引，本质为其hash值对容量取余，但是位运算更快。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">static final int hash(Object key) &#123;</div><div class="line">int h;</div><div class="line">return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>HashMap更新和新增的核心思想：</p>
<ul>
<li>根据键值对key的hashCode计算键值对的HashMap中的槽位</li>
<li>判断是否空桶或者发生Hash冲突</li>
<li>解决hash冲突：根据桶组织形式是红黑树或者链表进行对应插入操作，链表插入操作完成之后，检查是否超过链表阈值，超过将链表转换成红黑树</li>
<li>最后检查键值对总数是否超过阈值，超过阈值调用resize（）进行rehash操作。</li>
</ul>
</li>
</ul>
<h2 id="resize方法"><a href="#resize方法" class="headerlink" title="resize方法"></a>resize方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">final Node&lt;K,V&gt;[] resize() &#123;</div><div class="line">       Node&lt;K,V&gt;[] oldTab = table;</div><div class="line">       int oldCap = (oldTab == null) ? 0 : oldTab.length;</div><div class="line">       int oldThr = threshold;</div><div class="line">       int newCap, newThr = 0;</div><div class="line">       if (oldCap &gt; 0) &#123;</div><div class="line">           if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</div><div class="line">               threshold = Integer.MAX_VALUE;</div><div class="line">               return oldTab;</div><div class="line">           &#125;</div><div class="line">           else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;</div><div class="line">                    oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</div><div class="line">               newThr = oldThr &lt;&lt; 1; // double threshold</div><div class="line">       &#125;</div><div class="line">       else if (oldThr &gt; 0) // initial capacity was placed in threshold</div><div class="line">           newCap = oldThr;</div><div class="line">       else &#123;               // zero initial threshold signifies using defaults</div><div class="line">           newCap = DEFAULT_INITIAL_CAPACITY;</div><div class="line">           newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</div><div class="line">       &#125;</div><div class="line">       if (newThr == 0) &#123;</div><div class="line">           float ft = (float)newCap * loadFactor;</div><div class="line">           newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?</div><div class="line">                     (int)ft : Integer.MAX_VALUE);</div><div class="line">       &#125;</div><div class="line">       threshold = newThr;</div><div class="line">       @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</div><div class="line">           Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];</div><div class="line">       table = newTab;</div><div class="line">       if (oldTab != null) &#123;</div><div class="line">           for (int j = 0; j &lt; oldCap; ++j) &#123;</div><div class="line">               Node&lt;K,V&gt; e;</div><div class="line">               if ((e = oldTab[j]) != null) &#123;</div><div class="line">                   oldTab[j] = null;</div><div class="line">                   if (e.next == null)</div><div class="line">                       newTab[e.hash &amp; (newCap - 1)] = e;</div><div class="line">                   else if (e instanceof TreeNode)</div><div class="line">                       ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);</div><div class="line">                   else &#123; // preserve order</div><div class="line">                       Node&lt;K,V&gt; loHead = null, loTail = null;</div><div class="line">                       Node&lt;K,V&gt; hiHead = null, hiTail = null;</div><div class="line">                       Node&lt;K,V&gt; next;</div><div class="line">                       do &#123;</div><div class="line">                           next = e.next;</div><div class="line">                           if ((e.hash &amp; oldCap) == 0) &#123;</div><div class="line">                               if (loTail == null)</div><div class="line">                                   loHead = e;</div><div class="line">                               else</div><div class="line">                                   loTail.next = e;</div><div class="line">                               loTail = e;</div><div class="line">                           &#125;</div><div class="line">                           else &#123;</div><div class="line">                               if (hiTail == null)</div><div class="line">                                   hiHead = e;</div><div class="line">                               else</div><div class="line">                                   hiTail.next = e;</div><div class="line">                               hiTail = e;</div><div class="line">                           &#125;</div><div class="line">                       &#125; while ((e = next) != null);</div><div class="line">                       if (loTail != null) &#123;</div><div class="line">                           loTail.next = null;</div><div class="line">                           newTab[j] = loHead;</div><div class="line">                       &#125;</div><div class="line">                       if (hiTail != null) &#123;</div><div class="line">                           hiTail.next = null;</div><div class="line">                           newTab[j + oldCap] = hiHead;</div><div class="line">                       &#125;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       return newTab;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>当键值对总数超过阈值时，HashMap通过resize方法实现重散列rehash，容量增加为原来的2倍。</li>
</ul>
<h2 id="remove方法"><a href="#remove方法" class="headerlink" title="remove方法"></a>remove方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">public V remove(Object key) &#123;</div><div class="line">    Node&lt;K,V&gt; e;</div><div class="line">    return (e = removeNode(hash(key), key, null, false, true)) == null ?</div><div class="line">        null : e.value;</div><div class="line">&#125;</div><div class="line">final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value,</div><div class="line">                               boolean matchValue, boolean movable) &#123;</div><div class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index;</div><div class="line">        if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</div><div class="line">            (p = tab[index = (n - 1) &amp; hash]) != null) &#123;</div><div class="line">            Node&lt;K,V&gt; node = null, e; K k; V v;</div><div class="line">            if (p.hash == hash &amp;&amp;</div><div class="line">                ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))</div><div class="line">                node = p;</div><div class="line">            else if ((e = p.next) != null) &#123;</div><div class="line">                if (p instanceof TreeNode)</div><div class="line">                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</div><div class="line">                else &#123;</div><div class="line">                    do &#123;</div><div class="line">                        if (e.hash == hash &amp;&amp;</div><div class="line">                            ((k = e.key) == key ||</div><div class="line">                             (key != null &amp;&amp; key.equals(k)))) &#123;</div><div class="line">                            node = e;</div><div class="line">                            break;</div><div class="line">                        &#125;</div><div class="line">                        p = e;</div><div class="line">                    &#125; while ((e = e.next) != null);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            if (node != null &amp;&amp; (!matchValue || (v = node.value) == value ||</div><div class="line">                                 (value != null &amp;&amp; value.equals(v)))) &#123;</div><div class="line">                if (node instanceof TreeNode)</div><div class="line">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable);</div><div class="line">                else if (node == p)</div><div class="line">                    tab[index] = node.next;</div><div class="line">                else</div><div class="line">                    p.next = node.next;</div><div class="line">                ++modCount;</div><div class="line">                --size;</div><div class="line">                afterNodeRemoval(node);</div><div class="line">                return node;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h1 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h1><ul>
<li>在HashMap的基础上，ConcurrentHashMap放弃了分段锁机制，利用CAS+Synchronized来保证并发更新的安全，低层依然采用数组+链表+红黑树的存储结构</li>
</ul>
<h1 id="重要属性"><a href="#重要属性" class="headerlink" title="重要属性"></a>重要属性</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * The array of bins. Lazily initialized upon first insertion.</div><div class="line"> * Size is always a power of two. Accessed directly by iterators.</div><div class="line"> */</div><div class="line">transient volatile Node&lt;K,V&gt;[] table;</div></pre></td></tr></table></figure>
<p>table:默认为null，懒加载，初始化发生在第一次插入的时候，默认大小16，大小总为2的幂次方，用来存储节点数据，可以由迭代器直接调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * The next table to use; non-null only while resizing.</div><div class="line"> */</div><div class="line">private transient volatile Node&lt;K,V&gt;[] nextTable;</div></pre></td></tr></table></figure>
<p>nextTable:默认为null，扩容时新生成的数组，其大小为原数组的两倍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Table initialization and resizing control.  When negative, the</div><div class="line"> * table is being initialized or resized: -1 for initialization,</div><div class="line"> * else -(1 + the number of active resizing threads).  Otherwise,</div><div class="line"> * when table is null, holds the initial table size to use upon</div><div class="line"> * creation, or 0 for default. After initialization, holds the</div><div class="line"> * next element count value upon which to resize the table.</div><div class="line"> */</div><div class="line">private transient volatile int sizeCtl;</div></pre></td></tr></table></figure>
<p>sizeCtl:默认为0，用来控制table初始化和扩容操作，-1表示table正在初始化，-N表示有N-1个线程正在进行扩容操作。如果table未被初始化，表示table需要初始化的大小，如果table初始化完成，表示table的容量，默认为0.75</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;</div><div class="line">    final int hash;</div><div class="line">    final K key;</div><div class="line">    volatile V val;</div><div class="line">    volatile Node&lt;K,V&gt; next;</div><div class="line"></div><div class="line">    Node(int hash, K key, V val, Node&lt;K,V&gt; next) &#123;</div><div class="line">        this.hash = hash;</div><div class="line">        this.key = key;</div><div class="line">        this.val = val;</div><div class="line">        this.next = next;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>Node:保存key,value以及key的hash值的数据结构，val和next由violate修饰，保证并发可见性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;</div><div class="line">        final Node&lt;K,V&gt;[] nextTable;</div><div class="line">        ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;</div><div class="line">            super(MOVED, null, null, null);</div><div class="line">            this.nextTable = tab;</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ForwardingNode：特殊的Node节点，hash值为-1，其中存储nextTable的引用，只有table发生扩容时才有用，作为一个占位符放在table中表示当前节点为null或者已经被移动。</p>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public ConcurrentHashMap(int initialCapacity) &#123;</div><div class="line">    if (initialCapacity &lt; 0)</div><div class="line">        throw new IllegalArgumentException();</div><div class="line">    int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ?</div><div class="line">               MAXIMUM_CAPACITY :</div><div class="line">               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1));</div><div class="line">    this.sizeCtl = cap;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>会自动调整输入的证书为2的幂次方。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">private static final int tableSizeFor(int c) &#123;</div><div class="line">    int n = c - 1;</div><div class="line">    n |= n &gt;&gt;&gt; 1;</div><div class="line">    n |= n &gt;&gt;&gt; 2;</div><div class="line">    n |= n &gt;&gt;&gt; 4;</div><div class="line">    n |= n &gt;&gt;&gt; 8;</div><div class="line">    n |= n &gt;&gt;&gt; 16;</div><div class="line">    return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于初始化在第一次插入数据时进行，则要确保只有一次初始化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">   * Initializes table, using the size recorded in sizeCtl.</div><div class="line">   */</div><div class="line">  private final Node&lt;K,V&gt;[] initTable() &#123;</div><div class="line">      Node&lt;K,V&gt;[] tab; int sc;</div><div class="line">      while ((tab = table) == null || tab.length == 0) &#123;</div><div class="line">          if ((sc = sizeCtl) &lt; 0)</div><div class="line">              Thread.yield(); // lost initialization race; just spin</div><div class="line">          else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123;</div><div class="line">              try &#123;</div><div class="line">                  if ((tab = table) == null || tab.length == 0) &#123;</div><div class="line">                      int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;</div><div class="line">                      @SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">                      Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];</div><div class="line">                      table = tab = nt;</div><div class="line">                      sc = n - (n &gt;&gt;&gt; 2);</div><div class="line">                  &#125;</div><div class="line">              &#125; finally &#123;</div><div class="line">                  sizeCtl = sc;</div><div class="line">              &#125;</div><div class="line">              break;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">      return tab;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>sizeCtl默认值为0，如果ConcurrentHashMap实例化时有传参数，sizeCtl会是一个2的幂次方的值。所以和自行第一次put操作的线程会执行compareAndSwapInt方法修改sizeCtl值为-1，有且只有一个线程能够修改成功，其他线程通过Thread.yield()让出CPU时间片等待table初始化完成。</p>
<h2 id="put方法-1"><a href="#put方法-1" class="headerlink" title="put方法"></a>put方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">public V put(K key, V value) &#123;</div><div class="line">    return putVal(key, value, false);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/** Implementation for put and putIfAbsent */</div><div class="line">final V putVal(K key, V value, boolean onlyIfAbsent) &#123;</div><div class="line">    if (key == null || value == null) throw new NullPointerException();</div><div class="line">    int hash = spread(key.hashCode());</div><div class="line">    int binCount = 0;</div><div class="line">    for (Node&lt;K,V&gt;[] tab = table;;) &#123;</div><div class="line">        Node&lt;K,V&gt; f; int n, i, fh;</div><div class="line">        if (tab == null || (n = tab.length) == 0)</div><div class="line">            tab = initTable();</div><div class="line">        else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123;</div><div class="line">            if (casTabAt(tab, i, null,</div><div class="line">                         new Node&lt;K,V&gt;(hash, key, value, null)))</div><div class="line">                break;                   // no lock when adding to empty bin</div><div class="line">        &#125;</div><div class="line">        else if ((fh = f.hash) == MOVED)</div><div class="line">            tab = helpTransfer(tab, f);</div><div class="line">        else &#123;</div><div class="line">            V oldVal = null;</div><div class="line">            synchronized (f) &#123;</div><div class="line">                if (tabAt(tab, i) == f) &#123;</div><div class="line">                    if (fh &gt;= 0) &#123;</div><div class="line">                        binCount = 1;</div><div class="line">                        for (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</div><div class="line">                            K ek;</div><div class="line">                            if (e.hash == hash &amp;&amp;</div><div class="line">                                ((ek = e.key) == key ||</div><div class="line">                                 (ek != null &amp;&amp; key.equals(ek)))) &#123;</div><div class="line">                                oldVal = e.val;</div><div class="line">                                if (!onlyIfAbsent)</div><div class="line">                                    e.val = value;</div><div class="line">                                break;</div><div class="line">                            &#125;</div><div class="line">                            Node&lt;K,V&gt; pred = e;</div><div class="line">                            if ((e = e.next) == null) &#123;</div><div class="line">                                pred.next = new Node&lt;K,V&gt;(hash, key,</div><div class="line">                                                          value, null);</div><div class="line">                                break;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    else if (f instanceof TreeBin) &#123;</div><div class="line">                        Node&lt;K,V&gt; p;</div><div class="line">                        binCount = 2;</div><div class="line">                        if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</div><div class="line">                                                       value)) != null) &#123;</div><div class="line">                            oldVal = p.val;</div><div class="line">                            if (!onlyIfAbsent)</div><div class="line">                                p.val = value;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            if (binCount != 0) &#123;</div><div class="line">                if (binCount &gt;= TREEIFY_THRESHOLD)</div><div class="line">                    treeifyBin(tab, i);</div><div class="line">                if (oldVal != null)</div><div class="line">                    return oldVal;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    addCount(1L, binCount);</div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>put采用CAS+synchronized实现并发插入或更新操作。</p>
<ol>
<li>hash算法获取key的hash值</li>
<li>table中定位索引的位置，n为table的大小</li>
<li>获取table中对应索引的元素f，Unsafe.getObjectVolatile来确保获取的数据为最新的。</li>
<li>f为空，说明该位置第一次插入节点，用Unsafe.compareAndSwapObject插入Node节点。如果CAS成功，说明Node节点已经插入，随后检查当前容量是否需要扩容。如果CAS失败，说明有其他线程提前插入了节点，自旋重新尝试在这个位置插入节点。</li>
<li>如果f的值为-1，说明f是当前ForwardingNode节点，意味着有其他线程进行扩容，则一起进行扩容操作。</li>
<li>其余情况把新的Node节点按照链或者红黑树的方式插入到合适的位置，这个过程采用同步内置锁实现。</li>
</ol>
<h2 id="table扩容"><a href="#table扩容" class="headerlink" title="table扩容"></a>table扩容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">private final void addCount(long x, int check) &#123;</div><div class="line">       CounterCell[] as; long b, s;</div><div class="line">       if ((as = counterCells) != null ||</div><div class="line">           !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) &#123;</div><div class="line">           CounterCell a; long v; int m;</div><div class="line">           boolean uncontended = true;</div><div class="line">           if (as == null || (m = as.length - 1) &lt; 0 ||</div><div class="line">               (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null ||</div><div class="line">               !(uncontended =</div><div class="line">                 U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123;</div><div class="line">               fullAddCount(x, uncontended);</div><div class="line">               return;</div><div class="line">           &#125;</div><div class="line">           if (check &lt;= 1)</div><div class="line">               return;</div><div class="line">           s = sumCount();</div><div class="line">       &#125;</div><div class="line">       if (check &gt;= 0) &#123;</div><div class="line">           Node&lt;K,V&gt;[] tab, nt; int n, sc;</div><div class="line">           while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp;</div><div class="line">                  (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;</div><div class="line">               int rs = resizeStamp(n);</div><div class="line">               if (sc &lt; 0) &#123;</div><div class="line">                   if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||</div><div class="line">                       sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||</div><div class="line">                       transferIndex &lt;= 0)</div><div class="line">                       break;</div><div class="line">                   if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))</div><div class="line">                       transfer(tab, nt);</div><div class="line">               &#125;</div><div class="line">               else if (U.compareAndSwapInt(this, SIZECTL, sc,</div><div class="line">                                            (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2))</div><div class="line">                   transfer(tab, null);</div><div class="line">               s = sumCount();</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>当table容量不足时，及table的元素数量达到容量阈值sizeCtl，需要经table扩容：</p>
<ol>
<li>构建一个nextTable,大小为table的两倍<ul>
<li>通过Unsafe.compareAndSwapInt修改sizeCtl的值，保证只有一个线程能够输出化nextTable,扩容后数组长度为原来的两倍，但是容量是原来的1.5。</li>
</ul>
</li>
<li>把table的数据复制到nextTable中<ul>
<li>首先根据运算得到遍历的次数i,然后利用tabAt方法获得i位置的元素f,初始化一个forwardNode实例fwd。</li>
<li>如果f == null，则在table的i位置放入fwd。</li>
<li>如果f是链表的头节点，就构造一个反序链表，把他们分别放在nextTable的i和i+n的位置上，移动完成，采用Unsafe.putObjectVolatile方法给table原位置赋值fwd。</li>
<li>如果f是TreeBin节点，也做一个反序处理，并判断是否需要untreeify，把处理的结果分别放在nextTable的i和i+n的位置上，移动完成，同样采用Unsafe.putObjectVolatile方法给table原位置赋值fwd</li>
</ul>
</li>
</ol>
<h2 id="get方法-1"><a href="#get方法-1" class="headerlink" title="get方法"></a>get方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public V get(Object key) &#123;</div><div class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;</div><div class="line">       int h = spread(key.hashCode());</div><div class="line">       if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;</div><div class="line">           (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123;</div><div class="line">           if ((eh = e.hash) == h) &#123;</div><div class="line">               if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))</div><div class="line">                   return e.val;</div><div class="line">           &#125;</div><div class="line">           else if (eh &lt; 0)</div><div class="line">               return (p = e.find(h, key)) != null ? p.val : null;</div><div class="line">           while ((e = e.next) != null) &#123;</div><div class="line">               if (e.hash == h &amp;&amp;</div><div class="line">                   ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))</div><div class="line">                   return e.val;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       return null;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>ConcurrentHashMap是一个并发散列表的实现，它允许完全并发的读取，并且支持给定数量的并发更新。相比于HashTable和同步包装的HashMap，适用一个全局的锁来同步不同线程的并发访问，同一时间点，只能有一个线程持有锁，也就是说在同一个时间点，只有一个线程能访问容器，这虽然保证了多线程的并发访问安全，但是同时也和导致对容器的访问变成串行的了。1.6中采用ReentrantLock分段锁的方式，使用多个线程在不同的segment上进行写操作不会发生阻塞行为。1.8中采用内置锁synchronized。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/20/Java虚拟机_2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/Java虚拟机_2/" itemprop="url">垃圾收集器和内存分配策略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T16:18:38+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h1><ul>
<li><p>垃圾收集器的历史要远早于Java，不过我们很多人都是通过Java才了解垃圾收集器的。学习垃圾收集器可以更好进行内存泄漏，内存溢出的排查，以及高并发场景下垃圾收集成为系统性能瓶颈。</p>
</li>
<li><p>垃圾收集器关注的问题很简单：</p>
<pre><code>哪些垃圾需要回收？--who
什么时候回收？-- when
怎么回收？--how
</code></pre></li>
<li><p>程序计数器，虚拟机栈，本地方法栈是线程私有的，也就是和线程的生命周期一致，栈帧随着方法的执行进行进栈和出栈操作，内存分配和回收具有确定性，不需要考虑垃圾回收问题。方法区和Java堆则需要在运行时才确定需要的内存大小，从而需要我们动态的分配内存和垃圾收集。</p>
</li>
</ul>
<h2 id="那些垃圾需要回收？-who"><a href="#那些垃圾需要回收？-who" class="headerlink" title="那些垃圾需要回收？-who"></a>那些垃圾需要回收？-who</h2><p>已经“死掉”的对象需要回收，对象死掉的概念是指没有引用他的对象了。</p>
<ol>
<li><p>引用计数法：给对象中添加一个引用计数器，当有一个地方引用他时，计数器+1，当引用失效时，计数器-1，当计数器为0时，对象死掉。java中并没有采用这种机制。</p>
<ul>
<li>优点：实现简单，判定效率高</li>
<li><p>缺点：循环引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class ReferenceCountingGC &#123;</div><div class="line"></div><div class="line">	public Object instance = null;</div><div class="line"></div><div class="line">	private static final int _1MB = 1024 * 1024;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 这个成员属性的唯一意义就是占点内存，以便在能在GC日志中看清楚是否有回收过</div><div class="line">	 */</div><div class="line">	private byte[] bigSize = new byte[2 * _1MB];</div><div class="line"></div><div class="line">	public static void testGC() &#123;</div><div class="line">		ReferenceCountingGC objA = new ReferenceCountingGC();</div><div class="line">		ReferenceCountingGC objB = new ReferenceCountingGC();</div><div class="line">		objA.instance = objB;</div><div class="line">		objB.instance = objA;</div><div class="line"></div><div class="line">		objA = null;</div><div class="line">		objB = null;</div><div class="line"></div><div class="line">		// 假设在这行发生GC，objA和objB是否能被回收？</div><div class="line">		System.gc();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">0.137: [GC (System.gc()) [PSYoungGen: 9344K-&gt;808K(76288K)] 9344K-&gt;816K(251392K), 0.0029826 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]</div><div class="line">0.140: [Full GC (System.gc()) [PSYoungGen: 808K-&gt;0K(76288K)] [ParOldGen: 8K-&gt;662K(175104K)] 816K-&gt;662K(251392K), [Metaspace: 3464K-&gt;3464K(1056768K)], 0.0046314 secs] [Times: user=0.03 sys=0.00, real=0.02 secs]</div><div class="line">Heap</div><div class="line"> PSYoungGen      total 76288K, used 655K [0x000000076b380000, 0x0000000770880000, 0x00000007c0000000)</div><div class="line">  eden space 65536K, 1% used [0x000000076b380000,0x000000076b423ee8,0x000000076f380000)</div><div class="line">  from space 10752K, 0% used [0x000000076f380000,0x000000076f380000,0x000000076fe00000)</div><div class="line">  to   space 10752K, 0% used [0x000000076fe00000,0x000000076fe00000,0x0000000770880000)</div><div class="line"> ParOldGen       total 175104K, used 662K [0x00000006c1a00000, 0x00000006cc500000, 0x000000076b380000)</div><div class="line">  object space 175104K, 0% used [0x00000006c1a00000,0x00000006c1aa5b78,0x00000006cc500000)</div><div class="line"> Metaspace       used 3470K, capacity 4496K, committed 4864K, reserved 1056768K</div><div class="line">  class space    used 381K, capacity 388K, committed 512K, reserved 1048576K</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>可达性分析算法：起始点为GC Root Set中的GC Roots对象，由GC Root向下的路径成为引用链，当一个对象和GC Roots没有引用链连接时，此对象死掉。</p>
<p><img src="/img/jvm-3.png" alt="Alt text"></p>
<p>Java中可以作为GC Roots的对象包括：</p>
<ul>
<li>虚拟机栈(栈帧中的本地变量表)中引用的对象</li>
<li>方法区中静态属性引用的对象</li>
<li>方法区中常亮引用的对象</li>
<li>本地方法栈中JNI（Native方法）引用的对象</li>
</ul>
</li>
<li><p>引用的类型</p>
</li>
</ol>
<p>Java1.2之前，reference类型的数据中存储的数值代表的是一个内存的起始地址，则称为一个引用。对象只存在被引用和不被引用两种状态。</p>
<ul>
<li>强引用：程序代码中普遍存在的</li>
<li>软引用：描述一些还有用但不是必须的对象，系统内存溢出前会对其进行二次垃圾回收</li>
<li>弱引用：描述非必须的对象，垃圾回收时直接回收</li>
<li>虚引用：不影响其生存，回收时可以收到一个系统通知</li>
</ul>
<ol>
<li><p>对象死亡的过程</p>
<ol>
<li>可达性分析后，对没有和GC Roots相连接的引用链的对象会被标记一次，同时对其进行一次筛选，筛选条件为此对象是否有必要执行finalize()方法，当对象没有重写finalize()方法或者finalize()方法被虚拟机调用过，则不执行finalize()方法。</li>
<li><p>有必要执行finalize()方法的对象会被放到F-Queue对象中，等待虚拟机的Finalizer线程去执行finalize()方法，GC会对F-Queue对象进行小范围标记，如果对象在finalize()方法中和引用链连接上，则会被移出队列，否则被真正回收。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 对象可以在被GC时自我拯救</div><div class="line"> * 这种自救机会只有一次，因为一个对象的finalize()方法最多只会被系统调用一遍</div><div class="line"> */</div><div class="line">public class FinalizeEscapeGC &#123;</div><div class="line">    public static FinalizeEscapeGC SAVE_HOOK = null;</div><div class="line"></div><div class="line">    public void isAlive() &#123;</div><div class="line">        System.out.println(&quot; I am alive !&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void finalize() throws Throwable &#123;</div><div class="line">        super.finalize();</div><div class="line">        System.out.println(&quot;finalize method executed!&quot;);</div><div class="line">        FinalizeEscapeGC.SAVE_HOOK = this;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void main(String[] args) throws InterruptedException &#123;</div><div class="line">        SAVE_HOOK = new FinalizeEscapeGC();</div><div class="line">        //对象第一次拯救自己</div><div class="line">        SAVE_HOOK = null;</div><div class="line">        System.gc();</div><div class="line">        //finalize()优先级很低，暂停0.5s等待</div><div class="line">        Thread.sleep(500);</div><div class="line">        if (SAVE_HOOK != null)</div><div class="line">            SAVE_HOOK.isAlive();</div><div class="line">        else</div><div class="line">            System.out.println(&quot;no, I am dead!&quot;);</div><div class="line">        //第二次自救失败</div><div class="line">        SAVE_HOOK = null;</div><div class="line">        System.gc();</div><div class="line">        //finalize()优先级很低，暂停0.5s等待</div><div class="line">        Thread.sleep(500);</div><div class="line">        if (SAVE_HOOK != null)</div><div class="line">            SAVE_HOOK.isAlive();</div><div class="line">        else</div><div class="line">            System.out.println(&quot;no, I am dead!&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">finalize method executed!</div><div class="line"> I am alive !</div><div class="line">no, I am dead!</div></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>回收方法区</p>
</li>
</ol>
<p>虽然虚拟机规范中没有要求在方法区进行垃圾回收，但是方法区存在垃圾回收，回收效率很低。回收的内容为废弃常亮和无用的类。</p>
<ul>
<li>回收废弃常亮：看和GC Roots之间是否存在引用链</li>
<li>回收无用类：<ol>
<li>该类的所有实例都已经被回收</li>
<li>加载该类的ClassLoader已经被回收</li>
<li>该类对应的Java.lang.Class对象没有在任何地方被引用，无法在任何地方通过反射访问该类的方法。</li>
</ol>
</li>
</ul>
<h2 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h2><ol>
<li><p>标记-清除算法(Mark-Sweep):首先标记所有需要回收的对象，标记完成后统一回收被标记对象。</p>
<ul>
<li><p>存在两个不足：</p>
<ol>
<li>效率问题：标记和清除两个过程的效率都不高</li>
<li>空间问题：标记清除之后会产生大量不连续的内存碎片，会导致存放大对象时没有足够的空间而提前出发垃圾清楚</li>
</ol>
<p><img src="/img/jvm-4.png" alt="Alt text"></p>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>复制算法(Copint)：将内存分成一样的两块，每次只使用一块，当一块用完了就进行垃圾回收，并将还存活的对象复制到第二块硬盘上并整理顺序。每次回收针对的是一半内存空间，同时也没有了空间碎片的问题</p>
<p> <img src="/img/jvm-5.png" alt="Alt text"></p>
<ul>
<li>存在的问题是内存空间变为一半。实际上，新生的对象98%是朝生夕死的，所以不需要1:1来划分内存空间。而是将新生代内存化为一块Eden空间和两块Survivor空间，比例为8:1:1。</li>
<li>每次使用Eden空间和其中一块Survivor空间，回收时将Eden和Survivor空间中还存活的对象复制到另一块Survivor中，然后清除Eden和Survivor空间。</li>
<li>如果空间不够的话，需要老年代进行分配担保</li>
</ul>
</li>
<li><p>标记-整理算法(Mark-Compact)：标记过程和之前相同，整理过程将存活对象移动到一边，根据整理边界回收剩余空间内的对象，适用于老年代的垃圾收集</p>
<p> <img src="/img/jvm-6.png" alt="Alt text"></p>
</li>
<li><p>分代收集算法：将Java堆对象根据存货周期划分为新生代和老年代，新生代采用复制算法，老年代给新生代做分配担保，由于老年代的对象存活率高，所以老年代采用标记-整理或者标记-清除算法。</p>
</li>
</ol>
<h2 id="HotSpot的算法实现"><a href="#HotSpot的算法实现" class="headerlink" title="HotSpot的算法实现"></a>HotSpot的算法实现</h2><ol>
<li>枚举根节点：可作为根节点的主要在全局性的引用(常亮或者静态属性)与执行上下文(栈帧中的本地变量表)，可达性分析时需要停止一切的Java程序执行，Stop the world，在Oop中保存着对象引用的地址。</li>
<li>安全点：程序执行过程中并不是所有位置都可以停下来GC，让系统中的所有线程到安全点的方式有两种：<ul>
<li>抢先式中断：所有线程中断，如果有线程不在安全点上，则恢复线程，让其跑到安全点上再中断</li>
<li>主动式中断：设置一个标志，各个线程执行时去轮询这个标志，发现中断标志位真时就自己中断挂起，轮询标志的地方和安全点是重合的。</li>
</ul>
</li>
<li>安全区域：<ul>
<li>解决线程处于休眠状态无法响应JVM的中断请求的情况。</li>
<li>安全区域指在一段代码中，引用关系不会发生变化</li>
<li>线程执行Safe Region中的代码时，会标识自己已经进入Safe Region，可以随时进行GC，如果线程离开安全区域时，会先检查枚举根节点或者GC是否完成，未完成则需要等待。</li>
</ul>
</li>
</ol>
<h2 id="垃圾收集器-1"><a href="#垃圾收集器-1" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h2><p>Java虚拟机规范中对垃圾收集器如何实现并没有规定，因此诞生了多种多样的垃圾收集器，适合各自的应用场景。HotSpot虚拟机中的垃圾收集器包括对新生代回收的Serial，ParNew，Parallel Scavenge，对老年代回收的CMS，Serial Old(MSC), Parallel Old及G1。</p>
<ol>
<li><p>Serial收集器</p>
<ul>
<li>最基本，历史最悠久的单线程收集器</li>
<li>GC过程中必须停止整个程序的运行，Stop the World</li>
<li>优点:简单而高效，适用Client模式下工作的虚拟机</li>
</ul>
<p><img src="/img/jvm-7.png" alt="Alt text"></p>
</li>
<li><p>ParNew收集器</p>
<ul>
<li>Serial收集器的多线程版本</li>
<li>运行在Server模式的虚拟机中首选的新生代收集器—重要原因是，其是除了Serial外唯一能和CMS收集器配合工作。<br><img src="/img/jvm-8.png" alt="Alt text"></li>
</ul>
</li>
<li><p>Parallel Scavenge收集器</p>
<ul>
<li>新生代收集器，复制算法，并行的多线程收集器</li>
<li>收集器的关注点不是尽可能缩短垃圾收集时用户线程的停顿时间，而是尽可能达到一个可控制的吞吐量(吞吐量=运行代码时间/(运行代码时间+GC时间))</li>
<li>吞吐量优先收集器，</li>
<li>GC自适应调节策略<br><img src="/img/jvm-9.png" alt="Alt text"></li>
</ul>
</li>
<li><p>Serial Old收集器</p>
<ul>
<li>单线程</li>
<li>老年代</li>
<li>标记-整理（Mark-Compact）算法</li>
<li>适用Client模式的虚拟机，如果要用在Server模式下，有两个用途，一个是与Parallel Scavenge搭配适用，一个是作为CMS收集器的后备预案，在并发收集失败时使用。<br><img src="/img/jvm-7.png" alt="Alt text"></li>
</ul>
</li>
</ol>
<ol>
<li><p>Parallel Old收集器</p>
<ul>
<li>Parallel Scavenge老年代版本</li>
<li>多线程+标记-整理算法</li>
<li>在注重吞吐量和CPU资源敏感的场合，可以优先考虑和Parallel Scavenge搭配使用。<br><img src="/img/jvm-9.png" alt="Alt text"></li>
</ul>
</li>
<li><p>CMS收集器：Concurrent Mark Sweep</p>
<ul>
<li>以获取最短回收停顿时间为目标的收集器</li>
<li>标记-清除算法</li>
<li>运作过程：<ol>
<li>初始标记(CMS initial mark)     – stop the world, 标记GC Roots能直接关联到的对象，速度很快</li>
<li>并发标记(CMS concurrent mark)  – stop the world，进行GC Roots Tracing，</li>
<li>重新标记(CMS remark)，修正标记期间因为用户线程运行而改变的对象的标记记录，时间长于初始标记但短于并发标记</li>
<li>并发清除(CMS concurrent sweep)，清除标记的对象<br><img src="/img/jvm-10.png" alt="Alt text"></li>
</ol>
</li>
<li>缺点：<ul>
<li>CMS对CPU资源敏感，默认回收线程数是：（CPU数量+3）/4</li>
<li>CMS收集器无法处理浮动垃圾（Floating Garbage，并发清除阶段产生的垃圾,当前GC无法清除，需要下次GC才可以清除），会导致Concurrent Mode Failure而引发另一次Full GC。老年代需要保留足够的空间给用户线程使用，当CMS运行期间预留的内存空间不够时会发生Concurrent Mode Failure，这时候需要临时调用Serial Old来进行Full GC，停顿时间很长。</li>
<li>产生内存碎片问题，解决方法，CMS进行Full GC时，先进行碎片整理，或者进行若干次不整理的GC时，进行一次碎片整理的GC。</li>
</ul>
</li>
</ul>
</li>
<li><p>G1收集器：Garbage First</p>
<ul>
<li>并行与并发</li>
<li>分代收集</li>
<li>空间整合：marking-compact</li>
<li>可预测的停顿</li>
<li>G1将整个堆划分为很多Region，新生代和老年代都是由很多Region组成，G1后台维护一个列表，列表中记录了各个Region里面的垃圾价值大小（回收获得的空间和回收需要时间），GC时，优先回收价值最大的Region，保证G1在有限的时间内获得最高的回收效率。RememberSet避免全堆扫描。</li>
<li>运作过程：<ol>
<li>initial marking</li>
<li>concurrent marking</li>
<li>final marking</li>
<li>live data counting and evacuation<br><img src="/img/jvm-11.png" alt="Alt text"></li>
</ol>
</li>
</ul>
</li>
</ol>
<h1 id="内存分配与回收策略"><a href="#内存分配与回收策略" class="headerlink" title="内存分配与回收策略"></a>内存分配与回收策略</h1><ol>
<li>对象优先在Eden区生成</li>
<li>大对象直接进入老年代，如字符串和数组</li>
<li>长期存活的对象将进入老年代</li>
<li>动态对象年龄判定，如果Survivor中相同年龄所有对象大小的总和大于Survivor空间的一半，则大于或等于该年龄的对象将直接进入老年代。</li>
<li>空间分配担保：Minor GC之前检查老年代最大可用连续空间是否大于新生代所有对象总和或者大于新生代晋升老年代的历次平均大小，进行Minor GC,否则进行Full GC</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/20/Java虚拟机_1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/Java虚拟机_1/" itemprop="url">Java内存区域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T14:50:19+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h1><ul>
<li><p>Java和C++之间有一堵由内存动态分配和垃圾收集机制所围成的墙，墙外面的人想进来，墙里面的人想出去。深入理解Java虚拟机这本书的作者在介绍自动化内存管理时写到。个人认为内存动态分配和垃圾收集机制是Java的特点，不同于C++，一个对象从创建的内存分配，到销毁的内存回收都需要程序员来掌控，Java把这部分权限从程序员手中收回，限制了程序员的权限，但同时也减少了开发中存在的内存泄漏，内存溢出的频率。Java中不是没有内存泄漏和内存溢出，但是相对来说没有c++里面那么频繁，排查起来相对简单。了解虚拟机的相关知识对一个Java程序员是必不可少的技能。</p>
</li>
<li><p>Java虚拟机是Java实现跨平台的基础，也就是一直宣称的一次编译，到处执行，Java文件编译后生成的文件并不是调用操作系统的native方法，而是运行在JVM上，由JVM来调用操作系统的native方法。JVM在执行Java程序时，会将自身管理的内存划分为若干个数据区域：<br>  <img src="/img/jvm-1.png" alt="Alt text"></p>
<ol>
<li>程序计数器：<ul>
<li>线程私有内存，</li>
<li>不会产生OOM(唯一)</li>
<li>一块较小的内存空间，可以看做是当前线程所执行的字节码的行号指示器。</li>
<li>字节码解释器工作时就是通过改变计数器的值来选取下一条执行的字节码指令。</li>
</ul>
</li>
<li>Java虚拟机栈<ul>
<li>线程私有</li>
<li>声明周期和线程一样</li>
<li>描述的是Java方法执行的内存模型(也就是说每个方法在执行过程中都会创建一个栈帧，栈帧中存储着局部变量表，操作数栈，动态链接，方法出口等信息，方法的执行过程对应着栈帧的入栈和出栈过程)</li>
<li>平常说的栈指的是虚拟机栈或者说是其中局部变量表部分(局部变量表存放着编译期可知的各种基本数据类型8+reference，也就是说在编译完成之后其方法的局部变量表的大小就已经确定)</li>
</ul>
</li>
<li>本地方法栈<ul>
<li>线程私有</li>
<li>服务Native方法</li>
<li>hotspot虚拟机将本地方法栈和Java虚拟机栈合二为一</li>
</ul>
</li>
<li>Java堆<ul>
<li>所有线程共享</li>
<li>原则上存放所有的对象实例(JIT和逃逸分析技术，栈上分配，标量替换优化等可能会在堆外创建实例)</li>
<li>GC堆，垃圾收集的主要区域</li>
<li>新生代和老年代，Eden和Survivor</li>
<li>可以划分多个Thread Local Allocation Buffer TLAB</li>
</ul>
</li>
<li>方法区<ul>
<li>所有线程共享</li>
<li>存储已被虚拟机加载的类信息，常量，静态变量，即时编译器变异后的代码等数据</li>
<li>Non-Heap</li>
<li>hotspot将其称为永久代，不过已经取消</li>
<li>运行时常亮池是方法区的一部分，存放字面量和符号引用</li>
</ul>
</li>
</ol>
<ul>
<li>直接只存：Direct Memory，NIO类，可以在native函数库外直接分配堆外内存，可以通过在堆中存储的DirectByBuffer对象作为引用来操作</li>
</ul>
</li>
</ul>
<h1 id="HotSpot"><a href="#HotSpot" class="headerlink" title="HotSpot"></a>HotSpot</h1><ol>
<li><p>对象创建流程</p>
<p> <img src="/img/jvm-2.png" alt="Alt text"></p>
<ul>
<li><p>虚拟机为新生对象分配内存时，对象所需的内存大小在类加载完毕之后就已经确定。分配方式有两种</p>
<ul>
<li>Bump the Pointer，碰撞指针，此时内存空闲内存时连续规整的，Serial, ParNew等垃圾收集器采用</li>
<li>Free List 空闲列表，空闲内存时分散的，找一个足够大的空间，Mark-Sweep收集器</li>
</ul>
</li>
<li><p>线程安全问题，也就是同时有两个对象申请同一块内存</p>
<ul>
<li>对分配内存空间的动作进行同步处理，CAS+失败重试</li>
<li>将内存分配的动作按照线程划分在不同的空间中进行，TLAB，TLAB满了并且分配新的TLAB才需要同步</li>
</ul>
</li>
</ul>
</li>
<li><p>对象的内存布局</p>
<ol>
<li>对象头 Header<ul>
<li>存储对象自身运行时的数据<ul>
<li>哈希码</li>
<li>GC分代年龄</li>
<li>锁状态标志</li>
<li>线程持有的锁</li>
<li>偏向线程ID</li>
<li>偏向时间戳</li>
</ul>
</li>
<li>类型指针：指向类元数据的指针</li>
</ul>
</li>
<li>实例数据<ul>
<li>对象真正存储的有效信息，代码中定义的字段内容</li>
</ul>
</li>
<li>对齐填充<ul>
<li>非必须，对齐实例数据，使其为8的倍数。</li>
</ul>
</li>
</ol>
</li>
<li><p>对象的访问定位</p>
<ul>
<li><p>句柄：Java堆中划分出一块内存来作为句柄池，reference中存储的是对象的句柄地址，句柄中包含了对象实例数据和类型数据各自的具体地址信息</p>
</li>
<li><p>直接指针：reference中存储的是对象地址，对象中存储着到对象类型指针的地址。</p>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/Springmvc总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/29/Springmvc总结/" itemprop="url">Springmvc总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T20:54:31+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Springmvc/" itemprop="url" rel="index">
                    <span itemprop="name">Springmvc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1、Springmvc介绍"><a href="#1、Springmvc介绍" class="headerlink" title="1、Springmvc介绍"></a>1、Springmvc介绍</h1><ul>
<li><p>Spring MVC 是一个模型 - 视图 - 控制器（MVC）的Web框架建立在中央前端控制器servlet（DispatcherServlet），它负责发送每个请求到合适的处理程序，使用视图来最终返回响应结果的概念。Spring MVC 是 Spring 产品组合的一部分，它享有 Spring IoC容器紧密结合Spring松耦合等特点，因此它有Spring的所有优点。</p>
</li>
<li><p>Springmvc处理流程</p>
<p><img src="/img/springmvc-1.png" alt="Alt text"></p>
</li>
</ul>
<h1 id="2、入门程序"><a href="#2、入门程序" class="headerlink" title="2、入门程序"></a>2、入门程序</h1><h2 id="1、开发环境"><a href="#1、开发环境" class="headerlink" title="1、开发环境"></a>1、开发环境</h2><ul>
<li>IDEA 2017.2</li>
<li>JDK 1.8.0.141</li>
<li>Tomcat 9.0.0 M22</li>
<li>Springmvc 4.1.3</li>
</ul>
<h2 id="2、需求"><a href="#2、需求" class="headerlink" title="2、需求"></a>2、需求</h2><p>使用Springmvc实现商品列表的展示：</p>
<ul>
<li><p>请求的url：/itemList.action</p>
</li>
<li><p>参数：无</p>
</li>
<li><p>数据：静态数据</p>
</li>
</ul>
<h2 id="3、开发步骤"><a href="#3、开发步骤" class="headerlink" title="3、开发步骤"></a>3、开发步骤</h2><ol>
<li><p>创建一个Javaweb工程</p>
</li>
<li><p>导入jar包</p>
<p><img src="/img/springmvc-2.png" alt="Alt text"></p>
</li>
<li><p>创建itemList.jsp</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</div><div class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</div><div class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot;  prefix=&quot;fmt&quot;%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="line">&lt;title&gt;查询商品列表&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/item/queryitem.action&quot; method=&quot;post&quot;&gt;</div><div class="line">查询条件：</div><div class="line">&lt;table width=&quot;100%&quot; border=1&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;查询&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;/table&gt;</div><div class="line">商品列表：</div><div class="line">&lt;table width=&quot;100%&quot; border=1&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">	&lt;td&gt;商品名称&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品价格&lt;/td&gt;</div><div class="line">	&lt;td&gt;生产日期&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品描述&lt;/td&gt;</div><div class="line">	&lt;td&gt;操作&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot;&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">	&lt;td&gt;$&#123;item.name &#125;&lt;/td&gt;</div><div class="line">	&lt;td&gt;$&#123;item.price &#125;&lt;/td&gt;</div><div class="line">	&lt;td&gt;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&lt;/td&gt;</div><div class="line">	&lt;td&gt;$&#123;item.detail &#125;&lt;/td&gt;</div><div class="line"></div><div class="line">	&lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/itemEdit.action?id=$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line"></div><div class="line">&lt;/table&gt;</div><div class="line">&lt;/form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>创建ItemsController</p>
<p> ItemController是一个普通的java类，不需要实现任何接口，只需要在类上添加@Controller注解即可。@RequestMapping注解指定请求的url，其中“.action”可以加也可以不加。在ModelAndView对象中，将视图设置为“/WEB-INF/jsp/itemList.jsp”。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">publicclass ItemController &#123;</div><div class="line"></div><div class="line">	@RequestMapping(&quot;/itemList&quot;)</div><div class="line">	public ModelAndView itemList() throws Exception &#123;</div><div class="line"></div><div class="line">		List&lt;Items&gt;itemList = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">		//商品列表</div><div class="line">		Items items_1 = new Items();</div><div class="line">		items_1.setName(&quot;联想笔记本_3&quot;);</div><div class="line">		items_1.setPrice(6000f);</div><div class="line">		items_1.setDetail(&quot;ThinkPad T430 联想笔记本电脑！&quot;);</div><div class="line"></div><div class="line">		Items items_2 = new Items();</div><div class="line">		items_2.setName(&quot;苹果手机&quot;);</div><div class="line">		items_2.setPrice(5000f);</div><div class="line">		items_2.setDetail(&quot;iphone6苹果手机！&quot;);</div><div class="line"></div><div class="line">		itemList.add(items_1);</div><div class="line">		itemList.add(items_2);</div><div class="line">		//创建modelandView对象</div><div class="line">		ModelAndView modelAndView = new ModelAndView();</div><div class="line">		//添加model</div><div class="line">		modelAndView.addObject(&quot;itemList&quot;, itemList);</div><div class="line">		//添加视图</div><div class="line">		modelAndView.setViewName(&quot;/WEB-INF/jsp/itemList.jsp&quot;);</div><div class="line">//		modelAndView.setViewName(&quot;itemsList&quot;);</div><div class="line">		returnmodelAndView;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>创建springmvc.xml</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">        xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">        xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/mvc</div><div class="line">        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://code.alibabatech.com/schema/dubbo</div><div class="line">        http://code.alibabatech.com/schema/dubbo/dubbo.xsd</div><div class="line">        http://www.springframework.org/schema/context</div><div class="line">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</div><div class="line">    &lt;!--配置controller注解扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>配置前端控制器:在web.xml中添加DispatcherServlet的配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;!--springmvc前端控制器--&gt;</div><div class="line">&lt;servlet&gt;</div><div class="line">    &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</div><div class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line"></div><div class="line">    &lt;!--指定配置文件--&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath*:springmvc.xml&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line"></div><div class="line">    &lt;!--启动加载--&gt;</div><div class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">&lt;/servlet&gt;</div><div class="line">&lt;servlet-mapping&gt;</div><div class="line">    &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</div><div class="line">    &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">&lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="3、Springmvc架构"><a href="#3、Springmvc架构" class="headerlink" title="3、Springmvc架构"></a>3、Springmvc架构</h1><h2 id="1、框架结构"><a href="#1、框架结构" class="headerlink" title="1、框架结构"></a>1、框架结构</h2><p><img src="/img/springmvc-3.png" alt="Alt text"></p>
<h2 id="2、架构流程"><a href="#2、架构流程" class="headerlink" title="2、架构流程"></a>2、架构流程</h2><ol>
<li><p>用户发送请求至前端控制器DispatcherServlet</p>
</li>
<li><p>DispatcherServlet收到请求调用HandlerMapping(处理器映射器)</p>
</li>
<li><p>处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器一并返回给DispatcherServlet</p>
</li>
<li><p>DispatcherServlet通过HandlerAdapter(处理器适配器)调用处理器</p>
</li>
<li><p>执行处理器(Controller，也叫后端控制器)</p>
</li>
<li><p>Controller执行完成返回ModelAndView</p>
</li>
<li><p>HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet</p>
</li>
<li><p>DispatcherServlet将ModelAndView传给ViewResolver(视图解析器)</p>
</li>
<li><p>ViewResolver解析后返回具体View</p>
</li>
<li><p>DispatcherServlet对View进行渲染视图(也就是讲模型数据填充至视图中)</p>
</li>
<li><p>DispatcherServlet相应用户</p>
</li>
</ol>
<h2 id="3、组件说明"><a href="#3、组件说明" class="headerlink" title="3、组件说明"></a>3、组件说明</h2><ul>
<li><p>DispatcherServlet：前段控制器，用户请求到达前端控制器，它就相当于mvc模式中的c，dispatcherServlet是整个流程控制的中心，由它调用其它组件处理用户的请求，dispatcherServlet的存在降低了组件之间的耦合性。</p>
</li>
<li><p>HandlerMapping：处理器映射器，HandlerMapping负责根据用户请求找到Handler即处理器，springmvc提供了不同的映射器实现不同的映射方式，例如：配置文件方式，实现接口方式，注解方式等。</p>
</li>
<li><p>Handler：处理器，Handler 是继DispatcherServlet前端控制器的后端控制器，在DispatcherServlet的控制下Handler对具体的用户请求进行处理。由于Handler涉及到具体的用户业务请求，所以一般情况需要程序员根据业务需求开发Handler。</p>
</li>
<li><p>HandlAdapter：处理器适配器，通过HandlerAdapter对处理器进行执行，这是适配器模式的应用，通过扩展适配器可以对更多类型的处理器进行执行。</p>
</li>
<li><p>View Resolver：视图解析器，View Resolver负责将处理结果生成View视图，View Resolver首先根据逻辑视图名解析成物理视图名即具体的页面地址，再生成View视图对象，最后对View进行渲染将处理结果通过页面展示给用户。</p>
</li>
<li><p>View：视图，springmvc框架提供了很多的View视图类型的支持，包括：jstlView、freemarkerView、pdfView等。我们最常用的视图就是jsp。一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面。</p>
<p><em>在springmvc的各个组件中，处理器映射器、处理器适配器、视图解析器称为springmvc的三大组件。</em></p>
<p><em>需要用户开放的组件有handler、view</em></p>
</li>
</ul>
<h2 id="4、框架默认加载组件-DispatcherServelet-properties"><a href="#4、框架默认加载组件-DispatcherServelet-properties" class="headerlink" title="4、框架默认加载组件:DispatcherServelet.properties"></a>4、框架默认加载组件:DispatcherServelet.properties</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"># Default implementation classes for DispatcherServlet&apos;s strategy interfaces.</div><div class="line"># Used as fallback when no matching beans are found in the DispatcherServlet context.</div><div class="line"># Not meant to be customized by application developers.</div><div class="line"></div><div class="line">org.springframework.web.servlet.LocaleResolver=org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.ThemeResolver=org.springframework.web.servlet.theme.FixedThemeResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerMapping=org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerAdapter=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.RequestToViewNameTranslator=org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</div><div class="line"></div><div class="line">org.springframework.web.servlet.ViewResolver=org.springframework.web.servlet.view.InternalResourceViewResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.FlashMapManager=org.springframework.web.servlet.support.SessionFlashMapManager</div></pre></td></tr></table></figure>
<h2 id="5、注解映射器和适配器"><a href="#5、注解映射器和适配器" class="headerlink" title="5、注解映射器和适配器"></a>5、注解映射器和适配器</h2><ol>
<li><p>组件扫描器：使用组件扫描器省去在Spring容器中配置每个controller类的繁琐。使用<context:component-scan>自动标记@controller的控制器类,多个包中间使用半角逗号分隔</context:component-scan></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置controller注解扫描--&gt;</div><div class="line">&lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>RequestMappingHandlerMapping</p>
<ul>
<li><p>注解式处理器映射器，对类中标记@ResquestMapping的方法进行映射，根据ResquestMapping定义的url匹配ResquestMapping标记的方法，匹配成功返回HandlerMethod对象给前端控制器，HandlerMethod对象中封装url对应的方法Method。从spring3.1版本开始，废除了DefaultAnnotationHandlerMapping的使用，推荐使用RequestMappingHandlerMapping完成注解式处理器映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!--如果没有显示的配置处理器映射器和处理器适配器，那么SpringMVC会去默认</div><div class="line">    的dispatcherServlet.properties中查找，对应的处理器映射器和处理器适配器来使用。</div><div class="line">    导致每个请求都要扫描一次他的默认文件，效率很低，降低访问速度，需要显示的配置</div><div class="line">    处理器映射器和处理器适配器</div><div class="line">--&gt;</div><div class="line">&lt;!--注解形式的处理器映射器--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>RequestMappingHandlerAdapter</p>
<ul>
<li><p>注解式处理器适配器，对标记@ResquestMapping的方法进行适配。从spring3.1版本开始，废除了AnnotationMethodHandlerAdapter的使用，推荐使用RequestMappingHandlerAdapter完成注解式处理器适配。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--注解形式的处理器适配器--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>&lt;mvc:annotation-driven&gt;</code></p>
<ul>
<li><p>springmvc使用<mvc:annotation-driven>自动加载RequestMappingHandlerMapping和RequestMappingHandlerAdapter，可用在springmvc.xml配置文件中使用<mvc:annotation-driven>替代注解处理器和适配器的配置。</mvc:annotation-driven></mvc:annotation-driven></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!--//注解驱动：自动配置最新版的处理器映射器和处理器适配器--&gt;</div><div class="line">&lt;mvc:annotation-driven/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="6、视图解析器"><a href="#6、视图解析器" class="headerlink" title="6、视图解析器"></a>6、视图解析器</h2><ul>
<li>InternalResourceViewResolver：支持JSP视图解析</li>
<li>viewClass：JstlView表示JSP模板页面需要使用JSTL标签库，所以classpath中必须包含jstl的相关jar 包。此属性可以不设置，默认为JstlView。</li>
<li>prefix 和suffix：查找视图页面的前缀和后缀，最终视图的址为：前缀+逻辑视图名+后缀，逻辑视图名需要在controller中返回ModelAndView指定，比如逻辑视图名为hello，则最终返回的jsp视图地址 “WEB-INF/jsp/hello.jsp”</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置视图解析器，在controller中指定路径名称时不用谢完整的扩展名名称，只写名称就可以--&gt;</div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</div><div class="line">    &lt;!--真正的页面路径 = 前缀 + 去掉后缀名的页面名称 + 后缀--&gt;</div><div class="line">    &lt;!--前缀--&gt;</div><div class="line">    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</div><div class="line">    &lt;!--后缀--&gt;</div><div class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
</code></pre><h1 id="4、Springmvc整合mybatis"><a href="#4、Springmvc整合mybatis" class="headerlink" title="4、Springmvc整合mybatis"></a>4、Springmvc整合mybatis</h1><p>控制层采用Springmvc，持久层使用mybatis。</p>
<h2 id="1、需求"><a href="#1、需求" class="headerlink" title="1、需求"></a>1、需求</h2><p>实现商品查询列表，从MySQL数据库查询商品信息。</p>
<h2 id="2、jar包"><a href="#2、jar包" class="headerlink" title="2、jar包"></a>2、jar包</h2><p><img src="/img/springmvc-4.png" alt="Alt text"></p>
<h2 id="3、工程搭建"><a href="#3、工程搭建" class="headerlink" title="3、工程搭建"></a>3、工程搭建</h2><h3 id="1、整合思路"><a href="#1、整合思路" class="headerlink" title="1、整合思路"></a>1、整合思路</h3><p>DAO层：</p>
<ol>
<li><p>SqlMapConfig.xml,空文件，需要头文件。</p>
</li>
<li><p>application.xml中配置：</p>
<ul>
<li><p>数据库连接池</p>
</li>
<li><p>SqlSessionFactory对象，需要Spring和mybatis整合包下的</p>
</li>
<li><p>配置mapper文件扫描器</p>
</li>
</ul>
</li>
</ol>
<p>Service层：</p>
<ol>
<li><p>applicationContext-service.xml包扫描器，扫描<code>@Service</code>注解的类</p>
</li>
<li><p>applicationContext-trans.xml配置事务</p>
</li>
</ol>
<p>表现层：</p>
<ol>
<li><p>springmvc.xml：</p>
<ul>
<li><p>包扫描器，扫描<code>@Controller</code>注解的类</p>
</li>
<li><p>配置注解驱动</p>
</li>
<li><p>视图解析器</p>
</li>
</ul>
</li>
<li><p>Web.xml：</p>
<ul>
<li>配置前端控制器</li>
</ul>
</li>
</ol>
<h3 id="2、sqlMapConfig-xml"><a href="#2、sqlMapConfig-xml" class="headerlink" title="2、sqlMapConfig.xml"></a>2、sqlMapConfig.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;!DOCTYPE configuration</div><div class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</div><div class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</div><div class="line">&lt;configuration&gt;</div><div class="line"></div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="3、applicationContext-dao-xml"><a href="#3、applicationContext-dao-xml" class="headerlink" title="3、applicationContext-dao.xml"></a>3、applicationContext-dao.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 加载配置文件 --&gt;</div><div class="line">    &lt;context:property-placeholder location=&quot;classpath:db.properties&quot; /&gt;</div><div class="line">    &lt;!-- 数据库连接池 --&gt;</div><div class="line">    &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;</div><div class="line">          destroy-method=&quot;close&quot;&gt;</div><div class="line">        &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</div><div class="line">        &lt;property name=&quot;maxActive&quot; value=&quot;10&quot; /&gt;</div><div class="line">        &lt;property name=&quot;maxIdle&quot; value=&quot;5&quot; /&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!-- mapper配置 --&gt;</div><div class="line">    &lt;!-- 让spring管理sqlsessionfactory 使用mybatis和spring整合包中的 --&gt;</div><div class="line">    &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</div><div class="line">        &lt;!-- 数据库连接池 --&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</div><div class="line">        &lt;!-- 加载mybatis的全局配置文件 --&gt;</div><div class="line">        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:SqlMapConfig.xml&quot; /&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!-- 配置Mapper扫描器 --&gt;</div><div class="line">    &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</div><div class="line">        &lt;property name=&quot;basePackage&quot; value=&quot;cn.itheima.dao&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<p>db.properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">jdbc.driver=com.mysql.jdbc.Driver</div><div class="line">jdbc.url=jdbc:mysql://localhost:3306/springmvc?characterEncoding=utf-8</div><div class="line">jdbc.username=root</div><div class="line">jdbc.password=linux</div></pre></td></tr></table></figure>
<h3 id="4、applicationContext-service-xml"><a href="#4、applicationContext-service-xml" class="headerlink" title="4、applicationContext-service.xml"></a>4、applicationContext-service.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--@Serviece扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.service&quot;/&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="5、applicationContext-transaction-xml"><a href="#5、applicationContext-transaction-xml" class="headerlink" title="5、applicationContext-transaction.xml"></a>5、applicationContext-transaction.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 事务管理器 --&gt;</div><div class="line">    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</div><div class="line">        &lt;!--数据源--&gt;</div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line"></div><div class="line">    &lt;!--通知--&gt;</div><div class="line">    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</div><div class="line">        &lt;tx:attributes&gt;</div><div class="line">            &lt;!--传播行为--&gt;</div><div class="line">            &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;</div><div class="line">            &lt;tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;/&gt;</div><div class="line">        &lt;/tx:attributes&gt;</div><div class="line">    &lt;/tx:advice&gt;</div><div class="line"></div><div class="line">    &lt;!--切面--&gt;</div><div class="line">    &lt;aop:config&gt;</div><div class="line">        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut=&quot;execution(* cn.itheima.service.*.*(..))&quot;/&gt;</div><div class="line">    &lt;/aop:config&gt;</div><div class="line"></div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="6、springmvc-xml"><a href="#6、springmvc-xml" class="headerlink" title="6、springmvc.xml"></a>6、springmvc.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">        xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</div><div class="line">        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</div><div class="line">        xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">        xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</div><div class="line">        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--配置注解扫描--&gt;</div><div class="line">    &lt;context:component-scan base-package=&quot;cn.itheima.controller&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;!--配置注解驱动--&gt;</div><div class="line">    &lt;!--&lt;mvc:annotation-driven/&gt;--&gt;</div><div class="line"></div><div class="line">    &lt;!--配置视图解析器--&gt;</div><div class="line">    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</div><div class="line">        &lt;!--前缀--&gt;</div><div class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</div><div class="line">        &lt;!--后缀--&gt;</div><div class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</div><div class="line">    &lt;/bean&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="7、web-xml"><a href="#7、web-xml" class="headerlink" title="7、web.xml"></a>7、web.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</div><div class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</div><div class="line">         version=&quot;3.1&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--解决post乱码问题--&gt;</div><div class="line">    &lt;filter&gt;</div><div class="line">        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</div><div class="line">        &lt;init-param&gt;</div><div class="line">            &lt;param-name&gt;encoding&lt;/param-name&gt;</div><div class="line">            &lt;param-value&gt;utf-8&lt;/param-value&gt;</div><div class="line">        &lt;/init-param&gt;</div><div class="line">    &lt;/filter&gt;</div><div class="line">    &lt;filter-mapping&gt;</div><div class="line">        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">    &lt;/filter-mapping&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;!--SpringMVC的前端控制器--&gt;</div><div class="line">    &lt;servlet&gt;</div><div class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line">        &lt;init-param&gt;</div><div class="line">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">            &lt;param-value&gt;classpath:SpringMvc.xml&lt;/param-value&gt;</div><div class="line">        &lt;/init-param&gt;</div><div class="line">        &lt;!--在Tomcat启动的时候就加载这个Servlet--&gt;</div><div class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">    &lt;/servlet&gt;</div><div class="line">    &lt;servlet-mapping&gt;</div><div class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">        &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">    &lt;/servlet-mapping&gt;</div><div class="line"></div><div class="line">    &lt;!--配置Spring监听器--&gt;</div><div class="line">    &lt;context-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath:applicationContext-*.xml&lt;/param-value&gt;</div><div class="line">    &lt;/context-param&gt;</div><div class="line">    &lt;listener&gt;</div><div class="line">        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</div><div class="line">    &lt;/listener&gt;</div><div class="line"></div><div class="line">&lt;/web-app&gt;</div></pre></td></tr></table></figure>
<h2 id="4、Dao"><a href="#4、Dao" class="headerlink" title="4、Dao"></a>4、Dao</h2><p>通过mybatis逆向工程生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public interface ItemsMapper &#123;</div><div class="line">    int countByExample(ItemsExample example);</div><div class="line"></div><div class="line">    int deleteByExample(ItemsExample example);</div><div class="line"></div><div class="line">    int deleteByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int insert(Items record);</div><div class="line"></div><div class="line">    int insertSelective(Items record);</div><div class="line"></div><div class="line">    List&lt;Items&gt; selectByExampleWithBLOBs(ItemsExample example);</div><div class="line"></div><div class="line">    List&lt;Items&gt; selectByExample(ItemsExample example);</div><div class="line"></div><div class="line">    Items selectByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int updateByExampleSelective(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByExampleWithBLOBs(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByExample(@Param(&quot;record&quot;) Items record, @Param(&quot;example&quot;) ItemsExample example);</div><div class="line"></div><div class="line">    int updateByPrimaryKeySelective(Items record);</div><div class="line"></div><div class="line">    int updateByPrimaryKeyWithBLOBs(Items record);</div><div class="line"></div><div class="line">    int updateByPrimaryKey(Items record);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public interface UserMapper &#123;</div><div class="line">    int countByExample(UserExample example);</div><div class="line"></div><div class="line">    int deleteByExample(UserExample example);</div><div class="line"></div><div class="line">    int deleteByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int insert(User record);</div><div class="line"></div><div class="line">    int insertSelective(User record);</div><div class="line"></div><div class="line">    List&lt;User&gt; selectByExample(UserExample example);</div><div class="line"></div><div class="line">    User selectByPrimaryKey(Integer id);</div><div class="line"></div><div class="line">    int updateByExampleSelective(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</div><div class="line"></div><div class="line">    int updateByExample(@Param(&quot;record&quot;) User record, @Param(&quot;example&quot;) UserExample example);</div><div class="line"></div><div class="line">    int updateByPrimaryKeySelective(User record);</div><div class="line"></div><div class="line">    int updateByPrimaryKey(User record);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5、Service"><a href="#5、Service" class="headerlink" title="5、Service"></a>5、Service</h2><p>Service由Spring管理，Spring对service进行事务控制。</p>
<h3 id="1、ItemService接口"><a href="#1、ItemService接口" class="headerlink" title="1、ItemService接口"></a>1、ItemService接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public interface ItemsService &#123;</div><div class="line">    public List&lt;Items&gt; list() throws Exception;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2、ItemsServiceImplement实现类"><a href="#2、ItemsServiceImplement实现类" class="headerlink" title="2、ItemsServiceImplement实现类"></a>2、ItemsServiceImplement实现类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Service</div><div class="line">public class ItemsServiceImpl implements ItemsService&#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private ItemsMapper itemsMapper;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public List&lt;Items&gt; list() throws Exception &#123;</div><div class="line">        ItemsExample example = new ItemsExample();</div><div class="line"></div><div class="line">        List&lt;Items&gt; list = itemsMapper.selectByExampleWithBLOBs(example);</div><div class="line"></div><div class="line">        return list;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">//窄化请求映射</div><div class="line">@RequestMapping(&quot;/items&quot;)</div><div class="line">public class ItemsController &#123;</div><div class="line">    @Autowired</div><div class="line">    private ItemsService itemsService;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/list&quot;)</div><div class="line">    public ModelAndView itemsList() throws Exception &#123;</div><div class="line">        List&lt;Items&gt; list = itemsService.list();</div><div class="line"></div><div class="line">        ModelAndView modelAndView = new ModelAndView();</div><div class="line">        modelAndView.addObject(&quot;itemList&quot;, list);</div><div class="line">        modelAndView.setViewName(&quot;itemList&quot;);</div><div class="line"></div><div class="line">        return modelAndView;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>访问<a href="http://localhost:8080//items/list.action进行测试。" target="_blank" rel="external">http://localhost:8080//items/list.action进行测试。</a></p>
<h1 id="5、参数绑定"><a href="#5、参数绑定" class="headerlink" title="5、参数绑定"></a>5、参数绑定</h1><h2 id="1、简单数据类型"><a href="#1、简单数据类型" class="headerlink" title="1、简单数据类型"></a>1、简单数据类型</h2><p>需求：打开商品编辑页面，展示商品信息。</p>
<ul>
<li><p>编辑商品信息，需要根据id查询商品信息，然后展示到页面，</p>
</li>
<li><p>请求：/itemsEdit.action，</p>
</li>
<li><p>参数：id,</p>
</li>
<li><p>相应结果：商品编辑页面，展示商品详细信息</p>
</li>
</ul>
<h3 id="1、service"><a href="#1、service" class="headerlink" title="1、service"></a>1、service</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public Items findItemsById(Integer id) throws Exception &#123;</div><div class="line">    return itemsMapper.selectByPrimaryKey(id);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2、Controller参数绑定"><a href="#2、Controller参数绑定" class="headerlink" title="2、Controller参数绑定"></a>2、Controller参数绑定</h3><p>根据id查询商品数据，需要从请求的参数中把请求的id提取出来。Id应该包含在Request对象中。可以从Request中取id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">public ModelAnd itemEdit(HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">  //从Request中取id</div><div class="line">  String strId = request.getParameter(&quot;id&quot;);</div><div class="line">  Integer id = null;</div><div class="line">  //如果id有值则转换成int类型</div><div class="line">  if (strId != null&amp;&amp; !&quot;&quot;.equals(strId)) &#123;</div><div class="line">    id = newInteger(strId);</div><div class="line">  &#125; else &#123;</div><div class="line">    //出错</div><div class="line">    returnnull;</div><div class="line">  &#125;</div><div class="line">  Items items = itemService.getItemById(id);</div><div class="line">  //创建ModelAndView</div><div class="line">  ModelAndView modelAndView = new ModelAndView();</div><div class="line">  //向jsp传递数据</div><div class="line">  modelAndView.addObject(&quot;item&quot;, items);</div><div class="line">  //设置跳转的jsp页面</div><div class="line">  modelAndView.setViewName(&quot;editItem&quot;);</div><div class="line">  returnmodelAndView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、Springmvc默认支持的类型"><a href="#3、Springmvc默认支持的类型" class="headerlink" title="3、Springmvc默认支持的类型"></a>3、Springmvc默认支持的类型</h3><p>处理器形参中添加如下类型的参数，处理适配器会默认识别并进行赋值。</p>
<ul>
<li><p>HttpServletRequest：通过request对象获取请求信息</p>
</li>
<li><p>HttpServletResponse: 通过response处理相应信息</p>
</li>
<li><p>HttpSession：通过Session对象得到session中存放的对象</p>
</li>
<li><p>Model/ModelMap：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//调用service查询商品信息</div><div class="line">Items item = itemService.findItemById(id);</div><div class="line">model.addAttribute(&quot;item&quot;, item);</div></pre></td></tr></table></figure>
<ul>
<li><p>页面通过${item.xxx}获取Model中的属性。实际上使用Model和ModelMap效果一样，使用Model，springmvc会实例化ModelMap。</p>
</li>
<li><p>如果使用Model则可以不使用ModelAndView对象，Model对象可以向页面传递数据，View对象则可以使用String返回值替代。不管是Model还是ModelAndView，其本质都是使用Request对象向jsp传递数据。</p>
</li>
<li><p>使用ModelAndView则方法可以变为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">public String itemEdit(HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">    String idStr = reuqest.getParameter(&quot;id&quot;);</div><div class="line">    Items items = itemsService.findItemsById(Integer.parseInt(idStr));</div><div class="line"></div><div class="line">    model.addAttribute(&quot;item&quot;, items);</div><div class="line">    //如果springmvc方法返回一个简单的字符串，nameSpringmvc就会认为这个字符串是页面的名称</div><div class="line">    return &quot;editItem&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="4、绑定简单类型"><a href="#4、绑定简单类型" class="headerlink" title="4、绑定简单类型"></a>4、绑定简单类型</h3><p>当请求的参数名称和处理器形参 <em>名称一致</em> 时，会将请求参数与形参进行绑定。从request取参数的方法可以进一步简化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit&quot;)</div><div class="line">	public String itemEdit(Integer id, Model model) &#123;</div><div class="line">		Items items = itemService.getItemById(id);</div><div class="line">		//向jsp传递数据</div><div class="line">		model.addAttribute(&quot;item&quot;, items);</div><div class="line">		//设置跳转的jsp页面</div><div class="line">		return&quot;editItem&quot;;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>支持的数据类型：参数类型推荐使用包装数据类型，因为基础数据类型不可以为null</p>
<ul>
<li><p>Integer，int</p>
</li>
<li><p>Float Float</p>
</li>
<li><p>Double Double</p>
</li>
<li><p>Boolean Boolean ：对于Boolean类型的参数，请求的参数值为true或者false。</p>
</li>
</ul>
</li>
<li><p><code>@RequestParam</code> ：使用<code>@RequestParam</code>用于处理简单类型的绑定</p>
<ul>
<li><p>value：参数名字，即入参的请求参数名字，如value=“item_id”表示请求的参数区中的名字为item_id的参数的值将传入；</p>
</li>
<li><p>required：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报:TTP Status 400 - Required Integer parameter ‘XXXX’ is not present</p>
</li>
<li><p>defaultValue：默认值，表示如果请求中没有同名参数时的默认值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public String editItem(@RequestParam(value=&quot;item_id&quot;,required=true) String id) &#123;&#125;</div></pre></td></tr></table></figure>
<p>形参名称为id,这里使用value=”item_id”限定请求的参数名为item_id，所以页面出传递的参数名必须为item_id。如果请求参数中没有该参数会报500错误。同时通过require=true限定item_id参数Wie必穿阐述，如果不传递则会报400错误。可以使用defaultvalue设置默认值。</p>
</li>
</ul>
</li>
</ol>
<h2 id="3、绑定pojo类型"><a href="#3、绑定pojo类型" class="headerlink" title="3、绑定pojo类型"></a>3、绑定pojo类型</h2><h3 id="1、需求-1"><a href="#1、需求-1" class="headerlink" title="1、需求"></a>1、需求</h3><p>将页面修改后的商品信息保存到数据库中。</p>
<ul>
<li><p>请求的url：/updateitem.action结尾的</p>
</li>
<li><p>参数：表单中的数据</p>
</li>
<li><p>相应内容：更新成功页面</p>
</li>
</ul>
<h3 id="2、使用pojo接收表单数据"><a href="#2、使用pojo接收表单数据" class="headerlink" title="2、使用pojo接收表单数据"></a>2、使用pojo接收表单数据</h3><p>如果提交的参数很多，或者提交的表单的内容很多的时候可以使用pojo接收数据。要求pojo对象中的属性名和表单input的name属性一致。</p>
<p>页面定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">  &lt;td&gt;商品名称&lt;/td&gt;</div><div class="line">  &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;$&#123;item.name &#125;&quot; /&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;tr&gt;</div><div class="line">  &lt;td&gt;商品价格&lt;/td&gt;</div><div class="line">  &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;price&quot; value=&quot;$&#123;item.price &#125;&quot; /&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div></pre></td></tr></table></figure>
<p>Pojo定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class Items &#123;</div><div class="line">    private Integer id;</div><div class="line"></div><div class="line">    private String name;</div><div class="line"></div><div class="line">    private Float price;</div><div class="line"></div><div class="line">    private String pic;</div><div class="line"></div><div class="line">    private Date createtime;</div><div class="line"></div><div class="line">    private String detail;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//可以直接绑定pojo对象，pojo属性名称和页面传过来的参数名称需要一致，</div><div class="line">// 按照名称来进行参数绑定</div><div class="line">@RequestMapping(&quot;/updateitem&quot;)</div><div class="line">public String update(Items items) throws Exception &#123;</div><div class="line"></div><div class="line">    itemsService.updateItem(items);</div><div class="line"></div><div class="line">    return &quot;success&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时提交的表单中不能有日期类型的数据，否则会报400错误。需要自定义参数绑定才可以提交日期类型的数据。</p>
<h3 id="3、解决post提交的乱码问题：在web-xml中加入："><a href="#3、解决post提交的乱码问题：在web-xml中加入：" class="headerlink" title="3、解决post提交的乱码问题：在web.xml中加入："></a>3、解决post提交的乱码问题：在web.xml中加入：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!--解决post乱码问题--&gt;</div><div class="line">&lt;filter&gt;</div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;encoding&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;utf-8&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line">&lt;/filter&gt;</div><div class="line">&lt;filter-mapping&gt;</div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;</div><div class="line">    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure>
<p>而对于get请求中文参数的乱码问题解决方案有两个：</p>
<ol>
<li><p>修改Tomcat配置文件添加编码与工程编码一致：<code>&lt;Connector URIEncoding=&quot;utf-8&quot; connectionTimeout=&quot;20000&quot; port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot;/&gt;</code></p>
</li>
<li><p>对参数重新编码：<code>String userName new
String(request.getParamter(&quot;userName&quot;).getBytes(&quot;ISO8859-1&quot;),&quot;utf-8&quot;)</code></p>
</li>
</ol>
<h2 id="4、pojo包装类型"><a href="#4、pojo包装类型" class="headerlink" title="4、pojo包装类型"></a>4、pojo包装类型</h2><ul>
<li>需求</li>
</ul>
<p>使用包装的pojo接收商品信息的查询条件。</p>
<ul>
<li>包装对象定义如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line"></div><div class="line">    public Items getItems() &#123;</div><div class="line">        return items;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setItems(Items items) &#123;</div><div class="line">        this.items = items;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>页面定义：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">	&lt;%--如果Controller中接收的是VO，name页面上的属性值要等于VO的属性.属性。属性--%&gt;</div><div class="line">	&lt;td&gt;商品名称：&lt;input type=&quot;text&quot; name=&quot;items.name&quot;/&gt;&lt;/td&gt;</div><div class="line">	&lt;td&gt;商品价格：&lt;input type=&quot;text&quot; name=&quot;items.price&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;查询&quot;/&gt;&lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div></pre></td></tr></table></figure>
<ul>
<li>Controller:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/search&quot;)</div><div class="line">public String search(QueryVo queryVo) throws Exception &#123;</div><div class="line">    System.out.println(queryVo);</div><div class="line">    return &quot;success&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5、自定义参数绑定"><a href="#5、自定义参数绑定" class="headerlink" title="5、自定义参数绑定"></a>5、自定义参数绑定</h2><ul>
<li>需求</li>
</ul>
<p>在商品修改页面可以修改商品的日期，并且根据业务需求自定义日期格式。</p>
<p>由于日期数据有多种格式，所以springmvc没办法把字符串转换成日期类型。所以需要自定义参数绑定。前端控制器接收到请求后，找到注解形式的处理器适配器，对RequestMapping标记的方法进行适配，并对方法中的形参进行参数绑定。在springmvc这可以在处理器适配器上自定义Converter进行参数绑定。如果使用<mvc:annotation-driven>可以在此标签上进行扩展。</mvc:annotation-driven></p>
<ul>
<li><p>自定义Convert</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class CustomGlobalStrToDataConvert implements Converter&lt;String, Date&gt;&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Date convert(String s) &#123;</div><div class="line">        try &#123;</div><div class="line">            Date date = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).parse(s);</div><div class="line">            return date;</div><div class="line">        &#125; catch (ParseException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置Convert:此方法需要独立配置处理器映射器，处理器适配器，不能使用<mvc:annotation-driven></mvc:annotation-driven></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置自定义转换器--&gt;</div><div class="line">&lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt;</div><div class="line">    &lt;property name=&quot;converters&quot;&gt;</div><div class="line">        &lt;set&gt;</div><div class="line">            &lt;bean class=&quot;cn.itheima.controller.convert.CustomGlobalStrToDataConvert&quot;/&gt;</div><div class="line">        &lt;/set&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- 自定义webBinder --&gt;</div><div class="line">&lt;beanid=&quot;customBinder&quot;	class=&quot;org.springframework.web.bind.support.ConfigurableWebBindingInitializer&quot;&gt;</div><div class="line">  &lt;propertyname=&quot;conversionService&quot;ref=&quot;conversionService&quot;/&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!--注解适配器 --&gt;</div><div class="line">&lt;beanclass=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;</div><div class="line">  &lt;propertyname=&quot;webBindingInitializer&quot;ref=&quot;customBinder&quot;&gt;&lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;!-- 注解处理器映射器 --&gt;</div><div class="line">&lt;beanclass=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="6、Springmvc和Struts2的区别"><a href="#6、Springmvc和Struts2的区别" class="headerlink" title="6、Springmvc和Struts2的区别"></a>6、Springmvc和Struts2的区别</h1><ol>
<li><p>springmvc的入口是一个servlet，也就是前端控制器，Struts2入口是一个filter过滤器。</p>
</li>
<li><p>springmvc是基于方法开发(一个url对应一个方法)，请求参数传递到方法的形参，可以设计为单例或者多例。Struts2是基于类开发的，传递参数是通过类的属性，只能设计为多例。</p>
</li>
<li><p>Struts2采用值栈存储请求和相应的数据，通过OGNL表达式存取数据。springmvc通过参数解析器是将request中请求内容解析，并给方法形参赋值，将数据和视图封装成ModelAndView对象，通过又将ModelAndView中的模型数据通过request域传输到页面。JSP视图解析器默认使用jstl。</p>
</li>
</ol>
<h1 id="7、高级参数绑定"><a href="#7、高级参数绑定" class="headerlink" title="7、高级参数绑定"></a>7、高级参数绑定</h1><h2 id="1、数组类型的参数绑定"><a href="#1、数组类型的参数绑定" class="headerlink" title="1、数组类型的参数绑定"></a>1、数组类型的参数绑定</h2><h3 id="1、需求-2"><a href="#1、需求-2" class="headerlink" title="1、需求"></a>1、需求</h3><p>在商品列表页面选中多个商品，然后删除，此功能要求商品列表页面的每个商品签名有个复选框，选中多个商品后点击删除按钮，将商品id传递给Controller，根据id删除商品信息。</p>
<h3 id="2、jsp页面修改"><a href="#2、jsp页面修改" class="headerlink" title="2、jsp页面修改"></a>2、jsp页面修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot; varStatus=&quot;status&quot;&gt;</div><div class="line">			&lt;tr&gt;</div><div class="line">				&lt;td&gt;</div><div class="line">					&lt;input type=&quot;checkbox&quot; name=&quot;ids&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">				&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.name&quot; value=&quot;$&#123;item.name &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.price&quot; value=&quot;$&#123;item.price &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.createtime&quot;</div><div class="line">						   value=&quot;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;item.detail&quot; value=&quot;$&#123;item.detail &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">				&lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/items/itemEdit/$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">			&lt;/tr&gt;</div><div class="line">		&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<h3 id="3、Controller"><a href="#3、Controller" class="headerlink" title="3、Controller"></a>3、Controller</h3><p>Controller方法可以用String[]接收，或者pojo的String[]属性接收。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/delAll&quot;)</div><div class="line">public String delAll(QueryVo vo) throws Exception &#123;</div><div class="line">//        如果批量删除，一堆input框，name可以提交数组，选中的会自动进入到数组中</div><div class="line">    System.out.println(vo);</div><div class="line">    return &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Vo:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line">    //批量删除使用</div><div class="line">    private Integer[] ids;</div><div class="line">    //批量修改使用</div><div class="line">    private List&lt;Items&gt; itemsList;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2、List类型的参数绑定"><a href="#2、List类型的参数绑定" class="headerlink" title="2、List类型的参数绑定"></a>2、List类型的参数绑定</h2><h3 id="1、需求-3"><a href="#1、需求-3" class="headerlink" title="1、需求"></a>1、需求</h3><p>实现商品数据的批量修改。要想实现商品数据的批量修改，需要在商品列表中可以对商品信息进行修改，并且可以批量提交修改后的商品数据。</p>
<h3 id="2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。"><a href="#2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。" class="headerlink" title="2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。"></a>2、pojo类：List中存放对象，并将定义的List放入包装类中，使用包装类pojo对象接收。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class QueryVo &#123;</div><div class="line">//    商品对象</div><div class="line">    private Items items;</div><div class="line">    //批量删除使用</div><div class="line">    private Integer[] ids;</div><div class="line">    //批量修改使用</div><div class="line">    private List&lt;Items&gt; itemsList;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、jsp修改"><a href="#3、jsp修改" class="headerlink" title="3、jsp修改"></a>3、jsp修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items=&quot;$&#123;itemList &#125;&quot; var=&quot;item&quot; varStatus=&quot;status&quot;&gt;</div><div class="line">  &lt;tr&gt;</div><div class="line">    &lt;!-- name属性名称要等于vo中的接收的属性名 --&gt;</div><div class="line">    &lt;!-- 如果批量删除,可以用List&lt;pojo&gt;来接收,页面上input框的name属性值= vo中接收的集合属性名称+[list的下标]+.+list泛型的属性名称 --&gt;</div><div class="line">    &lt;td&gt;</div><div class="line">      &lt;input type=&quot;checkbox&quot; name=&quot;ids&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">      &lt;input type=&quot;hidden&quot; name=&quot;itemsList[$&#123;status.index &#125;].id&quot; value=&quot;$&#123;item.id &#125;&quot;/&gt;</div><div class="line">    &lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].name&quot; value=&quot;$&#123;item.name &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].price&quot; value=&quot;$&#123;item.price &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].createtime&quot;</div><div class="line">           value=&quot;&lt;fmt:formatDate value=&quot;$&#123;item.createtime&#125;&quot; pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;/&gt;&quot;/&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;itemsList[$&#123;status.index &#125;].detail&quot; value=&quot;$&#123;item.detail &#125;&quot;/&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">    &lt;td&gt;&lt;a href=&quot;$&#123;pageContext.request.contextPath &#125;/items/itemEdit/$&#123;item.id&#125;&quot;&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line"></div><div class="line">  &lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<p>其中name属性必须是包装pojo的list属性+下表+元素属性。</p>
<ul>
<li><p>varStatus属性常用参数总结：</p>
<ul>
<li>${status.index}      输出行号，从0开始。</li>
<li>${status.count}      输出行号，从1开始。</li>
<li>${status.current}   当前这次迭代的（集合中的）项</li>
<li>${status.first}  判断当前项是否为集合中的第一项，返回值为true或false</li>
<li>${status.last}   判断当前项是否为集合中的最后一项，返回值为true或false</li>
<li>begin、end、step分别表示：起始序号，结束序号，跳跃步伐。</li>
</ul>
</li>
</ul>
<h3 id="4、Controller"><a href="#4、Controller" class="headerlink" title="4、Controller"></a>4、Controller</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/updateAll&quot;)</div><div class="line">public String updateAll(QueryVo vo) throws Exception &#123;</div><div class="line">    System.out.println(vo);</div><div class="line">    return &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <em>接收List类型的数据必须是pojo的属性，方法的形参为List类型无法正确接收到数据</em></p>
<h1 id="8、-RequestMapping注解的使用"><a href="#8、-RequestMapping注解的使用" class="headerlink" title="8、@RequestMapping注解的使用"></a>8、<code>@RequestMapping</code>注解的使用</h1><p>通过<code>@RequestMapping</code>注解可以定义不同的处理器映射规则。</p>
<ul>
<li><p><code>@RequestMapping(value=&quot;/item&quot;)</code>或者<code>@RequestMapping(&quot;/item&quot;)</code>， value的值是数组，可以将多个url映射到一个方法中。</p>
</li>
<li><p>窄化请求映射，在class上添加<code>@RequestMapping(url)</code>指定通用请求前缀，限制此类下的所有方法请求url必须以请求前缀开头，通过此方法对url进行分类管理。例如：在类名上添加<code>@RequestMapping(&quot;/item&quot;)</code>,在方法名上添加<code>@RequestMapping(&quot;/list&quot;)</code>，则访问地址为：<code>/item/list</code></p>
</li>
<li><p>方法请求限定：</p>
<ul>
<li><p>限定Get方法：<code>@RequestMapping(method = RequestMethod.GET)</code> 如果通过post请求会报错：<code>HTTP Status 405 - Request method &#39;POST&#39; not supported</code></p>
</li>
<li><p>限定POST方法：<code>@RequestMapping(method = RequestMethod.POST)</code>如果通过get请求则报错：<code>HTTP Status 405 - Request method &#39;GET&#39; not supported</code></p>
</li>
<li><p>GET和POST都可以：<code>@RequestMapping(method={RequestMethod.GET,RequestMethod.POST})</code></p>
</li>
</ul>
</li>
</ul>
<h1 id="9、Controller方法的返回值"><a href="#9、Controller方法的返回值" class="headerlink" title="9、Controller方法的返回值"></a>9、Controller方法的返回值</h1><ol>
<li><p>返回ModelAndView：controller方法中定义ModelAndView对象并返回，对象中可添加model数据，指定view。</p>
</li>
<li><p>返回Void：在controller方法形参上可以定义request和response，使用request或者response指定响应结果：</p>
<ul>
<li><p>使用request转向页面：<code>request.getRequestDispatcher(&quot;/WEB-INF/jsp/success.jsp&quot;).forward(request, response);</code></p>
</li>
<li><p>使用response重定向:<code>response.sendRedirect(&quot;url&quot;)</code></p>
</li>
<li><p>也可以通过response指定响应结果：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">response.setCharacterEncoding(&quot;utf-8&quot;);</div><div class="line">response.setContentType(&quot;application/json;charset=utf-8&quot;);</div><div class="line">response.getWriter().write(&quot;json串&quot;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回字符串</p>
<ul>
<li><p>逻辑视图名</p>
<ul>
<li><p>controller方法返回字符串可以指定逻辑视图名，通过视图解析器解析为物理视图地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//指定逻辑视图名，经过视图解析器解析为jsp物理路径：/WEB-INF/jsp/item/editItem.jsp</div><div class="line">return &quot;item/editItem&quot;;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Redirect重定向</p>
<ul>
<li><p>Controller方法返回结果重定向到一个url地址吗，如下商品修改提交后重定向到商品查询方法，参数无法带到商品查询方法中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//重定向到queryItem.action地址,request无法带过去</div><div class="line">return &quot;redirect:queryItem.action&quot;;</div></pre></td></tr></table></figure>
</li>
<li><p>redirect方式相当于<code>response.sendRedirect()</code>,转发后浏览器的地址栏变为转发后的地址，因为转发执行了一个新的request和response。由于发起了一个request原来的参数在转发时就不能传递到下一个url，如果要传入参数可以在url中添加</p>
</li>
</ul>
</li>
<li><p>forward转发</p>
<ul>
<li><p>controller方法执行后继续执行另一个controller方法，如下商品修改提交后转向到商品修改页面，修改商品的id参数可以带到商品修改方法中去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//结果转发到editItem.action，request可以带过去</div><div class="line">return &quot;forward:editItem.action&quot;;</div></pre></td></tr></table></figure>
</li>
<li><p>forward方式相当于<code>request.getRequestDispatcher().forward(request,response)</code>，转发后浏览器地址栏还是原来的地址，转发并没有执行新的request和response，而是和转发前的请求公用一个request和response。所以转发请求的参数在转发后仍然可以读取到。</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="10、Springmvc中的异常处理"><a href="#10、Springmvc中的异常处理" class="headerlink" title="10、Springmvc中的异常处理"></a>10、Springmvc中的异常处理</h1><p>springmvc在处理请求过程中出现异常信息交由异常处理器进行处理，自定义异常处理器可以实现一个系统的异常处理逻辑。</p>
<h2 id="1、异常处理思路"><a href="#1、异常处理思路" class="headerlink" title="1、异常处理思路"></a>1、异常处理思路</h2><ul>
<li><p>系统中异常分为两类：</p>
<ul>
<li><p>预期异常，通过捕获异常从而获取异常</p>
</li>
<li><p>运行时异常，规范代码开发</p>
</li>
</ul>
</li>
<li><p>系统的dao、service、controller出现都通过throws Exception向上抛出，最后由springmvc的前端控制器交由异常处理器进行异常处理</p>
</li>
</ul>
<p><img src="/img/springmvc-5.png" alt="Alt text"></p>
<h2 id="2、自定义异常类"><a href="#2、自定义异常类" class="headerlink" title="2、自定义异常类"></a>2、自定义异常类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class CustomException extends Exception &#123;</div><div class="line"></div><div class="line">	/** serialVersionUID*/</div><div class="line">	private static final long serialVersionUID = -5212079010855161498L;</div><div class="line"></div><div class="line">	public CustomException(String message)&#123;</div><div class="line">		super(message);</div><div class="line">		this.message = message;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//异常信息</div><div class="line">	private String message;</div><div class="line"></div><div class="line">	public String getMessage() &#123;</div><div class="line">		return message;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setMessage(String message) &#123;</div><div class="line">		this.message = message;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、自定义异常处理器"><a href="#3、自定义异常处理器" class="headerlink" title="3、自定义异常处理器"></a>3、自定义异常处理器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class CustomExceptionResolver implements HandlerExceptionResolver &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public ModelAndView resolveException(HttpServletRequest request,</div><div class="line">			HttpServletResponse response, Object handler, Exception ex) &#123;</div><div class="line"></div><div class="line">		ex.printStackTrace();</div><div class="line"></div><div class="line">		CustomException customException = null;</div><div class="line"></div><div class="line">		//如果抛出的是系统自定义异常则直接转换</div><div class="line">		if(ex instanceof CustomException)&#123;</div><div class="line">			customException = (CustomException)ex;</div><div class="line">		&#125;else&#123;</div><div class="line">			//如果抛出的不是系统自定义异常则重新构造一个系统错误异常。</div><div class="line">			customException = new CustomException(&quot;系统错误，请与系统管理 员联系！&quot;);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		ModelAndView modelAndView = new ModelAndView();</div><div class="line">		modelAndView.addObject(&quot;message&quot;, customException.getMessage());</div><div class="line">		modelAndView.setViewName(&quot;error&quot;);</div><div class="line"></div><div class="line">		return modelAndView;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4、配置异常处理器"><a href="#4、配置异常处理器" class="headerlink" title="4、配置异常处理器"></a>4、配置异常处理器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 异常处理器 --&gt;</div><div class="line">	&lt;bean id=&quot;handlerExceptionResolver&quot; class=&quot;cn.itcast.ssm.controller.exceptionResolver.CustomExceptionResolver&quot;/&gt;</div></pre></td></tr></table></figure>
<h1 id="11、-图片上传处理"><a href="#11、-图片上传处理" class="headerlink" title="11、 图片上传处理"></a>11、 图片上传处理</h1><h2 id="1、Tomcat上配置图片虚拟目录"><a href="#1、Tomcat上配置图片虚拟目录" class="headerlink" title="1、Tomcat上配置图片虚拟目录"></a>1、Tomcat上配置图片虚拟目录</h2><p>  <img src="/img/springmvc-6.png" alt="Alt text"></p>
<h2 id="2、jar包-1"><a href="#2、jar包-1" class="headerlink" title="2、jar包"></a>2、jar包</h2><p>CommonsMultipartResolver解析器依赖commons-fileupload和commons-io</p>
<h2 id="3、配置解析器"><a href="#3、配置解析器" class="headerlink" title="3、配置解析器"></a>3、配置解析器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置文件上传--&gt;</div><div class="line">&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</div><div class="line">    &lt;!--设置上传文件的最大尺寸为5M--&gt;</div><div class="line">    &lt;property name=&quot;maxUploadSize&quot;&gt;</div><div class="line">        &lt;value&gt;5242880&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h2 id="4、图片上传实现"><a href="#4、图片上传实现" class="headerlink" title="4、图片上传实现"></a>4、图片上传实现</h2><ul>
<li><p>Controller</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/updateitem&quot;)</div><div class="line">public String update(MultipartFile pictureFile, Items items) throws Exception &#123;</div><div class="line"></div><div class="line">    //1获取图片完整名称</div><div class="line">    String fileStr = pictureFile.getOriginalFilename();</div><div class="line">    //2使用随机生成的字符串+原图片扩展名，放置图片重名</div><div class="line">    String newFileStr = UUID.randomUUID().toString() + fileStr.substring(fileStr.lastIndexOf(&quot;.&quot;));</div><div class="line">    //3将图片保存到硬盘</div><div class="line">    pictureFile.transferTo(new File(&quot;E:\\pic\\&quot; + newFileStr));</div><div class="line">    //4将图片名称保存到数据库</div><div class="line">    items.setPic(newFileStr);</div><div class="line"></div><div class="line">    itemsService.updateItem(items);</div><div class="line"></div><div class="line">    return &quot;redirect:itemEdit/&quot; + items.getId();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;form id=&quot;itemForm&quot;	action=&quot;$&#123;pageContext.request.contextPath &#125;/items/updateitem&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</div><div class="line">	     ...</div><div class="line">        &lt;tr&gt;</div><div class="line">            &lt;td&gt;商品图片&lt;/td&gt;</div><div class="line">            &lt;td&gt;</div><div class="line">                &lt;c:if test=&quot;$&#123;item.pic !=null&#125;&quot;&gt;</div><div class="line">                    &lt;img src=&quot;/pic/$&#123;item.pic&#125;&quot; width=100 height=100/&gt;</div><div class="line">                    &lt;br/&gt;</div><div class="line">                &lt;/c:if&gt;</div><div class="line">                &lt;input type=&quot;file&quot;  name=&quot;pictureFile&quot;/&gt;</div><div class="line">            &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">			 ...</div><div class="line">	&lt;/form&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="12、Json数据交互"><a href="#12、Json数据交互" class="headerlink" title="12、Json数据交互"></a>12、Json数据交互</h1><h2 id="1、-RequestBody"><a href="#1、-RequestBody" class="headerlink" title="1、@RequestBody"></a>1、<code>@RequestBody</code></h2><ul>
<li><code>@RequestBody</code>注解用于读取http请求的内容，通过springmvc提供的HttpMessageConvert接口架构读到的内容转换为json，xml等格式的数据并绑定到controller方法的参数上。</li>
</ul>
<h2 id="2、-ResponseBody"><a href="#2、-ResponseBody" class="headerlink" title="2、@ResponseBody"></a>2、<code>@ResponseBody</code></h2><ul>
<li>该注解用于将Controller的方法返回的对象，通过HttpMessageConverter接口转换为指定格式的数据如：json,xml等，通过Response响应给客户端</li>
</ul>
<h2 id="3、请求json，相应json的实现"><a href="#3、请求json，相应json的实现" class="headerlink" title="3、请求json，相应json的实现"></a>3、请求json，相应json的实现</h2><ol>
<li><p>环境准备：springmvc默认用MappingJacksonHttpMesseageConvert对json数据进行转换，需要加入Jackson的包：</p>
<ul>
<li><p>jackson-core-asl-1.9.11.jar</p>
</li>
<li><p>jackson-mapper-asl-1.9.11.jar</p>
</li>
</ul>
</li>
<li><p>配置json转换器:在注解适配器中加入messageConvert</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;!--注解适配器 --&gt;</div><div class="line">	&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;</div><div class="line">		&lt;property name=&quot;messageConverters&quot;&gt;</div><div class="line">		&lt;list&gt;</div><div class="line">		&lt;bean class=&quot;org.springframework.http.converter.json.MappingJacksonHttpMessageConverter&quot;&gt;&lt;/bean&gt;</div><div class="line">		&lt;/list&gt;</div><div class="line">		&lt;/property&gt;</div><div class="line">	&lt;/bean&gt;</div></pre></td></tr></table></figure>
<p> 如果使用了<mvc:annotation-driven> 则不用定义上边的内容。</mvc:annotation-driven></p>
</li>
<li><p>Controller编写</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//导入jsckson的jar包在controller的方法中可以使用@RequestBody，让springmvc将</div><div class="line">// json格式字符串自动转换成java中的pojo对象，要求json的key的值等于pojo中的属性</div><div class="line">@RequestMapping(&quot;/sendJson&quot;)</div><div class="line">//controller方法返回pojo类型的对象，添加@ResponseBody注解，</div><div class="line">// springmvc会自动将对象转换成json格式字符串并传递给页面</div><div class="line">@ResponseBody</div><div class="line">public Items json(@RequestBody Items items) throws Exception &#123;</div><div class="line">    System.out.println(items);</div><div class="line"></div><div class="line">    return items;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>页面js方法的编写</p>
<ul>
<li><p>引入js：    <script type="text/javascript" src="${pageContext.request.contextPath }/js/jquery-1.4.4.min.js"></script></p>
</li>
<li><p>ajax请求：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    function sendJson()&#123;</div><div class="line">        //请求json响应json</div><div class="line">        $.ajax(&#123;</div><div class="line">            type:&quot;post&quot;,</div><div class="line">            url:&quot;$&#123;pageContext.request.contextPath &#125;/items/sendJson.action&quot;,</div><div class="line">            contentType:&quot;application/json;charset=utf-8&quot;,</div><div class="line">            data:&apos;&#123;&quot;name&quot;:&quot;测试商品&quot;,&quot;price&quot;:99.9&#125;&apos;,</div><div class="line">            success:function(data)&#123;</div><div class="line">                alert(data);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h1 id="13、Springmvc实现Restful"><a href="#13、Springmvc实现Restful" class="headerlink" title="13、Springmvc实现Restful"></a>13、Springmvc实现Restful</h1><h2 id="1、RESTful定义"><a href="#1、RESTful定义" class="headerlink" title="1、RESTful定义"></a>1、RESTful定义</h2><ul>
<li><p>Restful就是一个资源定位及资源操作的风格。不是标准也不是协议，只是一种风格，是对http协议的诠释。</p>
</li>
<li><p>资源定位：互联网所有的事物都是资源，要求url中没有动词，只有名词。没有参数:Url格式：<a href="http://blog.csdn.net/beat_the_world/article/details/45621673" target="_blank" rel="external">http://blog.csdn.net/beat_the_world/article/details/45621673</a></p>
</li>
<li><p>资源操作：使用put、delete、post、get，使用不同方法对资源进行操作。分别对应添加、删除、修改、查询。一般使用时还是post和get。Put和Delete几乎不使用。</p>
</li>
</ul>
<h2 id="2、需求-1"><a href="#2、需求-1" class="headerlink" title="2、需求"></a>2、需求</h2><p>RESTful方式实现商品信息查询，返回json数据。</p>
<h2 id="3、添加DispatcherServlet的rest配置"><a href="#3、添加DispatcherServlet的rest配置" class="headerlink" title="3、添加DispatcherServlet的rest配置"></a>3、添加DispatcherServlet的rest配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;!--SpringMVC的前端控制器--&gt;</div><div class="line">&lt;servlet&gt;</div><div class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;classpath:SpringMvc.xml&lt;/param-value&gt;</div><div class="line">    &lt;/init-param&gt;</div><div class="line">    &lt;!--在Tomcat启动的时候就加载这个Servlet--&gt;</div><div class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</div><div class="line">&lt;/servlet&gt;</div><div class="line">&lt;servlet-mapping&gt;</div><div class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</div><div class="line">    &lt;!--</div><div class="line">    &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</div><div class="line">    *.action    拦截后缀名为.action结尾的</div><div class="line">    /           拦截所有到那时不包括.jsp</div><div class="line">    /*          拦截所有，包括.jsp</div><div class="line">    --&gt;</div><div class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</div><div class="line">&lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure>
<h2 id="4、URL模板模式映射"><a href="#4、URL模板模式映射" class="headerlink" title="4、URL模板模式映射"></a>4、URL模板模式映射</h2><ul>
<li><p><code>@RequestMapping(value=&quot;/ viewItems/{id}&quot;)</code>：{×××}占位符，请求的URL可以是“/viewItems/1”或“/viewItems/2”，通过在方法中使用<code>@PathVariable</code>获取{×××}中的×××变量。</p>
</li>
<li><p><code>@PathVariable</code>用于将请求URL中的模板变量映射到功能处理方法的参数上。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(&quot;/itemEdit/&#123;id&#125;&quot;)</div><div class="line">public String itemEdit(@PathVariable(&quot;id&quot;) Integer id,  HttpServletRequest reuqest, Model model) throws Exception&#123;</div><div class="line">//        String idStr = reuqest.getParameter(&quot;id&quot;);</div><div class="line">    Items items = itemsService.findItemsById(id);</div><div class="line">//        if (items == null) &#123;</div><div class="line">//            throw new CustomException(&quot;商品信息不存在！&quot;);</div><div class="line">//        &#125;</div><div class="line"></div><div class="line">    model.addAttribute(&quot;item&quot;, items);</div><div class="line">    //如果springmvc方法返回一个简单的字符串，nameSpringmvc就会认为这个字符串是页面的名称</div><div class="line">    return &quot;editItem&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果RequestMapping中表示为”/itemEdit/{id}”，id和形参名称一致，使用<code>@PathVariable</code>不用指定名称。</li>
</ul>
</li>
</ul>
<h2 id="5、静态资源访问"><a href="#5、静态资源访问" class="headerlink" title="5、静态资源访问"></a>5、静态资源访问<mvc:resources></mvc:resources></h2><ul>
<li><p>如果在DispatcherServlet中设置url-pattern为 /则必须对静态资源进行访问处理。spring mvc 的<mvc:resources mapping="" location="">实现对静态资源进行映射访问。</mvc:resources></p>
</li>
<li><p>如下是对js文件访问配置：<code>&lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt;</code></p>
</li>
</ul>
<h1 id="14、拦截器"><a href="#14、拦截器" class="headerlink" title="14、拦截器"></a>14、拦截器</h1><h2 id="1、定义"><a href="#1、定义" class="headerlink" title="1、定义"></a>1、定义</h2><ul>
<li>Spring Web MVC 的处理器拦截器类似于Servlet 开发中的过滤器Filter，用于对处理器进行预处理和后处理。</li>
</ul>
<h2 id="2、拦截器定义"><a href="#2、拦截器定义" class="headerlink" title="2、拦截器定义"></a>2、拦截器定义</h2><ul>
<li><p>实现HandlerInterceptor接口，如下：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">public class Inteceptor1 implements HandlerInterceptor&#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时间：controller方法没有被执行， modelAndView没有被返回</div><div class="line">     * 使用场景：权限验证</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @return true:放行， false：拦截</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========pre===========&quot;);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时机：controller方法已经执行，modelAndView没有返回</div><div class="line">     * 使用场景：可以在此方法中设置全局的数据处理业务，</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @param modelAndView</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========post===========&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 执行时机：controller方法已经执行，modelAndView已经返回</div><div class="line">     * 使用场景：记录操作日志，记录登录用户的IP，时间等</div><div class="line">     * @param httpServletRequest</div><div class="line">     * @param httpServletResponse</div><div class="line">     * @param o</div><div class="line">     * @param e</div><div class="line">     * @throws Exception</div><div class="line">     */</div><div class="line">    @Override</div><div class="line">    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123;</div><div class="line">        System.out.println(&quot;==========Inteceptor1===========after===========&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3、拦截器配置"><a href="#3、拦截器配置" class="headerlink" title="3、拦截器配置"></a>3、拦截器配置</h2><h3 id="1、针对某种mapping配置拦截器"><a href="#1、针对某种mapping配置拦截器" class="headerlink" title="1、针对某种mapping配置拦截器"></a>1、针对某种mapping配置拦截器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;bean</div><div class="line">	class=&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;&gt;</div><div class="line">	&lt;property name=&quot;interceptors&quot;&gt;</div><div class="line">		&lt;list&gt;</div><div class="line">			&lt;ref bean=&quot;handlerInterceptor1&quot;/&gt;</div><div class="line">			&lt;ref bean=&quot;handlerInterceptor2&quot;/&gt;</div><div class="line">		&lt;/list&gt;</div><div class="line">	&lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">	&lt;bean id=&quot;handlerInterceptor1&quot; class=&quot;springmvc.intercapter.HandlerInterceptor1&quot;/&gt;</div><div class="line">	&lt;bean id=&quot;handlerInterceptor2&quot; class=&quot;springmvc.intercapter.HandlerInterceptor2&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="2、针对所有mapper配置全局拦截器"><a href="#2、针对所有mapper配置全局拦截器" class="headerlink" title="2、针对所有mapper配置全局拦截器"></a>2、针对所有mapper配置全局拦截器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;!--配置拦截器--&gt;</div><div class="line">&lt;mvc:interceptors&gt;</div><div class="line">    &lt;!--多个拦截器的执行顺序，等于其配置顺序--&gt;</div><div class="line">    &lt;mvc:interceptor&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;配置拦截请求的路径 /**代表所有&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;mvc:mapping path=&quot;/**&quot;/&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;指定拦截器的位置&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;bean class=&quot;cn.itheima.interceptor.Inteceptor1&quot;/&gt;</div><div class="line">    &lt;/mvc:interceptor&gt;</div><div class="line"></div><div class="line">    &lt;mvc:interceptor&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;配置拦截请求的路径 /**代表所有&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;mvc:mapping path=&quot;/**&quot;/&gt;</div><div class="line">        &lt;!--&amp;lt;!&amp;ndash;指定拦截器的位置&amp;ndash;&amp;gt;--&gt;</div><div class="line">        &lt;bean class=&quot;cn.itheima.interceptor.Inteceptor2&quot;/&gt;</div><div class="line">    &lt;/mvc:interceptor&gt;</div><div class="line">&lt;/mvc:interceptors&gt;</div></pre></td></tr></table></figure>
<h2 id="4、测试流程"><a href="#4、测试流程" class="headerlink" title="4、测试流程"></a>4、测试流程</h2><ul>
<li><p>定义两个拦截器分别为HandlerInterceptor1和HandlerInterceptor2，每个拦截器的preHandler方法都返回true：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception &#123;</div><div class="line">    System.out.println(&quot;==========Inteceptor1===========pre===========&quot;);</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre></li>
<li><p>运行流程：</p>
<ul>
<li>HandlerInterceptor1..preHandle..</li>
<li>HandlerInterceptor2..preHandle..</li>
<li>HandlerInterceptor2..postHandle..</li>
<li>HandlerInterceptor1..postHandle..</li>
<li>HandlerInterceptor2..afterCompletion..</li>
<li>HandlerInterceptor1..afterCompletion..</li>
</ul>
</li>
</ul>
<h2 id="5、终端流程测试"><a href="#5、终端流程测试" class="headerlink" title="5、终端流程测试"></a>5、终端流程测试</h2><ul>
<li><p>定义两个拦截器分别为HandlerInterceptor1和HandlerInterceptor2</p>
</li>
<li><p>运行流程：</p>
<ul>
<li><p>preHandler按拦截器定义顺序调用</p>
</li>
<li><p>postHandler按拦截器定义逆序调用</p>
</li>
<li><p>afterCompletion按拦截器定义逆序调用</p>
</li>
<li><p>postHandler在拦截器链内所有拦截器返回成功调用</p>
</li>
<li><p>afterCompletion只有preHandler返回true才调用</p>
</li>
</ul>
</li>
</ul>
<h2 id="6、拦截器应用"><a href="#6、拦截器应用" class="headerlink" title="6、拦截器应用"></a>6、拦截器应用</h2><h3 id="1、处理流程"><a href="#1、处理流程" class="headerlink" title="1、处理流程"></a>1、处理流程</h3><ol>
<li><p>有一个登录页面，需要写一个controler访问页面</p>
</li>
<li><p>登录页面有一项提交表单的动作，需要在controller中处理。</p>
<ul>
<li><p>判断用户名是否正确</p>
</li>
<li><p>如果正确，向session中写入用户信息</p>
</li>
<li><p>返回登录成功，或者跳转到登录页面</p>
</li>
</ul>
</li>
<li><p>拦截器</p>
<ul>
<li><p>拦截用户请求，判断用户是否登录</p>
</li>
<li><p>如果已经登录，放行</p>
</li>
<li><p>如果用户未登录，跳转到登录页面</p>
</li>
</ul>
</li>
</ol>
<h3 id="2、用户身份认证"><a href="#2、用户身份认证" class="headerlink" title="2、用户身份认证"></a>2、用户身份认证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">package cn.itheima.interceptor;</div><div class="line"></div><div class="line">import org.springframework.web.servlet.HandlerInterceptor;</div><div class="line">import org.springframework.web.servlet.ModelAndView;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import javax.servlet.http.HttpSession;</div><div class="line"></div><div class="line">public class LoginInterceptor implements HandlerInterceptor&#123;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object arg2) throws Exception &#123;</div><div class="line">        //判断当前访问路径是否为登录的路径,如果是则放行</div><div class="line">        if(request.getRequestURI().indexOf(&quot;/login&quot;) &gt;= 0)&#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //判断session中是否有登录信息,如果没有则跳转到登录页面,如果有则放行</div><div class="line">        HttpSession session = request.getSession();</div><div class="line">        if(session.getAttribute(&quot;username&quot;) != null)&#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        request.getRequestDispatcher(&quot;/WEB-INF/jsp/login.jsp&quot;).forward(request, response);</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3、用户登录controller"><a href="#3、用户登录controller" class="headerlink" title="3、用户登录controller"></a>3、用户登录controller</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">@RequestMapping(&quot;/login&quot;)</div><div class="line">public class LoginController &#123;</div><div class="line"></div><div class="line">    //跳转到登录页面</div><div class="line">    @RequestMapping(&quot;/login&quot;)</div><div class="line">    public String login() throws Exception&#123;</div><div class="line">        return &quot;login&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/submit&quot;)</div><div class="line">    public String submit(String username, String pwd ,HttpServletRequest request) throws Exception&#123;</div><div class="line"></div><div class="line">        HttpSession session = request.getSession();</div><div class="line">        //判断用户名密码的正确性,如果正确则将登录信息放入session中</div><div class="line">        //这里简写,真正项目中需要去数据库中校验用户名和密码</div><div class="line">        if(username != null)&#123;</div><div class="line">            session.setAttribute(&quot;username&quot;, username);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        //跳转到列表页</div><div class="line">        return &quot;redirect:/items/list&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="15、重点总结"><a href="#15、重点总结" class="headerlink" title="15、重点总结"></a>15、重点总结</h1><ol>
<li><p>springMvc:是一个表现层框架</p>
<ul>
<li>作用:就是从请求中接收传入的参数,将处理后的结果数据返回给页面展示</li>
</ul>
</li>
<li><p>ssm整合:</p>
<ol>
<li><p>Dao层</p>
<ul>
<li><p>pojo和映射文件以及接口使用逆向工程生成</p>
</li>
<li><p>SqlMapConfig.xml   mybatis核心配置文件</p>
</li>
<li><p>ApplicationContext-dao.xml 整合后spring在dao层的配置</p>
</li>
<li><p>数据源</p>
</li>
<li><p>会话工厂</p>
</li>
<li><p>扫描Mapper</p>
</li>
</ul>
</li>
<li><p>service层</p>
<ul>
<li><p>事务            ApplicationContext-trans.xml</p>
</li>
<li><p><code>@Service</code>注解扫描    ApplicationContext-service.xml</p>
</li>
</ul>
</li>
<li><p>controller层</p>
<ul>
<li><p>SpringMvc.xml</p>
<ul>
<li><p>注解扫描:扫描@Controller注解</p>
</li>
<li><p>注解驱动:替我们显示的配置了最新版的处理器映射器和处理器适配器</p>
</li>
<li><p>视图解析器:显示的配置是为了在controller中不用每个方法都写页面的全路径</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>web.xml</p>
<ul>
<li><p>springMvc前端控制器配置</p>
</li>
<li><p>spring监听</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>参数绑定:(从请求中接收参数)</p>
<ol>
<li><p>默认支持的类型:Request,Response,Session,Model</p>
</li>
<li><p>基本数据类型(包含String)</p>
</li>
<li><p>Pojo类型</p>
</li>
<li><p>Vo类型</p>
</li>
<li><p>Converter自定义转换器</p>
</li>
<li><p>数组</p>
</li>
<li><p>List</p>
</li>
</ol>
</li>
<li><p>controller方法返回值(指定返回到哪个页面, 指定返回到页面的数据)</p>
<ol>
<li><p>ModelAndView</p>
<ul>
<li><p>modelAndView.addObject(“itemList”, list); 指定返回页面的数据</p>
</li>
<li><p>modelAndView.setViewName(“itemList”);      指定返回的页面</p>
</li>
</ul>
</li>
<li><p>String(推荐使用)</p>
<ul>
<li><p>返回普通字符串,就是页面去掉扩展名的名称, 返回给页面数据通过Model来完成</p>
</li>
<li><p>返回的字符串以forward:开头为请求转发</p>
</li>
<li><p>返回的字符串以redirect:开头为重定向</p>
</li>
</ul>
</li>
<li><p>返回void(使用它破坏了springMvc的结构,所以不建议使用)</p>
<ul>
<li><p>可以使用request.setAttribut 来给页面返回数据</p>
</li>
<li><p>可以使用request.getRquestDispatcher().forward()来指定返回的页面</p>
</li>
<li><p>如果controller返回值为void则不走springMvc的组件,所以要写页面的完整路径名称</p>
</li>
</ul>
<ul>
<li><p>相对路径:相对于当前目录,也就是在当前类的目录下,这时候可以使用相对路径跳转</p>
</li>
<li><p>绝对路径:从项目名后开始.</p>
</li>
<li><p>在springMvc中不管是forward还是redirect后面凡是以/开头的为绝对路径,不以/开头的为相对路径例如:forward:/items/itemEdit.action 为绝对路径,forward:itemEdit.action为相对路径</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>架构级别异常处理:</p>
<ul>
<li>主要为了防止项目上线后给用户抛500等异常信息,所以需要在架构级别上整体处理.hold住异常首先自定义全局异常处理器实现HandlerExceptionResolver接口,在spirngMvc.xml中配置生效</li>
</ul>
</li>
<li><p>上传图片:</p>
<ol>
<li><p>在tomcat中配置虚拟图片服务器</p>
</li>
<li><p>导入fileupload的jar包</p>
</li>
<li><p>在springMvc.xml中配置上传组件</p>
</li>
<li><p>在页面上编写上传域,更改form标签的类型</p>
</li>
<li><p>在controller方法中可以使用MultiPartFile接口接收上传的图片</p>
</li>
<li><p>将文件名保存到数据库,将图片保存到磁盘中</p>
</li>
</ol>
</li>
<li><p>Json数据交互:</p>
<ul>
<li><p>需要加入jackson的jar包</p>
</li>
<li><p><code>@Requestbody</code>:将页面传到controller中的json格式字符串自动转换成java的pojo对象</p>
</li>
<li><p><code>@ResponseBody</code>:将java中pojo对象自动转换成json格式字符串返回给页面</p>
</li>
</ul>
</li>
<li><p>RestFul支持:</p>
<ul>
<li><p>就是对url的命名标准,要求url中只有能名词,没有动词(不严格要求),但是要求url中不能用问号?传参<br>传参数:</p>
<ul>
<li><p>页面:${pageContext.request.contextPath }/items/itemEdit/${item.id}</p>
</li>
<li><p>方法: @RquestMapping(“/itemEdit/{id}”)</p>
</li>
<li><p>方法: @PathVariable(“id”) Integer idd</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>拦截器:</p>
<ul>
<li><p>作用:拦截请求,一般做登录权限验证时用的比较多</p>
<ol>
<li><p>需要编写自定义拦截器类,实现HandlerInterceptor接口</p>
</li>
<li><p>在spirngMvc.xml中配置拦截器生效</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>登录权限验证:</p>
<ol>
<li><p>编写登录的controller, 编写跳转到登录页面的方法,  编写登录验证方法</p>
</li>
<li><p>编写登录页面</p>
</li>
<li><p>编写拦截器</p>
</li>
</ol>
<ul>
<li>运行过程:</li>
</ul>
<ol>
<li><p>访问随意一个页面,拦截器会拦截请求,会验证session中是否有登录信息,如果已登录,放行,        如果未登录,跳转到登录页面</p>
</li>
<li><p>在登录页面中输入用户名,密码,点击登录按钮,拦截器会拦截请求,如果是登录路径放行,在controller方法中判断用户名密码是否正确,如果正确则将登录信息放入session</p>
</li>
</ol>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.gif"
              alt="cdx" />
          
            <p class="site-author-name" itemprop="name">cdx</p>
            <p class="site-description motion-element" itemprop="description">Be a better man!</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cdx0312" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:cdxu0312@outlook.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cdx</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
