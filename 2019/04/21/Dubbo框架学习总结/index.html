<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,Dubbo,RPC," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Dubbo的定义官方定义：Apache Dubbo是一个由阿里提供开源的基于Java的高性能的RPC框架。遵循RPC框架的设计原则，Dubbo也定义了服务的概念，可以远程根据参数和返回值来调用具体的方法。在服务侧，服务侧实现这个接口并运行一个Dubbo服务来处理客户端的请求，在客户端保存有服务端相同的方法存根。
Dubbo有三个主要特性：

基于接口的远程的调用
容错和负载均衡
服务的子自动注册和">
<meta property="og:type" content="article">
<meta property="og:title" content="Dubbo框架学习总结">
<meta property="og:url" content="http://yoursite.com/2019/04/21/Dubbo框架学习总结/index.html">
<meta property="og:site_name" content="小黄">
<meta property="og:description" content="Dubbo的定义官方定义：Apache Dubbo是一个由阿里提供开源的基于Java的高性能的RPC框架。遵循RPC框架的设计原则，Dubbo也定义了服务的概念，可以远程根据参数和返回值来调用具体的方法。在服务侧，服务侧实现这个接口并运行一个Dubbo服务来处理客户端的请求，在客户端保存有服务端相同的方法存根。
Dubbo有三个主要特性：

基于接口的远程的调用
容错和负载均衡
服务的子自动注册和">
<meta property="og:image" content="http://yoursite.com/img/Dubbo-Arch.png">
<meta property="og:image" content="http://yoursite.com/img/Dubbo-Futurearch.png">
<meta property="og:image" content="http://yoursite.com/img/Dubbo-3.png">
<meta property="og:image" content="http://yoursite.com/img/Dubbo-4.png">
<meta property="og:image" content="http://yoursite.com/img/Dubbo-5.png">
<meta property="og:updated_time" content="2018-09-01T04:45:24.685Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dubbo框架学习总结">
<meta name="twitter:description" content="Dubbo的定义官方定义：Apache Dubbo是一个由阿里提供开源的基于Java的高性能的RPC框架。遵循RPC框架的设计原则，Dubbo也定义了服务的概念，可以远程根据参数和返回值来调用具体的方法。在服务侧，服务侧实现这个接口并运行一个Dubbo服务来处理客户端的请求，在客户端保存有服务端相同的方法存根。
Dubbo有三个主要特性：

基于接口的远程的调用
容错和负载均衡
服务的子自动注册和">
<meta name="twitter:image" content="http://yoursite.com/img/Dubbo-Arch.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/21/Dubbo框架学习总结/"/>





  <title>Dubbo框架学习总结 | 小黄</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黄</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">黄小黄的幸福生活！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/Java/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Java
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/Dubbo框架学习总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Dubbo框架学习总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:14+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Dubbo/" itemprop="url" rel="index">
                    <span itemprop="name">Dubbo</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/Dubbo/RPC/" itemprop="url" rel="index">
                    <span itemprop="name">RPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Dubbo的定义"><a href="#Dubbo的定义" class="headerlink" title="Dubbo的定义"></a>Dubbo的定义</h1><p>官方定义：Apache Dubbo是一个由阿里提供开源的基于Java的高性能的RPC框架。遵循RPC框架的设计原则，Dubbo也定义了服务的概念，可以远程根据参数和返回值来调用具体的方法。在服务侧，服务侧实现这个接口并运行一个Dubbo服务来处理客户端的请求，在客户端保存有服务端相同的方法存根。</p>
<p>Dubbo有三个主要特性：</p>
<ul>
<li>基于接口的远程的调用</li>
<li>容错和负载均衡</li>
<li>服务的子自动注册和发现。</li>
</ul>
<p>Dubbo相关的文档：<br><a href="http://dubbo.apache.org/books/dubbo-user-book/preface/background.html" target="_blank" rel="external">Dubbo用户手册</a><br><a href="http://dubbo.apache.org/books/dubbo-dev-book/build.html" target="_blank" rel="external">Dubbo开发手册</a><br><a href="http://dubbo.apache.org/books/dubbo-admin-book/install/zookeeper.html" target="_blank" rel="external">Dubbo管理手册</a><br><a href="https://github.com/apache/incubator-dubbo" target="_blank" rel="external">Dubbo GitHub </a></p>
<h1 id="Dubbo结构"><a href="#Dubbo结构" class="headerlink" title="Dubbo结构"></a>Dubbo结构</h1><p><img src="/img/Dubbo-Arch.png" alt="Alt text"></p>
<ol>
<li>服务提供者-对外暴露自己的服务，服务提供者会将自己提供的服务注册到注册中心</li>
<li>容器-初始化服务，加载服务，运行服务</li>
<li>服务消费者-调用远程服务，会向注册中心订阅他需要的服务。</li>
<li>注册中心-服务注册与发现</li>
<li>监控中心-记录服务相关的数据，比如服务的调用频率，调用次数等</li>
</ol>
<p><em>服务提供者，服务消费者和注册中心的连接是持久的，所以当一个服务提供者挂掉之后，注册中心可以检测到服务提供者的失效并将此信息通知给服务消费者</em></p>
<p><em>注册中心和监控中心是可选的，服务消费者可以直接连接到服务提供者，但是这样会影响整个系统的稳定性，不推荐直接连接</em></p>
<h2 id="调用关系说明"><a href="#调用关系说明" class="headerlink" title="调用关系说明"></a>调用关系说明</h2><ol>
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己需要的服务。</li>
<li>注册中心返回服务提供者列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者经调用，如果调用失败，再选一台调用。</li>
<li>服务消费者和提供者，在内存中累积调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<h2 id="Dubbo架构的特点"><a href="#Dubbo架构的特点" class="headerlink" title="Dubbo架构的特点"></a>Dubbo架构的特点</h2><h3 id="连通性"><a href="#连通性" class="headerlink" title="连通性"></a>连通性</h3><ul>
<li>注册中心负责服务地址的注册于查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发消息，压力较小。</li>
<li>监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示。</li>
<li>服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销。</li>
<li>服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销。</li>
<li>注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心不是。</li>
<li>注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者。</li>
<li>注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地魂村了提供者列表。</li>
<li>注册中心和监控中心都是可选的，服务消费者可以直连服务提供者。</li>
</ul>
<h3 id="健壮性"><a href="#健壮性" class="headerlink" title="健壮性"></a>健壮性</h3><ul>
<li>监控中心宕机不影响使用，只是丢失部分统计数据。</li>
<li>数据库宕机，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li>
<li>注册中心对等集群，任意一台宕机之后，将自动切换到另一台</li>
<li>注册中心全部宕机后，服务提供者和服务消费者仍能通过本地换粗通讯</li>
<li>服务提供者无状态，任意一台宕机后，不影响使用。</li>
<li>服务提供者全部宕机之后，服务消费者应用将无法使用，并无限次重连等待服务提供者回复。</li>
</ul>
<h3 id="伸缩性"><a href="#伸缩性" class="headerlink" title="伸缩性"></a>伸缩性</h3><ul>
<li>注册中心为了对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心</li>
<li>服务提供者无状态，可动态增加及其部署实例，注册中心将推送新的服务提供者信息给消费者。</li>
</ul>
<h3 id="升级性"><a href="#升级性" class="headerlink" title="升级性"></a>升级性</h3><ul>
<li>当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有的分布式架构不会带来阻力，下图为一种可能结果：</li>
</ul>
<p><img src="/img/Dubbo-Futurearch.png" alt="Alt text"></p>
<h1 id="Dubbo依赖要求"><a href="#Dubbo依赖要求" class="headerlink" title="Dubbo依赖要求"></a>Dubbo依赖要求</h1><ul>
<li><p>工具版本要求：</p>
<ul>
<li>JDK：6及以上</li>
<li>Maven：3及以上</li>
</ul>
</li>
<li><p>Maven依赖配置：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<ul>
<li>Dubbo缺省依赖以下库：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[INFO] +- com.alibaba:dubbo:jar:2.5.9-SNAPSHOT:compile</div><div class="line">[INFO] |  +- org.springframework:spring-context:jar:4.3.10.RELEASE:compile</div><div class="line">[INFO] |  +- org.javassist:javassist:jar:3.21.0-GA:compile</div><div class="line">[INFO] |  \- org.jboss.netty:netty:jar:3.2.5.Final:compile</div></pre></td></tr></table></figure>
<ul>
<li>可选依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">netty-all 4.0.35.Final</div><div class="line">mina: 1.1.7</div><div class="line">grizzly: 2.1.4</div><div class="line">httpclient: 4.5.3</div><div class="line">hessian_lite: 3.2.1-fixed</div><div class="line">fastjson: 1.2.31</div><div class="line">zookeeper: 3.4.9</div><div class="line">jedis: 2.9.0</div><div class="line">xmemcached: 1.3.6</div><div class="line">hessian: 4.0.38</div><div class="line">jetty: 6.1.26</div><div class="line">hibernate-validator: 5.4.1.Final</div><div class="line">zkclient: 0.2</div><div class="line">curator: 2.12.0</div><div class="line">cxf: 3.0.14</div><div class="line">thrift: 0.8.0</div><div class="line">servlet: 3.0 6</div><div class="line">validation-api: 1.1.0.GA 6</div><div class="line">jcache: 1.0.0 6</div><div class="line">javax.el: 3.0.1-b08 6</div><div class="line">kryo: 4.0.1</div><div class="line">kryo-serializers: 0.42</div><div class="line">fst: 2.48-jdk-6</div><div class="line">resteasy: 3.0.19.Final</div><div class="line">tomcat-embed-core: 8.0.11</div><div class="line">slf4j: 1.7.25</div><div class="line">log4j: 1.2.16</div></pre></td></tr></table></figure>
<h2 id="Spring中Dubbo应用示例"><a href="#Spring中Dubbo应用示例" class="headerlink" title="Spring中Dubbo应用示例"></a>Spring中Dubbo应用示例</h2><ul>
<li>定义服务接口：由于服务的提供者和消费者都依赖于同一个接口，因此强烈建议将接口定义在一个单独的模块里面，从而方便服务提供者模块和消费者模块来依赖。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">package com.alibaba.dubbo.demo;</div><div class="line"></div><div class="line">public interface DemoService &#123;</div><div class="line">    String sayHello(String name);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>实现服务的提供者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">package com.alibaba.dubbo.demo.provider;</div><div class="line">import com.alibaba.dubbo.demo.DemoService;</div><div class="line"></div><div class="line">public class DemoServiceImpl implements DemoService &#123;</div><div class="line">    public String sayHello(String name) &#123;</div><div class="line">        return &quot;Hello &quot; + name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置服务的提供者–在spring中如何配置Dubbo服务。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 提供方应用信息，用于计算依赖关系 --&gt;</div><div class="line">    &lt;dubbo:application name=&quot;hello-world-app&quot;  /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 使用multicast广播注册中心暴露服务地址 --&gt;</div><div class="line">    &lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;</div><div class="line">    &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 声明需要暴露的服务接口 --&gt;</div><div class="line">    &lt;dubbo:service interface=&quot;com.alibaba.dubbo.demo.DemoService&quot; ref=&quot;demoService&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 和本地bean一样实现服务 --&gt;</div><div class="line">    &lt;bean id=&quot;demoService&quot; class=&quot;com.alibaba.dubbo.demo.provider.DemoServiceImpl&quot; /&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<p>从配置文件中可以看到我们只将demoService的接口暴露给一个URL，dubbo://127.0.0.1:20880,并将该服务注册给一个多媒体地址：multicast://224.5.6.7:1234</p>
<p>dubbo协议是Dubbo框架支持的众多协议之一，dubbo协议是在Java NIO特性的基础之上的，为Dubbo架构的默认协议。</p>
<ul>
<li>开启服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line"></div><div class="line">public class Provider &#123;</div><div class="line">    public static void main(String[] args) throws Exception &#123;</div><div class="line">        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(</div><div class="line">                new String[] &#123;&quot;META-INF/spring/dubbo-demo-provider.xml&quot;&#125;);</div><div class="line">        context.start();</div><div class="line">        // press any key to exit</div><div class="line">        System.in.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置服务消费者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!-- 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 --&gt;</div><div class="line">    &lt;dubbo:application name=&quot;consumer-of-helloworld-app&quot;  /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 使用multicast广播注册中心暴露发现服务地址 --&gt;</div><div class="line">    &lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;!-- 生成远程服务代理，可以和本地bean一样使用demoService --&gt;</div><div class="line">    &lt;dubbo:reference id=&quot;demoService&quot; interface=&quot;com.alibaba.dubbo.demo.DemoService&quot; /&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<p>这个过程看起来和传统的web服务调用很想，但是dubbo协议使得其调用更加简单，轻量化，效率相对要高。</p>
<ul>
<li>运行服务消费者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line">import com.alibaba.dubbo.demo.DemoService;</div><div class="line"></div><div class="line">public class Consumer &#123;</div><div class="line">    public static void main(String[] args) throws Exception &#123;</div><div class="line">        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[] &#123;&quot;http://10.20.160.198/wiki/display/dubbo/consumer.xml&quot;&#125;);</div><div class="line">        context.start();</div><div class="line">        DemoService demoService = (DemoService)context.getBean(&quot;demoService&quot;); // 获取远程服务代理</div><div class="line">        String hello = demoService.sayHello(&quot;world&quot;); // 执行远程方法</div><div class="line">        System.out.println( hello ); // 显示调用结果</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>配置简单注册中心</li>
</ul>
<p>当我们使用多点传播注册中心时，注册服务不是单独的，因此适用于局域网场景。为了适应更加便于管理的注册中心，可以使用SimpleRegistryService。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:application name=&quot;simple-registry&quot; /&gt;</div><div class="line">&lt;dubbo:protocol port=&quot;9090&quot; /&gt;</div><div class="line">&lt;dubbo:service interface=&quot;com.alibaba.dubbo.registry.RegistryService&quot;</div><div class="line">  ref=&quot;registryService&quot; registry=&quot;N/A&quot; ondisconnect=&quot;disconnect&quot;&gt;</div><div class="line">    &lt;dubbo:method name=&quot;subscribe&quot;&gt;</div><div class="line">        &lt;dubbo:argument index=&quot;1&quot; callback=&quot;true&quot; /&gt;</div><div class="line">    &lt;/dubbo:method&gt;</div><div class="line">    &lt;dubbo:method name=&quot;unsubscribe&quot;&gt;</div><div class="line">        &lt;dubbo:argument index=&quot;1&quot; callback=&quot;true&quot; /&gt;</div><div class="line">    &lt;/dubbo:method&gt;</div><div class="line">&lt;/dubbo:service&gt;</div><div class="line"></div><div class="line">&lt;bean class=&quot;com.alibaba.dubbo.registry.simple.SimpleRegistryService&quot;</div><div class="line">  id=&quot;registryService&quot; /&gt;</div></pre></td></tr></table></figure>
<p>可以用于测试，但是实际工程中不推荐使用。</p>
<h1 id="Dubbo配置"><a href="#Dubbo配置" class="headerlink" title="Dubbo配置"></a>Dubbo配置</h1><h2 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h2><p>xml配置Dubbo可以参照上一节的实例，spring中可以直接通过dubbo标签库来对其进行配置设定等操作，使用广泛且条理清晰。所有的标签都支持自定义参数，用于不同扩展点实现的特殊配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:protocol name=&quot;jms&quot;&gt;</div><div class="line">    &lt;dubbo:parameter key=&quot;queue&quot; value=&quot;your_queue&quot; /&gt;</div><div class="line">&lt;/dubbo:protocol&gt;</div></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//2.1之后开始支持这种自定义参数的方式</div><div class="line">&lt;dubbo:protocol name=&quot;jms&quot; p:queue=&quot;your_queue&quot; /&gt;</div></pre></td></tr></table></figure>
<ul>
<li>常用标签</li>
</ul>
<table>
<thead>
<tr>
<th>标签</th>
<th style="text-align:center">用途</th>
<th style="text-align:right">解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;dubbo:service/&gt;</code></td>
<td style="text-align:center">服务配置</td>
<td style="text-align:right">用于暴露一个服务，定义服务的元信息，一个服务可以用多个协议暴露，一个服务也可以注册到多个注册中心</td>
</tr>
<tr>
<td><code>&lt;dubbo:reference/&gt;</code></td>
<td style="text-align:center">引用配置</td>
<td style="text-align:right">用于创建一个远程服务代理，一个引用可以指向多个注册中心</td>
</tr>
<tr>
<td><code>&lt;dubbo:protocol/&gt;</code></td>
<td style="text-align:center">协议配置</td>
<td style="text-align:right">用于配置提供服务的协议信息，协议由提供方指定，消费方被动接受</td>
</tr>
<tr>
<td><code>&lt;dubbo:application/&gt;</code></td>
<td style="text-align:center">应用配置</td>
<td style="text-align:right">用于配置当前应用信息，不管该应用是提供者还是消费者</td>
</tr>
<tr>
<td><code>&lt;dubbo:module/&gt;</code></td>
<td style="text-align:center">模块配置</td>
<td style="text-align:right">用于配置当前模块信息，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:registry/&gt;</code></td>
<td style="text-align:center">注册中心配置</td>
<td style="text-align:right">用于配置连接注册中心相关信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:monitor/&gt;</code></td>
<td style="text-align:center">监控中心配置</td>
<td style="text-align:right">用于配置连接监控中心相关信息，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:provider/&gt;</code></td>
<td style="text-align:center">提供方配置</td>
<td style="text-align:right">当ProtocolConfig 和 ServiceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:consumer/&gt;</code></td>
<td style="text-align:center">消费方配置</td>
<td style="text-align:right">当 ReferenceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:method/&gt;</code></td>
<td style="text-align:center">方法配置</td>
<td style="text-align:right">用于 ServiceConfig 和 ReferenceConfig 指定方法级的配置信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:argument/&gt;</code></td>
<td style="text-align:center">参数配置</td>
<td style="text-align:right">用于指定方法参数配置</td>
</tr>
</tbody>
</table>
<ul>
<li>标签之间的关系</li>
</ul>
<p><img src="/img/Dubbo-3.png" alt="Alt text"></p>
<p>  <em>配置覆盖关系为方法级别的优先，接口几倍的次之，全局配置再次之，级别一样消费者优先，提供者次之</em></p>
<h2 id="属性配置"><a href="#属性配置" class="headerlink" title="属性配置"></a>属性配置</h2><p>公共配置简单，没有多注册中心，多协议等情况，或者多个Spring容器想要共享配置，可以使用dubbo.properties作为缺省配置。Dubbo会自动加载classpath路径下的dubbo.properties文件，可以通过JVM启动参数<code>-Ddubbo.properties.file=xxx.properties</code>改动缺省位置。</p>
<ul>
<li>映射规则:将XML配置的标签名，属性名，用点分隔，多个属性拆分成多行。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dubbo.application.name=foo</div><div class="line">dubbo.application.owner=bar</div><div class="line">dubbo.registry.address=10.20.153.10:9090</div></pre></td></tr></table></figure>
<ul>
<li>覆盖策略：JVM启动，-D参数优先，XML次之，Properties文件最后。只有XML没有配置时，dubbo.properties才会生效。</li>
</ul>
<h2 id="Java-API配置Dubbo"><a href="#Java-API配置Dubbo" class="headerlink" title="Java API配置Dubbo"></a>Java API配置Dubbo</h2><p>除了spring配置文件来配置Dubbo之外，通过Java API，property文件以及注解来配置Dubbo同样可以。配置文件和注解配置适用于结构不是很复杂的场景。下面介绍如何使用API来配置Dubbo。</p>
<ul>
<li>服务提供者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">import com.alibaba.dubbo.rpc.config.ApplicationConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.RegistryConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.ProviderConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.ServiceConfig;</div><div class="line">import com.xxx.XxxService;</div><div class="line">import com.xxx.XxxServiceImpl;</div><div class="line"></div><div class="line">// 服务实现</div><div class="line">XxxService xxxService = new XxxServiceImpl();</div><div class="line"></div><div class="line">// 当前应用配置</div><div class="line">ApplicationConfig application = new ApplicationConfig();</div><div class="line">application.setName(&quot;xxx&quot;);</div><div class="line"></div><div class="line">// 连接注册中心配置</div><div class="line">RegistryConfig registry = new RegistryConfig();</div><div class="line">registry.setAddress(&quot;10.20.130.230:9090&quot;);</div><div class="line">registry.setUsername(&quot;aaa&quot;);</div><div class="line">registry.setPassword(&quot;bbb&quot;);</div><div class="line"></div><div class="line">// 服务提供者协议配置</div><div class="line">ProtocolConfig protocol = new ProtocolConfig();</div><div class="line">protocol.setName(&quot;dubbo&quot;);</div><div class="line">protocol.setPort(12345);</div><div class="line">protocol.setThreads(200);</div><div class="line"></div><div class="line">// 注意：ServiceConfig为重对象，内部封装了与注册中心的连接，以及开启服务端口</div><div class="line"></div><div class="line">// 服务提供者暴露服务配置</div><div class="line">ServiceConfig&lt;XxxService&gt; service = new ServiceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接，请自行缓存，否则可能造成内存和连接泄漏</div><div class="line">service.setApplication(application);</div><div class="line">service.setRegistry(registry); // 多个注册中心可以用setRegistries()</div><div class="line">service.setProtocol(protocol); // 多个协议可以用setProtocols()</div><div class="line">service.setInterface(XxxService.class);</div><div class="line">service.setRef(xxxService);</div><div class="line">service.setVersion(&quot;1.0.0&quot;);</div><div class="line"></div><div class="line">// 暴露及注册服务</div><div class="line">service.export();</div></pre></td></tr></table></figure>
<ul>
<li>此时，服务已经暴露给多点传播的注册中心了，然后配置服务消费者：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">import com.alibaba.dubbo.rpc.config.ApplicationConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.RegistryConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.ConsumerConfig;</div><div class="line">import com.alibaba.dubbo.rpc.config.ReferenceConfig;</div><div class="line">import com.xxx.XxxService;</div><div class="line"></div><div class="line">// 当前应用配置</div><div class="line">ApplicationConfig application = new ApplicationConfig();</div><div class="line">application.setName(&quot;yyy&quot;);</div><div class="line"></div><div class="line">// 连接注册中心配置</div><div class="line">RegistryConfig registry = new RegistryConfig();</div><div class="line">registry.setAddress(&quot;10.20.130.230:9090&quot;);</div><div class="line">registry.setUsername(&quot;aaa&quot;);</div><div class="line">registry.setPassword(&quot;bbb&quot;);</div><div class="line"></div><div class="line">// 注意：ReferenceConfig为重对象，内部封装了与注册中心的连接，以及与服务提供方的连接</div><div class="line"></div><div class="line">// 引用远程服务</div><div class="line">ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏</div><div class="line">reference.setApplication(application);</div><div class="line">reference.setRegistry(registry); // 多个注册中心可以用setRegistries()</div><div class="line">reference.setInterface(XxxService.class);</div><div class="line">reference.setVersion(&quot;1.0.0&quot;);</div><div class="line"></div><div class="line">// 和本地bean一样使用xxxService</div><div class="line">XxxService xxxService = reference.get(); // 注意：此代理对象内部封装了所有通讯细节，对象较重，请缓存复用</div></pre></td></tr></table></figure>
<h2 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h2><h3 id="服务提供方"><a href="#服务提供方" class="headerlink" title="服务提供方"></a>服务提供方</h3><ul>
<li>Service注解暴露服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import com.alibaba.dubbo.config.annotation.Service;</div><div class="line"></div><div class="line">@Service(timeout = 5000)</div><div class="line">public class AnnotateServiceImpl implements AnnotateService &#123;</div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>javaconfig形式配置公共模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class DubboConfiguration &#123;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public ApplicationConfig applicationConfig() &#123;</div><div class="line">        ApplicationConfig applicationConfig = new ApplicationConfig();</div><div class="line">        applicationConfig.setName(&quot;provider-test&quot;);</div><div class="line">        return applicationConfig;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public RegistryConfig registryConfig() &#123;</div><div class="line">        RegistryConfig registryConfig = new RegistryConfig();</div><div class="line">        registryConfig.setAddress(&quot;zookeeper://127.0.0.1:2181&quot;);</div><div class="line">        registryConfig.setClient(&quot;curator&quot;);</div><div class="line">        return registryConfig;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>指定Java扫描路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@DubboComponentScan(basePackages = &quot;com.alibaba.dubbo.test.service.impl&quot;)</div><div class="line">public class ProviderTestApp &#123;</div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="服务消费者"><a href="#服务消费者" class="headerlink" title="服务消费者"></a>服务消费者</h3><ul>
<li>reference 注解引用服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class AnnotationConsumeService &#123;</div><div class="line"></div><div class="line">    @com.alibaba.dubbo.config.annotation.Reference</div><div class="line">    public AnnotateService annotateService;</div><div class="line"></div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>javaconfig形式配置公共模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class DubboConfiguration &#123;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public ApplicationConfig applicationConfig() &#123;</div><div class="line">        ApplicationConfig applicationConfig = new ApplicationConfig();</div><div class="line">        applicationConfig.setName(&quot;consumer-test&quot;);</div><div class="line">        return applicationConfig;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public ConsumerConfig consumerConfig() &#123;</div><div class="line">        ConsumerConfig consumerConfig = new ConsumerConfig();</div><div class="line">        consumerConfig.setTimeout(3000);</div><div class="line">        return consumerConfig;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public RegistryConfig registryConfig() &#123;</div><div class="line">        RegistryConfig registryConfig = new RegistryConfig();</div><div class="line">        registryConfig.setAddress(&quot;zookeeper://127.0.0.1:2181&quot;);</div><div class="line">        registryConfig.setClient(&quot;curator&quot;);</div><div class="line">        return registryConfig;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>指定dubbo扫描路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@SpringBootApplication</div><div class="line">@DubboComponentScan(basePackages = &quot;com.alibaba.dubbo.test.service&quot;)</div><div class="line">public class ConsumerTestApp &#123;</div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看出，还是XML配置更加的简洁明了。</p>
<h1 id="Dubbo支持的协议"><a href="#Dubbo支持的协议" class="headerlink" title="Dubbo支持的协议"></a>Dubbo支持的协议</h1><p>Dubbo框架支持多种协议，包括dubbo、RMI、hessian、HTTP、web service、thrift、memcached、redis等。大多数协议之前都已经了解过，除了dubbo这个协议。</p>
<p>dubbo协议在服务提供者和消费者之间建立了长连接，这种长连接和非阻塞的网络传输在传输数据小于100k的时候效率非常高。dubbo协议中的参数包含端口，每个消费者的连接数，最大接受的连接数等。</p>
<p><code>&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot;  connections=&quot;2&quot; accepts=&quot;1000&quot; /&gt;</code></p>
<p>Dubbo还支持通过不同协议来同时暴露服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; /&gt;</div><div class="line">&lt;dubbo:protocol name=&quot;rmi&quot; port=&quot;1099&quot; /&gt;</div><div class="line"></div><div class="line">&lt;dubbo:service interface=&quot;com.baeldung.dubbo.remote.GreetingsService&quot; version=&quot;1.0.0&quot; ref=&quot;greetingsService&quot; protocol=&quot;dubbo&quot; /&gt;</div><div class="line">&lt;dubbo:service interface=&quot;com.bealdung.dubbo.remote.AnotherService&quot; version=&quot;1.0.0&quot; ref=&quot;anotherService&quot; protocol=&quot;rmi&quot; /&gt;</div></pre></td></tr></table></figure>
<h1 id="结果缓存"><a href="#结果缓存" class="headerlink" title="结果缓存"></a>结果缓存</h1><p>Dubbo对于远程调用的结果进行了本地的缓存来提高对于热点数据的访问速度。实现添加cache属性即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:reference interface=&quot;com.baeldung.dubbo.remote.GreetingsService&quot; id=&quot;greetingsService&quot; cache=&quot;lru&quot; /&gt;</div></pre></td></tr></table></figure>
<p>缓存策略选择的是最少最近使用缓存，当我们队服务的提供者的实现类进行修改之后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class GreetingsServiceSpecialImpl implements GreetingsService &#123;</div><div class="line">    @Override</div><div class="line">    public String sayHi(String name) &#123;</div><div class="line">        try &#123;</div><div class="line">            SECONDS.sleep(5);</div><div class="line">        &#125; catch (Exception ignored) &#123; &#125;</div><div class="line">        return &quot;hi, &quot; + name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对调用速度进行一下测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void givenProvider_whenConsumerSaysHi_thenGotResponse() &#123;</div><div class="line">    ClassPathXmlApplicationContext localContext</div><div class="line">      = new ClassPathXmlApplicationContext(&quot;multicast/consumer-app.xml&quot;);</div><div class="line">    localContext.start();</div><div class="line">    GreetingsService greetingsService</div><div class="line">      = (GreetingsService) localContext.getBean(&quot;greetingsService&quot;);</div><div class="line"></div><div class="line">    long before = System.currentTimeMillis();</div><div class="line">    String hiMessage = greetingsService.sayHi(&quot;baeldung&quot;);</div><div class="line"></div><div class="line">    long timeElapsed = System.currentTimeMillis() - before;</div><div class="line">    assertTrue(timeElapsed &gt; 5000);</div><div class="line">    assertNotNull(hiMessage);</div><div class="line">    assertEquals(&quot;hi, baeldung&quot;, hiMessage);</div><div class="line"></div><div class="line">    before = System.currentTimeMillis();</div><div class="line">    hiMessage = greetingsService.sayHi(&quot;baeldung&quot;);</div><div class="line">    timeElapsed = System.currentTimeMillis() - before;</div><div class="line"></div><div class="line">    assertTrue(timeElapsed &lt; 1000);</div><div class="line">    assertNotNull(hiMessage);</div><div class="line">    assertEquals(&quot;hi, baeldung&quot;, hiMessage);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了第一次调用，后面的调用几乎是立刻完成的，说明缓存生效了。</p>
<h1 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h1><p>Dubbo通过负载均衡和集中容错策略可以支持我们来自由的扩展我们的服务。假定我们使用zookeeper来做我们管理服务的集群。服务提供者在zookeeper上注册服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot;/&gt;</div></pre></td></tr></table></figure>
<p>为了引入使用以上的注册方式，需要引入zookeeper的相关依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;3.4.11&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.101tec&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;zkclient&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.10&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><ul>
<li>随机负载均衡<ul>
<li>随机，按照权重设置随机概率</li>
<li>在一个截面上碰撞的概率高，单调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。</li>
</ul>
</li>
<li>轮询负载均衡<ul>
<li>按公约后的权重设置轮询比率。</li>
<li>存在慢的提供者累积请求的问题，比如第二台机器很慢，当请求调到第二台就卡在那里，时间久了所有请求都卡在第二台机器上。</li>
</ul>
</li>
<li>最少活跃数负载均衡<ul>
<li>最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。</li>
<li>使慢的提供者受到更少的请求，因为越慢的提供者的调用前后计数差会越大。</li>
</ul>
</li>
<li>一致性哈希负载均衡<ul>
<li>相同参数的请求总是发到同一个提供者</li>
<li>当某一台提供者挂掉时，原本发往该提供者的请求，基于虚拟节点，平摊到其他提供者，不会引起剧烈变动。</li>
<li>缺醒只对第一个参数哈希，也可以配置<dubbo:parameter key="hash.arguments" value="0,1">修改。</dubbo:parameter></li>
<li>缺醒使用160份虚拟节点，如果要修改，请配置<dubbo:parameter key="hash.nodes" value="320"></dubbo:parameter></li>
</ul>
</li>
</ul>
<p>配置：</p>
<ul>
<li><p>服务端</p>
<ul>
<li>服务级别<code>&lt;dubbo:service interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;</code></li>
<li>方法级别<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:service interface=&quot;...&quot;&gt;</div><div class="line">    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;</div><div class="line">&lt;/dubbo:service&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>客户端</p>
<ul>
<li>服务级别<code>&lt;dubbo:reference interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;</code></li>
<li>方法级别<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:reference interface=&quot;...&quot;&gt;</div><div class="line">    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;</div><div class="line">&lt;/dubbo:reference&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="轮询负载均衡举例"><a href="#轮询负载均衡举例" class="headerlink" title="轮询负载均衡举例"></a>轮询负载均衡举例</h2><p>假定在一个集群里面存在两这个服务的实现作为服务提供者，请求时采用轮询方式做负载均衡。首先，创建服务提供者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Before</div><div class="line">public void initRemote() &#123;</div><div class="line">    ExecutorService executorService = Executors.newFixedThreadPool(2);</div><div class="line">    executorService.submit(() -&gt; &#123;</div><div class="line">        ClassPathXmlApplicationContext remoteContext</div><div class="line">          = new ClassPathXmlApplicationContext(&quot;cluster/provider-app-default.xml&quot;);</div><div class="line">        remoteContext.start();</div><div class="line">    &#125;);</div><div class="line">    executorService.submit(() -&gt; &#123;</div><div class="line">        ClassPathXmlApplicationContext backupRemoteContext</div><div class="line">          = new ClassPathXmlApplicationContext(&quot;cluster/provider-app-special.xml&quot;);</div><div class="line">        backupRemoteContext.start();</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们有一个标准的高速服务提供者，可以立即给出相应结果，一个低速服务提供者，每个响应需要等候5s。执行六次请求，此时采用轮询的负载均衡侧率，则期待的是平均相应时间为2.5s。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void givenProviderCluster_whenConsumerSaysHi_thenResponseBalanced() &#123;</div><div class="line">    ClassPathXmlApplicationContext localContext</div><div class="line">      = new ClassPathXmlApplicationContext(&quot;cluster/consumer-app-lb.xml&quot;);</div><div class="line">    localContext.start();</div><div class="line">    GreetingsService greetingsService</div><div class="line">      = (GreetingsService) localContext.getBean(&quot;greetingsService&quot;);</div><div class="line"></div><div class="line">    List&lt;Long&gt; elapseList = new ArrayList&lt;&gt;(6);</div><div class="line">    for (int i = 0; i &lt; 6; i++) &#123;</div><div class="line">        long current = System.currentTimeMillis();</div><div class="line">        String hiMessage = greetingsService.sayHi(&quot;baeldung&quot;);</div><div class="line">        assertNotNull(hiMessage);</div><div class="line">        elapseList.add(System.currentTimeMillis() - current);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    OptionalDouble avgElapse = elapseList</div><div class="line">      .stream()</div><div class="line">      .mapToLong(e -&gt; e)</div><div class="line">      .average();</div><div class="line">    assertTrue(avgElapse.isPresent());</div><div class="line">    assertTrue(avgElapse.getAsDouble() &gt; 2500.0);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时，动态负载均衡是支持的，下面的例子说明这一点，采用的是轮询的负载均衡策略，当新的服务注册时候，消费者会选择新的服务。低俗的服务提供者在系统启动后2s注册。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Before</div><div class="line">public void initRemote() &#123;</div><div class="line">    ExecutorService executorService = Executors.newFixedThreadPool(2);</div><div class="line">    executorService.submit(() -&gt; &#123;</div><div class="line">        ClassPathXmlApplicationContext remoteContext</div><div class="line">          = new ClassPathXmlApplicationContext(&quot;cluster/provider-app-default.xml&quot;);</div><div class="line">        remoteContext.start();</div><div class="line">    &#125;);</div><div class="line">    executorService.submit(() -&gt; &#123;</div><div class="line">        SECONDS.sleep(2);</div><div class="line">        ClassPathXmlApplicationContext backupRemoteContext</div><div class="line">          = new ClassPathXmlApplicationContext(&quot;cluster/provider-app-special.xml&quot;);</div><div class="line">        backupRemoteContext.start();</div><div class="line">        return null;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>服务提供者此时每秒调用一次服务，6次之后，我们期望平均响应时间大于1.6s。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void givenProviderCluster_whenConsumerSaysHi_thenResponseBalanced()</div><div class="line">  throws InterruptedException &#123;</div><div class="line">    ClassPathXmlApplicationContext localContext</div><div class="line">      = new ClassPathXmlApplicationContext(&quot;cluster/consumer-app-lb.xml&quot;);</div><div class="line">    localContext.start();</div><div class="line">    GreetingsService greetingsService</div><div class="line">      = (GreetingsService) localContext.getBean(&quot;greetingsService&quot;);</div><div class="line">    List&lt;Long&gt; elapseList = new ArrayList&lt;&gt;(6);</div><div class="line">    for (int i = 0; i &lt; 6; i++) &#123;</div><div class="line">        long current = System.currentTimeMillis();</div><div class="line">        String hiMessage = greetingsService.sayHi(&quot;baeldung&quot;);</div><div class="line">        assertNotNull(hiMessage);</div><div class="line">        elapseList.add(System.currentTimeMillis() - current);</div><div class="line">        SECONDS.sleep(1);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    OptionalDouble avgElapse = elapseList</div><div class="line">      .stream()</div><div class="line">      .mapToLong(e -&gt; e)</div><div class="line">      .average();</div><div class="line"></div><div class="line">    assertTrue(avgElapse.isPresent());</div><div class="line">    assertTrue(avgElapse.getAsDouble() &gt; 1666.0);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>负载均衡在服务提供者和服务消费者都可以使用。</em></p>
<h1 id="集群容错"><a href="#集群容错" class="headerlink" title="集群容错"></a>集群容错</h1><p>Dubbo支持多种容错机制，默认为failover重试。</p>
<p><img src="/img/Dubbo-4.png" alt="Alt text"></p>
<h2 id="各节点的关系"><a href="#各节点的关系" class="headerlink" title="各节点的关系"></a>各节点的关系</h2><ul>
<li>Invoke是Provider的一个可调用Service的抽象，Invoker封装了Provider地址及Service接口信息。</li>
<li>Directory代表多个Invoker，List<invoker>，值可以动态变化，比如注册中心推送变更</invoker></li>
<li>Cluster将Director中的多个Invoker封装成一个Invoker，对上层逃命，伪装过程包含了容错逻辑，如果失败后，重试另一个</li>
<li>Route负责从多个Invoker中按照路由规则选出子集没比如读写分离，应用隔离等</li>
<li>loadbalance负责从多个Invoker中选出一个具体用于本地调用，选的过程中包含了负载均衡该算法。</li>
</ul>
<h2 id="集群容错模式"><a href="#集群容错模式" class="headerlink" title="集群容错模式"></a>集群容错模式</h2><ul>
<li>fail-over<ul>
<li>当一个消费者获取一个服务失败的时候，会尝试访问集群中其他的服务提供者</li>
<li>通常用于读操作，但是重试会带来更长的延迟</li>
<li>可通过retries=“2”来设置重试次数，其中第一次不包含在内。</li>
</ul>
</li>
<li>fail-safe<ul>
<li>失败安全，出现异常时，直接忽略</li>
<li>通常用于写入审计日志等操作</li>
</ul>
</li>
<li>fail-fast<ul>
<li>快速失败，只发起一次调用，失败立即报错</li>
<li>通常用于非幂等性的写操作，比如新增记录</li>
</ul>
</li>
<li>fail-back<ul>
<li>失败自动恢复，后台记录失败请求，定时重发</li>
<li>通常用于消息通知操作</li>
</ul>
</li>
<li>forking<ul>
<li>并行调度多个服务器，只要一个成功及返回。</li>
<li>通常实时性要求比较高的读操作，但是需要浪费很多服务资源，可以通过forks=”2”来设置最大并行数</li>
</ul>
</li>
<li>broadcast<ul>
<li>广播调用所有的提供者，逐个调用，任意一台报错则报错。</li>
<li>通常用于通知所有提供者更新缓存或者日志等本地资源信息。</li>
</ul>
</li>
</ul>
<h2 id="集群模式配置"><a href="#集群模式配置" class="headerlink" title="集群模式配置"></a>集群模式配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//服务端</div><div class="line">&lt;dubbo:service cluster=&quot;failsafe&quot; /&gt;</div><div class="line">//客户端</div><div class="line">&lt;dubbo:reference cluster=&quot;failsafe&quot; /&gt;</div></pre></td></tr></table></figure>
<h1 id="线性模型"><a href="#线性模型" class="headerlink" title="线性模型"></a>线性模型</h1><p><img src="/img/Dubbo-5.png" alt="Alt text"></p>
<ul>
<li>如果事件的处理逻辑能够迅速完成，并且不会发起新的IO请求，比如只是在内存中标记个标识，则直接在IO线程上处理更快，因为这样减少了线程池的调度。</li>
<li>如果事件处理逻辑较慢，或者需要发起新的IO请求，比如需要查询数据库，则必须派发到线程池，否则IO线程阻塞，将导致不能接受其他请求。</li>
<li>如果用IO线程处理事件，又在事件处理过程中发起新的IO请求，比如在链接事件中发起登录请求，会报可能发生死锁异常。</li>
</ul>
<p>针对不同的场景，需要设定相应的派发侧率和不同的线程池：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;dubbo:protocol name=&quot;dubbo&quot; dispatcher=&quot;all&quot; threadpool=&quot;fixed&quot; threads=&quot;100&quot; /&gt;</div></pre></td></tr></table></figure>
<h2 id="Dispatcher"><a href="#Dispatcher" class="headerlink" title="Dispatcher"></a>Dispatcher</h2><ul>
<li>all，所有消息都派发到线程池，包括请求，相应，连接事件，断开事件，心跳等。</li>
<li>direct，所有消息都不派发到线程池，全部在IO线程上直接执行</li>
<li>message，只有请求相应消息派发到线程池，其他直接在IO线程执行</li>
<li>execution，只将请求消息派发到线程池，其他直接在IO线程执行</li>
<li>connection，在IO线程上，将连接断开事件放入队列，顺序执行，其他消息派发到线程池</li>
</ul>
<h2 id="threadPool"><a href="#threadPool" class="headerlink" title="threadPool"></a>threadPool</h2><ul>
<li>fixed，固定大小线程池，启动时创建线程，不关闭，一致持有，缺省</li>
<li>cached，缓存线程池，线程空闲一分钟自动删除，需要时创建</li>
<li>limited，可伸缩性线程池，单线程池中的线程数只会增长不会收缩，避免收缩带来的性能问题。</li>
<li>eager，优先创建worker线程池，当任务数量大于corePoolSize但小于maximumPoolSize时，优先创建Worker来处理任务。当任务数量大于maximumpoolSize时，将任务放入阻塞队列，阻塞队列充满时抛出RejectedExecutionException。</li>
</ul>
<h1 id="客户端和服务端直连"><a href="#客户端和服务端直连" class="headerlink" title="客户端和服务端直连"></a>客户端和服务端直连</h1><p>测试过程中，可以绕过注册中心来直接连接，此时会忽略注册中心的提供者列表，A接口配置点对点，不影响B接口从注册中心获取列表。</p>
<p>配置方法：</p>
<ul>
<li><p>XML：<code>&lt;dubbo:reference id=&quot;xxxService&quot; interface=&quot;com.alibaba.xxx.XxxService&quot; url=&quot;dubbo://localhost:20890&quot; /&gt;</code></p>
</li>
<li><p>JVM：<code>java -Dcom.alibaba.xxx.XxxService=dubbo://localhost:20890</code></p>
</li>
<li><p>properties: <code>com.alibaba.xxx.XxxService=dubbo://localhost:20890</code></p>
</li>
</ul>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate comment here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="cdx 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="cdx 支付宝"/>
        <p>支付宝</p>
      </div>
    

    
      <div id="bitcoin" style="display: inline-block">
        <img id="bitcoin_qr" src="/images/bitcoin.png" alt="cdx 比特币"/>
        <p>比特币</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Dubbo/" rel="tag"># Dubbo</a>
          
            <a href="/tags/RPC/" rel="tag"># RPC</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/21/ActiveMQ学习总结（二）/" rel="next" title="ActiveMQ学习总结（二）">
                <i class="fa fa-chevron-left"></i> ActiveMQ学习总结（二）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/21/Java Enum的用法总结/" rel="prev" title="Java Enum用法总结">
                Java Enum用法总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.gif"
              alt="cdx" />
          
            <p class="site-author-name" itemprop="name">cdx</p>
            <p class="site-description motion-element" itemprop="description">Be a better man!</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cdx0312" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:cdxu0312@outlook.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo的定义"><span class="nav-number">1.</span> <span class="nav-text">Dubbo的定义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo结构"><span class="nav-number">2.</span> <span class="nav-text">Dubbo结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#调用关系说明"><span class="nav-number">2.1.</span> <span class="nav-text">调用关系说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo架构的特点"><span class="nav-number">2.2.</span> <span class="nav-text">Dubbo架构的特点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连通性"><span class="nav-number">2.2.1.</span> <span class="nav-text">连通性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#健壮性"><span class="nav-number">2.2.2.</span> <span class="nav-text">健壮性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伸缩性"><span class="nav-number">2.2.3.</span> <span class="nav-text">伸缩性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#升级性"><span class="nav-number">2.2.4.</span> <span class="nav-text">升级性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo依赖要求"><span class="nav-number">3.</span> <span class="nav-text">Dubbo依赖要求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring中Dubbo应用示例"><span class="nav-number">3.1.</span> <span class="nav-text">Spring中Dubbo应用示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo配置"><span class="nav-number">4.</span> <span class="nav-text">Dubbo配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#XML配置"><span class="nav-number">4.1.</span> <span class="nav-text">XML配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性配置"><span class="nav-number">4.2.</span> <span class="nav-text">属性配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-API配置Dubbo"><span class="nav-number">4.3.</span> <span class="nav-text">Java API配置Dubbo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解配置"><span class="nav-number">4.4.</span> <span class="nav-text">注解配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务提供方"><span class="nav-number">4.4.1.</span> <span class="nav-text">服务提供方</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务消费者"><span class="nav-number">4.4.2.</span> <span class="nav-text">服务消费者</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo支持的协议"><span class="nav-number">5.</span> <span class="nav-text">Dubbo支持的协议</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结果缓存"><span class="nav-number">6.</span> <span class="nav-text">结果缓存</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#zookeeper"><span class="nav-number">7.</span> <span class="nav-text">zookeeper</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#负载均衡"><span class="nav-number">8.</span> <span class="nav-text">负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#轮询负载均衡举例"><span class="nav-number">8.1.</span> <span class="nav-text">轮询负载均衡举例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集群容错"><span class="nav-number">9.</span> <span class="nav-text">集群容错</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#各节点的关系"><span class="nav-number">9.1.</span> <span class="nav-text">各节点的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集群容错模式"><span class="nav-number">9.2.</span> <span class="nav-text">集群容错模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集群模式配置"><span class="nav-number">9.3.</span> <span class="nav-text">集群模式配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#线性模型"><span class="nav-number">10.</span> <span class="nav-text">线性模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Dispatcher"><span class="nav-number">10.1.</span> <span class="nav-text">Dispatcher</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#threadPool"><span class="nav-number">10.2.</span> <span class="nav-text">threadPool</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#客户端和服务端直连"><span class="nav-number">11.</span> <span class="nav-text">客户端和服务端直连</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cdx</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
