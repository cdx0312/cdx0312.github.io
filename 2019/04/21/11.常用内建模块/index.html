<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python基础," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="常用内建模块datetimedatetime是Python处理日期和时间的标准库。 获取当前的日期和时间：123456&amp;gt;&amp;gt;&amp;gt; from datetime import datetime&amp;gt;&amp;gt;&amp;gt; now=datetime.now()  #获取当前的datetime&amp;gt;&amp;gt;&amp;gt; print(now)2016-11-01 20:25:50.305269&amp;gt">
<meta name="keywords" content="Python基础">
<meta property="og:type" content="article">
<meta property="og:title" content="11. 常用内建模块">
<meta property="og:url" content="http://yoursite.com/2019/04/21/11.常用内建模块/index.html">
<meta property="og:site_name" content="小黄">
<meta property="og:description" content="常用内建模块datetimedatetime是Python处理日期和时间的标准库。 获取当前的日期和时间：123456&amp;gt;&amp;gt;&amp;gt; from datetime import datetime&amp;gt;&amp;gt;&amp;gt; now=datetime.now()  #获取当前的datetime&amp;gt;&amp;gt;&amp;gt; print(now)2016-11-01 20:25:50.305269&amp;gt">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/1478069277975.png">
<meta property="og:updated_time" content="2017-09-09T10:26:36.853Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11. 常用内建模块">
<meta name="twitter:description" content="常用内建模块datetimedatetime是Python处理日期和时间的标准库。 获取当前的日期和时间：123456&amp;gt;&amp;gt;&amp;gt; from datetime import datetime&amp;gt;&amp;gt;&amp;gt; now=datetime.now()  #获取当前的datetime&amp;gt;&amp;gt;&amp;gt; print(now)2016-11-01 20:25:50.305269&amp;gt">
<meta name="twitter:image" content="http://yoursite.com/img/1478069277975.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/21/11.常用内建模块/"/>





  <title>11. 常用内建模块 | 小黄</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黄</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">黄小黄的幸福生活！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/Java/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Java
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/11.常用内建模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cdx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黄">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">11. 常用内建模块</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T14:13:13+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="常用内建模块"><a href="#常用内建模块" class="headerlink" title="常用内建模块"></a>常用内建模块</h1><h2 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h2><p>datetime是Python处理日期和时间的标准库。</p>
<p>获取当前的日期和时间：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now=datetime.now()  <span class="comment">#获取当前的datetime</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">20</span>:<span class="number">25</span>:<span class="number">50.305269</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(type(now))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">datetime</span>.<span class="title">datetime</span>'&gt;</span></div></pre></td></tr></table></figure></p>
<p>注意到<code>datetime</code>是模块，<code>datetime</code>模块还包含一个<code>datetime</code>类，通过<code>from datetime import datetime</code>导入的才是<code>datetime</code>这个类。如果仅导入<code>import datetime</code>，则必须引用全名<code>datetime.datetime</code>。<code>datetime.now()</code>返回当前日期和时间，其类型是<code>datetime</code>。</p>
<p>获取指定日期和时间：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt=datetime(<span class="number">2015</span>,<span class="number">11</span>,<span class="number">11</span>,<span class="number">11</span>,<span class="number">11</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(dt)</div><div class="line"><span class="number">2015</span><span class="number">-11</span><span class="number">-11</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">00</span></div></pre></td></tr></table></figure></p>
<p>datetime转换为timestamp，在计算机中，时间实际上是由数字表示的，我们把1970年1月1日00:00:00UTC+00:00时区的时刻称为epoch time，记为0，当前时间就是相当于epoch time的秒数，称为timestamp。</p>
<blockquote>
<p>timestamp=0=1970-1-1 00:00:00 UTC+0:00</p>
</blockquote>
<p>对应的北京时间是</p>
<blockquote>
<p>timestamp=0=1970-1-1 08:00:00 UTC+8:00</p>
</blockquote>
<p>课件timestamp的值和时区毫无关系，因为timestamp一旦确定，其UTC时间就确定了，转换到任意时区的时间也是完全确定的，这就是为什么计算机存储的当前时间是一timestamp表示的，因为世界各地的计算机在任意时刻的timestamp都是完全相同的。</p>
<p>把一个<code>datetime</code>类型转换为timestamp只需要简单调用<code>timestamp()</code>方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt.timestamp()</div><div class="line"><span class="number">1447211460.0</span></div></pre></td></tr></table></figure></p>
<p>注意Python的timestamp是一个浮点数。如果有小数点，小数位表示毫秒数。某些编程语言的timestamp使用整数表示毫秒数，这种情况下需要把timestamp除以1000就得到Python的浮点表示方法。</p>
<p>timestamp转换为datetime：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t=<span class="number">1429417200.0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))</div><div class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></div></pre></td></tr></table></figure></p>
<p>注意到timestamp是一个浮点数，它没有时区的概念，而datetime有时区的。上述转换是在timestamp和本地时间做转换。本地时间是指当前操作系统设定的时区。例如北京时区是东八区，则本地时间是2015-04-19 12:20:00，实际上就是UTC+8:00时区的时间2015-04-19 12:20:00 UTC+8:00，而此时的格林威治标准时间与北京差了八个小时，也就是UTC+0:00时区的时间：2015-04-19 04:20:00 UTC+0:00。</p>
<p>timestamp也可以直接转换到UTC标准时区的时间：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t=<span class="number">1429417200.0</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.fromtimestamp(t))</div><div class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.utcfromtimestamp(t))</div><div class="line"><span class="number">2015</span><span class="number">-04</span><span class="number">-19</span> <span class="number">04</span>:<span class="number">20</span>:<span class="number">00</span></div></pre></td></tr></table></figure></p>
<p>str转换为datetime，很多时候，用户输入的日期和时间是字符串，要处理日期和时间，首先要把str转换为datetime。转换方法是通过<code>datetime.strptime()</code>实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cday=datetime.strptime(<span class="string">'2015-6-1 18:19:59'</span>,<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(cday)</div><div class="line"><span class="number">2015</span><span class="number">-06</span><span class="number">-01</span> <span class="number">18</span>:<span class="number">19</span>:<span class="number">59</span></div></pre></td></tr></table></figure></p>
<p>字符串<code>&#39;%Y-%m-%d %H:%M:%S&#39;</code>规定了日期和时间部分的格式。</p>
<p>datetime转换为str，如果已经有了datetime对象，要把它格式化 为字符串显示给用户，就需要转换为str，转换方法是通过<code>strftime()</code>实现的，同样需要一个日期和时间的格式化字符串：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now=datetime.now()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(now.strftime(<span class="string">'%a,%b %d %H:%M'</span>))</div><div class="line">Tue,Nov <span class="number">01</span> <span class="number">21</span>:<span class="number">26</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(now)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">21</span>:<span class="number">26</span>:<span class="number">20.187960</span></div></pre></td></tr></table></figure></p>
<p>datetime加减，对日期和时间进行加减实际上就是把datetime往后或往前计算，得到新的datetime。加减可以直接用<code>+``-</code>运算符，需要导入<code>timedelta</code>这个类：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timedelta</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now=datetime.now()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">50</span>, <span class="number">726284</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now+timedelta(hours=<span class="number">10</span>)</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">29</span>, <span class="number">50</span>, <span class="number">726284</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now-timedelta(days=<span class="number">2</span>)</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">10</span>, <span class="number">30</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">50</span>, <span class="number">726284</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now+timedelta(days=<span class="number">1</span>,hours=<span class="number">10</span>)</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">29</span>, <span class="number">50</span>, <span class="number">726284</span>)</div></pre></td></tr></table></figure></p>
<p>本地时间转换为UTC时间，一个<code>datetime</code>类型有一个时区属性<code>tzinfo</code>，但是默认为<code>None</code>，所以无法区分这个<code>datetime</code>到底是哪个市区，除非强行给<code>datetime</code>设置一个时区：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timedelta,timezone</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tz_utc_8=timezone(timedelta(hours=<span class="number">8</span>))  <span class="comment">#创建时区UTC+8:00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now=datetime.now()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>now</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">35</span>, <span class="number">48</span>, <span class="number">271569</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt=now.replace(tzinfo=tz_utc_8) <span class="comment">#强制设置为UTC+8:00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dt</div><div class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">35</span>, <span class="number">48</span>, <span class="number">271569</span>, tzinfo=datetime.timezone(datetime.timedelta(<span class="number">0</span>, <span class="number">28800</span>)))</div></pre></td></tr></table></figure></p>
<p>如果系统时区恰好是UTC+8:00,那么上述代码就是正确的，否则，不能强制设置为UTC+8:00时区。</p>
<p>时区转换，我们可以先通过<code>utcnow()</code>拿到当前的UTC时间，再转换为任意时区的时间：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>utc_dt=datetime.utcnow().replace(tzinfo=timezone.utc) <span class="comment">#拿到UTC时间，强制设置时区为UTC+0:00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(utc_dt)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">13</span>:<span class="number">39</span>:<span class="number">21.800814</span>+<span class="number">00</span>:<span class="number">00</span>  <span class="comment">#astimezone()将转化时区为北京时间</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>bj_dt=utc_dt.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(bj_dt)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">21</span>:<span class="number">39</span>:<span class="number">21.800814</span>+<span class="number">08</span>:<span class="number">00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt=utc_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">22</span>:<span class="number">39</span>:<span class="number">21.800814</span>+<span class="number">09</span>:<span class="number">00</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo_dt2=bj_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(tokyo_dt2)</div><div class="line"><span class="number">2016</span><span class="number">-11</span><span class="number">-01</span> <span class="number">22</span>:<span class="number">39</span>:<span class="number">21.800814</span>+<span class="number">09</span>:<span class="number">00</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>时区转换的关键在于，拿到一个<code>datetime</code>时，要获知其正确的时区，然后强制设置时区，作为基准时间。利用带时区的<code>datetime</code>，通过<code>astimezone()</code>方法，可以转换到任意时区。</p>
<p>datetime表示时间需要时区信息才能确定一个特定的时间，否则只能视为本地时间。如果要存储datetime，最佳方法是将其转换为timestamp再存储，因为timestamp的值与时区完全无关。</p>
<hr>
<h2 id="collections"><a href="#collections" class="headerlink" title="collections"></a>collections</h2><p>collections是Python内建的一个集合模块，提供了许多有用的集合类。</p>
<h3 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h3><p>我们知道<code>tuple</code>可以表示不变集合，比如，一个点的二维坐标可以表示为：<br>                                    <figure class="highlight plain"><figcaption><span>p</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">但是看到(1,2)，很难看出这个`tuple`是用来表示一个坐标的。定义一个class又没有必要，这时候，`namedtuple`就可以使用了：</div><div class="line"></div><div class="line">```python</div><div class="line">&gt;&gt;&gt; from collections import namedtuple</div><div class="line">&gt;&gt;&gt; Point=namedtuple(&apos;Point&apos;,[&apos;x&apos;,&apos;y&apos;])</div><div class="line">&gt;&gt;&gt; p=Point(1,2)</div><div class="line">&gt;&gt;&gt; p.x</div><div class="line">1</div><div class="line">&gt;&gt;&gt; p.y</div><div class="line">2</div><div class="line">&gt;&gt;&gt; isinstance(p,Point)</div><div class="line">True</div><div class="line">&gt;&gt;&gt; isinstance(p,tuple)</div><div class="line">True</div></pre></td></tr></table></figure></p>
<p><code>namedtuple</code>是一个函数，它用来创建一个自定义的<code>tuple</code>对象，并且规定了<code>tuple</code>元素的个数，并可以用属性而不是索引来引用<code>tuple</code>的某个元素。这样我们可以用<code>namedtuple</code>可以很方便的定义一种数据结构，它具备tuple的不变性，又可以根据属性来引用，十分方便。可以验证创建的<code>Point</code>对象是<code>tuple</code>的一种子类。</p>
<p>类似的如果要用坐标和半径定义一个圆：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Circle=namedtuple(<span class="string">'Circle'</span>,[<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'r'</span>])</div></pre></td></tr></table></figure></p>
<h3 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h3><p>使用list村塾数据时，按索引访问元素很快，但是插入和删除元素就很慢了，因为list是线性存储，数据量大的时候，插入和删除效率很低。deque是为了高效实现插入和删除操作 的双向列表，适合用于队列和栈：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> deque</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>q=deque([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>q.append(<span class="string">'x'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>q.appendleft(<span class="string">'y'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>q</div><div class="line">deque([<span class="string">'y'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'x'</span>])</div></pre></td></tr></table></figure></p>
<p><code>deque</code>除了实现list的<code>append()</code>和<code>pop()</code>外，还支持<code>appendleft()</code>和<code>popleft()</code>这样可以非常高效的往头部添加或删除元素。</p>
<h3 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h3><p>使用<code>dict</code>时，如果引用的key不存在，就会抛出<code>KeyError</code>。如果希望key不存在时，返回一个默认值，就可以用<code>defalultdict</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dd=defaultdict(<span class="keyword">lambda</span>: <span class="string">'N/A'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key1'</span>]=<span class="string">'abc'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key1'</span>]</div><div class="line"><span class="string">'abc'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'key2'</span>]</div><div class="line"><span class="string">'N/A'</span></div></pre></td></tr></table></figure>
<p>注意默认值是返回函数调用的，而函数在创建<code>defaultdict</code>对象时传入。</p>
<h3 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h3><p>使用dict时，key是无序的。在对dict做迭代时，我们无法确定Key的顺序，如果要保持Key的顺序，可以用<code>OrderedDict</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d=dict([(<span class="string">'a'</span>,<span class="number">1</span>),(<span class="string">'b'</span>,<span class="number">2</span>),(<span class="string">'c'</span>,<span class="number">3</span>)])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>d</div><div class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od=OrderedDict([(<span class="string">'a'</span>,<span class="number">1</span>),(<span class="string">'b'</span>,<span class="number">2</span>),(<span class="string">'c'</span>,<span class="number">3</span>)])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od</div><div class="line">OrderedDict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</div></pre></td></tr></table></figure></p>
<p>注意，<code>OrderedDict</code>的Key会按照插入的顺序排列，不是Key本身排序：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>od=OrderedDict()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'z'</span>]=<span class="number">1</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'y'</span>]=<span class="number">2</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'a'</span>]=<span class="number">3</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>od</div><div class="line">OrderedDict([(<span class="string">'z'</span>, <span class="number">1</span>), (<span class="string">'y'</span>, <span class="number">2</span>), (<span class="string">'a'</span>, <span class="number">3</span>)])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(od.keys())</div><div class="line">[<span class="string">'z'</span>, <span class="string">'y'</span>, <span class="string">'a'</span>]</div></pre></td></tr></table></figure></p>
<p><code>OrderedDict</code>可以实现一个FIFO的dict，当容量超出限制时，先删除最早添加的Key：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">LastUpdatedOrderedDict</span><span class="params">(OrderedDict)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,capacity)</span>:</span></div><div class="line"><span class="meta">... </span>            super( LastUpdatedOrderedDict,self).__init__()</div><div class="line"><span class="meta">... </span>            self._capacity=capacity</div><div class="line">...</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self,key,value)</span>:</span></div><div class="line"><span class="meta">... </span>            containsKey=<span class="number">1</span> <span class="keyword">if</span> key <span class="keyword">in</span> self <span class="keyword">else</span> <span class="number">0</span></div><div class="line"><span class="meta">... </span>            <span class="keyword">if</span> len(self)-constainsKey&gt;=self._capacity:</div><div class="line"><span class="meta">... </span>                    last=self.popoitem(last=<span class="keyword">False</span>)</div><div class="line"><span class="meta">... </span>                    print(<span class="string">'remove:'</span>,last)</div><div class="line"><span class="meta">... </span>            <span class="keyword">if</span> constainsKey:</div><div class="line"><span class="meta">... </span>                    <span class="keyword">del</span> self[key]</div><div class="line"><span class="meta">... </span>                    print(<span class="string">'set:'</span>,(key,value))</div><div class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</div><div class="line"><span class="meta">... </span>                    print(<span class="string">'add:'</span>,(key,value))</div><div class="line"><span class="meta">... </span>            OrderdeDict.__setitem__(self,key,value)</div><div class="line">...</div></pre></td></tr></table></figure></p>
<h3 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h3><p><code>Counter</code>是一个简单的计数器，例如统计字符出现的个数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c=Counter()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="string">'programming'</span>:</div><div class="line"><span class="meta">... </span>    c[ch]=c[ch]+<span class="number">1</span></div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c</div><div class="line">Counter(&#123;<span class="string">'m'</span>: <span class="number">2</span>, <span class="string">'g'</span>: <span class="number">2</span>, <span class="string">'r'</span>: <span class="number">2</span>, <span class="string">'o'</span>: <span class="number">1</span>, <span class="string">'p'</span>: <span class="number">1</span>, <span class="string">'n'</span>: <span class="number">1</span>, <span class="string">'i'</span>: <span class="number">1</span>, <span class="string">'a'</span>: <span class="number">1</span>&#125;)</div></pre></td></tr></table></figure></p>
<p><code>Counter</code>实际上也是<code>dict</code>的一个子类。</p>
<hr>
<h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>Base64是一种用64个字符来表示任意二进制数据的方法。用记事本打开exe,jpg,pdf这些文件会看到一大堆乱码，因为二进制文件包含了很多无法显示和打印的字符，所以，如果让笔记本这样的文本处理软件能处理二进制数据，就需要一个二进制到字符串的转换方法。Base64是一种最常见的二进制编码方法。</p>
<p>Base64的原理很简单，首先，准备一个包含64个字符的数组：</p>
<blockquote>
<p>[‘A’,’B’,’C’……’a’,’b’,’c’…….’0’,’1’,’2’…..’+’,’/‘]</p>
</blockquote>
<p>然后，对二进制数据进行处理，每三个字节一组，一共是24个bit，划为四组，每组为6bit：<br><img src="/img/1478069277975.png" alt="Alt text"></p>
<p>这样我们得到4个数字作为索引，然后查表，获得相应的4个字符，就是编码后的字符串。</p>
<p>所以，base64编码会把三个字节的二进制数据编码为4字节的文本数据，长度增加33%，好处是编码后的文本数据可以在邮件正文，网页等直接显示。如果要编码的二进制数据不是3的倍数，最后剩下的1个或2个字节可以用\x00字节在末尾补足后，再在编码的末尾加上一个或两个=号，表示补了多少个字节，解码的时候会自动去掉。</p>
<p>Python内置的base64可以直接进行base64的编解码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">b'binary\x00string'</span>)</div><div class="line"><span class="string">b'YmluYXJ5AHN0cmluZw=='</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64decode(<span class="string">b'YmluYXJ5AHN0cmluZw=='</span>)</div><div class="line"><span class="string">b'binary\x00string'</span></div></pre></td></tr></table></figure></p>
<p>由于标准的Base64编码后可能出现符号+和/，在URL中就不能直接作为参数，所以又有一种URL safe的base64编码，其实就是把+、/分别变为-和_：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">b'i\xb7\x1d\xfb\xef\xff'</span>)</div><div class="line"><span class="string">b'abcd++//'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>base64.urlsafe_b64encode(<span class="string">b'i\xb7\x1d\xfb\xef\xff'</span>)</div><div class="line"><span class="string">b'abcd--__'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>base64.urlsafe_b64decode(<span class="string">'abcd--__'</span>)</div><div class="line"><span class="string">b'i\xb7\x1d\xfb\xef\xff'</span></div></pre></td></tr></table></figure></p>
<p> Base64是一种通过查表的编码方法，不能用于加密，即使使用自定义的编码表也不行。适用于小段内容的编码，比如数字证书签名，Cookie的内容等。</p>
<p>由于=字符也可能出现在Base64编码中，但=用在URL，Cookie里面会造成歧义，很多Base64编码后会把=去掉。</p>
<blockquote>
<p>标准Base64:<br>‘abcd’ -&gt; ‘YWJjZA==’<br>自动去掉=:<br>‘abcd’ -&gt; ‘YWJjZA’</p>
</blockquote>
<p>去掉之后解码时，由于Base64是把3个字节变为4个字节的，所以Base64编码的长度永远是4的倍数，加上=后就可以正常解码了。</p>
<hr>
<h2 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h2><p>Python没有专门处理字节的数据类型，但是由于<code>b&#39;str&#39;</code>可以表示字节，所以，字节数组=二进制str。而在C语言中，我们可以很方便的使用struct、union等来处理字节，以及字节和int、float的转换。</p>
<p>在Python中，比如要把一个32位无符号整数编程字节，也就是四个长度的bytes ，需要配合运算符：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>n=<span class="number">10240099</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b1=(n&amp;<span class="number">0xff000000</span>)&gt;&gt;<span class="number">24</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b2=(n&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b3=(n&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b4=n&amp;<span class="number">0xff</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>bs=bytes([b1,b2,b3,b4])</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>bs</div><div class="line"><span class="string">b'\x00\x9c@c'</span></div></pre></td></tr></table></figure></p>
<p>很麻烦，如果换成浮点数就无能为力了。Python提供了一个<code>struct</code>模块来解决bytes和其他二进制数据类型的转换。<code>struct</code>的<code>pack</code>函数把任意数据变为<code>bytes</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> struct</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">'&gt;I'</span>,<span class="number">10240099</span>)</div><div class="line"><span class="string">b'\x00\x9c@c'</span></div></pre></td></tr></table></figure></p>
<p><code>pack</code>的第一个参数是处理指令，<code>‘&gt;I’</code>的意思是：<code>&gt;</code>表示字节顺序是big-endian，也就是网络序，<code>I</code>表示4字节无符号整数。后面的参数个数要和处理指令一致。<code>unpack</code>把<code>bytes</code>变成相应的数据类型:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>struct.unpack(<span class="string">'&gt;IH'</span>,<span class="string">b'\xf0\xf0\xf0\xf0\x80\x80'</span>)</div><div class="line">(<span class="number">4042322160</span>, <span class="number">32896</span>)</div></pre></td></tr></table></figure></p>
<p>根据<code>&gt;IH</code>的说明，后面的<code>bytes</code>一次变为<code>I</code>：4字节无符号数和<code>H</code>：2字节无符号整数。所以，尽管Python不适合编写底层操作字节流的代码，但在对性能要求不高的地方，利用struct 很方便。</p>
<h2 id="hashlib"><a href="#hashlib" class="headerlink" title="hashlib"></a>hashlib</h2><p>Python的hashlib提供了常见的摘要算法，如MD5、SHA1等等。</p>
<h3 id="摘要算法"><a href="#摘要算法" class="headerlink" title="摘要算法"></a>摘要算法</h3><p>又称哈希算法、散列算法。它通过一个函数，把任意长度的数据转换为一个长度固定的数据串。摘要算法就是通过摘要函数<code>f()</code>对任意的数据data计算出固定长度的摘要digest，目的是为了发现原始数据是否被人篡改过。摘要算法之所以可以确定数据是否被篡改过是因为摘要函数是一个单向函数，计算<code>f(data)</code>很容易，但是通过digest 反推data很困难。对原始数据做一个bit的修改都会导致计算出的摘要完全不同。</p>
<p>以MD5为例，计算一个字符串的MD5值：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hashlib</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>md5=hashlib.md5()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>md5.update(<span class="string">'how to use md5 in python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(md5.hexdigest())</div><div class="line">d26a53750bc40b38b65a520292f69306</div></pre></td></tr></table></figure></p>
<p>如果数据量很大，可以分块多次调用<code>update()</code>，最后计算的结果是一样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hashlib</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>md5=hashlib.md5()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>md5.update(<span class="string">'how to use md5 in'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>md5.update(<span class="string">'python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(md5.hexdigest())</div><div class="line"><span class="number">047</span>b2e59ed7530a32db954459f82266b</div></pre></td></tr></table></figure></p>
<p>MD5是最常见的摘要算法，速度很快，上观南城结果是固定的128bit字节，通常用一个32位的16进制字符串表示。</p>
<p>另一种常见的摘要算法是SHA1：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hashlib</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sha1=hashlib.sha1()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sha1.update(<span class="string">'how to use sha1 in '</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sha1.update(<span class="string">'python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(sha1.hexdigest())</div><div class="line"><span class="number">2</span>c76b57293ce30acef38d98f6046927161b46a44</div></pre></td></tr></table></figure></p>
<p>SHA1的结果是160bit字节，通常用一个40位的16进制字符来表示。比SHA1更安全的算法是SHA256和SHA512，越安全的算法越慢，摘要长度也会更长。</p>
<h3 id="摘要算法应用"><a href="#摘要算法应用" class="headerlink" title="摘要算法应用"></a>摘要算法应用</h3><p>任何允许用户登录的网站都会存储用户登录的用户名和口令，存储的方法是存储到数据库表中：</p>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:right">passwd</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Michael</td>
<td style="text-align:right">123456</td>
</tr>
<tr>
<td style="text-align:left">bob</td>
<td style="text-align:right">asd121</td>
</tr>
<tr>
<td style="text-align:left">alice</td>
<td style="text-align:right">alice123456</td>
</tr>
</tbody>
</table>
<p>如果以明文保存用户口令，如果数据库泄露，所有用户的口令都泄露。而且网站运维人员是可以访问数据库的，也就是能获取到所有用户的口令。正确保存口令的方式是不存储用户的明文口令，而是存储用户口令的摘要，比如MD5：<br>| name      |  passwd |<br>| :——– | ——–:|<br>| Michael   |   e10adc3949ba59abbe56e057f20f883e |<br>|bob        |   878ef96e86145580c38c87f0410ad153 |<br>|alice      |  99b1c2188db85afee403b1536010c2c9|</p>
<p>当用户登录时，首先计算机用户输入的明文口令的MD5，然后和数据库的MD5对比，结果一致说明口令输入正确，如果不一致则口令错误。</p>
<hr>
<h2 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h2><p>Python的内建模块<code>itertools</code>提供了非常有用的用于操作迭代对象的函数。首先来看<code>itertools</code>提供的几个无限迭代器：</p>
<p><code>cycle()</code>会把传入的一个序列无限重复下去。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> itertools</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cs = itertools.cycle(<span class="string">'ABC'</span>) <span class="comment"># 注意字符串也是序列的一种</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> cs:</div><div class="line"><span class="meta">... </span>    print(c)</div><div class="line">...</div><div class="line"><span class="string">'A'</span></div><div class="line"><span class="string">'B'</span></div><div class="line"><span class="string">'C'</span></div><div class="line"><span class="string">'A'</span></div><div class="line"><span class="string">'B'</span></div><div class="line"><span class="string">'C'</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p><code>repeat()</code>负责把一个元素无限重复下去，不过提供第二个参数就可以限定重复次数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> itertools</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ns=itertools.repeat(<span class="string">'a'</span>,<span class="number">4</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> n <span class="keyword">in</span> ns:</div><div class="line">	print(n)</div><div class="line"></div><div class="line"></div><div class="line">a</div><div class="line">a</div><div class="line">a</div><div class="line">a</div></pre></td></tr></table></figure></p>
<p>无限序列只有在<code>for</code>迭代时才会无限地迭代下去，如果只是创建了一个迭代对象，它不会事先把无限个元素生成出来，事实上也不可能在内存中创建无限多个元素。无限序列虽然可以无限迭代下去，但是通常我们会通过<code>takewhile()</code>等函数根据条件判断来截取出一个有限的序列：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>naturals=itertools.count(<span class="number">1</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ns=itertools.takewhile(<span class="keyword">lambda</span> x:x&lt;=<span class="number">10</span>,naturals)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(ns)</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</div></pre></td></tr></table></figure></p>
<p><code>itertools</code>提供的几个迭代器操作函数更加有用：</p>
<h3 id="chain"><a href="#chain" class="headerlink" title="chain()"></a>chain()</h3><p><code>chain()</code>可以把一组迭代对象串联起来，形成一个更大的迭代器：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> itertools.chain(<span class="string">'abc'</span>,<span class="string">'1234'</span>):</div><div class="line">	print(c)</div><div class="line"></div><div class="line"></div><div class="line">a</div><div class="line">b</div><div class="line">c</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<h3 id="groupby"><a href="#groupby" class="headerlink" title="groupby()"></a>groupby()</h3><p><code>groupby()</code>把迭代器中相邻的重复元素挑出来放在一起：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key,group <span class="keyword">in</span> itertools.groupby(<span class="string">'aaabbbccaaadd'</span>):</div><div class="line">	print(key,list(group))</div><div class="line"></div><div class="line"></div><div class="line">a [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>]</div><div class="line">b [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>]</div><div class="line">c [<span class="string">'c'</span>, <span class="string">'c'</span>]</div><div class="line">a [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>]</div><div class="line">d [<span class="string">'d'</span>, <span class="string">'d'</span>]</div></pre></td></tr></table></figure></p>
<p>实际上挑选规则是通过函数完成的，只要作用于函数的两个元素返回的值相等，这两个元素就被认为是在一组的，而函数返回值作为组的key。如果我们要忽略大小写分组，可以让元素Aa都返回相同的key:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key,group <span class="keyword">in</span> itertools.groupby(<span class="string">'AAaBbbcCCDcd'</span>,<span class="keyword">lambda</span> c:c.upper()):</div><div class="line">	print(key,list(group))</div><div class="line"></div><div class="line"></div><div class="line">A [<span class="string">'A'</span>, <span class="string">'A'</span>, <span class="string">'a'</span>]</div><div class="line">B [<span class="string">'B'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>]</div><div class="line">C [<span class="string">'c'</span>, <span class="string">'C'</span>, <span class="string">'C'</span>]</div><div class="line">D [<span class="string">'D'</span>]</div><div class="line">C [<span class="string">'c'</span>]</div><div class="line">D [<span class="string">'d'</span>]</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><h3 id="DOM-vs-SAX"><a href="#DOM-vs-SAX" class="headerlink" title="DOM vs SAX"></a>DOM vs SAX</h3><p>操作XMl有两种方法：DOM和SAX，DOM会把整个XML读入内存，解析为树，因此占用内存大，解析慢，优点是可以任意遍历树的节点。SAX是流模式，边读边解析，占用内存小，缺点是我们需要自己处理事件。正常情况下优先考虑SAX。在Python中我们关心的事件是<code>start_element</code>,<code>end_element</code>,<code>char_data</code>准备好这三个函数就可以解析xml了。如当SAX解析器读到一个节点时：</p>
<blockquote>
<p><a href="/">python</a></p>
</blockquote>
<p>会产生三个事件：</p>
<blockquote>
<p>1.start_element事件，在读取<a href="/">时；<br>2.char_data事件，在读取python时<br>3.end_element事件，在读取</a></p>
</blockquote>
<p>代码验证如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> xml.parsers.expat <span class="keyword">import</span> ParserCreate</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultSaxHandler</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_element</span><span class="params">(self, name, attrs)</span>:</span></div><div class="line">        print(<span class="string">'sax:start_element: %s, attrs: %s'</span> % (name, str(attrs)))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end_element</span><span class="params">(self, name)</span>:</span></div><div class="line">        print(<span class="string">'sax:end_element: %s'</span> % name)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">char_data</span><span class="params">(self, text)</span>:</span></div><div class="line">        print(<span class="string">'sax:char_data: %s'</span> % text)</div><div class="line"></div><div class="line">xml = <span class="string">r'''&lt;?xml version="1.0"?&gt;</span></div><div class="line"><span class="string">&lt;ol&gt;</span></div><div class="line"><span class="string">    &lt;li&gt;&lt;a href="/python"&gt;Python&lt;/a&gt;&lt;/li&gt;</span></div><div class="line"><span class="string">    &lt;li&gt;&lt;a href="/ruby"&gt;Ruby&lt;/a&gt;&lt;/li&gt;</span></div><div class="line"><span class="string">&lt;/ol&gt;</span></div><div class="line"><span class="string">'''</span></div><div class="line"></div><div class="line">handler = DefaultSaxHandler()</div><div class="line">parser = ParserCreate()</div><div class="line">parser.StartElementHandler = handler.start_element</div><div class="line">parser.EndElementHandler = handler.end_element</div><div class="line">parser.CharacterDataHandler = handler.char_data</div><div class="line">parser.Parse(xml)</div></pre></td></tr></table></figure></p>
<p>需要注意的是读取一大段字符串时，CharacterDataHandler可能被多次调用，所以需要自己保存起来，在EndElementHandler里面合并。</p>
<hr>
<h2 id="HTMLParser"><a href="#HTMLParser" class="headerlink" title="HTMLParser"></a>HTMLParser</h2><p>编写一个搜索引擎，第一步是用爬虫把目标网站的页面抓下来，第二步就是解析该HTML页面，看看里面的内容到底是新闻、图片还是视频。</p>
<p>HTML本质上是XML的子集，但是HTML的语法没有XML那么严格，所以不能用标准的DOM或者SAX来解析HTML。可以用HTMLParser来解析HTML：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</div><div class="line"><span class="keyword">from</span> html.entities <span class="keyword">import</span> name2codepoint</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHTMLParser</span><span class="params">(HTMLParser)</span>:</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_starttag</span><span class="params">(self,tag,attrs)</span>:</span></div><div class="line">		print(<span class="string">'&lt;/%s&gt;'</span> %tag)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_endtag</span><span class="params">(self,tag)</span>:</span></div><div class="line">		print(<span class="string">'&lt;/%s&gt;'</span> %tag)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_startendtag</span><span class="params">(self ,tag,attrs)</span>:</span></div><div class="line">		print(<span class="string">'&lt;/%s&gt;'</span> %tag)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self,data)</span>:</span></div><div class="line">		print(data)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_comment</span><span class="params">(self,data)</span>:</span></div><div class="line">		print(<span class="string">'&lt;!--'</span>,data ,<span class="string">'--&gt;'</span>)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_entityref</span><span class="params">(self,name)</span>:</span></div><div class="line">		print(<span class="string">'&amp;%s:'</span> %name)</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handle_charref</span><span class="params">(self,name)</span>:</span></div><div class="line">		print(<span class="string">'&amp;#%s:'</span> %name)</div><div class="line"></div><div class="line">parser=MyHTMLParser()</div><div class="line">parser.feed(<span class="string">'''&lt;html&gt;</span></div><div class="line"><span class="string">&lt;head&gt;&lt;/head&gt;</span></div><div class="line"><span class="string">&lt;body&gt;</span></div><div class="line"><span class="string">&lt;!-- test html parser--&gt;</span></div><div class="line"><span class="string">	&lt;p&gt;Some&lt;a href=\"#\"&gt;html&lt;/a&gt; HTML&amp;nbsp;tutorial...&lt;br&gt;END&lt;/p&gt;</span></div><div class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;'''</span>)</div></pre></td></tr></table></figure></p>
<p><code>feed()</code>方法可以多次调用，也就是不一定一次把整个HTML字符串都塞进去，可以一部分一部分塞进去。特殊字符有两种，一种是用英文表示的<code>&amp;nbsp</code>，一种是用数字表示的<code>&amp;#1234;</code>，这两种字符都可以通过Parser解析出来。</p>
<hr>
<h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><p>urllib提供了一系列用于操作URL的功能。</p>
<h3 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h3><p>urllib的<code>request</code>模块可以非常方便地抓取URL内容，也就是发送一个GET请求到指定的页面，然后返回HTTP的相应：</p>
<p>例如，对豆瓣的一个URL<code>https://api.douban.com/v2/book/2129650</code>进行抓取并返回相应：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib <span class="keyword">import</span> request</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> request.urlopen(<span class="string">'https://api.douban.com/v2/book/2129650'</span>) <span class="keyword">as</span> f:</div><div class="line"><span class="meta">... </span>    dada=f.read()</div><div class="line"><span class="meta">... </span>    print(<span class="string">'Status:'</span>,f.status,f.reason)</div><div class="line"><span class="meta">... </span>    <span class="keyword">for</span> k,v <span class="keyword">in</span> f.getheaders():</div><div class="line"><span class="meta">... </span>            print(<span class="string">'%s:%s'</span> %(k,v))</div><div class="line"><span class="meta">... </span>    print(<span class="string">'Data:'</span>,data.decode(<span class="string">'utf-8'</span>))</div><div class="line">...</div><div class="line">Status: <span class="number">200</span> OK</div><div class="line">Date:Sun, <span class="number">06</span> Nov <span class="number">2016</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">01</span> GMT</div><div class="line">Content-Type:application/json; charset=utf<span class="number">-8</span></div><div class="line">Content-Length:<span class="number">2055</span></div><div class="line">Connection:close</div><div class="line">Vary:Accept-Encoding</div><div class="line">X-Ratelimit-Remaining2:<span class="number">96</span></div><div class="line">X-Ratelimit-Limit2:<span class="number">100</span></div><div class="line">Expires:Sun, <span class="number">1</span> Jan <span class="number">2006</span> <span class="number">01</span>:<span class="number">00</span>:<span class="number">00</span> GMT</div><div class="line">Pragma:no-cache</div><div class="line">Cache-Control:must-revalidate, no-cache, private</div><div class="line">Set-Cookie:bid=L9LbgN0KHkE; Expires=Mon, <span class="number">06</span>-Nov<span class="number">-17</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">01</span> GMT; Domain=.douban.com; Path=/</div><div class="line">X-DOUBAN-NEWBID:L9LbgN0KHkE</div><div class="line">X-DAE-Node:dis16</div><div class="line">X-DAE-App:book</div><div class="line">Server:dae</div><div class="line">Data: &#123;<span class="string">"rating"</span>:&#123;<span class="string">"max"</span>:<span class="number">10</span>,<span class="string">"numRaters"</span>:<span class="number">16</span>,<span class="string">"average"</span>:<span class="string">"7.4"</span>,<span class="string">"min"</span>:<span class="number">0</span>&#125;,<span class="string">"subtitle"</span>:<span class="string">""</span>,<span class="string">"author"</span>:[<span class="string">"廖雪峰编著"</span>],<span class="string">"pubdate"</span>:<span class="string">"2007-6"</span>,<span class="string">"tags"</span>:[&#123;<span class="string">"count"</span>:<span class="number">20</span>,<span class="string">"name"</span>:<span class="string">"spring"</span>,<span class="string">"title"</span>:<span class="string">"spring"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">11</span>,<span class="string">"name"</span>:<span class="string">"Java"</span>,<span class="string">"title"</span>:<span class="string">"Java"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">6</span>,<span class="string">"name"</span>:<span class="string">"javaee"</span>,<span class="string">"title"</span>:<span class="string">"javaee"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">4</span>,<span class="string">"name"</span>:<span class="string">"j2ee"</span>,<span class="string">"title"</span>:<span class="string">"j2ee"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">3</span>,<span class="string">"name"</span>:<span class="string">"POJO"</span>,<span class="string">"title"</span>:<span class="string">"POJO"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">3</span>,<span class="string">"name"</span>:<span class="string">"计算机"</span>,<span class="string">"title"</span>:<span class="string">"计算机"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">3</span>,<span class="string">"name"</span>:<span class="string">"藏书"</span>,<span class="string">"title"</span>:<span class="string">"藏书"</span>&#125;,&#123;<span class="string">"count"</span>:<span class="number">3</span>,<span class="string">"name"</span>:<span class="string">"编程"</span>,<span class="string">"title"</span>:<span class="string">"编程"</span>&#125;],<span class="string">"origin_title"</span>:<span class="string">""</span>,<span class="string">"image"</span>:<span class="string">"https://img3.doubanio.com\/mpic\/s2648230.jpg"</span>,<span class="string">"binding"</span>:<span class="string">""</span>,<span class="string">"translator"</span>:[],<span class="string">"catalog"</span>:<span class="string">""</span>,<span class="string">"pages"</span>:<span class="string">"509"</span>,<span class="string">"images"</span>:&#123;<span class="string">"small"</span>:<span class="string">"https://img3.doubanio.com\/spic\/s2648230.jpg"</span>,<span class="string">"large"</span>:<span class="string">"https://img3.doubanio.com\/lpic\/s2648230.jpg"</span>,<span class="string">"medium"</span>:<span class="string">"https://img3.doubanio.com\/mpic\/s2648230.jpg"</span>&#125;,<span class="string">"alt"</span>:<span class="string">"https:\/\/book.douban.com\/subject\/2129650\/"</span>,<span class="string">"id"</span>:<span class="string">"2129650"</span>,<span class="string">"publisher"</span>:<span class="string">"电子工业"</span>,<span class="string">"isbn10"</span>:<span class="string">"7121042622"</span>,<span class="string">"isbn13"</span>:<span class="string">"9787121042621"</span>,<span class="string">"title"</span>:<span class="string">"Spring 2.0核心技术与最佳实践"</span>,<span class="string">"url"</span>:<span class="string">"https:\/\/api.douban.com\/v2\/book\/2129650"</span>,<span class="string">"alt_title"</span>:<span class="string">""</span>,<span class="string">"author_intro"</span>:<span class="string">""</span>,<span class="string">"summary"</span>:<span class="string">"本书注重实践而又深入 理论，由浅入深且详细介绍了Spring 2.0框架的几乎全部的内容，并重点突出2.0版本的新特性。本书将为读者展示如何应用Spring 2.0框架创建灵活高效的JavaEE应用，并提供了一个真正 可直接部署的完整的Web应用程序——Live在线书店(http:\/\/www.livebookstore.net)。\n在介绍Spring框架的同时，本书还介绍了与Spring相关的大量第三方框架，涉及领域全面，实用 性强。本书另一大特色是实用性强，易于上手，以实际项目为出发点，介绍项目开发中应遵循 的最佳开发模式。\n本书还介绍了大量实践性极强的例子，并给出了完整的配置步骤，几乎覆 盖了Spring 2.0版本的新特性。\n本书适合有一定Java基础的读者，对JavaEE开发人员特别有 帮助。本书既可以作为Spring 2.0的学习指南，也可以作为实际项目开发的参考手册。"</span>,<span class="string">"price"</span>:<span class="string">"59.80元"</span>&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到HTTP相应的头和JSON数据，如果我们要模拟浏览器发送GET请求，就需要使用Request对象，通过往Request对象添加HTTP头，我们就可以把请求伪装成浏览器。例如，模拟iPhone6区请求豆瓣首页：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib <span class="keyword">import</span> request</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>req=request.Request(<span class="string">'http://www.douban.com/'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> request.urlopen(req) <span class="keyword">as</span> f:</div><div class="line"><span class="meta">... </span>    print(<span class="string">'Status:'</span>,f.status, f.reason)</div><div class="line"><span class="meta">... </span>    <span class="keyword">for</span> k,v <span class="keyword">in</span> f.getheaders():</div><div class="line"><span class="meta">... </span>            print(<span class="string">'%s:%s'</span> %(k,v))</div><div class="line"><span class="meta">... </span>    print(<span class="string">'Data:'</span>,f.read().decode(<span class="string">'utf-8'</span>))</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>这样豆瓣就会返回适合iPhone的移动版网页。</p>
<h3 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h3><p>如果要以POST发送一个请求，只需要把参数data以bytes形式传入。</p>
<p>我们模拟一个微博登录，先读取登录的邮箱和口令，然后按照weibo.cn的登录页的格式以<code>username=xxx&amp;password=xxx</code>的编码传入：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, parse</div><div class="line"></div><div class="line">print(<span class="string">'Login to weibo.cn...'</span>)</div><div class="line">email = input(<span class="string">'Email: '</span>)</div><div class="line">passwd = input(<span class="string">'Password: '</span>)</div><div class="line">login_data = parse.urlencode([</div><div class="line">    (<span class="string">'username'</span>, email),</div><div class="line">    (<span class="string">'password'</span>, passwd),</div><div class="line">    (<span class="string">'entry'</span>, <span class="string">'mweibo'</span>),</div><div class="line">    (<span class="string">'client_id'</span>, <span class="string">''</span>),</div><div class="line">    (<span class="string">'savestate'</span>, <span class="string">'1'</span>),</div><div class="line">    (<span class="string">'ec'</span>, <span class="string">''</span>),</div><div class="line">    (<span class="string">'pagerefer'</span>, <span class="string">'https://passport.weibo.cn/signin/welcome?entry=mweibo&amp;r=http%3A%2F%2Fm.weibo.cn%2F'</span>)</div><div class="line">])</div><div class="line"></div><div class="line">req = request.Request(<span class="string">'https://passport.weibo.cn/sso/login'</span>)</div><div class="line">req.add_header(<span class="string">'Origin'</span>, <span class="string">'https://passport.weibo.cn'</span>)</div><div class="line">req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'</span>)</div><div class="line">req.add_header(<span class="string">'Referer'</span>, <span class="string">'https://passport.weibo.cn/signin/login?entry=mweibo&amp;res=wel&amp;wm=3349&amp;r=http%3A%2F%2Fm.weibo.cn%2F'</span>)</div><div class="line"></div><div class="line"><span class="keyword">with</span> request.urlopen(req, data=login_data.encode(<span class="string">'utf-8'</span>)) <span class="keyword">as</span> f:</div><div class="line">    print(<span class="string">'Status:'</span>, f.status, f.reason)</div><div class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> f.getheaders():</div><div class="line">        print(<span class="string">'%s: %s'</span> % (k, v))</div><div class="line">    print(<span class="string">'Data:'</span>, f.read().decode(<span class="string">'utf-8'</span>))</div></pre></td></tr></table></figure></p>
<h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>如果还需要更复杂的控制，比如通过一个Proxy去访问网站，我们需要利用ProxyHandler来处理，实例如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">proxy_handler = urllib.request.ProxyHandler(&#123;<span class="string">'http'</span>: <span class="string">'http://www.example.com:3128/'</span>&#125;)</div><div class="line">proxy_auth_handler = urllib.request.ProxyBasicAuthHandler()</div><div class="line">proxy_auth_handler.add_password(<span class="string">'realm'</span>, <span class="string">'host'</span>, <span class="string">'username'</span>, <span class="string">'password'</span>)</div><div class="line">opener = urllib.request.build_opener(proxy_handler, proxy_auth_handler)</div><div class="line"><span class="keyword">with</span> opener.open(<span class="string">'http://www.example.com/login.html'</span>) <span class="keyword">as</span> f:</div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p>urllib提供的功能就是利用程序去执行各种HTTP请求。如果要模拟浏览器完成特定功能，需要把请求伪装成浏览器。伪装的方法是先监控浏览器发出的请求，再根据浏览器的请求头来伪装，<code>User-Agent</code>头就是用来标示浏览器的。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Donate comment here</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="cdx 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="cdx 支付宝"/>
        <p>支付宝</p>
      </div>
    

    
      <div id="bitcoin" style="display: inline-block">
        <img id="bitcoin_qr" src="/images/bitcoin.png" alt="cdx 比特币"/>
        <p>比特币</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python基础/" rel="tag"># Python基础</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/21/10.正则表达式/" rel="next" title="10. 正则表达式">
                <i class="fa fa-chevron-left"></i> 10. 正则表达式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/21/13.virtualenv&图形界面/" rel="prev" title="13. virtualenv&图形界面">
                13. virtualenv&图形界面 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.gif"
              alt="cdx" />
          
            <p class="site-author-name" itemprop="name">cdx</p>
            <p class="site-description motion-element" itemprop="description">Be a better man!</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">79</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cdx0312" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:cdxu0312@outlook.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#常用内建模块"><span class="nav-number">1.</span> <span class="nav-text">常用内建模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#datetime"><span class="nav-number">1.1.</span> <span class="nav-text">datetime</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#collections"><span class="nav-number">1.2.</span> <span class="nav-text">collections</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#namedtuple"><span class="nav-number">1.2.1.</span> <span class="nav-text">namedtuple</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deque"><span class="nav-number">1.2.2.</span> <span class="nav-text">deque</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defaultdict"><span class="nav-number">1.2.3.</span> <span class="nav-text">defaultdict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderedDict"><span class="nav-number">1.2.4.</span> <span class="nav-text">OrderedDict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Counter"><span class="nav-number">1.2.5.</span> <span class="nav-text">Counter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#base64"><span class="nav-number">1.3.</span> <span class="nav-text">base64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#struct"><span class="nav-number">1.4.</span> <span class="nav-text">struct</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hashlib"><span class="nav-number">1.5.</span> <span class="nav-text">hashlib</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要算法"><span class="nav-number">1.5.1.</span> <span class="nav-text">摘要算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要算法应用"><span class="nav-number">1.5.2.</span> <span class="nav-text">摘要算法应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#itertools"><span class="nav-number">1.6.</span> <span class="nav-text">itertools</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#chain"><span class="nav-number">1.6.1.</span> <span class="nav-text">chain()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#groupby"><span class="nav-number">1.6.2.</span> <span class="nav-text">groupby()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XML"><span class="nav-number">1.7.</span> <span class="nav-text">XML</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DOM-vs-SAX"><span class="nav-number">1.7.1.</span> <span class="nav-text">DOM vs SAX</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTMLParser"><span class="nav-number">1.8.</span> <span class="nav-text">HTMLParser</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#urllib"><span class="nav-number">1.9.</span> <span class="nav-text">urllib</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Get"><span class="nav-number">1.9.1.</span> <span class="nav-text">Get</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Post"><span class="nav-number">1.9.2.</span> <span class="nav-text">Post</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Handler"><span class="nav-number">1.9.3.</span> <span class="nav-text">Handler</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cdx</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
